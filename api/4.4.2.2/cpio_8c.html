<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>rpm: lib/cpio.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul>
</div>
<h1>lib/cpio.c File Reference</h1>Handle cpio payloads within rpm packages. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="system_8h-source.html">system.h</a>&quot;</code><br>
<code>#include &lt;<a class="el" href="rpmio__internal_8h-source.html">rpmio_internal.h</a>&gt;</code><br>
<code>#include &lt;<a class="el" href="rpmlib_8h-source.html">rpmlib.h</a>&gt;</code><br>
<code>#include &quot;<a class="el" href="cpio_8h-source.html">cpio.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="fsm_8h-source.html">fsm.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="rpmerr_8h-source.html">rpmerr.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="debug_8h-source.html">debug.h</a>&quot;</code><br>

<p>
<a href="cpio_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cpio_8c.html#d0b2b3138d2bc4c330cd3bd1005c7fa9">GET_NUM_FIELD</a>(phys, log)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cpio_8c.html#70b0396c0bddba49cd61607425e1e30b">SET_NUM_FIELD</a>(phys, val, space)</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cpio_8c.html#538fed6916d09b74aca1444830a05411">strntoul</a> (const char *str, char **endptr, int base, int num)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert string to unsigned integer (with buffer size check).  <a href="#538fed6916d09b74aca1444830a05411"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cpio_8c.html#9bc52ffb75ef798b4ff5a43e29df9ce1">cpioTrailerWrite</a> (<a class="el" href="structfsm__s.html">FSM_t</a> fsm)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write cpio trailer.  <a href="#9bc52ffb75ef798b4ff5a43e29df9ce1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cpio_8c.html#0364dffab5bf80d3afdaa841da5a497f">cpioHeaderWrite</a> (<a class="el" href="structfsm__s.html">FSM_t</a> fsm, struct stat *st)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write cpio header.  <a href="#0364dffab5bf80d3afdaa841da5a497f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cpio_8c.html#e672b69d8e0ef099707991d463d76164">cpioHeaderRead</a> (<a class="el" href="structfsm__s.html">FSM_t</a> fsm, struct stat *st)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read cpio header.  <a href="#e672b69d8e0ef099707991d463d76164"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">const char *const&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__payload.html#g662f242398346a77fd1d9933053f11ac">cpioStrerror</a> (int rc)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return formatted error message on payload handling failure.  <a href="group__payload.html#g662f242398346a77fd1d9933053f11ac"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Handle cpio payloads within rpm packages. 
<p>
<dl class="warning" compact><dt><b>Warning:</b></dt><dd>FIXME: We don't translate between cpio and system mode bits! These should both be the same, but really odd things are going to happen if that's not true! </dd></dl>

<p>
Definition in file <a class="el" href="cpio_8c-source.html">cpio.c</a>.<hr><h2>Define Documentation</h2>
<a class="anchor" name="d0b2b3138d2bc4c330cd3bd1005c7fa9"></a><!-- doxytag: member="cpio.c::GET_NUM_FIELD" ref="d0b2b3138d2bc4c330cd3bd1005c7fa9" args="(phys, log)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define GET_NUM_FIELD          </td>
          <td>(</td>
          <td class="paramtype">phys,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">log&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="comment">/*@-boundswrite@*/</span> \
        log = <a class="code" href="cpio_8c.html#538fed6916d09b74aca1444830a05411" title="Convert string to unsigned integer (with buffer size check).">strntoul</a>(phys, &amp;end, 16, <span class="keyword">sizeof</span>(phys)); \
        <span class="comment">/*@=boundswrite@*/</span> \
        <span class="keywordflow">if</span> ( (end - phys) != <span class="keyword">sizeof</span>(phys) ) <span class="keywordflow">return</span> <a class="code" href="group__payload.html#gg4dbf9405fc8be17d6ed0d0b606b65a2e492023124653d08dc4f871372bbc0bb1">CPIOERR_BAD_HEADER</a>;
</pre></div>
<p>
Definition at line <a class="el" href="cpio_8c-source.html#l00053">53</a> of file <a class="el" href="cpio_8c-source.html">cpio.c</a>.
<p>
Referenced by <a class="el" href="cpio_8c-source.html#l00130">cpioHeaderRead()</a>.
</div>
</div><p>
<a class="anchor" name="70b0396c0bddba49cd61607425e1e30b"></a><!-- doxytag: member="cpio.c::SET_NUM_FIELD" ref="70b0396c0bddba49cd61607425e1e30b" args="(phys, val, space)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SET_NUM_FIELD          </td>
          <td>(</td>
          <td class="paramtype">phys,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">val,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">space&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Value:</b><div class="fragment"><pre class="fragment">sprintf(space, <span class="stringliteral">"%8.8lx"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) (val)); \
        <span class="comment">/*@-boundsread@*/</span> \
        memcpy(phys, space, 8) \
</pre></div>
<p>
Definition at line <a class="el" href="cpio_8c-source.html#l00058">58</a> of file <a class="el" href="cpio_8c-source.html">cpio.c</a>.
<p>
Referenced by <a class="el" href="cpio_8c-source.html#l00092">cpioHeaderWrite()</a>.
</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="e672b69d8e0ef099707991d463d76164"></a><!-- doxytag: member="cpio.c::cpioHeaderRead" ref="e672b69d8e0ef099707991d463d76164" args="(FSM_t fsm, struct stat *st)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cpioHeaderRead           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfsm__s.html">FSM_t</a>&nbsp;</td>
          <td class="paramname"> <em>fsm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct stat *&nbsp;</td>
          <td class="paramname"> <em>st</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read cpio header. 
<p>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fsm</em>&nbsp;</td><td>file path and stat info </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>st</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success </dd></dl>

<p>
Definition at line <a class="el" href="cpio_8c-source.html#l00130">130</a> of file <a class="el" href="cpio_8c-source.html">cpio.c</a>.
<p>
References <a class="el" href="rpmlib_8h-source.html#l00058">_free()</a>, <a class="el" href="cpio_8h-source.html#l00072">CPIO_CRC_MAGIC</a>, <a class="el" href="cpio_8h-source.html#l00071">CPIO_NEWC_MAGIC</a>, <a class="el" href="cpio_8h-source.html#l00024">CPIOERR_BAD_HEADER</a>, <a class="el" href="cpio_8h-source.html#l00023">CPIOERR_BAD_MAGIC</a>, <a class="el" href="cpio_8h-source.html#l00042">CPIOERR_READ_FAILED</a>, <a class="el" href="cpio_8h-source.html#l00087">cpioCrcPhysicalHeader::devMajor</a>, <a class="el" href="cpio_8h-source.html#l00088">cpioCrcPhysicalHeader::devMinor</a>, <a class="el" href="cpio_8h-source.html#l00086">cpioCrcPhysicalHeader::filesize</a>, <a class="el" href="fsm_8h-source.html#l00078">FSM_DREAD</a>, <a class="el" href="fsm_8c-source.html#l00406">fsmNext()</a>, <a class="el" href="cpio_8c-source.html#l00053">GET_NUM_FIELD</a>, <a class="el" href="cpio_8h-source.html#l00083">cpioCrcPhysicalHeader::gid</a>, <a class="el" href="cpio_8h-source.html#l00080">cpioCrcPhysicalHeader::inode</a>, <a class="el" href="cpio_8h-source.html#l00079">cpioCrcPhysicalHeader::magic</a>, <a class="el" href="system_8h-source.html#l00090">major</a>, <a class="el" href="system_8h-source.html#l00092">makedev</a>, <a class="el" href="system_8h-source.html#l00091">minor</a>, <a class="el" href="cpio_8h-source.html#l00081">cpioCrcPhysicalHeader::mode</a>, <a class="el" href="cpio_8h-source.html#l00085">cpioCrcPhysicalHeader::mtime</a>, <a class="el" href="cpio_8h-source.html#l00091">cpioCrcPhysicalHeader::namesize</a>, <a class="el" href="cpio_8h-source.html#l00084">cpioCrcPhysicalHeader::nlink</a>, <a class="el" href="fsm_8h-source.html#l00126">fsm_s::path</a>, <a class="el" href="cpio_8h-source.html#l00095">PHYS_HDR_SIZE</a>, <a class="el" href="cpio_8h-source.html#l00089">cpioCrcPhysicalHeader::rdevMajor</a>, <a class="el" href="cpio_8h-source.html#l00090">cpioCrcPhysicalHeader::rdevMinor</a>, <a class="el" href="fsm_8h-source.html#l00139">fsm_s::rdnb</a>, <a class="el" href="cpio_8h-source.html#l00082">cpioCrcPhysicalHeader::uid</a>, <a class="el" href="fsm_8h-source.html#l00142">fsm_s::wrbuf</a>, <a class="el" href="fsm_8h-source.html#l00146">fsm_s::wrlen</a>, <a class="el" href="fsm_8h-source.html#l00145">fsm_s::wrsize</a>, and <a class="el" href="rpmmalloc_8c-source.html#l00024">xmalloc()</a>.
</div>
</div><p>
<a class="anchor" name="0364dffab5bf80d3afdaa841da5a497f"></a><!-- doxytag: member="cpio.c::cpioHeaderWrite" ref="0364dffab5bf80d3afdaa841da5a497f" args="(FSM_t fsm, struct stat *st)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cpioHeaderWrite           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfsm__s.html">FSM_t</a>&nbsp;</td>
          <td class="paramname"> <em>fsm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct stat *&nbsp;</td>
          <td class="paramname"> <em>st</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Write cpio header. 
<p>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fsm</em>&nbsp;</td><td>file path and stat info </td></tr>
  </table>
</dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>st</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success </dd></dl>

<p>
Definition at line <a class="el" href="cpio_8c-source.html#l00092">92</a> of file <a class="el" href="cpio_8c-source.html">cpio.c</a>.
<p>
References <a class="el" href="cpio_8h-source.html#l00092">cpioCrcPhysicalHeader::checksum</a>, <a class="el" href="cpio_8h-source.html#l00071">CPIO_NEWC_MAGIC</a>, <a class="el" href="cpio_8h-source.html#l00028">CPIOERR_WRITE_FAILED</a>, <a class="el" href="cpio_8h-source.html#l00087">cpioCrcPhysicalHeader::devMajor</a>, <a class="el" href="cpio_8h-source.html#l00088">cpioCrcPhysicalHeader::devMinor</a>, <a class="el" href="cpio_8h-source.html#l00086">cpioCrcPhysicalHeader::filesize</a>, <a class="el" href="fsm_8h-source.html#l00079">FSM_DWRITE</a>, <a class="el" href="fsm_8h-source.html#l00074">FSM_PAD</a>, <a class="el" href="fsm_8c-source.html#l00406">fsmNext()</a>, <a class="el" href="cpio_8h-source.html#l00083">cpioCrcPhysicalHeader::gid</a>, <a class="el" href="cpio_8h-source.html#l00080">cpioCrcPhysicalHeader::inode</a>, <a class="el" href="cpio_8h-source.html#l00079">cpioCrcPhysicalHeader::magic</a>, <a class="el" href="system_8h-source.html#l00090">major</a>, <a class="el" href="system_8h-source.html#l00091">minor</a>, <a class="el" href="cpio_8h-source.html#l00081">cpioCrcPhysicalHeader::mode</a>, <a class="el" href="cpio_8h-source.html#l00085">cpioCrcPhysicalHeader::mtime</a>, <a class="el" href="cpio_8h-source.html#l00091">cpioCrcPhysicalHeader::namesize</a>, <a class="el" href="cpio_8h-source.html#l00084">cpioCrcPhysicalHeader::nlink</a>, <a class="el" href="fsm_8h-source.html#l00126">fsm_s::path</a>, <a class="el" href="cpio_8h-source.html#l00095">PHYS_HDR_SIZE</a>, <a class="el" href="fsm_8h-source.html#l00134">fsm_s::rdbuf</a>, <a class="el" href="cpio_8h-source.html#l00089">cpioCrcPhysicalHeader::rdevMajor</a>, <a class="el" href="cpio_8h-source.html#l00090">cpioCrcPhysicalHeader::rdevMinor</a>, <a class="el" href="fsm_8h-source.html#l00139">fsm_s::rdnb</a>, <a class="el" href="cpio_8c-source.html#l00058">SET_NUM_FIELD</a>, <a class="el" href="cpio_8h-source.html#l00082">cpioCrcPhysicalHeader::uid</a>, and <a class="el" href="fsm_8h-source.html#l00147">fsm_s::wrnb</a>.
</div>
</div><p>
<a class="anchor" name="9bc52ffb75ef798b4ff5a43e29df9ce1"></a><!-- doxytag: member="cpio.c::cpioTrailerWrite" ref="9bc52ffb75ef798b4ff5a43e29df9ce1" args="(FSM_t fsm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cpioTrailerWrite           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfsm__s.html">FSM_t</a>&nbsp;</td>
          <td class="paramname"> <em>fsm</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Write cpio trailer. 
<p>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fsm</em>&nbsp;</td><td>file path and stat info </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success </dd></dl>

<p>
Definition at line <a class="el" href="cpio_8c-source.html#l00064">64</a> of file <a class="el" href="cpio_8c-source.html">cpio.c</a>.
<p>
References <a class="el" href="cpio_8h-source.html#l00071">CPIO_NEWC_MAGIC</a>, <a class="el" href="cpio_8h-source.html#l00073">CPIO_TRAILER</a>, <a class="el" href="fsm_8h-source.html#l00079">FSM_DWRITE</a>, <a class="el" href="fsm_8h-source.html#l00074">FSM_PAD</a>, <a class="el" href="fsm_8c-source.html#l00406">fsmNext()</a>, <a class="el" href="cpio_8h-source.html#l00095">PHYS_HDR_SIZE</a>, <a class="el" href="fsm_8h-source.html#l00134">fsm_s::rdbuf</a>, and <a class="el" href="fsm_8h-source.html#l00139">fsm_s::rdnb</a>.
</div>
</div><p>
<a class="anchor" name="538fed6916d09b74aca1444830a05411"></a><!-- doxytag: member="cpio.c::strntoul" ref="538fed6916d09b74aca1444830a05411" args="(const char *str, char **endptr, int base, int num)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int strntoul           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>endptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>base</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>num</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Convert string to unsigned integer (with buffer size check). 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>str</em>&nbsp;</td><td>input string </td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>endptr</em>&nbsp;</td><td>address of 1st character not processed </td></tr>
  </table>
</dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>base</em>&nbsp;</td><td>numerical conversion base </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>num</em>&nbsp;</td><td>max no. of bytes to read </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>converted integer </dd></dl>

<p>
Definition at line <a class="el" href="cpio_8c-source.html#l00031">31</a> of file <a class="el" href="cpio_8c-source.html">cpio.c</a>.
<p>
References <a class="el" href="system_8h.html#58ff5c3142f685bf7e95cc0cbfaf49c9">alloca()</a>, and <a class="el" href="file_8h-source.html#l00328">strtoul</a>.
</div>
</div><p>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Oct 12 08:44:55 2007 for rpm by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
