<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>rpm: build/parsePreamble.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul>
</div>
<h1>build/parsePreamble.c</h1><a href="parsePreamble_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00006"></a>00006 <span class="preprocessor">#include "<a class="code" href="system_8h.html">system.h</a>"</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;<a class="code" href="rpmio__internal_8h.html">rpmio_internal.h</a>&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;<a class="code" href="rpmbuild_8h.html" title="This is the *only* module users of librpmbuild should need to include.">rpmbuild.h</a>&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="debug_8h.html">debug.h</a>"</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="comment">/*@access FD_t @*/</span>      <span class="comment">/* compared with NULL */</span>
<a name="l00013"></a>00013 
<a name="l00016"></a>00016 <span class="comment">/*@observer@*/</span> <span class="comment">/*@unchecked@*/</span>
<a name="l00017"></a><a class="code" href="parsePreamble_8c.html#87b7107c80253d2fdcccbda8e2dafdbc">00017</a> <span class="keyword">static</span> <a class="code" href="rpmlib_8h.html#4f08fde948b5511f2a904dc92e39e211">rpmTag</a> <a class="code" href="parsePreamble_8c.html#87b7107c80253d2fdcccbda8e2dafdbc">copyTagsDuringParse</a>[] = {
<a name="l00018"></a>00018     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359165eb02d228815f698f37657343fede4a">RPMTAG_EPOCH</a>,
<a name="l00019"></a>00019     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359183b943078409904e3db2fb07e0dc2fb0">RPMTAG_VERSION</a>,
<a name="l00020"></a>00020     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335910ed74ccfd50c25855a8647eec1dd0576">RPMTAG_RELEASE</a>,
<a name="l00021"></a>00021     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591fce7ed74da9e4e5824d0488dbb16c108">RPMTAG_LICENSE</a>,
<a name="l00022"></a>00022     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591746e308ff00ef1e53d83000f59fc9836">RPMTAG_PACKAGER</a>,
<a name="l00023"></a>00023     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359107dd778a22e1b69cbf57ad4582f3a4e2">RPMTAG_DISTRIBUTION</a>,
<a name="l00024"></a>00024     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359182a5e8043890607cd90e5c36798ad31b">RPMTAG_DISTURL</a>,
<a name="l00025"></a>00025     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591480938ec797288b6844a448448391014">RPMTAG_VENDOR</a>,
<a name="l00026"></a>00026     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335913ba77631b933a85efc7ee29f34175a18">RPMTAG_ICON</a>,
<a name="l00027"></a>00027     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359195103ff02ce93a1f78826a212c392299">RPMTAG_URL</a>,
<a name="l00028"></a>00028     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335917c54bb450d2f49c53fc00e6f9b2da7ee">RPMTAG_CHANGELOGTIME</a>,
<a name="l00029"></a>00029     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591f13b28c7907b2b9a95d6714f1c450c2f">RPMTAG_CHANGELOGNAME</a>,
<a name="l00030"></a>00030     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591e3ebb7f80b999bd09ca7c885d5548001">RPMTAG_CHANGELOGTEXT</a>,
<a name="l00031"></a>00031     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335917d24d8fd69ef9e2343d9b84ee95141a6">RPMTAG_PREFIXES</a>,
<a name="l00032"></a>00032     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591d4d06a4c8216ca2c18cacb754caf4ded">RPMTAG_RHNPLATFORM</a>,
<a name="l00033"></a>00033     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591c7a31c61431d67e03b5b8b938b4344c3">RPMTAG_DISTTAG</a>,
<a name="l00034"></a>00034     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591e6d84beb0c81e0790992d63a3154d872">RPMTAG_CVSID</a>,
<a name="l00035"></a>00035     0
<a name="l00036"></a>00036 };
<a name="l00037"></a>00037 
<a name="l00040"></a>00040 <span class="comment">/*@observer@*/</span> <span class="comment">/*@unchecked@*/</span>
<a name="l00041"></a><a class="code" href="parsePreamble_8c.html#2350baba9e5816a9d89219564077a5dd">00041</a> <span class="keyword">static</span> <a class="code" href="rpmlib_8h.html#4f08fde948b5511f2a904dc92e39e211">rpmTag</a> <a class="code" href="parsePreamble_8c.html#2350baba9e5816a9d89219564077a5dd">requiredTags</a>[] = {
<a name="l00042"></a>00042     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359156c18d1a35fe688a7ffb696e23e83277">RPMTAG_NAME</a>,
<a name="l00043"></a>00043     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359183b943078409904e3db2fb07e0dc2fb0">RPMTAG_VERSION</a>,
<a name="l00044"></a>00044     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335910ed74ccfd50c25855a8647eec1dd0576">RPMTAG_RELEASE</a>,
<a name="l00045"></a>00045     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591bd1d91d5ab5e18336b4ba004b10c1e7c">RPMTAG_SUMMARY</a>,
<a name="l00046"></a>00046     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335915485f21121ce49425dcf4eef0b83caa6">RPMTAG_GROUP</a>,
<a name="l00047"></a>00047     <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591fce7ed74da9e4e5824d0488dbb16c108">RPMTAG_LICENSE</a>,
<a name="l00048"></a>00048     0
<a name="l00049"></a>00049 };
<a name="l00050"></a>00050 
<a name="l00053"></a><a class="code" href="parsePreamble_8c.html#47de3cd5b29a8e7c65235f81ab034d79">00053</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="parsePreamble_8c.html#47de3cd5b29a8e7c65235f81ab034d79">addOrAppendListEntry</a>(<a class="code" href="structheaderToken__s.html" title="The Header data structure.">Header</a> h, <a class="code" href="header_8h.html#ec881c85645bc01204441cbc24e9c025">int_32</a> tag, <span class="keywordtype">char</span> * line)
<a name="l00054"></a>00054         <span class="comment">/*@modifies h @*/</span>
<a name="l00055"></a>00055 {
<a name="l00056"></a>00056     <span class="keywordtype">int</span> xx;
<a name="l00057"></a>00057     <span class="keywordtype">int</span> argc;
<a name="l00058"></a>00058     <span class="keyword">const</span> <span class="keywordtype">char</span> **<a class="code" href="compress_8c.html#a06161d5bbbc977dc1ad9e6669902c5e">argv</a>;
<a name="l00059"></a>00059 
<a name="l00060"></a>00060     xx = poptParseArgvString(line, &amp;argc, &amp;argv);
<a name="l00061"></a>00061     <span class="keywordflow">if</span> (argc)
<a name="l00062"></a>00062         xx = <a class="code" href="group__header.html#g35f1f3d2f8a07673bcb012331efde0aa" title="Add or append element to tag array in header.">headerAddOrAppendEntry</a>(h, tag, <a class="code" href="group__header.html#gg4342aae7379e715a6b927663b340f43c5de16ab5e977fbbb00fff7a70a0ff033">RPM_STRING_ARRAY_TYPE</a>, argv, argc);
<a name="l00063"></a>00063     argv = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(argv);
<a name="l00064"></a>00064 }
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="comment">/* Parse a simple part line that only take -n &lt;pkg&gt; or &lt;pkg&gt; */</span>
<a name="l00067"></a>00067 <span class="comment">/* &lt;pkg&gt; is return in name as a pointer into a static buffer */</span>
<a name="l00068"></a>00068 
<a name="l00071"></a>00071 <span class="comment">/*@-boundswrite@*/</span>
<a name="l00072"></a><a class="code" href="parsePreamble_8c.html#ba6b46b40af8c864440e1c103e16a7ac">00072</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="parsePreamble_8c.html#ba6b46b40af8c864440e1c103e16a7ac">parseSimplePart</a>(<span class="keywordtype">char</span> *line, <span class="comment">/*@out@*/</span><span class="keywordtype">char</span> **<a class="code" href="structname.html">name</a>, <span class="comment">/*@out@*/</span><span class="keywordtype">int</span> *flag)
<a name="l00073"></a>00073         <span class="comment">/*@globals internalState@*/</span>
<a name="l00074"></a>00074         <span class="comment">/*@modifies *name, *flag, internalState @*/</span>
<a name="l00075"></a>00075 {
<a name="l00076"></a>00076     <span class="keywordtype">char</span> *tok;
<a name="l00077"></a>00077     <span class="keywordtype">char</span> linebuf[BUFSIZ];
<a name="l00078"></a>00078     <span class="keyword">static</span> <span class="keywordtype">char</span> buf[BUFSIZ];
<a name="l00079"></a>00079 
<a name="l00080"></a>00080     strcpy(linebuf, line);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082     <span class="comment">/* Throw away the first token (the %xxxx) */</span>
<a name="l00083"></a>00083     (void)strtok(linebuf, <span class="stringliteral">" \t\n"</span>);
<a name="l00084"></a>00084     
<a name="l00085"></a>00085     <span class="keywordflow">if</span> (!(tok = strtok(NULL, <span class="stringliteral">" \t\n"</span>))) {
<a name="l00086"></a>00086         *name = NULL;
<a name="l00087"></a>00087         <span class="keywordflow">return</span> 0;
<a name="l00088"></a>00088     }
<a name="l00089"></a>00089     
<a name="l00090"></a>00090     <span class="keywordflow">if</span> (!strcmp(tok, <span class="stringliteral">"-n"</span>)) {
<a name="l00091"></a>00091         <span class="keywordflow">if</span> (!(tok = strtok(NULL, <span class="stringliteral">" \t\n"</span>)))
<a name="l00092"></a>00092             <span class="keywordflow">return</span> 1;
<a name="l00093"></a>00093         *flag = <a class="code" href="rpmbuild_8h.html#3b605c6b6a8a74a0bef68b4b938b4310">PART_NAME</a>;
<a name="l00094"></a>00094     } <span class="keywordflow">else</span> {
<a name="l00095"></a>00095         *flag = <a class="code" href="rpmbuild_8h.html#8668beb22148fe50b4d29a1c6f591b9a">PART_SUBNAME</a>;
<a name="l00096"></a>00096     }
<a name="l00097"></a>00097     strcpy(buf, tok);
<a name="l00098"></a>00098     *name = buf;
<a name="l00099"></a>00099 
<a name="l00100"></a>00100     <span class="keywordflow">return</span> (strtok(NULL, <span class="stringliteral">" \t\n"</span>)) ? 1 : 0;
<a name="l00101"></a>00101 }
<a name="l00102"></a>00102 <span class="comment">/*@=boundswrite@*/</span>
<a name="l00103"></a>00103 
<a name="l00106"></a><a class="code" href="parsePreamble_8c.html#4f6edbfdfb6039a32c65a59cbf8d3d96">00106</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="parsePreamble_8c.html#4f6edbfdfb6039a32c65a59cbf8d3d96">parseYesNo</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * s)
<a name="l00107"></a>00107         <span class="comment">/*@*/</span>
<a name="l00108"></a>00108 {
<a name="l00109"></a>00109     <span class="keywordflow">return</span> ((!s || (s[0] == <span class="charliteral">'n'</span> || s[0] == <span class="charliteral">'N'</span> || s[0] == <span class="charliteral">'0'</span>) ||
<a name="l00110"></a>00110         !<a class="code" href="group__rpmio.html#g12f9067ffd342363435f7022b4f3111e" title="Locale insensitive strcasecmp(3).">xstrcasecmp</a>(s, <span class="stringliteral">"false"</span>) || !<a class="code" href="group__rpmio.html#g12f9067ffd342363435f7022b4f3111e" title="Locale insensitive strcasecmp(3).">xstrcasecmp</a>(s, <span class="stringliteral">"off"</span>))
<a name="l00111"></a>00111             ? 0 : 1);
<a name="l00112"></a>00112 }
<a name="l00113"></a>00113 
<a name="l00114"></a><a class="code" href="structtokenBits__s.html">00114</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structtokenBits__s.html">tokenBits_s</a> {
<a name="l00115"></a>00115 <span class="comment">/*@observer@*/</span> <span class="comment">/*@null@*/</span>
<a name="l00116"></a><a class="code" href="structtokenBits__s.html#73855973213a4ace26777a7b62253a0b">00116</a>     <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="structname.html">name</a>;
<a name="l00117"></a><a class="code" href="structtokenBits__s.html#809099bad1dfde3a62955ee9ec7f2661">00117</a>     <a class="code" href="rpmlib_8h.html#59d9132cc8d54f9ff20570cc67438071" title="Dependency Attributes.">rpmsenseFlags</a> <a class="code" href="structtokenBits__s.html#809099bad1dfde3a62955ee9ec7f2661">bits</a>;
<a name="l00118"></a>00118 } * <a class="code" href="structtokenBits__s.html">tokenBits</a>;
<a name="l00119"></a>00119 
<a name="l00122"></a>00122 <span class="comment">/*@observer@*/</span> <span class="comment">/*@unchecked@*/</span>
<a name="l00123"></a><a class="code" href="parsePreamble_8c.html#f9fb127f2effbc02f0065585d8e8f6f5">00123</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtokenBits__s.html">tokenBits_s</a> <a class="code" href="parsePreamble_8c.html#f9fb127f2effbc02f0065585d8e8f6f5">installScriptBits</a>[] = {
<a name="l00124"></a>00124     { <span class="stringliteral">"interp"</span>,         <a class="code" href="rpmlib_8h.html#4e838340e1a594afcd39d47b94b27095437a1f60dc287c4799619404458b0cc1">RPMSENSE_INTERP</a> },
<a name="l00125"></a>00125     { <span class="stringliteral">"prereq"</span>,         <a class="code" href="rpmlib_8h.html#4e838340e1a594afcd39d47b94b27095fb0834643e81a8f0c9859fb173361f3d">RPMSENSE_PREREQ</a> },
<a name="l00126"></a>00126     { <span class="stringliteral">"preun"</span>,          <a class="code" href="rpmlib_8h.html#4e838340e1a594afcd39d47b94b27095a9dcfed7db2fe22892e2669eca9cea19">RPMSENSE_SCRIPT_PREUN</a> },
<a name="l00127"></a>00127     { <span class="stringliteral">"pre"</span>,            <a class="code" href="rpmlib_8h.html#4e838340e1a594afcd39d47b94b27095fb1591704e0e310209b112ed60bcedf4">RPMSENSE_SCRIPT_PRE</a> },
<a name="l00128"></a>00128     { <span class="stringliteral">"postun"</span>,         <a class="code" href="rpmlib_8h.html#4e838340e1a594afcd39d47b94b270959ab8b382fc5c2abc49b898e83be59c72">RPMSENSE_SCRIPT_POSTUN</a> },
<a name="l00129"></a>00129     { <span class="stringliteral">"post"</span>,           <a class="code" href="rpmlib_8h.html#4e838340e1a594afcd39d47b94b2709521ea0f711a1905522e450b1be7d72617">RPMSENSE_SCRIPT_POST</a> },
<a name="l00130"></a>00130     { <span class="stringliteral">"rpmlib"</span>,         <a class="code" href="rpmlib_8h.html#4e838340e1a594afcd39d47b94b27095885ce24fb4e9a92be55275f533362f76">RPMSENSE_RPMLIB</a> },
<a name="l00131"></a>00131     { <span class="stringliteral">"verify"</span>,         <a class="code" href="rpmlib_8h.html#4e838340e1a594afcd39d47b94b270952a8ae6e71283ee2963de18d4f9afa08f">RPMSENSE_SCRIPT_VERIFY</a> },
<a name="l00132"></a>00132     { NULL, 0 }
<a name="l00133"></a>00133 };
<a name="l00134"></a>00134 
<a name="l00137"></a>00137 <span class="comment">/*@observer@*/</span> <span class="comment">/*@unchecked@*/</span>
<a name="l00138"></a><a class="code" href="parsePreamble_8c.html#54c81a5ae9beef99b563e7466befe700">00138</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtokenBits__s.html">tokenBits_s</a> <a class="code" href="parsePreamble_8c.html#54c81a5ae9beef99b563e7466befe700">buildScriptBits</a>[] = {
<a name="l00139"></a>00139     { <span class="stringliteral">"prep"</span>,           <a class="code" href="rpmlib_8h.html#4e838340e1a594afcd39d47b94b27095c2b0f0ac252e6e93a32e6a5da3deb505">RPMSENSE_SCRIPT_PREP</a> },
<a name="l00140"></a>00140     { <span class="stringliteral">"build"</span>,          <a class="code" href="rpmlib_8h.html#4e838340e1a594afcd39d47b94b27095fc2927f90a16712573077edaa117faa1">RPMSENSE_SCRIPT_BUILD</a> },
<a name="l00141"></a>00141     { <span class="stringliteral">"install"</span>,        <a class="code" href="rpmlib_8h.html#4e838340e1a594afcd39d47b94b2709520d1edf71679beb4f39bd80dd1f1d88d">RPMSENSE_SCRIPT_INSTALL</a> },
<a name="l00142"></a>00142     { <span class="stringliteral">"clean"</span>,          <a class="code" href="rpmlib_8h.html#4e838340e1a594afcd39d47b94b2709535a374a46bdc11707970d7a3abce516b">RPMSENSE_SCRIPT_CLEAN</a> },
<a name="l00143"></a>00143     { NULL, 0 }
<a name="l00144"></a>00144 };
<a name="l00145"></a>00145 
<a name="l00148"></a>00148 <span class="comment">/*@-boundswrite@*/</span>
<a name="l00149"></a><a class="code" href="parsePreamble_8c.html#f35735f64dc5bae036ebc0ccac94a65b">00149</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="parsePreamble_8c.html#f35735f64dc5bae036ebc0ccac94a65b">parseBits</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * s, <span class="keyword">const</span> <a class="code" href="structtokenBits__s.html">tokenBits</a> tokbits,
<a name="l00150"></a>00150                 <span class="comment">/*@out@*/</span> <a class="code" href="rpmlib_8h.html#59d9132cc8d54f9ff20570cc67438071" title="Dependency Attributes.">rpmsenseFlags</a> * bp)
<a name="l00151"></a>00151         <span class="comment">/*@modifies *bp @*/</span>
<a name="l00152"></a>00152 {
<a name="l00153"></a>00153     <a class="code" href="structtokenBits__s.html">tokenBits</a> tb;
<a name="l00154"></a>00154     <span class="keyword">const</span> <span class="keywordtype">char</span> * se;
<a name="l00155"></a>00155     <a class="code" href="rpmlib_8h.html#59d9132cc8d54f9ff20570cc67438071" title="Dependency Attributes.">rpmsenseFlags</a> <a class="code" href="structtokenBits__s.html#809099bad1dfde3a62955ee9ec7f2661">bits</a> = <a class="code" href="rpmlib_8h.html#4e838340e1a594afcd39d47b94b27095cc820446dae032500d79201d59b1d824">RPMSENSE_ANY</a>;
<a name="l00156"></a>00156     <span class="keywordtype">int</span> c = 0;
<a name="l00157"></a>00157 
<a name="l00158"></a>00158     <span class="keywordflow">if</span> (s) {
<a name="l00159"></a>00159         <span class="keywordflow">while</span> (*s != <span class="charliteral">'\0'</span>) {
<a name="l00160"></a>00160             <span class="keywordflow">while</span> ((c = *s) &amp;&amp; <a class="code" href="stringbuf_8c.html#93a4309d5a0aa72a3e749ed3a5347ae1" title="Locale insensitive isspace(3).">xisspace</a>(c)) s++;
<a name="l00161"></a>00161             se = s;
<a name="l00162"></a>00162             <span class="keywordflow">while</span> ((c = *se) &amp;&amp; <a class="code" href="rpmio_8h.html#a910cf932e70fbf9fb60c074cb30baec">xisalpha</a>(c)) se++;
<a name="l00163"></a>00163             <span class="keywordflow">if</span> (s == se)
<a name="l00164"></a>00164                 <span class="keywordflow">break</span>;
<a name="l00165"></a>00165             <span class="keywordflow">for</span> (tb = tokbits; tb-&gt;<a class="code" href="structtokenBits__s.html#73855973213a4ace26777a7b62253a0b">name</a>; tb++) {
<a name="l00166"></a>00166                 <span class="keywordflow">if</span> (tb-&gt;<a class="code" href="structtokenBits__s.html#73855973213a4ace26777a7b62253a0b">name</a> != NULL &amp;&amp;
<a name="l00167"></a>00167                     strlen(tb-&gt;<a class="code" href="structtokenBits__s.html#73855973213a4ace26777a7b62253a0b">name</a>) == (se-s) &amp;&amp; !strncmp(tb-&gt;<a class="code" href="structtokenBits__s.html#73855973213a4ace26777a7b62253a0b">name</a>, s, (se-s)))
<a name="l00168"></a>00168                     <span class="comment">/*@innerbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00169"></a>00169             }
<a name="l00170"></a>00170             <span class="keywordflow">if</span> (tb-&gt;<a class="code" href="structtokenBits__s.html#73855973213a4ace26777a7b62253a0b">name</a> == NULL)
<a name="l00171"></a>00171                 <span class="keywordflow">break</span>;
<a name="l00172"></a>00172             bits |= tb-&gt;<a class="code" href="structtokenBits__s.html#809099bad1dfde3a62955ee9ec7f2661">bits</a>;
<a name="l00173"></a>00173             while ((c = *se) &amp;&amp; <a class="code" href="stringbuf_8c.html#93a4309d5a0aa72a3e749ed3a5347ae1" title="Locale insensitive isspace(3).">xisspace</a>(c)) se++;
<a name="l00174"></a>00174             <span class="keywordflow">if</span> (c != <span class="charliteral">','</span>)
<a name="l00175"></a>00175                 <span class="keywordflow">break</span>;
<a name="l00176"></a>00176             s = ++se;
<a name="l00177"></a>00177         }
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179     <span class="keywordflow">if</span> (c == 0 &amp;&amp; bp) *bp = bits;
<a name="l00180"></a>00180     <span class="keywordflow">return</span> (c ? <a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a> : 0);
<a name="l00181"></a>00181 }
<a name="l00182"></a>00182 <span class="comment">/*@=boundswrite@*/</span>
<a name="l00183"></a>00183 
<a name="l00186"></a><a class="code" href="parsePreamble_8c.html#8b7f1acdf17082bef5dc738e3bad03a6">00186</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">char</span> * <a class="code" href="parsePreamble_8c.html#8b7f1acdf17082bef5dc738e3bad03a6">findLastChar</a>(<span class="keywordtype">char</span> * s)
<a name="l00187"></a>00187         <span class="comment">/*@*/</span>
<a name="l00188"></a>00188 {
<a name="l00189"></a>00189     <span class="keywordtype">char</span> *res = s;
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 <span class="comment">/*@-boundsread@*/</span>
<a name="l00192"></a>00192     <span class="keywordflow">while</span> (*s != <span class="charliteral">'\0'</span>) {
<a name="l00193"></a>00193         <span class="keywordflow">if</span> (! <a class="code" href="stringbuf_8c.html#93a4309d5a0aa72a3e749ed3a5347ae1" title="Locale insensitive isspace(3).">xisspace</a>(*s))
<a name="l00194"></a>00194             res = s;
<a name="l00195"></a>00195         s++;
<a name="l00196"></a>00196     }
<a name="l00197"></a>00197 <span class="comment">/*@=boundsread@*/</span>
<a name="l00198"></a>00198 
<a name="l00199"></a>00199     <span class="comment">/*@-temptrans -retalias@*/</span>
<a name="l00200"></a>00200     <span class="keywordflow">return</span> res;
<a name="l00201"></a>00201     <span class="comment">/*@=temptrans =retalias@*/</span>
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 
<a name="l00206"></a><a class="code" href="parsePreamble_8c.html#a61d42aeefb241f00c70e28739697291">00206</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="parsePreamble_8c.html#a61d42aeefb241f00c70e28739697291">isMemberInEntry</a>(<a class="code" href="structheaderToken__s.html" title="The Header data structure.">Header</a> h, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structname.html">name</a>, <a class="code" href="rpmlib_8h.html#4f08fde948b5511f2a904dc92e39e211">rpmTag</a> tag)
<a name="l00207"></a>00207         <span class="comment">/*@*/</span>
<a name="l00208"></a>00208 {
<a name="l00209"></a>00209     <a class="code" href="rpmlib_8h.html#96d4b4739a1c6b1f0d1d73229a4ed1bf" title="Prototype for headerGetEntry() vector.">HGE_t</a> hge = (<a class="code" href="rpmlib_8h.html#96d4b4739a1c6b1f0d1d73229a4ed1bf" title="Prototype for headerGetEntry() vector.">HGE_t</a>)<a class="code" href="group__header.html#g29996e73fee54b49b34246121494cbf1" title="Retrieve tag value using header internal array.">headerGetEntryMinMemory</a>;
<a name="l00210"></a>00210     <a class="code" href="rpmlib_8h.html#b1e25001ce073d55e9fa97a3ad2213e8" title="Prototype for headerFreeData() vector.">HFD_t</a> hfd = <a class="code" href="group__header.html#ga2c977519b09cb7bf16f9765ec29d079" title="Free data allocated when retrieved from header.">headerFreeData</a>;
<a name="l00211"></a>00211     <span class="keyword">const</span> <span class="keywordtype">char</span> ** <a class="code" href="structnames.html">names</a>;
<a name="l00212"></a>00212     <a class="code" href="group__header.html#g30546f70b72fe13929f6e388dfd29b16" title="The basic types of data in tags from headers.">rpmTagType</a> type;
<a name="l00213"></a>00213     <span class="keywordtype">int</span> count;
<a name="l00214"></a>00214 
<a name="l00215"></a>00215     <span class="keywordflow">if</span> (!hge(h, tag, &amp;type, (<span class="keywordtype">void</span> **)&amp;names, &amp;count))
<a name="l00216"></a>00216         <span class="keywordflow">return</span> -1;
<a name="l00217"></a>00217 <span class="comment">/*@-boundsread@*/</span>
<a name="l00218"></a>00218     <span class="keywordflow">while</span> (count--) {
<a name="l00219"></a>00219         <span class="keywordflow">if</span> (!<a class="code" href="group__rpmio.html#g12f9067ffd342363435f7022b4f3111e" title="Locale insensitive strcasecmp(3).">xstrcasecmp</a>(names[count], name))
<a name="l00220"></a>00220             <span class="keywordflow">break</span>;
<a name="l00221"></a>00221     }
<a name="l00222"></a>00222     names = hfd(names, type);
<a name="l00223"></a>00223 <span class="comment">/*@=boundsread@*/</span>
<a name="l00224"></a>00224     <span class="keywordflow">return</span> (count &gt;= 0 ? 1 : 0);
<a name="l00225"></a>00225 }
<a name="l00226"></a>00226 
<a name="l00229"></a><a class="code" href="parsePreamble_8c.html#8c71013579f01223484cefdf3534a5c7">00229</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="parsePreamble_8c.html#8c71013579f01223484cefdf3534a5c7">checkForValidArchitectures</a>(<a class="code" href="structSpec__s.html" title="The structure used to store values parsed from a spec file.">Spec</a> spec)
<a name="l00230"></a>00230         <span class="comment">/*@*/</span>
<a name="l00231"></a>00231 {
<a name="l00232"></a>00232 <span class="preprocessor">#ifndef DYING</span>
<a name="l00233"></a>00233 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *arch = NULL;
<a name="l00234"></a>00234     <span class="keyword">const</span> <span class="keywordtype">char</span> *os = NULL;
<a name="l00235"></a>00235 
<a name="l00236"></a>00236     <a class="code" href="group__rpmrc.html#g2b4cfbbe4bda6838539b5b34be47abc8" title="Return current arch name and/or number.">rpmGetArchInfo</a>(&amp;arch, NULL);
<a name="l00237"></a>00237     <a class="code" href="group__rpmrc.html#g62b6de6717b6dfbdbfe2a338cacda5ea" title="Return current os name and/or number.">rpmGetOsInfo</a>(&amp;os, NULL);
<a name="l00238"></a>00238 <span class="preprocessor">#else</span>
<a name="l00239"></a>00239 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *arch = <a class="code" href="macro_8c.html#0dba4b275f1c8f96b8dae9537a8aa3cf" title="Return (malloc'ed) concatenated macro expansion(s).">rpmExpand</a>(<span class="stringliteral">"%{_target_cpu}"</span>, NULL);
<a name="l00240"></a>00240     <span class="keyword">const</span> <span class="keywordtype">char</span> *os = <a class="code" href="macro_8c.html#0dba4b275f1c8f96b8dae9537a8aa3cf" title="Return (malloc'ed) concatenated macro expansion(s).">rpmExpand</a>(<span class="stringliteral">"%{_target_os}"</span>, NULL);
<a name="l00241"></a>00241 <span class="preprocessor">#endif</span>
<a name="l00242"></a>00242 <span class="preprocessor"></span>    
<a name="l00243"></a>00243     <span class="keywordflow">if</span> (<a class="code" href="parsePreamble_8c.html#a61d42aeefb241f00c70e28739697291">isMemberInEntry</a>(spec-&gt;<a class="code" href="structSpec__s.html#6971ea3f633365c1451a806d359fd7ff">buildRestrictions</a>,
<a name="l00244"></a>00244                         arch, <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335916cbff6a7273d68eb904e5f5493eeda4c">RPMTAG_EXCLUDEARCH</a>) == 1) {
<a name="l00245"></a>00245         <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"Architecture is excluded: %s\n"</span>), arch);
<a name="l00246"></a>00246         <span class="keywordflow">return</span> <a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>;
<a name="l00247"></a>00247     }
<a name="l00248"></a>00248     <span class="keywordflow">if</span> (<a class="code" href="parsePreamble_8c.html#a61d42aeefb241f00c70e28739697291">isMemberInEntry</a>(spec-&gt;<a class="code" href="structSpec__s.html#6971ea3f633365c1451a806d359fd7ff">buildRestrictions</a>,
<a name="l00249"></a>00249                         arch, <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591ba325caacc4ba79b8497af54d063274f">RPMTAG_EXCLUSIVEARCH</a>) == 0) {
<a name="l00250"></a>00250         <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"Architecture is not included: %s\n"</span>), arch);
<a name="l00251"></a>00251         <span class="keywordflow">return</span> <a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>;
<a name="l00252"></a>00252     }
<a name="l00253"></a>00253     <span class="keywordflow">if</span> (<a class="code" href="parsePreamble_8c.html#a61d42aeefb241f00c70e28739697291">isMemberInEntry</a>(spec-&gt;<a class="code" href="structSpec__s.html#6971ea3f633365c1451a806d359fd7ff">buildRestrictions</a>,
<a name="l00254"></a>00254                         os, <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335910fc7a5b5cf7eb7284a1fd9d17eb5716b">RPMTAG_EXCLUDEOS</a>) == 1) {
<a name="l00255"></a>00255         <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"OS is excluded: %s\n"</span>), os);
<a name="l00256"></a>00256         <span class="keywordflow">return</span> <a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>;
<a name="l00257"></a>00257     }
<a name="l00258"></a>00258     <span class="keywordflow">if</span> (<a class="code" href="parsePreamble_8c.html#a61d42aeefb241f00c70e28739697291">isMemberInEntry</a>(spec-&gt;<a class="code" href="structSpec__s.html#6971ea3f633365c1451a806d359fd7ff">buildRestrictions</a>,
<a name="l00259"></a>00259                         os, <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591ae7c7614b41896b499c4d6a1616d62a3">RPMTAG_EXCLUSIVEOS</a>) == 0) {
<a name="l00260"></a>00260         <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"OS is not included: %s\n"</span>), os);
<a name="l00261"></a>00261         <span class="keywordflow">return</span> <a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>;
<a name="l00262"></a>00262     }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264     <span class="keywordflow">return</span> 0;
<a name="l00265"></a>00265 }
<a name="l00266"></a>00266 
<a name="l00273"></a><a class="code" href="parsePreamble_8c.html#fee822405e5c0e419766551b2fa41a04">00273</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="parsePreamble_8c.html#fee822405e5c0e419766551b2fa41a04" title="Check that required tags are present in header.">checkForRequired</a>(<a class="code" href="structheaderToken__s.html" title="The Header data structure.">Header</a> h, <span class="keyword">const</span> <span class="keywordtype">char</span> * NVR)
<a name="l00274"></a>00274         <span class="comment">/*@modifies h @*/</span> <span class="comment">/* LCL: parse error here with modifies */</span>
<a name="l00275"></a>00275 {
<a name="l00276"></a>00276     <span class="keywordtype">int</span> res = 0;
<a name="l00277"></a>00277     <a class="code" href="rpmlib_8h.html#4f08fde948b5511f2a904dc92e39e211">rpmTag</a> * p;
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 <span class="comment">/*@-boundsread@*/</span>
<a name="l00280"></a>00280     <span class="keywordflow">for</span> (p = <a class="code" href="parsePreamble_8c.html#2350baba9e5816a9d89219564077a5dd">requiredTags</a>; *p != 0; p++) {
<a name="l00281"></a>00281         <span class="keywordflow">if</span> (!<a class="code" href="group__header.html#g66b9abc5d3555279d547656ec0a2f245" title="Check if tag is in header.">headerIsEntry</a>(h, *p)) {
<a name="l00282"></a>00282             <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>,
<a name="l00283"></a>00283                         <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"%s field must be present in package: %s\n"</span>),
<a name="l00284"></a>00284                         <a class="code" href="rpmlib_8h.html#3a61a67f93831144b44b4f43cc718320" title="Return tag name from value.">tagName</a>(*p), NVR);
<a name="l00285"></a>00285             res = 1;
<a name="l00286"></a>00286         }
<a name="l00287"></a>00287     }
<a name="l00288"></a>00288 <span class="comment">/*@=boundsread@*/</span>
<a name="l00289"></a>00289 
<a name="l00290"></a>00290     <span class="keywordflow">return</span> res;
<a name="l00291"></a>00291 }
<a name="l00292"></a>00292 
<a name="l00299"></a><a class="code" href="parsePreamble_8c.html#92f0348d8bfd0fb088d922e6ed8c21f6">00299</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="parsePreamble_8c.html#92f0348d8bfd0fb088d922e6ed8c21f6" title="Check that no duplicate tags are present in header.">checkForDuplicates</a>(<a class="code" href="structheaderToken__s.html" title="The Header data structure.">Header</a> h, <span class="keyword">const</span> <span class="keywordtype">char</span> * NVR)
<a name="l00300"></a>00300         <span class="comment">/*@modifies h @*/</span>
<a name="l00301"></a>00301 {
<a name="l00302"></a>00302     <span class="keywordtype">int</span> res = 0;
<a name="l00303"></a>00303     <span class="keywordtype">int</span> lastTag, tag;
<a name="l00304"></a>00304     <a class="code" href="structheaderIterator__s.html" title="Header tag iterator data structure.">HeaderIterator</a> hi;
<a name="l00305"></a>00305     
<a name="l00306"></a>00306     <span class="keywordflow">for</span> (hi = <a class="code" href="group__header.html#g73b92dc996fcd304549391ec96b9b508" title="Create header tag iterator.">headerInitIterator</a>(h), lastTag = 0;
<a name="l00307"></a>00307         <a class="code" href="group__header.html#gfc9c79d37b24eebb38d4028649b8fce5" title="Return next tag from header.">headerNextIterator</a>(hi, &amp;tag, NULL, NULL, NULL);
<a name="l00308"></a>00308         lastTag = tag)
<a name="l00309"></a>00309     {
<a name="l00310"></a>00310         <span class="keywordflow">if</span> (tag != lastTag)
<a name="l00311"></a>00311             <span class="keywordflow">continue</span>;
<a name="l00312"></a>00312         <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"Duplicate %s entries in package: %s\n"</span>),
<a name="l00313"></a>00313                      <a class="code" href="rpmlib_8h.html#3a61a67f93831144b44b4f43cc718320" title="Return tag name from value.">tagName</a>(tag), NVR);
<a name="l00314"></a>00314         res = 1;
<a name="l00315"></a>00315     }
<a name="l00316"></a>00316     hi = <a class="code" href="group__header.html#g1bcc86556d43ec9631979f37089fc93f" title="Destroy header tag iterator.">headerFreeIterator</a>(hi);
<a name="l00317"></a>00317 
<a name="l00318"></a>00318     <span class="keywordflow">return</span> res;
<a name="l00319"></a>00319 }
<a name="l00320"></a>00320 
<a name="l00323"></a>00323 <span class="comment">/*@observer@*/</span> <span class="comment">/*@unchecked@*/</span>
<a name="l00324"></a><a class="code" href="structoptionalTag.html">00324</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structoptionalTag.html">optionalTag</a> {
<a name="l00325"></a><a class="code" href="structoptionalTag.html#470a5ba2104627188f9222c1cda84741">00325</a>     <a class="code" href="rpmlib_8h.html#4f08fde948b5511f2a904dc92e39e211">rpmTag</a>      <a class="code" href="structoptionalTag.html#470a5ba2104627188f9222c1cda84741">ot_tag</a>;
<a name="l00326"></a>00326 <span class="comment">/*@observer@*/</span> <span class="comment">/*@null@*/</span>
<a name="l00327"></a><a class="code" href="structoptionalTag.html#d426c54367ee2359a2ddb0120f5728da">00327</a>     <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="structoptionalTag.html#d426c54367ee2359a2ddb0120f5728da">ot_mac</a>;
<a name="l00328"></a>00328 } <a class="code" href="parsePreamble_8c.html#de9e61844f1abbbf679952b11581ce28">optionalTags</a>[] = {
<a name="l00329"></a>00329     { <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591480938ec797288b6844a448448391014">RPMTAG_VENDOR</a>,            <span class="stringliteral">"%{vendor}"</span> },
<a name="l00330"></a>00330     { <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591746e308ff00ef1e53d83000f59fc9836">RPMTAG_PACKAGER</a>,          <span class="stringliteral">"%{packager}"</span> },
<a name="l00331"></a>00331     { <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359107dd778a22e1b69cbf57ad4582f3a4e2">RPMTAG_DISTRIBUTION</a>,      <span class="stringliteral">"%{distribution}"</span> },
<a name="l00332"></a>00332     { <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359182a5e8043890607cd90e5c36798ad31b">RPMTAG_DISTURL</a>,           <span class="stringliteral">"%{disturl}"</span> },
<a name="l00333"></a>00333     { -1, NULL }
<a name="l00334"></a>00334 };
<a name="l00335"></a>00335 
<a name="l00338"></a><a class="code" href="parsePreamble_8c.html#0025e0c45b3f742b24769cedee82b787">00338</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="parsePreamble_8c.html#0025e0c45b3f742b24769cedee82b787">fillOutMainPackage</a>(<a class="code" href="structheaderToken__s.html" title="The Header data structure.">Header</a> h)
<a name="l00339"></a>00339         <span class="comment">/*@globals rpmGlobalMacroContext, h_errno @*/</span>
<a name="l00340"></a>00340         <span class="comment">/*@modifies h, rpmGlobalMacroContext @*/</span>
<a name="l00341"></a>00341 {
<a name="l00342"></a>00342     <span class="keyword">struct </span><a class="code" href="structoptionalTag.html">optionalTag</a> *ot;
<a name="l00343"></a>00343 
<a name="l00344"></a>00344     <span class="keywordflow">for</span> (ot = <a class="code" href="parsePreamble_8c.html#de9e61844f1abbbf679952b11581ce28">optionalTags</a>; ot-&gt;<a class="code" href="structoptionalTag.html#d426c54367ee2359a2ddb0120f5728da">ot_mac</a> != NULL; ot++) {
<a name="l00345"></a>00345         <span class="keywordflow">if</span> (!<a class="code" href="group__header.html#g66b9abc5d3555279d547656ec0a2f245" title="Check if tag is in header.">headerIsEntry</a>(h, ot-&gt;<a class="code" href="structoptionalTag.html#470a5ba2104627188f9222c1cda84741">ot_tag</a>)) {
<a name="l00346"></a>00346 <span class="comment">/*@-boundsread@*/</span>
<a name="l00347"></a>00347             <span class="keyword">const</span> <span class="keywordtype">char</span> *val = <a class="code" href="macro_8c.html#0dba4b275f1c8f96b8dae9537a8aa3cf" title="Return (malloc'ed) concatenated macro expansion(s).">rpmExpand</a>(ot-&gt;<a class="code" href="structoptionalTag.html#d426c54367ee2359a2ddb0120f5728da">ot_mac</a>, NULL);
<a name="l00348"></a>00348             if (val &amp;&amp; *val != <span class="charliteral">'%'</span>)
<a name="l00349"></a>00349                 (<span class="keywordtype">void</span>) <a class="code" href="group__header.html#g176a0175a522214ae4fffa162728a5f8" title="Add tag to header.">headerAddEntry</a>(h, ot-&gt;<a class="code" href="structoptionalTag.html#470a5ba2104627188f9222c1cda84741">ot_tag</a>, <a class="code" href="group__header.html#gg4342aae7379e715a6b927663b340f43cfe25304f92990326ba5c31d4ced5a84d">RPM_STRING_TYPE</a>, (<span class="keywordtype">void</span> *)val, 1);
<a name="l00350"></a>00350             val = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(val);
<a name="l00351"></a>00351 <span class="comment">/*@=boundsread@*/</span>
<a name="l00352"></a>00352         }
<a name="l00353"></a>00353     }
<a name="l00354"></a>00354 }
<a name="l00355"></a>00355 
<a name="l00358"></a>00358 <span class="comment">/*@-boundswrite@*/</span>
<a name="l00359"></a><a class="code" href="parsePreamble_8c.html#3156e830e103c91cb7b3c90d6d6dd359">00359</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="parsePreamble_8c.html#3156e830e103c91cb7b3c90d6d6dd359">readIcon</a>(<a class="code" href="structheaderToken__s.html" title="The Header data structure.">Header</a> h, <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="parseFiles_8c.html#4f4da8b93048dccc588f5ddc4d7e1561">file</a>)
<a name="l00360"></a>00360         <span class="comment">/*@globals rpmGlobalMacroContext, h_errno, fileSystem, internalState @*/</span>
<a name="l00361"></a>00361         <span class="comment">/*@modifies h, rpmGlobalMacroContext, fileSystem, internalState  @*/</span>
<a name="l00362"></a>00362 {
<a name="l00363"></a>00363     <span class="keyword">const</span> <span class="keywordtype">char</span> *fn = NULL;
<a name="l00364"></a>00364     <span class="keywordtype">char</span> *icon;
<a name="l00365"></a>00365     <a class="code" href="struct__FD__s.html" title="The FD_t File Handle data structure.">FD_t</a> fd;
<a name="l00366"></a>00366     <span class="keywordtype">int</span> rc = 0;
<a name="l00367"></a>00367     off_t size;
<a name="l00368"></a>00368     <span class="keywordtype">size_t</span> nb, iconsize;
<a name="l00369"></a>00369 
<a name="l00370"></a>00370     <span class="comment">/* XXX use rpmGenPath(rootdir, "%{_sourcedir}/", file) for icon path. */</span>
<a name="l00371"></a>00371     fn = <a class="code" href="macro_8c.html#1bce9a7d7c5c5833d2eda2dcaa761bd5" title="Return (malloc'ed) expanded, canonicalized, file path.">rpmGetPath</a>(<span class="stringliteral">"%{_sourcedir}/"</span>, file, NULL);
<a name="l00372"></a>00372 
<a name="l00373"></a>00373     fd = <a class="code" href="rpmio_8c.html#89bd8d7de2b3d1944f570fc2d2d7470a" title="fopen(3) clone.">Fopen</a>(fn, <span class="stringliteral">"r.ufdio"</span>);
<a name="l00374"></a>00374     <span class="keywordflow">if</span> (fd == NULL || <a class="code" href="rpmio_8c.html#5c33b1522107db905bc2e243e8715b7b" title="ferror(3) clone.">Ferror</a>(fd)) {
<a name="l00375"></a>00375         <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"Unable to open icon %s: %s\n"</span>),
<a name="l00376"></a>00376                 fn, <a class="code" href="rpmio_8c.html#89912365365ef408f46a76f2958fc78c" title="strerror(3) clone.">Fstrerror</a>(fd));
<a name="l00377"></a>00377         rc = RPMERR_BADSPEC;
<a name="l00378"></a>00378         <span class="keywordflow">goto</span> exit;
<a name="l00379"></a>00379     }
<a name="l00380"></a>00380     size = <a class="code" href="rpmio_8c.html#1fa5444b2f4f7abbafdd768036b62fec">fdSize</a>(fd);
<a name="l00381"></a>00381     iconsize = (size &gt;= 0 ? size : (8 * BUFSIZ));
<a name="l00382"></a>00382     <span class="keywordflow">if</span> (iconsize == 0) {
<a name="l00383"></a>00383         (void) <a class="code" href="rpmio_8c.html#df9d9b5146b0155f3629c50a5fbb3cb8" title="fclose(3) clone.">Fclose</a>(fd);
<a name="l00384"></a>00384         rc = 0;
<a name="l00385"></a>00385         <span class="keywordflow">goto</span> exit;
<a name="l00386"></a>00386     }
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     icon = <a class="code" href="system_8h.html#2ff4ef58da7e543466e75f20f2a2d8b7">xmalloc</a>(iconsize + 1);
<a name="l00389"></a>00389     *icon = <span class="charliteral">'\0'</span>;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391     nb = <a class="code" href="rpmio_8c.html#243fbe7e1cc405489b11045e43e20207" title="fread(3) clone.">Fread</a>(icon, <span class="keyword">sizeof</span>(icon[0]), iconsize, fd);
<a name="l00392"></a>00392     <span class="keywordflow">if</span> (<a class="code" href="rpmio_8c.html#5c33b1522107db905bc2e243e8715b7b" title="ferror(3) clone.">Ferror</a>(fd) || (size &gt;= 0 &amp;&amp; nb != size)) {
<a name="l00393"></a>00393         <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"Unable to read icon %s: %s\n"</span>),
<a name="l00394"></a>00394                 fn, <a class="code" href="rpmio_8c.html#89912365365ef408f46a76f2958fc78c" title="strerror(3) clone.">Fstrerror</a>(fd));
<a name="l00395"></a>00395         rc = RPMERR_BADSPEC;
<a name="l00396"></a>00396     }
<a name="l00397"></a>00397     (void) <a class="code" href="rpmio_8c.html#df9d9b5146b0155f3629c50a5fbb3cb8" title="fclose(3) clone.">Fclose</a>(fd);
<a name="l00398"></a>00398     <span class="keywordflow">if</span> (rc)
<a name="l00399"></a>00399         <span class="keywordflow">goto</span> exit;
<a name="l00400"></a>00400 
<a name="l00401"></a>00401     <span class="keywordflow">if</span> (! strncmp(icon, <span class="stringliteral">"GIF"</span>, <span class="keyword">sizeof</span>(<span class="stringliteral">"GIF"</span>)-1)) {
<a name="l00402"></a>00402         (void) <a class="code" href="group__header.html#g176a0175a522214ae4fffa162728a5f8" title="Add tag to header.">headerAddEntry</a>(h, <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335910938ea61006a4a6778994e7987b9c60a">RPMTAG_GIF</a>, <a class="code" href="group__header.html#gg4342aae7379e715a6b927663b340f43ce200877bfddf86d67887ae94caa2ab20">RPM_BIN_TYPE</a>, icon, iconsize);
<a name="l00403"></a>00403     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp(icon, <span class="stringliteral">"/* XPM"</span>, <span class="keyword">sizeof</span>(<span class="stringliteral">"/* XPM"</span>)-1)) {
<a name="l00404"></a>00404         (void) <a class="code" href="group__header.html#g176a0175a522214ae4fffa162728a5f8" title="Add tag to header.">headerAddEntry</a>(h, <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591578d80fc0e4bf4fc9da904a62f9acb1f">RPMTAG_XPM</a>, <a class="code" href="group__header.html#gg4342aae7379e715a6b927663b340f43ce200877bfddf86d67887ae94caa2ab20">RPM_BIN_TYPE</a>, icon, iconsize);
<a name="l00405"></a>00405     } <span class="keywordflow">else</span> {
<a name="l00406"></a>00406         <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"Unknown icon type: %s\n"</span>), file);
<a name="l00407"></a>00407         rc = <a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>;
<a name="l00408"></a>00408         <span class="keywordflow">goto</span> exit;
<a name="l00409"></a>00409     }
<a name="l00410"></a>00410     icon = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(icon);
<a name="l00411"></a>00411     
<a name="l00412"></a>00412 exit:
<a name="l00413"></a>00413     fn = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(fn);
<a name="l00414"></a>00414     <span class="keywordflow">return</span> rc;
<a name="l00415"></a>00415 }
<a name="l00416"></a>00416 <span class="comment">/*@=boundswrite@*/</span>
<a name="l00417"></a>00417 
<a name="l00418"></a><a class="code" href="group__rpmbuild.html#g3366fb4ff1a916edfd80645caa60a014">00418</a> <a class="code" href="structspectag__s.html">spectag</a> <a class="code" href="group__rpmbuild.html#g3366fb4ff1a916edfd80645caa60a014" title="spec file control structure">stashSt</a>(<a class="code" href="structSpec__s.html" title="The structure used to store values parsed from a spec file.">Spec</a> spec, <a class="code" href="structheaderToken__s.html" title="The Header data structure.">Header</a> h, <span class="keywordtype">int</span> tag, <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="parseDescription_8c.html#b2fc255429d1174065838ae9702d12b1">lang</a>)
<a name="l00419"></a>00419 {
<a name="l00420"></a>00420     <a class="code" href="rpmlib_8h.html#96d4b4739a1c6b1f0d1d73229a4ed1bf" title="Prototype for headerGetEntry() vector.">HGE_t</a> hge = (<a class="code" href="rpmlib_8h.html#96d4b4739a1c6b1f0d1d73229a4ed1bf" title="Prototype for headerGetEntry() vector.">HGE_t</a>)<a class="code" href="group__header.html#g29996e73fee54b49b34246121494cbf1" title="Retrieve tag value using header internal array.">headerGetEntryMinMemory</a>;
<a name="l00421"></a>00421     <a class="code" href="structspectag__s.html">spectag</a> t = NULL;
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     <span class="keywordflow">if</span> (spec-&gt;<a class="code" href="structSpec__s.html#79c8d93efa234640e8340e32b4d0c5ca">st</a>) {
<a name="l00424"></a>00424         <a class="code" href="structspectags__s.html">spectags</a> st = spec-&gt;<a class="code" href="structSpec__s.html#79c8d93efa234640e8340e32b4d0c5ca">st</a>;
<a name="l00425"></a>00425         <span class="keywordflow">if</span> (st-&gt;<a class="code" href="structspectags__s.html#21369137314add350710d6569d3f7298">st_ntags</a> == st-&gt;<a class="code" href="structspectags__s.html#82d7366cb8d144629b8a7d3c865c1bf9">st_nalloc</a>) {
<a name="l00426"></a>00426             st-&gt;<a class="code" href="structspectags__s.html#82d7366cb8d144629b8a7d3c865c1bf9">st_nalloc</a> += 10;
<a name="l00427"></a>00427             st-&gt;<a class="code" href="structspectags__s.html#3adc0c0f77e35dbbea9377780406f8b1">st_t</a> = <a class="code" href="system_8h.html#089316e2770f7e09a135f7128241af8a">xrealloc</a>(st-&gt;<a class="code" href="structspectags__s.html#3adc0c0f77e35dbbea9377780406f8b1">st_t</a>, st-&gt;<a class="code" href="structspectags__s.html#82d7366cb8d144629b8a7d3c865c1bf9">st_nalloc</a> * <span class="keyword">sizeof</span>(*(st-&gt;<a class="code" href="structspectags__s.html#3adc0c0f77e35dbbea9377780406f8b1">st_t</a>)));
<a name="l00428"></a>00428         }
<a name="l00429"></a>00429         t = st-&gt;<a class="code" href="structspectags__s.html#3adc0c0f77e35dbbea9377780406f8b1">st_t</a> + st-&gt;<a class="code" href="structspectags__s.html#21369137314add350710d6569d3f7298">st_ntags</a>++;
<a name="l00430"></a>00430         t-&gt;<a class="code" href="structspectag__s.html#6f3776fce9cc672f46675960642711e4">t_tag</a> = tag;
<a name="l00431"></a>00431         t-&gt;<a class="code" href="structspectag__s.html#a59c66fe7993d27b0d20cc24bdccd3a6">t_startx</a> = spec-&gt;<a class="code" href="structSpec__s.html#f11d8c7aaa2b4fc86b775a920d3fd319">lineNum</a> - 1;
<a name="l00432"></a>00432         t-&gt;<a class="code" href="structspectag__s.html#48ee096bee59ddc608f16c94a6daf412">t_nlines</a> = 1;
<a name="l00433"></a>00433         t-&gt;<a class="code" href="structspectag__s.html#3cf1adaa73be872cd00f3ffe9fa04a92">t_lang</a> = <a class="code" href="system_8h.html#700bf3013e33311eacdd1f20d13bdc9a">xstrdup</a>(lang);
<a name="l00434"></a>00434         t-&gt;<a class="code" href="structspectag__s.html#f11cfa2e26ddca745fbfd31da14ad3af">t_msgid</a> = NULL;
<a name="l00435"></a>00435         <span class="keywordflow">if</span> (!(t-&gt;<a class="code" href="structspectag__s.html#3cf1adaa73be872cd00f3ffe9fa04a92">t_lang</a> &amp;&amp; strcmp(t-&gt;<a class="code" href="structspectag__s.html#3cf1adaa73be872cd00f3ffe9fa04a92">t_lang</a>, <a class="code" href="rpmspec_8h.html#9b6c70d9e5d4215bdc8dc68a41d64f82">RPMBUILD_DEFAULT_LANG</a>))) {
<a name="l00436"></a>00436             <span class="keywordtype">char</span> *n;
<a name="l00437"></a>00437             <span class="keywordflow">if</span> (hge(h, <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359156c18d1a35fe688a7ffb696e23e83277">RPMTAG_NAME</a>, NULL, (<span class="keywordtype">void</span> **) &amp;n, NULL)) {
<a name="l00438"></a>00438                 <span class="keywordtype">char</span> buf[1024];
<a name="l00439"></a>00439                 sprintf(buf, <span class="stringliteral">"%s(%s)"</span>, n, <a class="code" href="rpmlib_8h.html#3a61a67f93831144b44b4f43cc718320" title="Return tag name from value.">tagName</a>(tag));
<a name="l00440"></a>00440                 t-&gt;<a class="code" href="structspectag__s.html#f11cfa2e26ddca745fbfd31da14ad3af">t_msgid</a> = <a class="code" href="system_8h.html#700bf3013e33311eacdd1f20d13bdc9a">xstrdup</a>(buf);
<a name="l00441"></a>00441             }
<a name="l00442"></a>00442         }
<a name="l00443"></a>00443     }
<a name="l00444"></a>00444     <span class="comment">/*@-usereleased -compdef@*/</span>
<a name="l00445"></a>00445     <span class="keywordflow">return</span> t;
<a name="l00446"></a>00446     <span class="comment">/*@=usereleased =compdef@*/</span>
<a name="l00447"></a>00447 }
<a name="l00448"></a>00448 
<a name="l00449"></a><a class="code" href="parsePreamble_8c.html#c2768a7d3541548040daea617087621d">00449</a> <span class="preprocessor">#define SINGLE_TOKEN_ONLY \</span>
<a name="l00450"></a>00450 <span class="preprocessor">if (multiToken) { \</span>
<a name="l00451"></a>00451 <span class="preprocessor">    rpmError(RPMERR_BADSPEC, _("line %d: Tag takes single token only: %s\n"), \</span>
<a name="l00452"></a>00452 <span class="preprocessor">             spec-&gt;lineNum, spec-&gt;line); \</span>
<a name="l00453"></a>00453 <span class="preprocessor">    return RPMERR_BADSPEC; \</span>
<a name="l00454"></a>00454 <span class="preprocessor">}</span>
<a name="l00455"></a>00455 <span class="preprocessor"></span>
<a name="l00456"></a>00456 <span class="comment">/*@-redecl@*/</span>
<a name="l00457"></a>00457 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="parseDescription_8c.html#c2a43016d59983551b2ef34696d4fcbe">noLang</a>;
<a name="l00458"></a>00458 <span class="comment">/*@=redecl@*/</span>
<a name="l00459"></a>00459 
<a name="l00462"></a>00462 <span class="comment">/*@-boundswrite@*/</span>
<a name="l00463"></a><a class="code" href="parsePreamble_8c.html#8b41acf8aced6f85722ec2c5cb1fcc3f">00463</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="parsePreamble_8c.html#8b41acf8aced6f85722ec2c5cb1fcc3f">handlePreambleTag</a>(<a class="code" href="structSpec__s.html" title="The structure used to store values parsed from a spec file.">Spec</a> spec, <a class="code" href="structPackage__s.html" title="The structure used to store values for a package.">Package</a> pkg, <a class="code" href="rpmlib_8h.html#4f08fde948b5511f2a904dc92e39e211">rpmTag</a> tag,
<a name="l00464"></a>00464                 <span class="keyword">const</span> <span class="keywordtype">char</span> *macro, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="parseDescription_8c.html#b2fc255429d1174065838ae9702d12b1">lang</a>)
<a name="l00465"></a>00465         <span class="comment">/*@globals rpmGlobalMacroContext, h_errno, fileSystem, internalState @*/</span>
<a name="l00466"></a>00466         <span class="comment">/*@modifies spec-&gt;macros, spec-&gt;st, spec-&gt;buildRootURL,</span>
<a name="l00467"></a>00467 <span class="comment">                spec-&gt;sources, spec-&gt;numSources, spec-&gt;noSource,</span>
<a name="l00468"></a>00468 <span class="comment">                spec-&gt;buildRestrictions, spec-&gt;BANames, spec-&gt;BACount,</span>
<a name="l00469"></a>00469 <span class="comment">                spec-&gt;line, spec-&gt;gotBuildRootURL,</span>
<a name="l00470"></a>00470 <span class="comment">                pkg-&gt;header, pkg-&gt;autoProv, pkg-&gt;autoReq, pkg-&gt;icon,</span>
<a name="l00471"></a>00471 <span class="comment">                rpmGlobalMacroContext, fileSystem, internalState @*/</span>
<a name="l00472"></a>00472 {
<a name="l00473"></a>00473     <a class="code" href="rpmlib_8h.html#96d4b4739a1c6b1f0d1d73229a4ed1bf" title="Prototype for headerGetEntry() vector.">HGE_t</a> hge = (<a class="code" href="rpmlib_8h.html#96d4b4739a1c6b1f0d1d73229a4ed1bf" title="Prototype for headerGetEntry() vector.">HGE_t</a>)<a class="code" href="group__header.html#g29996e73fee54b49b34246121494cbf1" title="Retrieve tag value using header internal array.">headerGetEntryMinMemory</a>;
<a name="l00474"></a>00474     <a class="code" href="rpmlib_8h.html#b1e25001ce073d55e9fa97a3ad2213e8" title="Prototype for headerFreeData() vector.">HFD_t</a> hfd = <a class="code" href="group__header.html#ga2c977519b09cb7bf16f9765ec29d079" title="Free data allocated when retrieved from header.">headerFreeData</a>;
<a name="l00475"></a>00475     <span class="keywordtype">char</span> * field = spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a>;
<a name="l00476"></a>00476     <span class="keywordtype">char</span> * end;
<a name="l00477"></a>00477     <span class="keywordtype">char</span> ** array;
<a name="l00478"></a>00478     <span class="keywordtype">int</span> multiToken = 0;
<a name="l00479"></a>00479     <a class="code" href="rpmlib_8h.html#59d9132cc8d54f9ff20570cc67438071" title="Dependency Attributes.">rpmsenseFlags</a> tagflags;
<a name="l00480"></a>00480     <a class="code" href="group__header.html#g30546f70b72fe13929f6e388dfd29b16" title="The basic types of data in tags from headers.">rpmTagType</a> type;
<a name="l00481"></a>00481     <span class="keywordtype">int</span> len;
<a name="l00482"></a>00482     <span class="keywordtype">int</span> num;
<a name="l00483"></a>00483     <span class="keywordtype">int</span> rc;
<a name="l00484"></a>00484     <span class="keywordtype">int</span> xx;
<a name="l00485"></a>00485     
<a name="l00486"></a>00486     <span class="keywordflow">if</span> (field == NULL) <span class="keywordflow">return</span> <a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>;   <span class="comment">/* XXX can't happen */</span>
<a name="l00487"></a>00487     <span class="comment">/* Find the start of the "field" and strip trailing space */</span>
<a name="l00488"></a>00488     <span class="keywordflow">while</span> ((*field) &amp;&amp; (*field != <span class="charliteral">':'</span>))
<a name="l00489"></a>00489         field++;
<a name="l00490"></a>00490     <span class="keywordflow">if</span> (*field != <span class="charliteral">':'</span>) {
<a name="l00491"></a>00491         <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"line %d: Malformed tag: %s\n"</span>),
<a name="l00492"></a>00492                  spec-&gt;<a class="code" href="structSpec__s.html#f11d8c7aaa2b4fc86b775a920d3fd319">lineNum</a>, spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a>);
<a name="l00493"></a>00493         <span class="keywordflow">return</span> <a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>;
<a name="l00494"></a>00494     }
<a name="l00495"></a>00495     field++;
<a name="l00496"></a>00496     <a class="code" href="rpmbuild_8h.html#8f81069c22bebb175ee6c1524590c93c">SKIPSPACE</a>(field);
<a name="l00497"></a>00497     <span class="keywordflow">if</span> (!*field) {
<a name="l00498"></a>00498         <span class="comment">/* Empty field */</span>
<a name="l00499"></a>00499         <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"line %d: Empty tag: %s\n"</span>),
<a name="l00500"></a>00500                  spec-&gt;<a class="code" href="structSpec__s.html#f11d8c7aaa2b4fc86b775a920d3fd319">lineNum</a>, spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a>);
<a name="l00501"></a>00501         <span class="keywordflow">return</span> RPMERR_BADSPEC;
<a name="l00502"></a>00502     }
<a name="l00503"></a>00503     end = <a class="code" href="parsePreamble_8c.html#8b7f1acdf17082bef5dc738e3bad03a6">findLastChar</a>(field);
<a name="l00504"></a>00504     *(end+1) = <span class="charliteral">'\0'</span>;
<a name="l00505"></a>00505 
<a name="l00506"></a>00506     <span class="comment">/* See if this is multi-token */</span>
<a name="l00507"></a>00507     end = field;
<a name="l00508"></a>00508     <a class="code" href="rpmbuild_8h.html#4738e29db8464eed47843e99635acb18">SKIPNONSPACE</a>(end);
<a name="l00509"></a>00509     <span class="keywordflow">if</span> (*end != <span class="charliteral">'\0'</span>)
<a name="l00510"></a>00510         multiToken = 1;
<a name="l00511"></a>00511 
<a name="l00512"></a>00512     <span class="keywordflow">switch</span> (tag) {
<a name="l00513"></a>00513     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359156c18d1a35fe688a7ffb696e23e83277">RPMTAG_NAME</a>:
<a name="l00514"></a>00514     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359183b943078409904e3db2fb07e0dc2fb0">RPMTAG_VERSION</a>:
<a name="l00515"></a>00515     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335910ed74ccfd50c25855a8647eec1dd0576">RPMTAG_RELEASE</a>:
<a name="l00516"></a>00516     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359195103ff02ce93a1f78826a212c392299">RPMTAG_URL</a>:
<a name="l00517"></a>00517     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591d4d06a4c8216ca2c18cacb754caf4ded">RPMTAG_RHNPLATFORM</a>:
<a name="l00518"></a>00518     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591c7a31c61431d67e03b5b8b938b4344c3">RPMTAG_DISTTAG</a>:
<a name="l00519"></a>00519     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591e6d84beb0c81e0790992d63a3154d872">RPMTAG_CVSID</a>:
<a name="l00520"></a>00520         <a class="code" href="parsePreamble_8c.html#c2768a7d3541548040daea617087621d">SINGLE_TOKEN_ONLY</a>;
<a name="l00521"></a>00521         <span class="comment">/* These macros are for backward compatibility */</span>
<a name="l00522"></a>00522         <span class="keywordflow">if</span> (tag == <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359183b943078409904e3db2fb07e0dc2fb0">RPMTAG_VERSION</a>) {
<a name="l00523"></a>00523             <span class="keywordflow">if</span> (strchr(field, <span class="charliteral">'-'</span>) != NULL) {
<a name="l00524"></a>00524                 <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"line %d: Illegal char '-' in %s: %s\n"</span>),
<a name="l00525"></a>00525                     spec-&gt;<a class="code" href="structSpec__s.html#f11d8c7aaa2b4fc86b775a920d3fd319">lineNum</a>, <span class="stringliteral">"version"</span>, spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a>);
<a name="l00526"></a>00526                 <span class="keywordflow">return</span> RPMERR_BADSPEC;
<a name="l00527"></a>00527             }
<a name="l00528"></a>00528             <a class="code" href="macro_8c.html#3851992697896dc8ed8f0be8ca6ec3e4" title="Add macro to context.">addMacro</a>(spec-&gt;<a class="code" href="structSpec__s.html#a6ba79a7deb05c10860fc4870fd7434d">macros</a>, <span class="stringliteral">"PACKAGE_VERSION"</span>, NULL, field, <a class="code" href="rpmmacro_8h.html#a46c45ed62aa0d2bd40507daf95acd65">RMIL_OLDSPEC</a>);
<a name="l00529"></a>00529         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335910ed74ccfd50c25855a8647eec1dd0576">RPMTAG_RELEASE</a>) {
<a name="l00530"></a>00530             <span class="keywordflow">if</span> (strchr(field, <span class="charliteral">'-'</span>) != NULL) {
<a name="l00531"></a>00531                 <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"line %d: Illegal char '-' in %s: %s\n"</span>),
<a name="l00532"></a>00532                     spec-&gt;<a class="code" href="structSpec__s.html#f11d8c7aaa2b4fc86b775a920d3fd319">lineNum</a>, <span class="stringliteral">"release"</span>, spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a>);
<a name="l00533"></a>00533                 <span class="keywordflow">return</span> RPMERR_BADSPEC;
<a name="l00534"></a>00534             }
<a name="l00535"></a>00535             <a class="code" href="macro_8c.html#3851992697896dc8ed8f0be8ca6ec3e4" title="Add macro to context.">addMacro</a>(spec-&gt;<a class="code" href="structSpec__s.html#a6ba79a7deb05c10860fc4870fd7434d">macros</a>, <span class="stringliteral">"PACKAGE_RELEASE"</span>, NULL, field, <a class="code" href="rpmmacro_8h.html#a46c45ed62aa0d2bd40507daf95acd65">RMIL_OLDSPEC</a>-1);
<a name="l00536"></a>00536         }
<a name="l00537"></a>00537         (void) <a class="code" href="group__header.html#g176a0175a522214ae4fffa162728a5f8" title="Add tag to header.">headerAddEntry</a>(pkg-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>, tag, <a class="code" href="group__header.html#gg4342aae7379e715a6b927663b340f43cfe25304f92990326ba5c31d4ced5a84d">RPM_STRING_TYPE</a>, field, 1);
<a name="l00538"></a>00538         <span class="keywordflow">break</span>;
<a name="l00539"></a>00539     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335915485f21121ce49425dcf4eef0b83caa6">RPMTAG_GROUP</a>:
<a name="l00540"></a>00540     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591bd1d91d5ab5e18336b4ba004b10c1e7c">RPMTAG_SUMMARY</a>:
<a name="l00541"></a>00541         (void) <a class="code" href="group__rpmbuild.html#g3366fb4ff1a916edfd80645caa60a014" title="spec file control structure">stashSt</a>(spec, pkg-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>, tag, lang);
<a name="l00542"></a>00542         <span class="comment">/*@fallthrough@*/</span>
<a name="l00543"></a>00543     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359107dd778a22e1b69cbf57ad4582f3a4e2">RPMTAG_DISTRIBUTION</a>:
<a name="l00544"></a>00544     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591480938ec797288b6844a448448391014">RPMTAG_VENDOR</a>:
<a name="l00545"></a>00545     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591fce7ed74da9e4e5824d0488dbb16c108">RPMTAG_LICENSE</a>:
<a name="l00546"></a>00546     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591746e308ff00ef1e53d83000f59fc9836">RPMTAG_PACKAGER</a>:
<a name="l00547"></a>00547         <span class="keywordflow">if</span> (!*lang)
<a name="l00548"></a>00548             (void) <a class="code" href="group__header.html#g176a0175a522214ae4fffa162728a5f8" title="Add tag to header.">headerAddEntry</a>(pkg-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>, tag, <a class="code" href="group__header.html#gg4342aae7379e715a6b927663b340f43cfe25304f92990326ba5c31d4ced5a84d">RPM_STRING_TYPE</a>, field, 1);
<a name="l00549"></a>00549         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(<a class="code" href="parseDescription_8c.html#c2a43016d59983551b2ef34696d4fcbe">noLang</a> &amp;&amp; strcmp(lang, <a class="code" href="rpmspec_8h.html#9b6c70d9e5d4215bdc8dc68a41d64f82">RPMBUILD_DEFAULT_LANG</a>)))
<a name="l00550"></a>00550             (void) <a class="code" href="group__header.html#gf8e62855815c7ea2563c55ddcdffe2f4" title="Add locale specific tag to header.">headerAddI18NString</a>(pkg-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>, tag, field, lang);
<a name="l00551"></a>00551         <span class="keywordflow">break</span>;
<a name="l00552"></a>00552     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335910b02d2c14a0d5843914580ec742e7926">RPMTAG_BUILDROOT</a>:
<a name="l00553"></a>00553         <a class="code" href="parsePreamble_8c.html#c2768a7d3541548040daea617087621d">SINGLE_TOKEN_ONLY</a>;
<a name="l00554"></a>00554       { <span class="keyword">const</span> <span class="keywordtype">char</span> * buildRoot = NULL;
<a name="l00555"></a>00555         <span class="keyword">const</span> <span class="keywordtype">char</span> * buildRootURL = spec-&gt;<a class="code" href="structSpec__s.html#e5e372fa94803e9d0ca3a75b74925f6f">buildRootURL</a>;
<a name="l00556"></a>00556 
<a name="l00557"></a>00557         <span class="comment">/*</span>
<a name="l00558"></a>00558 <span class="comment">         * Note: rpmGenPath should guarantee a "canonical" path. That means</span>
<a name="l00559"></a>00559 <span class="comment">         * that the following pathologies should be weeded out:</span>
<a name="l00560"></a>00560 <span class="comment">         *          //bin//sh</span>
<a name="l00561"></a>00561 <span class="comment">         *          //usr//bin/</span>
<a name="l00562"></a>00562 <span class="comment">         *          /.././../usr/../bin//./sh</span>
<a name="l00563"></a>00563 <span class="comment">         */</span>
<a name="l00564"></a>00564         <span class="keywordflow">if</span> (buildRootURL == NULL) {
<a name="l00565"></a>00565             buildRootURL = <a class="code" href="macro_8c.html#5705f5a076ff34aeb4966048adafd360" title="Merge 3 args into path, any or all of which may be a url.">rpmGenPath</a>(NULL, <span class="stringliteral">"%{?buildroot:%{buildroot}}"</span>, NULL);
<a name="l00566"></a>00566             <span class="keywordflow">if</span> (strcmp(buildRootURL, <span class="stringliteral">"/"</span>)) {
<a name="l00567"></a>00567                 spec-&gt;<a class="code" href="structSpec__s.html#e5e372fa94803e9d0ca3a75b74925f6f">buildRootURL</a> = buildRootURL;
<a name="l00568"></a>00568                 macro = NULL;
<a name="l00569"></a>00569             } <span class="keywordflow">else</span> {
<a name="l00570"></a>00570                 <span class="keyword">const</span> <span class="keywordtype">char</span> * specURL = field;
<a name="l00571"></a>00571 
<a name="l00572"></a>00572                 buildRootURL = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(buildRootURL);
<a name="l00573"></a>00573                 (void) <a class="code" href="rpmurl_8h.html#35492e2be1d0a9376b9b0d29512dab4d" title="Return path component of URL.">urlPath</a>(specURL, (<span class="keyword">const</span> <span class="keywordtype">char</span> **)&amp;field);
<a name="l00574"></a>00574                 <span class="comment">/*@-branchstate@*/</span>
<a name="l00575"></a>00575                 <span class="keywordflow">if</span> (*field == <span class="charliteral">'\0'</span>) field = <span class="stringliteral">"/"</span>;
<a name="l00576"></a>00576                 <span class="comment">/*@=branchstate@*/</span>
<a name="l00577"></a>00577                 buildRootURL = <a class="code" href="macro_8c.html#5705f5a076ff34aeb4966048adafd360" title="Merge 3 args into path, any or all of which may be a url.">rpmGenPath</a>(spec-&gt;<a class="code" href="structSpec__s.html#8038917cd6b1804cddc3812127b95125">rootURL</a>, field, NULL);
<a name="l00578"></a>00578                 spec-&gt;<a class="code" href="structSpec__s.html#e5e372fa94803e9d0ca3a75b74925f6f">buildRootURL</a> = buildRootURL;
<a name="l00579"></a>00579                 field = (<span class="keywordtype">char</span> *) buildRootURL;
<a name="l00580"></a>00580             }
<a name="l00581"></a>00581             spec-&gt;<a class="code" href="structSpec__s.html#50d744ecb106a091e13b9885cafe0f51">gotBuildRootURL</a> = 1;
<a name="l00582"></a>00582         } <span class="keywordflow">else</span> {
<a name="l00583"></a>00583             macro = NULL;
<a name="l00584"></a>00584         }
<a name="l00585"></a>00585         buildRootURL = <a class="code" href="macro_8c.html#5705f5a076ff34aeb4966048adafd360" title="Merge 3 args into path, any or all of which may be a url.">rpmGenPath</a>(NULL, spec-&gt;<a class="code" href="structSpec__s.html#e5e372fa94803e9d0ca3a75b74925f6f">buildRootURL</a>, NULL);
<a name="l00586"></a>00586         (void) <a class="code" href="rpmurl_8h.html#35492e2be1d0a9376b9b0d29512dab4d" title="Return path component of URL.">urlPath</a>(buildRootURL, &amp;buildRoot);
<a name="l00587"></a>00587         <span class="comment">/*@-branchstate@*/</span>
<a name="l00588"></a>00588         <span class="keywordflow">if</span> (*buildRoot == <span class="charliteral">'\0'</span>) buildRoot = <span class="stringliteral">"/"</span>;
<a name="l00589"></a>00589         <span class="comment">/*@=branchstate@*/</span>
<a name="l00590"></a>00590         <span class="keywordflow">if</span> (!strcmp(buildRoot, <span class="stringliteral">"/"</span>)) {
<a name="l00591"></a>00591             <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>,
<a name="l00592"></a>00592                      <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"BuildRoot can not be \"/\": %s\n"</span>), spec-&gt;<a class="code" href="structSpec__s.html#e5e372fa94803e9d0ca3a75b74925f6f">buildRootURL</a>);
<a name="l00593"></a>00593             buildRootURL = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(buildRootURL);
<a name="l00594"></a>00594             <span class="keywordflow">return</span> <a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>;
<a name="l00595"></a>00595         }
<a name="l00596"></a>00596         buildRootURL = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(buildRootURL);
<a name="l00597"></a>00597       } <span class="keywordflow">break</span>;
<a name="l00598"></a>00598     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335917d24d8fd69ef9e2343d9b84ee95141a6">RPMTAG_PREFIXES</a>:
<a name="l00599"></a>00599         <a class="code" href="parsePreamble_8c.html#47de3cd5b29a8e7c65235f81ab034d79">addOrAppendListEntry</a>(pkg-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>, tag, field);
<a name="l00600"></a>00600         xx = hge(pkg-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>, tag, &amp;type, (<span class="keywordtype">void</span> **)&amp;array, &amp;num);
<a name="l00601"></a>00601         <span class="keywordflow">while</span> (num--) {
<a name="l00602"></a>00602             len = strlen(array[num]);
<a name="l00603"></a>00603             <span class="keywordflow">if</span> (array[num][len - 1] == <span class="charliteral">'/'</span> &amp;&amp; len &gt; 1) {
<a name="l00604"></a>00604                 <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>,
<a name="l00605"></a>00605                          <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"line %d: Prefixes must not end with \"/\": %s\n"</span>),
<a name="l00606"></a>00606                          spec-&gt;<a class="code" href="structSpec__s.html#f11d8c7aaa2b4fc86b775a920d3fd319">lineNum</a>, spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a>);
<a name="l00607"></a>00607                 array = hfd(array, type);
<a name="l00608"></a>00608                 <span class="keywordflow">return</span> <a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>;
<a name="l00609"></a>00609             }
<a name="l00610"></a>00610         }
<a name="l00611"></a>00611         array = hfd(array, type);
<a name="l00612"></a>00612         <span class="keywordflow">break</span>;
<a name="l00613"></a>00613     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335918edd2dbeb0112c9401c31d479e3e19c7">RPMTAG_DOCDIR</a>:
<a name="l00614"></a>00614         <a class="code" href="parsePreamble_8c.html#c2768a7d3541548040daea617087621d">SINGLE_TOKEN_ONLY</a>;
<a name="l00615"></a>00615         <span class="keywordflow">if</span> (field[0] != <span class="charliteral">'/'</span>) {
<a name="l00616"></a>00616             <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>,
<a name="l00617"></a>00617                      <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"line %d: Docdir must begin with '/': %s\n"</span>),
<a name="l00618"></a>00618                      spec-&gt;<a class="code" href="structSpec__s.html#f11d8c7aaa2b4fc86b775a920d3fd319">lineNum</a>, spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a>);
<a name="l00619"></a>00619             <span class="keywordflow">return</span> <a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>;
<a name="l00620"></a>00620         }
<a name="l00621"></a>00621         macro = NULL;
<a name="l00622"></a>00622         <a class="code" href="macro_8c.html#6a0c98bd34099103b42dcbae343d8366" title="Delete macro from context.">delMacro</a>(NULL, <span class="stringliteral">"_docdir"</span>);
<a name="l00623"></a>00623         <a class="code" href="macro_8c.html#3851992697896dc8ed8f0be8ca6ec3e4" title="Add macro to context.">addMacro</a>(NULL, <span class="stringliteral">"_docdir"</span>, NULL, field, <a class="code" href="rpmmacro_8h.html#3ee0ea50fb98f2c07b552a72a401a7f9">RMIL_SPEC</a>);
<a name="l00624"></a>00624         <span class="keywordflow">break</span>;
<a name="l00625"></a>00625     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359165eb02d228815f698f37657343fede4a">RPMTAG_EPOCH</a>:
<a name="l00626"></a>00626         <a class="code" href="parsePreamble_8c.html#c2768a7d3541548040daea617087621d">SINGLE_TOKEN_ONLY</a>;
<a name="l00627"></a>00627         <span class="keywordflow">if</span> (<a class="code" href="group__rpmbuild.html#gd05cc467e34ee5f643b38744f18c2710" title="Parse a number.">parseNum</a>(field, &amp;num)) {
<a name="l00628"></a>00628             <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>,
<a name="l00629"></a>00629                      <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"line %d: Epoch/Serial field must be a number: %s\n"</span>),
<a name="l00630"></a>00630                      spec-&gt;<a class="code" href="structSpec__s.html#f11d8c7aaa2b4fc86b775a920d3fd319">lineNum</a>, spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a>);
<a name="l00631"></a>00631             <span class="keywordflow">return</span> RPMERR_BADSPEC;
<a name="l00632"></a>00632         }
<a name="l00633"></a>00633         xx = <a class="code" href="group__header.html#g176a0175a522214ae4fffa162728a5f8" title="Add tag to header.">headerAddEntry</a>(pkg-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>, tag, <a class="code" href="group__header.html#gg4342aae7379e715a6b927663b340f43c0f09132d2e6b1b080b7d26b68309b031">RPM_INT32_TYPE</a>, &amp;num, 1);
<a name="l00634"></a>00634         <span class="keywordflow">break</span>;
<a name="l00635"></a>00635     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359138c94926969c776d54537b1e64faf2c1">RPMTAG_AUTOREQPROV</a>:
<a name="l00636"></a>00636         pkg-&gt;<a class="code" href="structPackage__s.html#e2a33ee5b7d6e7999205ee82a5d4a6fc">autoReq</a> = <a class="code" href="parsePreamble_8c.html#4f6edbfdfb6039a32c65a59cbf8d3d96">parseYesNo</a>(field);
<a name="l00637"></a>00637         pkg-&gt;<a class="code" href="structPackage__s.html#6e5a9a8c2f50bcf63577bde592887525">autoProv</a> = pkg-&gt;<a class="code" href="structPackage__s.html#e2a33ee5b7d6e7999205ee82a5d4a6fc">autoReq</a>;
<a name="l00638"></a>00638         <span class="keywordflow">break</span>;
<a name="l00639"></a>00639     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359140c7aeae4819adeb9731f99e184d9b3f">RPMTAG_AUTOREQ</a>:
<a name="l00640"></a>00640         pkg-&gt;<a class="code" href="structPackage__s.html#e2a33ee5b7d6e7999205ee82a5d4a6fc">autoReq</a> = <a class="code" href="parsePreamble_8c.html#4f6edbfdfb6039a32c65a59cbf8d3d96">parseYesNo</a>(field);
<a name="l00641"></a>00641         <span class="keywordflow">break</span>;
<a name="l00642"></a>00642     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591c77d182d7cce879aefce8d58fb8305d2">RPMTAG_AUTOPROV</a>:
<a name="l00643"></a>00643         pkg-&gt;<a class="code" href="structPackage__s.html#6e5a9a8c2f50bcf63577bde592887525">autoProv</a> = <a class="code" href="parsePreamble_8c.html#4f6edbfdfb6039a32c65a59cbf8d3d96">parseYesNo</a>(field);
<a name="l00644"></a>00644         <span class="keywordflow">break</span>;
<a name="l00645"></a>00645     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591d4c54c3f82bb73a2cb4f9d7da6eed4e7">RPMTAG_SOURCE</a>:
<a name="l00646"></a>00646     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591f1ef9d557fe5d29a8ff069c48ca072fe">RPMTAG_PATCH</a>:
<a name="l00647"></a>00647         <a class="code" href="parsePreamble_8c.html#c2768a7d3541548040daea617087621d">SINGLE_TOKEN_ONLY</a>;
<a name="l00648"></a>00648         macro = NULL;
<a name="l00649"></a>00649         <span class="keywordflow">if</span> ((rc = <a class="code" href="group__rpmbuild.html#ge015968528f4151620ba653f0320078e" title="spec file control structure">addSource</a>(spec, pkg, field, tag)))
<a name="l00650"></a>00650             <span class="keywordflow">return</span> rc;
<a name="l00651"></a>00651         <span class="keywordflow">break</span>;
<a name="l00652"></a>00652     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335913ba77631b933a85efc7ee29f34175a18">RPMTAG_ICON</a>:
<a name="l00653"></a>00653         <a class="code" href="parsePreamble_8c.html#c2768a7d3541548040daea617087621d">SINGLE_TOKEN_ONLY</a>;
<a name="l00654"></a>00654         <span class="keywordflow">if</span> ((rc = <a class="code" href="group__rpmbuild.html#ge015968528f4151620ba653f0320078e" title="spec file control structure">addSource</a>(spec, pkg, field, tag)))
<a name="l00655"></a>00655             <span class="keywordflow">return</span> rc;
<a name="l00656"></a>00656         <span class="keywordflow">if</span> ((rc = <a class="code" href="parsePreamble_8c.html#3156e830e103c91cb7b3c90d6d6dd359">readIcon</a>(pkg-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>, field)))
<a name="l00657"></a>00657             <span class="keywordflow">return</span> <a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>;
<a name="l00658"></a>00658         <span class="keywordflow">break</span>;
<a name="l00659"></a>00659     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591c2f6801a422b78fcaad2ed2b04a26d23">RPMTAG_NOSOURCE</a>:
<a name="l00660"></a>00660     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359166112d6cbdc37f3634e091e8923b1a74">RPMTAG_NOPATCH</a>:
<a name="l00661"></a>00661         spec-&gt;<a class="code" href="structSpec__s.html#d45cb391c7d503d8988d31bfa444ea36">noSource</a> = 1;
<a name="l00662"></a>00662         <span class="keywordflow">if</span> ((rc = <a class="code" href="group__rpmbuild.html#g4ed6d99ee7b894b9b5a52df72cf246bb" title="spec file control structure">parseNoSource</a>(spec, field, tag)))
<a name="l00663"></a>00663             <span class="keywordflow">return</span> rc;
<a name="l00664"></a>00664         <span class="keywordflow">break</span>;
<a name="l00665"></a>00665     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591dbd80ebf3dde21809002d4391cf6db4d">RPMTAG_BUILDPREREQ</a>:
<a name="l00666"></a>00666     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359105fc24559aaf060841bb6ef9ce6500b4">RPMTAG_BUILDREQUIRES</a>:
<a name="l00667"></a>00667         <span class="keywordflow">if</span> ((rc = <a class="code" href="parsePreamble_8c.html#f35735f64dc5bae036ebc0ccac94a65b">parseBits</a>(lang, <a class="code" href="parsePreamble_8c.html#54c81a5ae9beef99b563e7466befe700">buildScriptBits</a>, &amp;tagflags))) {
<a name="l00668"></a>00668             <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>,
<a name="l00669"></a>00669                      <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"line %d: Bad %s: qualifiers: %s\n"</span>),
<a name="l00670"></a>00670                      spec-&gt;<a class="code" href="structSpec__s.html#f11d8c7aaa2b4fc86b775a920d3fd319">lineNum</a>, <a class="code" href="rpmlib_8h.html#3a61a67f93831144b44b4f43cc718320" title="Return tag name from value.">tagName</a>(tag), spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a>);
<a name="l00671"></a>00671             <span class="keywordflow">return</span> rc;
<a name="l00672"></a>00672         }
<a name="l00673"></a>00673         <span class="keywordflow">if</span> ((rc = <a class="code" href="group__rpmbuild.html#ga3bab230780101f25a02c435f08b87ba" title="Parse dependency relations from spec file and/or autogenerated output buffer.">parseRCPOT</a>(spec, pkg, field, tag, 0, tagflags)))
<a name="l00674"></a>00674             <span class="keywordflow">return</span> rc;
<a name="l00675"></a>00675         <span class="keywordflow">break</span>;
<a name="l00676"></a>00676     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591f764b8ea5b8eafbe12dcfff1d303c8e9">RPMTAG_REQUIREFLAGS</a>:
<a name="l00677"></a>00677     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359114412996b1d286132a311e874a6f967e">RPMTAG_PREREQ</a>:
<a name="l00678"></a>00678         <span class="keywordflow">if</span> ((rc = <a class="code" href="parsePreamble_8c.html#f35735f64dc5bae036ebc0ccac94a65b">parseBits</a>(lang, <a class="code" href="parsePreamble_8c.html#f9fb127f2effbc02f0065585d8e8f6f5">installScriptBits</a>, &amp;tagflags))) {
<a name="l00679"></a>00679             <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>,
<a name="l00680"></a>00680                      <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"line %d: Bad %s: qualifiers: %s\n"</span>),
<a name="l00681"></a>00681                      spec-&gt;<a class="code" href="structSpec__s.html#f11d8c7aaa2b4fc86b775a920d3fd319">lineNum</a>, <a class="code" href="rpmlib_8h.html#3a61a67f93831144b44b4f43cc718320" title="Return tag name from value.">tagName</a>(tag), spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a>);
<a name="l00682"></a>00682             <span class="keywordflow">return</span> rc;
<a name="l00683"></a>00683         }
<a name="l00684"></a>00684         <span class="keywordflow">if</span> ((rc = <a class="code" href="group__rpmbuild.html#ga3bab230780101f25a02c435f08b87ba" title="Parse dependency relations from spec file and/or autogenerated output buffer.">parseRCPOT</a>(spec, pkg, field, tag, 0, tagflags)))
<a name="l00685"></a>00685             <span class="keywordflow">return</span> rc;
<a name="l00686"></a>00686         <span class="keywordflow">break</span>;
<a name="l00687"></a>00687     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335911e4011052f99d089570e53343a01e6ad">RPMTAG_BUILDCONFLICTS</a>:
<a name="l00688"></a>00688     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335916eaf5be45f3dc264b228280e42e0208a">RPMTAG_CONFLICTFLAGS</a>:
<a name="l00689"></a>00689     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335910530bb31e4ac82ce3420877ae4d804da">RPMTAG_OBSOLETEFLAGS</a>:
<a name="l00690"></a>00690     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335914ae180b9c5d2dae07fdfd3a172114e62">RPMTAG_PROVIDEFLAGS</a>:
<a name="l00691"></a>00691         tagflags = <a class="code" href="rpmlib_8h.html#4e838340e1a594afcd39d47b94b27095cc820446dae032500d79201d59b1d824">RPMSENSE_ANY</a>;
<a name="l00692"></a>00692         <span class="keywordflow">if</span> ((rc = <a class="code" href="group__rpmbuild.html#ga3bab230780101f25a02c435f08b87ba" title="Parse dependency relations from spec file and/or autogenerated output buffer.">parseRCPOT</a>(spec, pkg, field, tag, 0, tagflags)))
<a name="l00693"></a>00693             <span class="keywordflow">return</span> rc;
<a name="l00694"></a>00694         <span class="keywordflow">break</span>;
<a name="l00695"></a>00695     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335916cbff6a7273d68eb904e5f5493eeda4c">RPMTAG_EXCLUDEARCH</a>:
<a name="l00696"></a>00696     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591ba325caacc4ba79b8497af54d063274f">RPMTAG_EXCLUSIVEARCH</a>:
<a name="l00697"></a>00697     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335910fc7a5b5cf7eb7284a1fd9d17eb5716b">RPMTAG_EXCLUDEOS</a>:
<a name="l00698"></a>00698     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591ae7c7614b41896b499c4d6a1616d62a3">RPMTAG_EXCLUSIVEOS</a>:
<a name="l00699"></a>00699         <a class="code" href="parsePreamble_8c.html#47de3cd5b29a8e7c65235f81ab034d79">addOrAppendListEntry</a>(spec-&gt;<a class="code" href="structSpec__s.html#6971ea3f633365c1451a806d359fd7ff">buildRestrictions</a>, tag, field);
<a name="l00700"></a>00700         <span class="keywordflow">break</span>;
<a name="l00701"></a>00701     <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591555547d8fca39c7263ab52e1f5fbf28d">RPMTAG_BUILDARCHS</a>:
<a name="l00702"></a>00702         <span class="keywordflow">if</span> ((rc = poptParseArgvString(field,
<a name="l00703"></a>00703                                       &amp;(spec-&gt;<a class="code" href="structSpec__s.html#1b967e2c626e4a8116f651338e70ead0">BACount</a>),
<a name="l00704"></a>00704                                       &amp;(spec-&gt;<a class="code" href="structSpec__s.html#317830f242bb2211397b65da0f86dd51">BANames</a>)))) {
<a name="l00705"></a>00705             <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>,
<a name="l00706"></a>00706                      <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"line %d: Bad BuildArchitecture format: %s\n"</span>),
<a name="l00707"></a>00707                      spec-&gt;<a class="code" href="structSpec__s.html#f11d8c7aaa2b4fc86b775a920d3fd319">lineNum</a>, spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a>);
<a name="l00708"></a>00708             <span class="keywordflow">return</span> <a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>;
<a name="l00709"></a>00709         }
<a name="l00710"></a>00710         <span class="keywordflow">if</span> (!spec-&gt;<a class="code" href="structSpec__s.html#1b967e2c626e4a8116f651338e70ead0">BACount</a>)
<a name="l00711"></a>00711             spec-&gt;<a class="code" href="structSpec__s.html#317830f242bb2211397b65da0f86dd51">BANames</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(spec-&gt;<a class="code" href="structSpec__s.html#317830f242bb2211397b65da0f86dd51">BANames</a>);
<a name="l00712"></a>00712         <span class="keywordflow">break</span>;
<a name="l00713"></a>00713 
<a name="l00714"></a>00714     <span class="keywordflow">default</span>:
<a name="l00715"></a>00715         <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66ba8b205aa9a4c5e16e423be357d90adccf">RPMERR_INTERNAL</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"Internal error: Bogus tag %d\n"</span>), tag);
<a name="l00716"></a>00716         <span class="keywordflow">return</span> <a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66ba8b205aa9a4c5e16e423be357d90adccf">RPMERR_INTERNAL</a>;
<a name="l00717"></a>00717     }
<a name="l00718"></a>00718 
<a name="l00719"></a>00719     <span class="keywordflow">if</span> (macro)
<a name="l00720"></a>00720         <a class="code" href="macro_8c.html#3851992697896dc8ed8f0be8ca6ec3e4" title="Add macro to context.">addMacro</a>(spec-&gt;<a class="code" href="structSpec__s.html#a6ba79a7deb05c10860fc4870fd7434d">macros</a>, macro, NULL, field, <a class="code" href="rpmmacro_8h.html#3ee0ea50fb98f2c07b552a72a401a7f9">RMIL_SPEC</a>);
<a name="l00721"></a>00721     
<a name="l00722"></a>00722     <span class="keywordflow">return</span> 0;
<a name="l00723"></a>00723 }
<a name="l00724"></a>00724 <span class="comment">/*@=boundswrite@*/</span>
<a name="l00725"></a>00725 
<a name="l00726"></a>00726 <span class="comment">/* This table has to be in a peculiar order.  If one tag is the */</span>
<a name="l00727"></a>00727 <span class="comment">/* same as another, plus a few letters, it must come first.     */</span>
<a name="l00728"></a>00728 
<a name="l00731"></a><a class="code" href="structPreambleRec__s.html">00731</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structPreambleRec__s.html">PreambleRec_s</a> {
<a name="l00732"></a><a class="code" href="structPreambleRec__s.html#9b56e21c372fcd1851db29c23184cdc1">00732</a>     <a class="code" href="rpmlib_8h.html#4f08fde948b5511f2a904dc92e39e211">rpmTag</a> <a class="code" href="structPreambleRec__s.html#9b56e21c372fcd1851db29c23184cdc1">tag</a>;
<a name="l00733"></a><a class="code" href="structPreambleRec__s.html#e6dd5242b884a0166c62b45388cd2deb">00733</a>     <span class="keywordtype">int</span> <a class="code" href="structPreambleRec__s.html#e6dd5242b884a0166c62b45388cd2deb">len</a>;
<a name="l00734"></a><a class="code" href="structPreambleRec__s.html#d5dac5f14025ee299540f35202edaa8a">00734</a>     <span class="keywordtype">int</span> <a class="code" href="structPreambleRec__s.html#d5dac5f14025ee299540f35202edaa8a">multiLang</a>;
<a name="l00735"></a><a class="code" href="structPreambleRec__s.html#5d150c0c995a70c302927884edbff686">00735</a>     <span class="keywordtype">int</span> <a class="code" href="structPreambleRec__s.html#5d150c0c995a70c302927884edbff686">obsolete</a>;
<a name="l00736"></a>00736 <span class="comment">/*@observer@*/</span> <span class="comment">/*@null@*/</span>
<a name="l00737"></a><a class="code" href="structPreambleRec__s.html#554412d8dc50ae2924876ee51073f780">00737</a>     <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="structPreambleRec__s.html#554412d8dc50ae2924876ee51073f780">token</a>;
<a name="l00738"></a>00738 } * <a class="code" href="structPreambleRec__s.html">PreambleRec</a>;
<a name="l00739"></a>00739 
<a name="l00740"></a>00740 <span class="comment">/*@unchecked@*/</span>
<a name="l00741"></a><a class="code" href="parsePreamble_8c.html#d46cbdb9eae2f3dc3c5011ca61ba8925">00741</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structPreambleRec__s.html">PreambleRec_s</a> <a class="code" href="parsePreamble_8c.html#d46cbdb9eae2f3dc3c5011ca61ba8925">preambleList</a>[] = {
<a name="l00742"></a>00742     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359156c18d1a35fe688a7ffb696e23e83277">RPMTAG_NAME</a>,               0, 0, 0, <span class="stringliteral">"name"</span>},
<a name="l00743"></a>00743     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359183b943078409904e3db2fb07e0dc2fb0">RPMTAG_VERSION</a>,            0, 0, 0, <span class="stringliteral">"version"</span>},
<a name="l00744"></a>00744     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335910ed74ccfd50c25855a8647eec1dd0576">RPMTAG_RELEASE</a>,            0, 0, 0, <span class="stringliteral">"release"</span>},
<a name="l00745"></a>00745     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359165eb02d228815f698f37657343fede4a">RPMTAG_EPOCH</a>,              0, 0, 0, <span class="stringliteral">"epoch"</span>},
<a name="l00746"></a>00746     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359165eb02d228815f698f37657343fede4a">RPMTAG_EPOCH</a>,              0, 0, 1, <span class="stringliteral">"serial"</span>},
<a name="l00747"></a>00747     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591bd1d91d5ab5e18336b4ba004b10c1e7c">RPMTAG_SUMMARY</a>,            0, 1, 0, <span class="stringliteral">"summary"</span>},
<a name="l00748"></a>00748     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591fce7ed74da9e4e5824d0488dbb16c108">RPMTAG_LICENSE</a>,            0, 0, 1, <span class="stringliteral">"copyright"</span>},
<a name="l00749"></a>00749     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591fce7ed74da9e4e5824d0488dbb16c108">RPMTAG_LICENSE</a>,            0, 0, 0, <span class="stringliteral">"license"</span>},
<a name="l00750"></a>00750     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359107dd778a22e1b69cbf57ad4582f3a4e2">RPMTAG_DISTRIBUTION</a>,       0, 0, 0, <span class="stringliteral">"distribution"</span>},
<a name="l00751"></a>00751     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359182a5e8043890607cd90e5c36798ad31b">RPMTAG_DISTURL</a>,            0, 0, 0, <span class="stringliteral">"disturl"</span>},
<a name="l00752"></a>00752     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591480938ec797288b6844a448448391014">RPMTAG_VENDOR</a>,             0, 0, 0, <span class="stringliteral">"vendor"</span>},
<a name="l00753"></a>00753     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335915485f21121ce49425dcf4eef0b83caa6">RPMTAG_GROUP</a>,              0, 1, 0, <span class="stringliteral">"group"</span>},
<a name="l00754"></a>00754     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591746e308ff00ef1e53d83000f59fc9836">RPMTAG_PACKAGER</a>,           0, 0, 0, <span class="stringliteral">"packager"</span>},
<a name="l00755"></a>00755     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359195103ff02ce93a1f78826a212c392299">RPMTAG_URL</a>,                0, 0, 0, <span class="stringliteral">"url"</span>},
<a name="l00756"></a>00756     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591d4c54c3f82bb73a2cb4f9d7da6eed4e7">RPMTAG_SOURCE</a>,             0, 0, 0, <span class="stringliteral">"source"</span>},
<a name="l00757"></a>00757     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591f1ef9d557fe5d29a8ff069c48ca072fe">RPMTAG_PATCH</a>,              0, 0, 0, <span class="stringliteral">"patch"</span>},
<a name="l00758"></a>00758     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591c2f6801a422b78fcaad2ed2b04a26d23">RPMTAG_NOSOURCE</a>,           0, 0, 0, <span class="stringliteral">"nosource"</span>},
<a name="l00759"></a>00759     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359166112d6cbdc37f3634e091e8923b1a74">RPMTAG_NOPATCH</a>,            0, 0, 0, <span class="stringliteral">"nopatch"</span>},
<a name="l00760"></a>00760     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335916cbff6a7273d68eb904e5f5493eeda4c">RPMTAG_EXCLUDEARCH</a>,        0, 0, 0, <span class="stringliteral">"excludearch"</span>},
<a name="l00761"></a>00761     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591ba325caacc4ba79b8497af54d063274f">RPMTAG_EXCLUSIVEARCH</a>,      0, 0, 0, <span class="stringliteral">"exclusivearch"</span>},
<a name="l00762"></a>00762     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335910fc7a5b5cf7eb7284a1fd9d17eb5716b">RPMTAG_EXCLUDEOS</a>,          0, 0, 0, <span class="stringliteral">"excludeos"</span>},
<a name="l00763"></a>00763     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591ae7c7614b41896b499c4d6a1616d62a3">RPMTAG_EXCLUSIVEOS</a>,        0, 0, 0, <span class="stringliteral">"exclusiveos"</span>},
<a name="l00764"></a>00764     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335913ba77631b933a85efc7ee29f34175a18">RPMTAG_ICON</a>,               0, 0, 0, <span class="stringliteral">"icon"</span>},
<a name="l00765"></a>00765     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335914ae180b9c5d2dae07fdfd3a172114e62">RPMTAG_PROVIDEFLAGS</a>,       0, 0, 0, <span class="stringliteral">"provides"</span>},
<a name="l00766"></a>00766     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591f764b8ea5b8eafbe12dcfff1d303c8e9">RPMTAG_REQUIREFLAGS</a>,       0, 1, 0, <span class="stringliteral">"requires"</span>},
<a name="l00767"></a>00767     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359114412996b1d286132a311e874a6f967e">RPMTAG_PREREQ</a>,             0, 1, 0, <span class="stringliteral">"prereq"</span>},
<a name="l00768"></a>00768     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335916eaf5be45f3dc264b228280e42e0208a">RPMTAG_CONFLICTFLAGS</a>,      0, 0, 0, <span class="stringliteral">"conflicts"</span>},
<a name="l00769"></a>00769     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335910530bb31e4ac82ce3420877ae4d804da">RPMTAG_OBSOLETEFLAGS</a>,      0, 0, 0, <span class="stringliteral">"obsoletes"</span>},
<a name="l00770"></a>00770     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335917d24d8fd69ef9e2343d9b84ee95141a6">RPMTAG_PREFIXES</a>,           0, 0, 0, <span class="stringliteral">"prefixes"</span>},
<a name="l00771"></a>00771     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335917d24d8fd69ef9e2343d9b84ee95141a6">RPMTAG_PREFIXES</a>,           0, 0, 0, <span class="stringliteral">"prefix"</span>},
<a name="l00772"></a>00772     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335910b02d2c14a0d5843914580ec742e7926">RPMTAG_BUILDROOT</a>,          0, 0, 0, <span class="stringliteral">"buildroot"</span>},
<a name="l00773"></a>00773     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591555547d8fca39c7263ab52e1f5fbf28d">RPMTAG_BUILDARCHS</a>,         0, 0, 0, <span class="stringliteral">"buildarchitectures"</span>},
<a name="l00774"></a>00774     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591555547d8fca39c7263ab52e1f5fbf28d">RPMTAG_BUILDARCHS</a>,         0, 0, 0, <span class="stringliteral">"buildarch"</span>},
<a name="l00775"></a>00775     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335911e4011052f99d089570e53343a01e6ad">RPMTAG_BUILDCONFLICTS</a>,     0, 0, 0, <span class="stringliteral">"buildconflicts"</span>},
<a name="l00776"></a>00776     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591dbd80ebf3dde21809002d4391cf6db4d">RPMTAG_BUILDPREREQ</a>,        0, 1, 0, <span class="stringliteral">"buildprereq"</span>},
<a name="l00777"></a>00777     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359105fc24559aaf060841bb6ef9ce6500b4">RPMTAG_BUILDREQUIRES</a>,      0, 1, 0, <span class="stringliteral">"buildrequires"</span>},
<a name="l00778"></a>00778     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359138c94926969c776d54537b1e64faf2c1">RPMTAG_AUTOREQPROV</a>,        0, 0, 0, <span class="stringliteral">"autoreqprov"</span>},
<a name="l00779"></a>00779     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359140c7aeae4819adeb9731f99e184d9b3f">RPMTAG_AUTOREQ</a>,            0, 0, 0, <span class="stringliteral">"autoreq"</span>},
<a name="l00780"></a>00780     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591c77d182d7cce879aefce8d58fb8305d2">RPMTAG_AUTOPROV</a>,           0, 0, 0, <span class="stringliteral">"autoprov"</span>},
<a name="l00781"></a>00781     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335918edd2dbeb0112c9401c31d479e3e19c7">RPMTAG_DOCDIR</a>,             0, 0, 0, <span class="stringliteral">"docdir"</span>},
<a name="l00782"></a>00782     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591d4d06a4c8216ca2c18cacb754caf4ded">RPMTAG_RHNPLATFORM</a>,        0, 0, 1, <span class="stringliteral">"rhnplatform"</span>},
<a name="l00783"></a>00783     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591c7a31c61431d67e03b5b8b938b4344c3">RPMTAG_DISTTAG</a>,            0, 0, 0, <span class="stringliteral">"disttag"</span>},
<a name="l00784"></a>00784     {<a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591e6d84beb0c81e0790992d63a3154d872">RPMTAG_CVSID</a>,              0, 0, 0, <span class="stringliteral">"cvsid"</span>},
<a name="l00785"></a>00785     {<a class="code" href="rpmlib_8h.html#78bbeb3547114a1e43f58cc98cd958c1">RPMTAG_SVNID</a>,              0, 0, 0, <span class="stringliteral">"svnid"</span>},
<a name="l00786"></a>00786     <span class="comment">/*@-nullassign@*/</span>   <span class="comment">/* LCL: can't add null annotation */</span>
<a name="l00787"></a>00787     {0, 0, 0, 0, 0}
<a name="l00788"></a>00788     <span class="comment">/*@=nullassign@*/</span>
<a name="l00789"></a>00789 };
<a name="l00790"></a>00790 
<a name="l00793"></a><a class="code" href="parsePreamble_8c.html#606edd570234caa1cbc4b886e27cb87f">00793</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="parsePreamble_8c.html#606edd570234caa1cbc4b886e27cb87f">initPreambleList</a>(<span class="keywordtype">void</span>)
<a name="l00794"></a>00794         <span class="comment">/*@globals preambleList @*/</span>
<a name="l00795"></a>00795         <span class="comment">/*@modifies preambleList @*/</span>
<a name="l00796"></a>00796 {
<a name="l00797"></a>00797     <a class="code" href="structPreambleRec__s.html">PreambleRec</a> p;
<a name="l00798"></a>00798     <span class="keywordflow">for</span> (p = <a class="code" href="parsePreamble_8c.html#d46cbdb9eae2f3dc3c5011ca61ba8925">preambleList</a>; p-&gt;<a class="code" href="structPreambleRec__s.html#554412d8dc50ae2924876ee51073f780">token</a> != NULL; p++)
<a name="l00799"></a>00799         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structPreambleRec__s.html#554412d8dc50ae2924876ee51073f780">token</a>) p-&gt;<a class="code" href="structPreambleRec__s.html#e6dd5242b884a0166c62b45388cd2deb">len</a> = strlen(p-&gt;<a class="code" href="structPreambleRec__s.html#554412d8dc50ae2924876ee51073f780">token</a>);
<a name="l00800"></a>00800 }
<a name="l00801"></a>00801 
<a name="l00804"></a>00804 <span class="comment">/*@-boundswrite@*/</span>
<a name="l00805"></a><a class="code" href="parsePreamble_8c.html#51a366feac7f7a64d56cc66282aecb70">00805</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="parsePreamble_8c.html#51a366feac7f7a64d56cc66282aecb70">findPreambleTag</a>(<a class="code" href="structSpec__s.html" title="The structure used to store values parsed from a spec file.">Spec</a> spec, <span class="comment">/*@out@*/</span><a class="code" href="rpmlib_8h.html#4f08fde948b5511f2a904dc92e39e211">rpmTag</a> * <a class="code" href="structPreambleRec__s.html#9b56e21c372fcd1851db29c23184cdc1">tag</a>,
<a name="l00806"></a>00806                 <span class="comment">/*@null@*/</span> <span class="comment">/*@out@*/</span> <span class="keyword">const</span> <span class="keywordtype">char</span> ** macro, <span class="comment">/*@out@*/</span> <span class="keywordtype">char</span> * <a class="code" href="parseDescription_8c.html#b2fc255429d1174065838ae9702d12b1">lang</a>)
<a name="l00807"></a>00807         <span class="comment">/*@modifies *tag, *macro, *lang @*/</span>
<a name="l00808"></a>00808 {
<a name="l00809"></a>00809     <a class="code" href="structPreambleRec__s.html">PreambleRec</a> p;
<a name="l00810"></a>00810     <span class="keywordtype">char</span> *s;
<a name="l00811"></a>00811 
<a name="l00812"></a>00812     <span class="keywordflow">if</span> (<a class="code" href="parsePreamble_8c.html#d46cbdb9eae2f3dc3c5011ca61ba8925">preambleList</a>[0].<a class="code" href="structPreambleRec__s.html#e6dd5242b884a0166c62b45388cd2deb">len</a> == 0)
<a name="l00813"></a>00813         <a class="code" href="parsePreamble_8c.html#606edd570234caa1cbc4b886e27cb87f">initPreambleList</a>();
<a name="l00814"></a>00814 
<a name="l00815"></a>00815     <span class="keywordflow">for</span> (p = <a class="code" href="parsePreamble_8c.html#d46cbdb9eae2f3dc3c5011ca61ba8925">preambleList</a>; p-&gt;<a class="code" href="structPreambleRec__s.html#554412d8dc50ae2924876ee51073f780">token</a> != NULL; p++) {
<a name="l00816"></a>00816         <span class="keywordflow">if</span> (!(p-&gt;<a class="code" href="structPreambleRec__s.html#554412d8dc50ae2924876ee51073f780">token</a> &amp;&amp; !<a class="code" href="group__rpmio.html#g20f858167ebf5f0534b4fd423a2db91c" title="Locale insensitive strncasecmp(3).">xstrncasecmp</a>(spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a>, p-&gt;<a class="code" href="structPreambleRec__s.html#554412d8dc50ae2924876ee51073f780">token</a>, p-&gt;<a class="code" href="structPreambleRec__s.html#e6dd5242b884a0166c62b45388cd2deb">len</a>)))
<a name="l00817"></a>00817             <span class="keywordflow">continue</span>;
<a name="l00818"></a>00818         if (p-&gt;<a class="code" href="structPreambleRec__s.html#5d150c0c995a70c302927884edbff686">obsolete</a>) {
<a name="l00819"></a>00819             <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"Legacy syntax is unsupported: %s\n"</span>),
<a name="l00820"></a>00820                         p-&gt;<a class="code" href="structPreambleRec__s.html#554412d8dc50ae2924876ee51073f780">token</a>);
<a name="l00821"></a>00821             p = NULL;
<a name="l00822"></a>00822         }
<a name="l00823"></a>00823         <span class="keywordflow">break</span>;
<a name="l00824"></a>00824     }
<a name="l00825"></a>00825     <span class="keywordflow">if</span> (p == NULL || p-&gt;token == NULL)
<a name="l00826"></a>00826         <span class="keywordflow">return</span> 1;
<a name="l00827"></a>00827 
<a name="l00828"></a>00828     s = spec-&gt;line + p-&gt;<a class="code" href="structPreambleRec__s.html#e6dd5242b884a0166c62b45388cd2deb">len</a>;
<a name="l00829"></a>00829     <a class="code" href="rpmbuild_8h.html#8f81069c22bebb175ee6c1524590c93c">SKIPSPACE</a>(s);
<a name="l00830"></a>00830 
<a name="l00831"></a>00831     <span class="keywordflow">switch</span> (p-&gt;multiLang) {
<a name="l00832"></a>00832     <span class="keywordflow">default</span>:
<a name="l00833"></a>00833     <span class="keywordflow">case</span> 0:
<a name="l00834"></a>00834         <span class="comment">/* Unless this is a source or a patch, a ':' better be next */</span>
<a name="l00835"></a>00835         if (p-&gt;tag != <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591d4c54c3f82bb73a2cb4f9d7da6eed4e7">RPMTAG_SOURCE</a> &amp;&amp; p-&gt;tag != <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591f1ef9d557fe5d29a8ff069c48ca072fe">RPMTAG_PATCH</a>) {
<a name="l00836"></a>00836             if (*s != <span class="charliteral">':'</span>) <span class="keywordflow">return</span> 1;
<a name="l00837"></a>00837         }
<a name="l00838"></a>00838         *<a class="code" href="parseDescription_8c.html#b2fc255429d1174065838ae9702d12b1">lang</a> = <span class="charliteral">'\0'</span>;
<a name="l00839"></a>00839         <span class="keywordflow">break</span>;
<a name="l00840"></a>00840     <span class="keywordflow">case</span> 1:     <span class="comment">/* Parse optional ( &lt;token&gt; ). */</span>
<a name="l00841"></a>00841         <span class="keywordflow">if</span> (*s == <span class="charliteral">':'</span>) {
<a name="l00842"></a>00842             strcpy(<a class="code" href="parseDescription_8c.html#b2fc255429d1174065838ae9702d12b1">lang</a>, <a class="code" href="rpmspec_8h.html#9b6c70d9e5d4215bdc8dc68a41d64f82">RPMBUILD_DEFAULT_LANG</a>);
<a name="l00843"></a>00843             <span class="keywordflow">break</span>;
<a name="l00844"></a>00844         }
<a name="l00845"></a>00845         <span class="keywordflow">if</span> (*s != <span class="charliteral">'('</span>) <span class="keywordflow">return</span> 1;
<a name="l00846"></a>00846         s++;
<a name="l00847"></a>00847         <a class="code" href="rpmbuild_8h.html#8f81069c22bebb175ee6c1524590c93c">SKIPSPACE</a>(s);
<a name="l00848"></a>00848         <span class="keywordflow">while</span> (!<a class="code" href="stringbuf_8c.html#93a4309d5a0aa72a3e749ed3a5347ae1" title="Locale insensitive isspace(3).">xisspace</a>(*s) &amp;&amp; *s != <span class="charliteral">')'</span>)
<a name="l00849"></a>00849             *<a class="code" href="parseDescription_8c.html#b2fc255429d1174065838ae9702d12b1">lang</a>++ = *s++;
<a name="l00850"></a>00850         *<a class="code" href="parseDescription_8c.html#b2fc255429d1174065838ae9702d12b1">lang</a> = <span class="charliteral">'\0'</span>;
<a name="l00851"></a>00851         <a class="code" href="rpmbuild_8h.html#8f81069c22bebb175ee6c1524590c93c">SKIPSPACE</a>(s);
<a name="l00852"></a>00852         <span class="keywordflow">if</span> (*s != <span class="charliteral">')'</span>) <span class="keywordflow">return</span> 1;
<a name="l00853"></a>00853         s++;
<a name="l00854"></a>00854         <a class="code" href="rpmbuild_8h.html#8f81069c22bebb175ee6c1524590c93c">SKIPSPACE</a>(s);
<a name="l00855"></a>00855         <span class="keywordflow">if</span> (*s != <span class="charliteral">':'</span>) <span class="keywordflow">return</span> 1;
<a name="l00856"></a>00856         <span class="keywordflow">break</span>;
<a name="l00857"></a>00857     }
<a name="l00858"></a>00858 
<a name="l00859"></a>00859     *<a class="code" href="structPreambleRec__s.html#9b56e21c372fcd1851db29c23184cdc1">tag</a> = p-&gt;tag;
<a name="l00860"></a>00860     <span class="keywordflow">if</span> (macro)
<a name="l00861"></a>00861         <span class="comment">/*@-onlytrans -observertrans -dependenttrans@*/</span> <span class="comment">/* FIX: double indirection. */</span>
<a name="l00862"></a>00862         *macro = p-&gt;token;
<a name="l00863"></a>00863         <span class="comment">/*@=onlytrans =observertrans =dependenttrans@*/</span>
<a name="l00864"></a>00864     <span class="keywordflow">return</span> 0;
<a name="l00865"></a>00865 }
<a name="l00866"></a>00866 <span class="comment">/*@=boundswrite@*/</span>
<a name="l00867"></a>00867 
<a name="l00868"></a>00868 <span class="comment">/*@-boundswrite@*/</span>
<a name="l00869"></a><a class="code" href="group__rpmbuild.html#g7b965237bed7e7202a7790284e9ecfbc">00869</a> <span class="keywordtype">int</span> <a class="code" href="group__rpmbuild.html#g7b965237bed7e7202a7790284e9ecfbc" title="Parse tags from preamble of a spec file.">parsePreamble</a>(<a class="code" href="structSpec__s.html" title="The structure used to store values parsed from a spec file.">Spec</a> spec, <span class="keywordtype">int</span> initialPackage)
<a name="l00870"></a>00870 {
<a name="l00871"></a>00871     <span class="keywordtype">int</span> nextPart;
<a name="l00872"></a>00872     <span class="keywordtype">int</span> rc, xx;
<a name="l00873"></a>00873     <span class="keywordtype">char</span> *<a class="code" href="structname.html">name</a>, *linep;
<a name="l00874"></a>00874     <span class="keywordtype">int</span> flag;
<a name="l00875"></a>00875     <a class="code" href="structPackage__s.html" title="The structure used to store values for a package.">Package</a> pkg;
<a name="l00876"></a>00876     <span class="keywordtype">char</span> NVR[BUFSIZ];
<a name="l00877"></a>00877     <span class="keywordtype">char</span> <a class="code" href="parseDescription_8c.html#b2fc255429d1174065838ae9702d12b1">lang</a>[BUFSIZ];
<a name="l00878"></a>00878 
<a name="l00879"></a>00879     strcpy(NVR, <span class="stringliteral">"(main package)"</span>);
<a name="l00880"></a>00880 
<a name="l00881"></a>00881     pkg = <a class="code" href="group__rpmbuild.html#g5ce0668d7200e6b064f2f28986065326" title="Create and initialize package control structure.">newPackage</a>(spec);
<a name="l00882"></a>00882         
<a name="l00883"></a>00883     <span class="keywordflow">if</span> (! initialPackage) {
<a name="l00884"></a>00884         <span class="comment">/* There is one option to %package: &lt;pkg&gt; or -n &lt;pkg&gt; */</span>
<a name="l00885"></a>00885         <span class="keywordflow">if</span> (<a class="code" href="parsePreamble_8c.html#ba6b46b40af8c864440e1c103e16a7ac">parseSimplePart</a>(spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a>, &amp;name, &amp;flag)) {
<a name="l00886"></a>00886             <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"Bad package specification: %s\n"</span>),
<a name="l00887"></a>00887                         spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a>);
<a name="l00888"></a>00888             <span class="keywordflow">return</span> RPMERR_BADSPEC;
<a name="l00889"></a>00889         }
<a name="l00890"></a>00890         
<a name="l00891"></a>00891         <span class="keywordflow">if</span> (!<a class="code" href="group__rpmbuild.html#g419b892d69af28181c394858fd776cea" title="Find sub-package control structure by name.">lookupPackage</a>(spec, name, flag, NULL)) {
<a name="l00892"></a>00892             <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"Package already exists: %s\n"</span>),
<a name="l00893"></a>00893                         spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a>);
<a name="l00894"></a>00894             <span class="keywordflow">return</span> RPMERR_BADSPEC;
<a name="l00895"></a>00895         }
<a name="l00896"></a>00896         
<a name="l00897"></a>00897         <span class="comment">/* Construct the package */</span>
<a name="l00898"></a>00898         <span class="keywordflow">if</span> (flag == <a class="code" href="rpmbuild_8h.html#8668beb22148fe50b4d29a1c6f591b9a">PART_SUBNAME</a>) {
<a name="l00899"></a>00899             <span class="keyword">const</span> <span class="keywordtype">char</span> * mainName;
<a name="l00900"></a>00900             xx = <a class="code" href="group__header.html#g53462b3c5298a60fa2a43162deb4f41a" title="Return name, version, release strings from header.">headerNVR</a>(spec-&gt;<a class="code" href="structSpec__s.html#ffcee259f7ea1e815853ac3ae9f643c2">packages</a>-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>, &amp;mainName, NULL, NULL);
<a name="l00901"></a>00901             sprintf(NVR, <span class="stringliteral">"%s-%s"</span>, mainName, name);
<a name="l00902"></a>00902         } <span class="keywordflow">else</span>
<a name="l00903"></a>00903             strcpy(NVR, name);
<a name="l00904"></a>00904         xx = <a class="code" href="group__header.html#g176a0175a522214ae4fffa162728a5f8" title="Add tag to header.">headerAddEntry</a>(pkg-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>, <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359156c18d1a35fe688a7ffb696e23e83277">RPMTAG_NAME</a>, <a class="code" href="group__header.html#gg4342aae7379e715a6b927663b340f43cfe25304f92990326ba5c31d4ced5a84d">RPM_STRING_TYPE</a>, NVR, 1);
<a name="l00905"></a>00905     }
<a name="l00906"></a>00906 
<a name="l00907"></a>00907     <span class="keywordflow">if</span> ((rc = <a class="code" href="group__rpmbuild.html#g729b47891a22a1a71aaebb10654b33f0" title="Read next line from spec file.">readLine</a>(spec, <a class="code" href="rpmbuild_8h.html#0d77ad1822f52ddd08cd1f1755a299a0">STRIP_TRAILINGSPACE</a> | <a class="code" href="rpmbuild_8h.html#31d55f10ecb40b82f1435238ace44cb8">STRIP_COMMENTS</a>)) &gt; 0) {
<a name="l00908"></a>00908         nextPart = <a class="code" href="group__rpmbuild.html#ggb6037532b2506708abe466429b6cded965d3e02e1b9718c8ac45f5779320cdc5">PART_NONE</a>;
<a name="l00909"></a>00909     } <span class="keywordflow">else</span> {
<a name="l00910"></a>00910         <span class="keywordflow">if</span> (rc)
<a name="l00911"></a>00911             <span class="keywordflow">return</span> rc;
<a name="l00912"></a>00912         <span class="keywordflow">while</span> (! (nextPart = <a class="code" href="group__rpmbuild.html#gd77585115777df6ff3f8e21c6290662e" title="Check line for section separator, return next parser state.">isPart</a>(spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a>))) {
<a name="l00913"></a>00913             <span class="keyword">const</span> <span class="keywordtype">char</span> * macro;
<a name="l00914"></a>00914             <a class="code" href="rpmlib_8h.html#4f08fde948b5511f2a904dc92e39e211">rpmTag</a> <a class="code" href="structPreambleRec__s.html#9b56e21c372fcd1851db29c23184cdc1">tag</a>;
<a name="l00915"></a>00915 
<a name="l00916"></a>00916             <span class="comment">/* Skip blank lines */</span>
<a name="l00917"></a>00917             linep = spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a>;
<a name="l00918"></a>00918             <a class="code" href="rpmbuild_8h.html#8f81069c22bebb175ee6c1524590c93c">SKIPSPACE</a>(linep);
<a name="l00919"></a>00919             <span class="keywordflow">if</span> (*linep != <span class="charliteral">'\0'</span>) {
<a name="l00920"></a>00920                 <span class="keywordflow">if</span> (<a class="code" href="parsePreamble_8c.html#51a366feac7f7a64d56cc66282aecb70">findPreambleTag</a>(spec, &amp;tag, &amp;macro, lang)) {
<a name="l00921"></a>00921                     <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"line %d: Unknown tag: %s\n"</span>),
<a name="l00922"></a>00922                                 spec-&gt;<a class="code" href="structSpec__s.html#f11d8c7aaa2b4fc86b775a920d3fd319">lineNum</a>, spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a>);
<a name="l00923"></a>00923                     <span class="keywordflow">return</span> RPMERR_BADSPEC;
<a name="l00924"></a>00924                 }
<a name="l00925"></a>00925                 <span class="keywordflow">if</span> (<a class="code" href="parsePreamble_8c.html#8b41acf8aced6f85722ec2c5cb1fcc3f">handlePreambleTag</a>(spec, pkg, tag, macro, lang))
<a name="l00926"></a>00926                     <span class="keywordflow">return</span> <a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>;
<a name="l00927"></a>00927                 <span class="keywordflow">if</span> (spec-&gt;<a class="code" href="structSpec__s.html#317830f242bb2211397b65da0f86dd51">BANames</a> &amp;&amp; !spec-&gt;<a class="code" href="structSpec__s.html#c449d990f6d1c34ea43fde17487ac28f">recursing</a>)
<a name="l00928"></a>00928                     <span class="keywordflow">return</span> <a class="code" href="group__rpmbuild.html#ggb6037532b2506708abe466429b6cded9377a280eb82c3428019e65d54089ddb4">PART_BUILDARCHITECTURES</a>;
<a name="l00929"></a>00929             }
<a name="l00930"></a>00930             <span class="keywordflow">if</span> ((rc =
<a name="l00931"></a>00931                  <a class="code" href="group__rpmbuild.html#g729b47891a22a1a71aaebb10654b33f0" title="Read next line from spec file.">readLine</a>(spec, <a class="code" href="rpmbuild_8h.html#0d77ad1822f52ddd08cd1f1755a299a0">STRIP_TRAILINGSPACE</a> | <a class="code" href="rpmbuild_8h.html#31d55f10ecb40b82f1435238ace44cb8">STRIP_COMMENTS</a>)) &gt; 0) {
<a name="l00932"></a>00932                 nextPart = <a class="code" href="group__rpmbuild.html#ggb6037532b2506708abe466429b6cded965d3e02e1b9718c8ac45f5779320cdc5">PART_NONE</a>;
<a name="l00933"></a>00933                 <span class="keywordflow">break</span>;
<a name="l00934"></a>00934             }
<a name="l00935"></a>00935             <span class="keywordflow">if</span> (rc)
<a name="l00936"></a>00936                 <span class="keywordflow">return</span> rc;
<a name="l00937"></a>00937         }
<a name="l00938"></a>00938     }
<a name="l00939"></a>00939 
<a name="l00940"></a>00940     <span class="comment">/* Do some final processing on the header */</span>
<a name="l00941"></a>00941     
<a name="l00942"></a>00942     <span class="keywordflow">if</span> (!spec-&gt;<a class="code" href="structSpec__s.html#50d744ecb106a091e13b9885cafe0f51">gotBuildRootURL</a> &amp;&amp; spec-&gt;<a class="code" href="structSpec__s.html#e5e372fa94803e9d0ca3a75b74925f6f">buildRootURL</a>) {
<a name="l00943"></a>00943         <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"Spec file can't use BuildRoot\n"</span>));
<a name="l00944"></a>00944         <span class="keywordflow">return</span> <a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>;
<a name="l00945"></a>00945     }
<a name="l00946"></a>00946 
<a name="l00947"></a>00947     <span class="comment">/* XXX Skip valid arch check if not building binary package */</span>
<a name="l00948"></a>00948     <span class="keywordflow">if</span> (!spec-&gt;<a class="code" href="structSpec__s.html#fd4ce69871aca68c60b6a935d2795301">anyarch</a> &amp;&amp; <a class="code" href="parsePreamble_8c.html#8c71013579f01223484cefdf3534a5c7">checkForValidArchitectures</a>(spec))
<a name="l00949"></a>00949         <span class="keywordflow">return</span> <a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>;
<a name="l00950"></a>00950 
<a name="l00951"></a>00951     <span class="keywordflow">if</span> (pkg == spec-&gt;<a class="code" href="structSpec__s.html#ffcee259f7ea1e815853ac3ae9f643c2">packages</a>)
<a name="l00952"></a>00952         <a class="code" href="parsePreamble_8c.html#0025e0c45b3f742b24769cedee82b787">fillOutMainPackage</a>(pkg-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>);
<a name="l00953"></a>00953 
<a name="l00954"></a>00954     <span class="keywordflow">if</span> (<a class="code" href="parsePreamble_8c.html#92f0348d8bfd0fb088d922e6ed8c21f6" title="Check that no duplicate tags are present in header.">checkForDuplicates</a>(pkg-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>, NVR))
<a name="l00955"></a>00955         <span class="keywordflow">return</span> <a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>;
<a name="l00956"></a>00956 
<a name="l00957"></a>00957     <span class="keywordflow">if</span> (pkg != spec-&gt;<a class="code" href="structSpec__s.html#ffcee259f7ea1e815853ac3ae9f643c2">packages</a>)
<a name="l00958"></a>00958         <a class="code" href="group__header.html#g80bcb9a0a690803099cbdd3778db8138" title="Duplicate tag values from one header into another.">headerCopyTags</a>(spec-&gt;<a class="code" href="structSpec__s.html#ffcee259f7ea1e815853ac3ae9f643c2">packages</a>-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>, pkg-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>,
<a name="l00959"></a>00959                         (<a class="code" href="header_8h.html#ec881c85645bc01204441cbc24e9c025">int_32</a> *)<a class="code" href="parsePreamble_8c.html#87b7107c80253d2fdcccbda8e2dafdbc">copyTagsDuringParse</a>);
<a name="l00960"></a>00960 
<a name="l00961"></a>00961     <span class="keywordflow">if</span> (<a class="code" href="parsePreamble_8c.html#fee822405e5c0e419766551b2fa41a04" title="Check that required tags are present in header.">checkForRequired</a>(pkg-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>, NVR))
<a name="l00962"></a>00962         <span class="keywordflow">return</span> <a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>;
<a name="l00963"></a>00963 
<a name="l00964"></a>00964     <span class="keywordflow">return</span> nextPart;
<a name="l00965"></a>00965 }
<a name="l00966"></a>00966 <span class="comment">/*@=boundswrite@*/</span>
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Fri Oct 12 08:44:53 2007 for rpm by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
