<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>rpm: lua/lopcodes.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul>
</div>
<h1>lua/lopcodes.h</h1><a href="lopcodes_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">** $Id: lopcodes.h,v 1.2 2004/03/23 05:09:14 jbj Exp $</span>
<a name="l00003"></a>00003 <span class="comment">** Opcodes for Lua virtual machine</span>
<a name="l00004"></a>00004 <span class="comment">** See Copyright Notice in lua.h</span>
<a name="l00005"></a>00005 <span class="comment">*/</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#ifndef lopcodes_h</span>
<a name="l00008"></a>00008 <span class="preprocessor"></span><span class="preprocessor">#define lopcodes_h</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span>
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="llimits_8h.html">llimits.h</a>"</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="comment">/*===========================================================================</span>
<a name="l00014"></a>00014 <span class="comment">  We assume that instructions are unsigned numbers.</span>
<a name="l00015"></a>00015 <span class="comment">  All instructions have an opcode in the first 6 bits.</span>
<a name="l00016"></a>00016 <span class="comment">  Instructions can have the following fields:</span>
<a name="l00017"></a>00017 <span class="comment">        `A' : 8 bits</span>
<a name="l00018"></a>00018 <span class="comment">        `B' : 9 bits</span>
<a name="l00019"></a>00019 <span class="comment">        `C' : 9 bits</span>
<a name="l00020"></a>00020 <span class="comment">        `Bx' : 18 bits (`B' and `C' together)</span>
<a name="l00021"></a>00021 <span class="comment">        `sBx' : signed Bx</span>
<a name="l00022"></a>00022 <span class="comment"></span>
<a name="l00023"></a>00023 <span class="comment">  A signed argument is represented in excess K; that is, the number</span>
<a name="l00024"></a>00024 <span class="comment">  value is the unsigned value minus K. K is exactly the maximum value</span>
<a name="l00025"></a>00025 <span class="comment">  for that argument (so that -max is represented by 0, and +max is</span>
<a name="l00026"></a>00026 <span class="comment">  represented by 2*max), which is half the maximum for the corresponding</span>
<a name="l00027"></a>00027 <span class="comment">  unsigned argument.</span>
<a name="l00028"></a>00028 <span class="comment">===========================================================================*/</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 
<a name="l00031"></a><a class="code" href="lopcodes_8h.html#817496f32311641a2ed9ee1f5865809b">00031</a> <span class="keyword">enum</span> <a class="code" href="lopcodes_8h.html#817496f32311641a2ed9ee1f5865809b">OpMode</a> {<a class="code" href="lopcodes_8h.html#817496f32311641a2ed9ee1f5865809b79fd5c48aea375bee09f8068166c39f1">iABC</a>, <a class="code" href="lopcodes_8h.html#817496f32311641a2ed9ee1f5865809bea3f278124d776cd4e4e141701f09396">iABx</a>, <a class="code" href="lopcodes_8h.html#817496f32311641a2ed9ee1f5865809b51e19d2fd6ce35492f1169244a906d34">iAsBx</a>};  <span class="comment">/* basic instruction format */</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="comment">/*</span>
<a name="l00035"></a>00035 <span class="comment">** size and position of opcode arguments.</span>
<a name="l00036"></a>00036 <span class="comment">*/</span>
<a name="l00037"></a><a class="code" href="lopcodes_8h.html#e2c041a7a75d23e381d819d80842a30f">00037</a> <span class="preprocessor">#define SIZE_C          9</span>
<a name="l00038"></a><a class="code" href="lopcodes_8h.html#d99c3e7e35fdfba4c35703ded5eaaada">00038</a> <span class="preprocessor"></span><span class="preprocessor">#define SIZE_B          9</span>
<a name="l00039"></a><a class="code" href="lopcodes_8h.html#1964ca8fe58ef7f57054e7c0a2129fb8">00039</a> <span class="preprocessor"></span><span class="preprocessor">#define SIZE_Bx         (SIZE_C + SIZE_B)</span>
<a name="l00040"></a><a class="code" href="lopcodes_8h.html#024165e32bb8bbc50372ad7ec5882dda">00040</a> <span class="preprocessor"></span><span class="preprocessor">#define SIZE_A          8</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00042"></a><a class="code" href="lopcodes_8h.html#5923fac9b226ab0993502a763e476672">00042</a> <span class="preprocessor">#define SIZE_OP         6</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span>
<a name="l00044"></a><a class="code" href="lopcodes_8h.html#bb63c042c969e9bcac2ff06907b52caa">00044</a> <span class="preprocessor">#define POS_C           SIZE_OP</span>
<a name="l00045"></a><a class="code" href="lopcodes_8h.html#36526ecacdce8b654b659a13baf74aeb">00045</a> <span class="preprocessor"></span><span class="preprocessor">#define POS_B           (POS_C + SIZE_C)</span>
<a name="l00046"></a><a class="code" href="lopcodes_8h.html#9a48133bada233adb7c22eecc356f8c3">00046</a> <span class="preprocessor"></span><span class="preprocessor">#define POS_Bx          POS_C</span>
<a name="l00047"></a><a class="code" href="lopcodes_8h.html#5cc54953d36b1311f1e614baa8c10ee8">00047</a> <span class="preprocessor"></span><span class="preprocessor">#define POS_A           (POS_B + SIZE_B)</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="comment">/*</span>
<a name="l00051"></a>00051 <span class="comment">** limits for opcode arguments.</span>
<a name="l00052"></a>00052 <span class="comment">** we use (signed) int to manipulate most arguments,</span>
<a name="l00053"></a>00053 <span class="comment">** so they must fit in BITS_INT-1 bits (-1 for sign)</span>
<a name="l00054"></a>00054 <span class="comment">*/</span>
<a name="l00055"></a>00055 <span class="preprocessor">#if SIZE_Bx &lt; BITS_INT-1</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span><span class="preprocessor">#define MAXARG_Bx        ((1&lt;&lt;SIZE_Bx)-1)</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span><span class="preprocessor">#define MAXARG_sBx        (MAXARG_Bx&gt;&gt;1)         </span><span class="comment">/* `sBx' is signed */</span>
<a name="l00058"></a>00058 <span class="preprocessor">#else</span>
<a name="l00059"></a><a class="code" href="lopcodes_8h.html#85a28f2fc1e6efe4507df90dd1d232af">00059</a> <span class="preprocessor"></span><span class="preprocessor">#define MAXARG_Bx        MAX_INT</span>
<a name="l00060"></a><a class="code" href="lopcodes_8h.html#82ada800ff3f3b969fb1b34fea4b2be8">00060</a> <span class="preprocessor"></span><span class="preprocessor">#define MAXARG_sBx        MAX_INT</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span>
<a name="l00063"></a>00063 
<a name="l00064"></a><a class="code" href="lopcodes_8h.html#be3934a1a63fe574b1bc841e91e708fa">00064</a> <span class="preprocessor">#define MAXARG_A        ((1&lt;&lt;SIZE_A)-1)</span>
<a name="l00065"></a><a class="code" href="lopcodes_8h.html#97dd25fb137262e307906699c10be2ab">00065</a> <span class="preprocessor"></span><span class="preprocessor">#define MAXARG_B        ((1&lt;&lt;SIZE_B)-1)</span>
<a name="l00066"></a><a class="code" href="lopcodes_8h.html#afb2f05be47bc350dbb7d688e0dc5d44">00066</a> <span class="preprocessor"></span><span class="preprocessor">#define MAXARG_C        ((1&lt;&lt;SIZE_C)-1)</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="comment">/* creates a mask with `n' 1 bits at position `p' */</span>
<a name="l00070"></a><a class="code" href="lopcodes_8h.html#c27df72b04cc33284d82aa11a8ebe39a">00070</a> <span class="preprocessor">#define MASK1(n,p)      ((~((~(Instruction)0)&lt;&lt;n))&lt;&lt;p)</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span>
<a name="l00072"></a>00072 <span class="comment">/* creates a mask with `n' 0 bits at position `p' */</span>
<a name="l00073"></a><a class="code" href="lopcodes_8h.html#209e718c7ff373f37dbfd59c31abdea4">00073</a> <span class="preprocessor">#define MASK0(n,p)      (~MASK1(n,p))</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span>
<a name="l00075"></a>00075 <span class="comment">/*</span>
<a name="l00076"></a>00076 <span class="comment">** the following macros help to manipulate instructions</span>
<a name="l00077"></a>00077 <span class="comment">*/</span>
<a name="l00078"></a>00078 
<a name="l00079"></a><a class="code" href="lopcodes_8h.html#c534aadfac00831d34aa121193db8e88">00079</a> <span class="preprocessor">#define GET_OPCODE(i)   (cast(OpCode, (i)&amp;MASK1(SIZE_OP,0)))</span>
<a name="l00080"></a><a class="code" href="lopcodes_8h.html#0bbc49aa78a2aa16723524c2a7e820e2">00080</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_OPCODE(i,o) ((i) = (((i)&amp;MASK0(SIZE_OP,0)) | cast(Instruction, o)))</span>
<a name="l00081"></a>00081 <span class="preprocessor"></span>
<a name="l00082"></a><a class="code" href="lopcodes_8h.html#1b6535ddc0b6ed588de8cc2a1096cc84">00082</a> <span class="preprocessor">#define GETARG_A(i)     (cast(int, (i)&gt;&gt;POS_A))</span>
<a name="l00083"></a><a class="code" href="lopcodes_8h.html#29c64cfcdafe9108e9e918f77bc59170">00083</a> <span class="preprocessor"></span><span class="preprocessor">#define SETARG_A(i,u)   ((i) = (((i)&amp;MASK0(SIZE_A,POS_A)) | \</span>
<a name="l00084"></a>00084 <span class="preprocessor">                ((cast(Instruction, u)&lt;&lt;POS_A)&amp;MASK1(SIZE_A,POS_A))))</span>
<a name="l00085"></a>00085 <span class="preprocessor"></span>
<a name="l00086"></a><a class="code" href="lopcodes_8h.html#59d1e6aadb0052fa6edc4c9500f88c3f">00086</a> <span class="preprocessor">#define GETARG_B(i)     (cast(int, ((i)&gt;&gt;POS_B) &amp; MASK1(SIZE_B,0)))</span>
<a name="l00087"></a><a class="code" href="lopcodes_8h.html#8b4ad719c249408727af43797f70fd70">00087</a> <span class="preprocessor"></span><span class="preprocessor">#define SETARG_B(i,b)   ((i) = (((i)&amp;MASK0(SIZE_B,POS_B)) | \</span>
<a name="l00088"></a>00088 <span class="preprocessor">                ((cast(Instruction, b)&lt;&lt;POS_B)&amp;MASK1(SIZE_B,POS_B))))</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span>
<a name="l00090"></a><a class="code" href="lopcodes_8h.html#e2885b1cb338f15dce1f7628aee686c0">00090</a> <span class="preprocessor">#define GETARG_C(i)     (cast(int, ((i)&gt;&gt;POS_C) &amp; MASK1(SIZE_C,0)))</span>
<a name="l00091"></a><a class="code" href="lopcodes_8h.html#a49102d375e58785a2ecef0f89b8af49">00091</a> <span class="preprocessor"></span><span class="preprocessor">#define SETARG_C(i,b)   ((i) = (((i)&amp;MASK0(SIZE_C,POS_C)) | \</span>
<a name="l00092"></a>00092 <span class="preprocessor">                ((cast(Instruction, b)&lt;&lt;POS_C)&amp;MASK1(SIZE_C,POS_C))))</span>
<a name="l00093"></a>00093 <span class="preprocessor"></span>
<a name="l00094"></a><a class="code" href="lopcodes_8h.html#718212239c50c62e0df9cd33f5a7f2ab">00094</a> <span class="preprocessor">#define GETARG_Bx(i)    (cast(int, ((i)&gt;&gt;POS_Bx) &amp; MASK1(SIZE_Bx,0)))</span>
<a name="l00095"></a><a class="code" href="lopcodes_8h.html#ee7bc30a710d17592caa9863b29f2f73">00095</a> <span class="preprocessor"></span><span class="preprocessor">#define SETARG_Bx(i,b)  ((i) = (((i)&amp;MASK0(SIZE_Bx,POS_Bx)) | \</span>
<a name="l00096"></a>00096 <span class="preprocessor">                ((cast(Instruction, b)&lt;&lt;POS_Bx)&amp;MASK1(SIZE_Bx,POS_Bx))))</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span>
<a name="l00098"></a><a class="code" href="lopcodes_8h.html#fb75cf4013e702c6ca0531318223baa8">00098</a> <span class="preprocessor">#define GETARG_sBx(i)   (GETARG_Bx(i)-MAXARG_sBx)</span>
<a name="l00099"></a><a class="code" href="lopcodes_8h.html#a99a5486b9b5185b624f24910a43300b">00099</a> <span class="preprocessor"></span><span class="preprocessor">#define SETARG_sBx(i,b) SETARG_Bx((i),cast(unsigned int, (b)+MAXARG_sBx))</span>
<a name="l00100"></a>00100 <span class="preprocessor"></span>
<a name="l00101"></a>00101 
<a name="l00102"></a><a class="code" href="lopcodes_8h.html#0dd059ff51cec2680a3dc8a161ee3f21">00102</a> <span class="preprocessor">#define CREATE_ABC(o,a,b,c)     (cast(Instruction, o) \</span>
<a name="l00103"></a>00103 <span class="preprocessor">                        | (cast(Instruction, a)&lt;&lt;POS_A) \</span>
<a name="l00104"></a>00104 <span class="preprocessor">                        | (cast(Instruction, b)&lt;&lt;POS_B) \</span>
<a name="l00105"></a>00105 <span class="preprocessor">                        | (cast(Instruction, c)&lt;&lt;POS_C))</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span>
<a name="l00107"></a><a class="code" href="lopcodes_8h.html#0fb5959bf226976c940ee16983c47a42">00107</a> <span class="preprocessor">#define CREATE_ABx(o,a,bc)      (cast(Instruction, o) \</span>
<a name="l00108"></a>00108 <span class="preprocessor">                        | (cast(Instruction, a)&lt;&lt;POS_A) \</span>
<a name="l00109"></a>00109 <span class="preprocessor">                        | (cast(Instruction, bc)&lt;&lt;POS_Bx))</span>
<a name="l00110"></a>00110 <span class="preprocessor"></span>
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 <span class="comment">/*</span>
<a name="l00115"></a>00115 <span class="comment">** invalid register that fits in 8 bits</span>
<a name="l00116"></a>00116 <span class="comment">*/</span>
<a name="l00117"></a><a class="code" href="lopcodes_8h.html#5610d5d48ea307983e900b439933b25b">00117</a> <span class="preprocessor">#define NO_REG          MAXARG_A</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span>
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 <span class="comment">/*</span>
<a name="l00121"></a>00121 <span class="comment">** R(x) - register</span>
<a name="l00122"></a>00122 <span class="comment">** Kst(x) - constant (in constant table)</span>
<a name="l00123"></a>00123 <span class="comment">** RK(x) == if x &lt; MAXSTACK then R(x) else Kst(x-MAXSTACK)</span>
<a name="l00124"></a>00124 <span class="comment">*/</span>
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 <span class="comment">/*</span>
<a name="l00128"></a>00128 <span class="comment">** grep "ORDER OP" if you change these enums</span>
<a name="l00129"></a>00129 <span class="comment">*/</span>
<a name="l00130"></a>00130 
<a name="l00131"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8">00131</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> {
<a name="l00132"></a>00132 <span class="comment">/*----------------------------------------------------------------------</span>
<a name="l00133"></a>00133 <span class="comment">name            args    description</span>
<a name="l00134"></a>00134 <span class="comment">------------------------------------------------------------------------*/</span>
<a name="l00135"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f89a45e5b03f75222f95232ad9d96ec252">00135</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f89a45e5b03f75222f95232ad9d96ec252">OP_MOVE</a>,<span class="comment">/*      A B     R(A) := R(B)                                    */</span>
<a name="l00136"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f821061309b8ce575e20d51138d725a0b1">00136</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f821061309b8ce575e20d51138d725a0b1">OP_LOADK</a>,<span class="comment">/*     A Bx    R(A) := Kst(Bx)                                 */</span>
<a name="l00137"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8f01c42e5508fdf39a4968d8c8deb0e09">00137</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8f01c42e5508fdf39a4968d8c8deb0e09">OP_LOADBOOL</a>,<span class="comment">/*  A B C   R(A) := (Bool)B; if (C) PC++                    */</span>
<a name="l00138"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f83279f88d983880567a6e87174a22dff6">00138</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f83279f88d983880567a6e87174a22dff6">OP_LOADNIL</a>,<span class="comment">/*   A B     R(A) := ... := R(B) := nil                      */</span>
<a name="l00139"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f80c96592c1ab5bb60e10eb42eb6e435aa">00139</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f80c96592c1ab5bb60e10eb42eb6e435aa">OP_GETUPVAL</a>,<span class="comment">/*  A B     R(A) := UpValue[B]                              */</span>
<a name="l00140"></a>00140 
<a name="l00141"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f88f4a1f0944efde71d0f95f29693808b2">00141</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f88f4a1f0944efde71d0f95f29693808b2">OP_GETGLOBAL</a>,<span class="comment">/* A Bx    R(A) := Gbl[Kst(Bx)]                            */</span>
<a name="l00142"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f806aba2f78387b3f823f0cfc425ba473e">00142</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f806aba2f78387b3f823f0cfc425ba473e">OP_GETTABLE</a>,<span class="comment">/*  A B C   R(A) := R(B)[RK(C)]                             */</span>
<a name="l00143"></a>00143 
<a name="l00144"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8136b7248bd6ca204f865aacf56fc3147">00144</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8136b7248bd6ca204f865aacf56fc3147">OP_SETGLOBAL</a>,<span class="comment">/* A Bx    Gbl[Kst(Bx)] := R(A)                            */</span>
<a name="l00145"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8e379a7c92e7e53cb806754789158d443">00145</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8e379a7c92e7e53cb806754789158d443">OP_SETUPVAL</a>,<span class="comment">/*  A B     UpValue[B] := R(A)                              */</span>
<a name="l00146"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8dca08b0d0f5d427b9457702d1b1e28ae">00146</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8dca08b0d0f5d427b9457702d1b1e28ae">OP_SETTABLE</a>,<span class="comment">/*  A B C   R(A)[RK(B)] := RK(C)                            */</span>
<a name="l00147"></a>00147 
<a name="l00148"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8f0091b5fea3fe56a9b7d4e146932c68f">00148</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8f0091b5fea3fe56a9b7d4e146932c68f">OP_NEWTABLE</a>,<span class="comment">/*  A B C   R(A) := {} (size = B,C)                         */</span>
<a name="l00149"></a>00149 
<a name="l00150"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8c10dc9bf02f0908196ac866c123d1e65">00150</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8c10dc9bf02f0908196ac866c123d1e65">OP_SELF</a>,<span class="comment">/*      A B C   R(A+1) := R(B); R(A) := R(B)[RK(C)]             */</span>
<a name="l00151"></a>00151 
<a name="l00152"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f87904a633eed55be4f9a362d5519b8e55">00152</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f87904a633eed55be4f9a362d5519b8e55">OP_ADD</a>,<span class="comment">/*       A B C   R(A) := RK(B) + RK(C)                           */</span>
<a name="l00153"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8e1ae8e7680817abd1890816683def91d">00153</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8e1ae8e7680817abd1890816683def91d">OP_SUB</a>,<span class="comment">/*       A B C   R(A) := RK(B) - RK(C)                           */</span>
<a name="l00154"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8870024877aed4621ab9c5030aab11010">00154</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8870024877aed4621ab9c5030aab11010">OP_MUL</a>,<span class="comment">/*       A B C   R(A) := RK(B) * RK(C)                           */</span>
<a name="l00155"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8d2d1549cdb38ae0e2770a800d1ff21c5">00155</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8d2d1549cdb38ae0e2770a800d1ff21c5">OP_DIV</a>,<span class="comment">/*       A B C   R(A) := RK(B) / RK(C)                           */</span>
<a name="l00156"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f86a139a2af28fd81fbd1ccb28520483c9">00156</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f86a139a2af28fd81fbd1ccb28520483c9">OP_POW</a>,<span class="comment">/*       A B C   R(A) := RK(B) ^ RK(C)                           */</span>
<a name="l00157"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f82c2f544d4244358e6b092d7b99dec0f2">00157</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f82c2f544d4244358e6b092d7b99dec0f2">OP_UNM</a>,<span class="comment">/*       A B     R(A) := -R(B)                                   */</span>
<a name="l00158"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8791ea6ce16f68048afc8b53d514f33e3">00158</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8791ea6ce16f68048afc8b53d514f33e3">OP_NOT</a>,<span class="comment">/*       A B     R(A) := not R(B)                                */</span>
<a name="l00159"></a>00159 
<a name="l00160"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8db7b410a1a5df04a858a04b9bb618e62">00160</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8db7b410a1a5df04a858a04b9bb618e62">OP_CONCAT</a>,<span class="comment">/*    A B C   R(A) := R(B).. ... ..R(C)                       */</span>
<a name="l00161"></a>00161 
<a name="l00162"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8c1cb8286635de6f6d8acd3a106ef4b2a">00162</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8c1cb8286635de6f6d8acd3a106ef4b2a">OP_JMP</a>,<span class="comment">/*       sBx     PC += sBx                                       */</span>
<a name="l00163"></a>00163 
<a name="l00164"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f864431379916faf6a7f623214f6722b1c">00164</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f864431379916faf6a7f623214f6722b1c">OP_EQ</a>,<span class="comment">/*        A B C   if ((RK(B) == RK(C)) ~= A) then pc++            */</span>
<a name="l00165"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f87403065ee82e1822f8da268d648cf104">00165</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f87403065ee82e1822f8da268d648cf104">OP_LT</a>,<span class="comment">/*        A B C   if ((RK(B) &lt;  RK(C)) ~= A) then pc++            */</span>
<a name="l00166"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8e3b2d09331eb9eb2fdc09e6ba0e0fbf3">00166</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8e3b2d09331eb9eb2fdc09e6ba0e0fbf3">OP_LE</a>,<span class="comment">/*        A B C   if ((RK(B) &lt;= RK(C)) ~= A) then pc++            */</span>
<a name="l00167"></a>00167 
<a name="l00168"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8d9053c66a926eca03e88f98ed50bb509">00168</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8d9053c66a926eca03e88f98ed50bb509">OP_TEST</a>,<span class="comment">/*      A B C   if (R(B) &lt;=&gt; C) then R(A) := R(B) else pc++     */</span> 
<a name="l00169"></a>00169 
<a name="l00170"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8dd9857b702bebf2d3d62c67f937b52fa">00170</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8dd9857b702bebf2d3d62c67f937b52fa">OP_CALL</a>,<span class="comment">/*      A B C   R(A), ... ,R(A+C-2) := R(A)(R(A+1), ... ,R(A+B-1)) */</span>
<a name="l00171"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8c56e23be8dea19d7e8a75285bab1cac4">00171</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8c56e23be8dea19d7e8a75285bab1cac4">OP_TAILCALL</a>,<span class="comment">/*  A B C   return R(A)(R(A+1), ... ,R(A+B-1))              */</span>
<a name="l00172"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f89ca6ffb0b699ee287919f5d151d76c57">00172</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f89ca6ffb0b699ee287919f5d151d76c57">OP_RETURN</a>,<span class="comment">/*    A B     return R(A), ... ,R(A+B-2)      (see note)      */</span>
<a name="l00173"></a>00173 
<a name="l00174"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f85e7650997649c1dbdfddb8857865b53f">00174</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f85e7650997649c1dbdfddb8857865b53f">OP_FORLOOP</a>,<span class="comment">/*   A sBx   R(A)+=R(A+2); if R(A) &lt;?= R(A+1) then PC+= sBx  */</span>
<a name="l00175"></a>00175 
<a name="l00176"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8cdb0130ffef612e8c4152e0db8b6e596">00176</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8cdb0130ffef612e8c4152e0db8b6e596">OP_TFORLOOP</a>,<span class="comment">/*  A C     R(A+2), ... ,R(A+2+C) := R(A)(R(A+1), R(A+2)); </span>
<a name="l00177"></a>00177 <span class="comment">                        if R(A+2) ~= nil then pc++                      */</span>
<a name="l00178"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f86f599f7989ae8bba5f9b89a656480222">00178</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f86f599f7989ae8bba5f9b89a656480222">OP_TFORPREP</a>,<span class="comment">/*  A sBx   if type(R(A)) == table then R(A+1):=R(A), R(A):=next;</span>
<a name="l00179"></a>00179 <span class="comment">                        PC += sBx                                       */</span>
<a name="l00180"></a>00180 
<a name="l00181"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8788a3d24f52b7e1f944cfcc8583ad44c">00181</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8788a3d24f52b7e1f944cfcc8583ad44c">OP_SETLIST</a>,<span class="comment">/*   A Bx    R(A)[Bx-Bx%FPF+i] := R(A+i), 1 &lt;= i &lt;= Bx%FPF+1 */</span>
<a name="l00182"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8f36c7cc1a55304c111cb016e8c88396a">00182</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8f36c7cc1a55304c111cb016e8c88396a">OP_SETLISTO</a>,<span class="comment">/*  A Bx                                                    */</span>
<a name="l00183"></a>00183 
<a name="l00184"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f80652074296686029414d6c12b21fece9">00184</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f80652074296686029414d6c12b21fece9">OP_CLOSE</a>,<span class="comment">/*     A       close all variables in the stack up to (&gt;=) R(A)*/</span>
<a name="l00185"></a><a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8bd3b010317ec61a3a779a06c5c465c26">00185</a> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8bd3b010317ec61a3a779a06c5c465c26">OP_CLOSURE</a><span class="comment">/*    A Bx    R(A) := closure(KPROTO[Bx], R(A), ... ,R(A+n))  */</span>
<a name="l00186"></a>00186 } <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8">OpCode</a>;
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 
<a name="l00189"></a><a class="code" href="lopcodes_8h.html#660ee91e945c7b19348f5acfafae4ac7">00189</a> <span class="preprocessor">#define NUM_OPCODES     (cast(int, OP_CLOSURE+1))</span>
<a name="l00190"></a>00190 <span class="preprocessor"></span>
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 <span class="comment">/*===========================================================================</span>
<a name="l00194"></a>00194 <span class="comment">  Notes:</span>
<a name="l00195"></a>00195 <span class="comment">  (1) In OP_CALL, if (B == 0) then B = top. C is the number of returns - 1,</span>
<a name="l00196"></a>00196 <span class="comment">      and can be 0: OP_CALL then sets `top' to last_result+1, so</span>
<a name="l00197"></a>00197 <span class="comment">      next open instruction (OP_CALL, OP_RETURN, OP_SETLIST) may use `top'.</span>
<a name="l00198"></a>00198 <span class="comment"></span>
<a name="l00199"></a>00199 <span class="comment">  (2) In OP_RETURN, if (B == 0) then return up to `top'</span>
<a name="l00200"></a>00200 <span class="comment"></span>
<a name="l00201"></a>00201 <span class="comment">  (3) For comparisons, B specifies what conditions the test should accept.</span>
<a name="l00202"></a>00202 <span class="comment"></span>
<a name="l00203"></a>00203 <span class="comment">  (4) All `skips' (pc++) assume that next instruction is a jump</span>
<a name="l00204"></a>00204 <span class="comment">===========================================================================*/</span>
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 <span class="comment">/*</span>
<a name="l00208"></a>00208 <span class="comment">** masks for instruction properties</span>
<a name="l00209"></a>00209 <span class="comment">*/</span>  
<a name="l00210"></a><a class="code" href="lopcodes_8h.html#c5548e9f891d0c31fc9012defc845a3e">00210</a> <span class="keyword">enum</span> <a class="code" href="lopcodes_8h.html#c5548e9f891d0c31fc9012defc845a3e">OpModeMask</a> {
<a name="l00211"></a><a class="code" href="lopcodes_8h.html#c5548e9f891d0c31fc9012defc845a3e1c3d80954c39d14695f43040765badb7">00211</a>   <a class="code" href="lopcodes_8h.html#c5548e9f891d0c31fc9012defc845a3e1c3d80954c39d14695f43040765badb7">OpModeBreg</a> = 2,       <span class="comment">/* B is a register */</span>
<a name="l00212"></a><a class="code" href="lopcodes_8h.html#c5548e9f891d0c31fc9012defc845a3e3e31462eab708bae554d839f8bde1ad7">00212</a>   <a class="code" href="lopcodes_8h.html#c5548e9f891d0c31fc9012defc845a3e3e31462eab708bae554d839f8bde1ad7">OpModeBrk</a>,            <span class="comment">/* B is a register/constant */</span>
<a name="l00213"></a><a class="code" href="lopcodes_8h.html#c5548e9f891d0c31fc9012defc845a3e194eaf5f524dc60a07e27a09f524bb8d">00213</a>   <a class="code" href="lopcodes_8h.html#c5548e9f891d0c31fc9012defc845a3e194eaf5f524dc60a07e27a09f524bb8d">OpModeCrk</a>,           <span class="comment">/* C is a register/constant */</span>
<a name="l00214"></a><a class="code" href="lopcodes_8h.html#c5548e9f891d0c31fc9012defc845a3e86800a00b99c42b2c04a3cfb130437a3">00214</a>   <a class="code" href="lopcodes_8h.html#c5548e9f891d0c31fc9012defc845a3e86800a00b99c42b2c04a3cfb130437a3">OpModesetA</a>,           <span class="comment">/* instruction set register A */</span>
<a name="l00215"></a><a class="code" href="lopcodes_8h.html#c5548e9f891d0c31fc9012defc845a3ec87b7e0b3e097db793bad78462845b3c">00215</a>   <a class="code" href="lopcodes_8h.html#c5548e9f891d0c31fc9012defc845a3ec87b7e0b3e097db793bad78462845b3c">OpModeK</a>,              <span class="comment">/* Bx is a constant */</span>
<a name="l00216"></a><a class="code" href="lopcodes_8h.html#c5548e9f891d0c31fc9012defc845a3e01d185fe863d283be4b4d44c6bc26da4">00216</a>   <a class="code" href="lopcodes_8h.html#c5548e9f891d0c31fc9012defc845a3e01d185fe863d283be4b4d44c6bc26da4">OpModeT</a>               <span class="comment">/* operator is a test */</span>
<a name="l00217"></a>00217   
<a name="l00218"></a>00218 };
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 
<a name="l00221"></a>00221 <span class="comment">/*@unchecked@*/</span>
<a name="l00222"></a>00222 <span class="keyword">extern</span> <span class="keyword">const</span> <a class="code" href="llimits_8h.html#64f8b22b40cd3b0d9a7b61d79ae2d98f">lu_byte</a> <a class="code" href="lopcodes_8c.html#8ea1bf13c7d345c0d40b0fada5b00c62">luaP_opmodes</a>[<a class="code" href="lopcodes_8h.html#660ee91e945c7b19348f5acfafae4ac7">NUM_OPCODES</a>];
<a name="l00223"></a>00223 
<a name="l00224"></a><a class="code" href="lopcodes_8h.html#b3f4ec225a2927c57ed31ffa3814b9c1">00224</a> <span class="preprocessor">#define getOpMode(m)            (cast(enum OpMode, luaP_opmodes[m] &amp; 3))</span>
<a name="l00225"></a><a class="code" href="lopcodes_8h.html#c70d94d3e14fbbc708860491f31c7e5c">00225</a> <span class="preprocessor"></span><span class="preprocessor">#define testOpMode(m, b)        (luaP_opmodes[m] &amp; (1 &lt;&lt; (b)))</span>
<a name="l00226"></a>00226 <span class="preprocessor"></span>
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 <span class="preprocessor">#ifdef LUA_OPNAMES</span>
<a name="l00229"></a>00229 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> luaP_opnames[];  <span class="comment">/* opcode names */</span>
<a name="l00230"></a>00230 <span class="preprocessor">#endif</span>
<a name="l00231"></a>00231 <span class="preprocessor"></span>
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 
<a name="l00234"></a>00234 <span class="comment">/* number of list items to accumulate before a SETLIST instruction */</span>
<a name="l00235"></a>00235 <span class="comment">/* (must be a power of 2) */</span>
<a name="l00236"></a><a class="code" href="lopcodes_8h.html#c93278629d2c705ec1d080c3790221d3">00236</a> <span class="preprocessor">#define LFIELDS_PER_FLUSH       32</span>
<a name="l00237"></a>00237 <span class="preprocessor"></span>
<a name="l00238"></a>00238 
<a name="l00239"></a>00239 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Fri Oct 12 08:44:54 2007 for rpm by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
