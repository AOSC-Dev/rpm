<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>rpm: rpmdb/legacy.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul>
</div>
<h1>rpmdb/legacy.c File Reference</h1><code>#include &quot;<a class="el" href="system_8h-source.html">system.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="rpmio__internal_8h-source.html">rpmio_internal.h</a>&quot;</code><br>
<code>#include &lt;<a class="el" href="rpmlib_8h-source.html">rpmlib.h</a>&gt;</code><br>
<code>#include &lt;<a class="el" href="rpmmacro_8h-source.html">rpmmacro.h</a>&gt;</code><br>
<code>#include &quot;<a class="el" href="misc_8h-source.html">misc.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="legacy_8h-source.html">legacy.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="debug_8h-source.html">debug.h</a>&quot;</code><br>

<p>
<a href="legacy_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="legacy_8c.html#0e6c36aa207979a118f67d4ddb341fce">alloca_strdup</a>(_s)&nbsp;&nbsp;&nbsp;strcpy(alloca(strlen(_s)+1), (_s))</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="legacy_8c.html#b3832114edf6afb9433ef5a6113d0ba8">open_dso</a> (const char *path, pid_t *pidp, size_t *fsizep)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Open a file descriptor to verify file MD5 and size.  <a href="#b3832114edf6afb9433ef5a6113d0ba8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="legacy_8c.html#1d4686e95c90e1a91f016655fbe85ece">domd5</a> (const char *fn, unsigned char *digest, int asAscii, size_t *fsizep)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return MD5 sum and size of a file.  <a href="#1d4686e95c90e1a91f016655fbe85ece"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="legacy_8c.html#2a848c199866818d4aee993910742935">dncmp</a> (const void *a, const void *b)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="legacy_8c.html#e6ab95bc495931e0733868b30143e252">compressFilelist</a> (<a class="el" href="structheaderToken__s.html">Header</a> h)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert absolute path tag to (dirname,basename,dirindex) tags.  <a href="#e6ab95bc495931e0733868b30143e252"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="legacy_8c.html#7a3747cee9eef44f62969af9b8d4d390">rpmfiBuildFNames</a> (<a class="el" href="structheaderToken__s.html">Header</a> h, <a class="el" href="rpmlib_8h.html#4f08fde948b5511f2a904dc92e39e211">rpmTag</a> tagN, const char ***fnp, int *fcp)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Retrieve file <a class="el" href="structnames.html">names</a> from header.  <a href="#7a3747cee9eef44f62969af9b8d4d390"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="legacy_8c.html#b2d4f783dd7c3fb997d180a34d851a1b">expandFilelist</a> (<a class="el" href="structheaderToken__s.html">Header</a> h)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert (dirname,basename,dirindex) tags to absolute path tag.  <a href="#b2d4f783dd7c3fb997d180a34d851a1b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="legacy_8c.html#5a9645dfd465c75595ec043f85c70a47">providePackageNVR</a> (<a class="el" href="structheaderToken__s.html">Header</a> h)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Retrofit a Provides: <a class="el" href="structname.html">name</a> = version-release dependency into legacy package headers.  <a href="#5a9645dfd465c75595ec043f85c70a47"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="legacy_8c.html#3e79dc4647f033f73a7b4c6237875b67">legacyRetrofit</a> (<a class="el" href="structheaderToken__s.html">Header</a> h, const struct <a class="el" href="structrpmlead.html">rpmlead</a> *lead)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Do all necessary retorfits for a package header.  <a href="#3e79dc4647f033f73a7b4c6237875b67"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpmcli.html#g684c24e565b576a81ada33525f7c07ce">_noDirTokens</a> = 0</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Should version 3 packages be produced?  <a href="group__rpmcli.html#g684c24e565b576a81ada33525f7c07ce"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>

<p>
Definition in file <a class="el" href="legacy_8c-source.html">legacy.c</a>.<hr><h2>Define Documentation</h2>
<a class="anchor" name="0e6c36aa207979a118f67d4ddb341fce"></a><!-- doxytag: member="legacy.c::alloca_strdup" ref="0e6c36aa207979a118f67d4ddb341fce" args="(_s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define alloca_strdup          </td>
          <td>(</td>
          <td class="paramtype">_s&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">&nbsp;&nbsp;&nbsp;strcpy(alloca(strlen(_s)+1), (_s))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="legacy_8c-source.html#l00027">27</a> of file <a class="el" href="legacy_8c-source.html">legacy.c</a>.
</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="e6ab95bc495931e0733868b30143e252"></a><!-- doxytag: member="legacy.c::compressFilelist" ref="e6ab95bc495931e0733868b30143e252" args="(Header h)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void compressFilelist           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structheaderToken__s.html">Header</a>&nbsp;</td>
          <td class="paramname"> <em>h</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Convert absolute path tag to (dirname,basename,dirindex) tags. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>h</em>&nbsp;</td><td>header </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="legacy_8c-source.html#l00270">270</a> of file <a class="el" href="legacy_8c-source.html">legacy.c</a>.
<p>
References <a class="el" href="system_8h.html#58ff5c3142f685bf7e95cc0cbfaf49c9">alloca()</a>, <a class="el" href="legacy_8c-source.html#l00260">dncmp()</a>, <a class="el" href="hdrinline_8h-source.html#l00315">headerAddEntry()</a>, <a class="el" href="header_8h-source.html#l00704">headerFreeData()</a>, <a class="el" href="hdrinline_8h-source.html#l00290">headerGetEntryMinMemory()</a>, <a class="el" href="hdrinline_8h-source.html#l00230">headerIsEntry()</a>, <a class="el" href="hdrinline_8h-source.html#l00417">headerRemoveEntry()</a>, <a class="el" href="header_8h-source.html#l00221">RPM_INT32_TYPE</a>, <a class="el" href="header_8h-source.html#l00225">RPM_STRING_ARRAY_TYPE</a>, <a class="el" href="rpmlib_8h-source.html#l00400">RPMTAG_BASENAMES</a>, <a class="el" href="rpmlib_8h-source.html#l00399">RPMTAG_DIRINDEXES</a>, <a class="el" href="rpmlib_8h-source.html#l00401">RPMTAG_DIRNAMES</a>, and <a class="el" href="rpmlib_8h-source.html#l00299">RPMTAG_OLDFILENAMES</a>.
<p>
Referenced by <a class="el" href="files_8c-source.html#l01129">genCpioListAndHeader()</a>, <a class="el" href="header-py_8c-source.html#l00238">hdrCompressFilelist()</a>, <a class="el" href="header-py_8c-source.html#l00720">hdrLoad()</a>, <a class="el" href="legacy_8c-source.html#l00530">legacyRetrofit()</a>, <a class="el" href="header-py_8c-source.html#l00250">mungeFilelist()</a>, and <a class="el" href="header-py_8c-source.html#l00810">rpmReadHeaders()</a>.
</div>
</div><p>
<a class="anchor" name="2a848c199866818d4aee993910742935"></a><!-- doxytag: member="legacy.c::dncmp" ref="2a848c199866818d4aee993910742935" args="(const void *a, const void *b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dncmp           </td>
          <td>(</td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>b</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="legacy_8c-source.html#l00260">260</a> of file <a class="el" href="legacy_8c-source.html">legacy.c</a>.
<p>
Referenced by <a class="el" href="legacy_8c-source.html#l00270">compressFilelist()</a>.
</div>
</div><p>
<a class="anchor" name="1d4686e95c90e1a91f016655fbe85ece"></a><!-- doxytag: member="legacy.c::domd5" ref="1d4686e95c90e1a91f016655fbe85ece" args="(const char *fn, unsigned char *digest, int asAscii, size_t *fsizep)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int domd5           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>fn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>digest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>asAscii</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&nbsp;</td>
          <td class="paramname"> <em>fsizep</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return MD5 sum and size of a file. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fn</em>&nbsp;</td><td>file <a class="el" href="structname.html">name</a> </td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>digest</em>&nbsp;</td><td>address of md5sum </td></tr>
  </table>
</dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>asAscii</em>&nbsp;</td><td>return md5sum as ascii string? </td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>*fsizep</em>&nbsp;</td><td>file size pointer (or NULL) </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success, 1 on error </dd></dl>

<p>
Definition at line <a class="el" href="legacy_8c-source.html#l00148">148</a> of file <a class="el" href="legacy_8c-source.html">legacy.c</a>.
<p>
References <a class="el" href="rpmlib_8h-source.html#l00058">_free()</a>, <a class="el" href="rpmio_8c-source.html#l02903">Fclose()</a>, <a class="el" href="rpmio_8c-source.html#l00237">fdDup()</a>, <a class="el" href="rpmio__internal_8h-source.html#l00571">fdFiniDigest()</a>, <a class="el" href="rpmio__internal_8h-source.html#l00533">fdInitDigest()</a>, <a class="el" href="rpmio_8c-source.html#l03277">Ferror()</a>, <a class="el" href="rpmio_8c-source.html#l03184">Fopen()</a>, <a class="el" href="rpmio_8c-source.html#l02824">Fread()</a>, <a class="el" href="legacy_8c-source.html#l00036">open_dso()</a>, <a class="el" href="rpmpgp_8h-source.html#l00285">PGPHASHALGO_MD5</a>, <a class="el" href="rpmpgp_8h-source.html#l00978">RPMDIGEST_NONE</a>, <a class="el" href="digest_8c-source.html#l00155">rpmDigestFinal()</a>, <a class="el" href="digest_8c-source.html#l00046">rpmDigestInit()</a>, <a class="el" href="digest_8c-source.html#l00141">rpmDigestUpdate()</a>, <a class="el" href="rpmurl_8h-source.html#l00015">URL_IS_DASH</a>, <a class="el" href="rpmurl_8h-source.html#l00017">URL_IS_FTP</a>, <a class="el" href="rpmurl_8h-source.html#l00020">URL_IS_HKP</a>, <a class="el" href="rpmurl_8h-source.html#l00018">URL_IS_HTTP</a>, <a class="el" href="rpmurl_8h-source.html#l00019">URL_IS_HTTPS</a>, <a class="el" href="rpmurl_8h-source.html#l00016">URL_IS_PATH</a>, <a class="el" href="rpmurl_8h-source.html#l00014">URL_IS_UNKNOWN</a>, and <a class="el" href="url_8c-source.html#l00383">urlPath()</a>.
<p>
Referenced by <a class="el" href="files_8c-source.html#l01129">genCpioListAndHeader()</a>, <a class="el" href="transaction_8c-source.html#l00454">handleOverlappedFiles()</a>, <a class="el" href="signature_8c-source.html#l00801">rpmAddSignature()</a>, <a class="el" href="rpmfi_8c-source.html#l00642">rpmfiConfigConflict()</a>, <a class="el" href="rpmfi_8c-source.html#l00547">rpmfiDecideFate()</a>, and <a class="el" href="verify_8c-source.html#l00027">rpmVerifyFile()</a>.
</div>
</div><p>
<a class="anchor" name="b2d4f783dd7c3fb997d180a34d851a1b"></a><!-- doxytag: member="legacy.c::expandFilelist" ref="b2d4f783dd7c3fb997d180a34d851a1b" args="(Header h)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void expandFilelist           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structheaderToken__s.html">Header</a>&nbsp;</td>
          <td class="paramname"> <em>h</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Convert (dirname,basename,dirindex) tags to absolute path tag. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>h</em>&nbsp;</td><td>header </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="legacy_8c-source.html#l00421">421</a> of file <a class="el" href="legacy_8c-source.html">legacy.c</a>.
<p>
References <a class="el" href="rpmlib_8h-source.html#l00058">_free()</a>, <a class="el" href="hdrinline_8h-source.html#l00315">headerAddEntry()</a>, <a class="el" href="hdrinline_8h-source.html#l00230">headerIsEntry()</a>, <a class="el" href="hdrinline_8h-source.html#l00417">headerRemoveEntry()</a>, <a class="el" href="header_8h-source.html#l00225">RPM_STRING_ARRAY_TYPE</a>, <a class="el" href="legacy_8c-source.html#l00362">rpmfiBuildFNames()</a>, <a class="el" href="rpmlib_8h-source.html#l00400">RPMTAG_BASENAMES</a>, <a class="el" href="rpmlib_8h-source.html#l00399">RPMTAG_DIRINDEXES</a>, <a class="el" href="rpmlib_8h-source.html#l00401">RPMTAG_DIRNAMES</a>, and <a class="el" href="rpmlib_8h-source.html#l00299">RPMTAG_OLDFILENAMES</a>.
<p>
Referenced by <a class="el" href="files_8c-source.html#l01129">genCpioListAndHeader()</a>, <a class="el" href="header-py_8c-source.html#l00227">hdrExpandFilelist()</a>, and <a class="el" href="rpmdb_8c-source.html#l02939">rpmdbAdd()</a>.
</div>
</div><p>
<a class="anchor" name="3e79dc4647f033f73a7b4c6237875b67"></a><!-- doxytag: member="legacy.c::legacyRetrofit" ref="3e79dc4647f033f73a7b4c6237875b67" args="(Header h, const struct rpmlead *lead)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void legacyRetrofit           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structheaderToken__s.html">Header</a>&nbsp;</td>
          <td class="paramname"> <em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structrpmlead.html">rpmlead</a> *&nbsp;</td>
          <td class="paramname"> <em>lead</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Do all necessary retorfits for a package header. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>h</em>&nbsp;</td><td>header </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>lead</em>&nbsp;</td><td></td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="legacy_8c-source.html#l00530">530</a> of file <a class="el" href="legacy_8c-source.html">legacy.c</a>.
<p>
References <a class="el" href="fsm_8c-source.html#l00034">alloca_strdup</a>, <a class="el" href="legacy_8c-source.html#l00270">compressFilelist()</a>, <a class="el" href="hdrinline_8h-source.html#l00315">headerAddEntry()</a>, <a class="el" href="hdrinline_8h-source.html#l00268">headerGetEntry()</a>, <a class="el" href="hdrinline_8h-source.html#l00230">headerIsEntry()</a>, <a class="el" href="hdrinline_8h-source.html#l00417">headerRemoveEntry()</a>, <a class="el" href="rpmlib_8h-source.html#l01113">rpmlead::major</a>, <a class="el" href="legacy_8c-source.html#l00449">providePackageNVR()</a>, <a class="el" href="header_8h-source.html#l00221">RPM_INT32_TYPE</a>, <a class="el" href="header_8h-source.html#l00225">RPM_STRING_ARRAY_TYPE</a>, <a class="el" href="rpmlib_8h-source.html#l01096">RPMLEAD_SOURCE</a>, <a class="el" href="rpmlib_8h-source.html#l00338">RPMTAG_DEFAULTPREFIX</a>, <a class="el" href="rpmlib_8h-source.html#l00304">RPMTAG_FILEGIDS</a>, <a class="el" href="rpmlib_8h-source.html#l00314">RPMTAG_FILEGROUPNAME</a>, <a class="el" href="rpmlib_8h-source.html#l00303">RPMTAG_FILEUIDS</a>, <a class="el" href="rpmlib_8h-source.html#l00313">RPMTAG_FILEUSERNAME</a>, <a class="el" href="rpmlib_8h-source.html#l00375">RPMTAG_PREFIXES</a>, <a class="el" href="rpmlib_8h-source.html#l00385">RPMTAG_SOURCEPACKAGE</a>, <a class="el" href="misc_8h-source.html#l00050">stripTrailingChar()</a>, and <a class="el" href="rpmlib_8h-source.html#l01115">rpmlead::type</a>.
<p>
Referenced by <a class="el" href="package_8c-source.html#l00748">rpmReadPackageFile()</a>.
</div>
</div><p>
<a class="anchor" name="b3832114edf6afb9433ef5a6113d0ba8"></a><!-- doxytag: member="legacy.c::open_dso" ref="b3832114edf6afb9433ef5a6113d0ba8" args="(const char *path, pid_t *pidp, size_t *fsizep)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int open_dso           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pid_t *&nbsp;</td>
          <td class="paramname"> <em>pidp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&nbsp;</td>
          <td class="paramname"> <em>fsizep</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Open a file descriptor to verify file MD5 and size. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>path</em>&nbsp;</td><td>file path </td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pidp</em>&nbsp;</td><td>prelink helper pid or 0 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fsizep</em>&nbsp;</td><td>file size </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>-1 on error, otherwise, an open file descriptor </dd></dl>

<p>
Definition at line <a class="el" href="legacy_8c-source.html#l00036">36</a> of file <a class="el" href="legacy_8c-source.html">legacy.c</a>.
<p>
References <a class="el" href="signature_8c-source.html#l00030">environ</a>, <a class="el" href="readelf_8h-source.html#l00098">ET_EXEC</a>, <a class="el" href="macro_8c-source.html#l02116">rpmExpand()</a>, and <a class="el" href="system_8h.html#440dcd7dd71b4d668d8b9112643b9e0a">unsetenv()</a>.
<p>
Referenced by <a class="el" href="legacy_8c-source.html#l00148">domd5()</a>.
</div>
</div><p>
<a class="anchor" name="5a9645dfd465c75595ec043f85c70a47"></a><!-- doxytag: member="legacy.c::providePackageNVR" ref="5a9645dfd465c75595ec043f85c70a47" args="(Header h)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void providePackageNVR           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structheaderToken__s.html">Header</a>&nbsp;</td>
          <td class="paramname"> <em>h</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Retrofit a Provides: <a class="el" href="structname.html">name</a> = version-release dependency into legacy package headers. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>h</em>&nbsp;</td><td>header </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="legacy_8c-source.html#l00449">449</a> of file <a class="el" href="legacy_8c-source.html">legacy.c</a>.
<p>
References <a class="el" href="system_8h.html#58ff5c3142f685bf7e95cc0cbfaf49c9">alloca()</a>, <a class="el" href="hdrinline_8h-source.html#l00354">headerAddOrAppendEntry()</a>, <a class="el" href="header_8h-source.html#l00704">headerFreeData()</a>, <a class="el" href="hdrinline_8h-source.html#l00290">headerGetEntryMinMemory()</a>, <a class="el" href="hdrNVR_8c-source.html#l00009">headerNVR()</a>, <a class="el" href="header_8h-source.html#l00221">RPM_INT32_TYPE</a>, <a class="el" href="header_8h-source.html#l00225">RPM_STRING_ARRAY_TYPE</a>, <a class="el" href="rpmlib_8h-source.html#l00498">RPMSENSE_ANY</a>, <a class="el" href="rpmlib_8h-source.html#l00504">RPMSENSE_EQUAL</a>, <a class="el" href="rpmlib_8h-source.html#l00270">RPMTAG_EPOCH</a>, <a class="el" href="rpmlib_8h-source.html#l00395">RPMTAG_PROVIDEFLAGS</a>, <a class="el" href="rpmlib_8h-source.html#l00323">RPMTAG_PROVIDENAME</a>, <a class="el" href="rpmlib_8h-source.html#l00396">RPMTAG_PROVIDEVERSION</a>, and <a class="el" href="system_8h.html#58841684f76853b313e27e663c850381">stpcpy()</a>.
<p>
Referenced by <a class="el" href="header-py_8c-source.html#l00720">hdrLoad()</a>, <a class="el" href="legacy_8c-source.html#l00530">legacyRetrofit()</a>, <a class="el" href="pack_8c-source.html#l00755">packageBinaries()</a>, <a class="el" href="header-py_8c-source.html#l00810">rpmReadHeaders()</a>, and <a class="el" href="pack_8c-source.html#l00420">writeRPM()</a>.
</div>
</div><p>
<a class="anchor" name="7a3747cee9eef44f62969af9b8d4d390"></a><!-- doxytag: member="legacy.c::rpmfiBuildFNames" ref="7a3747cee9eef44f62969af9b8d4d390" args="(Header h, rpmTag tagN, const char ***fnp, int *fcp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rpmfiBuildFNames           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structheaderToken__s.html">Header</a>&nbsp;</td>
          <td class="paramname"> <em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="rpmlib_8h.html#4f08fde948b5511f2a904dc92e39e211">rpmTag</a>&nbsp;</td>
          <td class="paramname"> <em>tagN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char ***&nbsp;</td>
          <td class="paramname"> <em>fnp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>fcp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Retrieve file <a class="el" href="structnames.html">names</a> from header. 
<p>
The representation of file <a class="el" href="structnames.html">names</a> in package headers changed in rpm-4.0. Originally, file <a class="el" href="structnames.html">names</a> were stored as an array of absolute paths. In rpm-4.0, file <a class="el" href="structnames.html">names</a> are stored as separate arrays of dirname's and basename's, * with a dirname index to associate the correct dirname with each basname.<p>
This function is used to retrieve file <a class="el" href="structnames.html">names</a> independent of how the file <a class="el" href="structnames.html">names</a> are represented in the package header.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>h</em>&nbsp;</td><td>header </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tagN</em>&nbsp;</td><td>RPMTAG_BASENAMES | PMTAG_ORIGBASENAMES </td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>*fnp</em>&nbsp;</td><td>array of file <a class="el" href="structnames.html">names</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>*fcp</em>&nbsp;</td><td>number of files </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="legacy_8c-source.html#l00362">362</a> of file <a class="el" href="legacy_8c-source.html">legacy.c</a>.
<p>
References <a class="el" href="rpmlib_8h-source.html#l00058">_free()</a>, <a class="el" href="header_8h-source.html#l00704">headerFreeData()</a>, <a class="el" href="hdrinline_8h-source.html#l00290">headerGetEntryMinMemory()</a>, <a class="el" href="rpmlib_8h-source.html#l00400">RPMTAG_BASENAMES</a>, <a class="el" href="rpmlib_8h-source.html#l00399">RPMTAG_DIRINDEXES</a>, <a class="el" href="rpmlib_8h-source.html#l00401">RPMTAG_DIRNAMES</a>, <a class="el" href="rpmlib_8h-source.html#l00403">RPMTAG_ORIGBASENAMES</a>, <a class="el" href="rpmlib_8h-source.html#l00402">RPMTAG_ORIGDIRINDEXES</a>, <a class="el" href="rpmlib_8h-source.html#l00404">RPMTAG_ORIGDIRNAMES</a>, <a class="el" href="system_8h.html#58841684f76853b313e27e663c850381">stpcpy()</a>, and <a class="el" href="rpmmalloc_8c-source.html#l00024">xmalloc()</a>.
<p>
Referenced by <a class="el" href="legacy_8c-source.html#l00421">expandFilelist()</a>, <a class="el" href="formats_8c-source.html#l00824">filenamesTag()</a>, <a class="el" href="formats_8c-source.html#l00625">fssizesTag()</a>, <a class="el" href="header-py_8c-source.html#l00250">mungeFilelist()</a>, <a class="el" href="lib_2misc_8c-source.html#l00248">rpmHeaderGetEntry()</a>, <a class="el" href="psm_8c-source.html#l00238">rpmInstallSourcePackage()</a>, and <a class="el" href="psm_8c-source.html#l01355">rpmpsmStage()</a>.
</div>
</div><p>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Oct 12 08:44:56 2007 for rpm by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
