<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>rpm: lua/lvm.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul>
</div>
<h1>lua/lvm.c</h1><a href="lvm_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">** $Id: lvm.c,v 1.3 2004/03/23 05:09:14 jbj Exp $</span>
<a name="l00003"></a>00003 <span class="comment">** Lua virtual machine</span>
<a name="l00004"></a>00004 <span class="comment">** See Copyright Notice in lua.h</span>
<a name="l00005"></a>00005 <span class="comment">*/</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="comment">/* needed only when `lua_number2str' uses `sprintf' */</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00014"></a>00014 
<a name="l00015"></a><a class="code" href="lvm_8c.html#75fc5a3f71337e3e6c599efb612d08a4">00015</a> <span class="preprocessor">#define lvm_c</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span>
<a name="l00017"></a>00017 <span class="preprocessor">#include "lua.h"</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="preprocessor">#include "<a class="code" href="ldebug_8h.html">ldebug.h</a>"</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include "<a class="code" href="ldo_8h.html">ldo.h</a>"</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include "<a class="code" href="lfunc_8h.html">lfunc.h</a>"</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include "<a class="code" href="lgc_8h.html">lgc.h</a>"</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include "<a class="code" href="lobject_8h.html">lobject.h</a>"</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include "<a class="code" href="lopcodes_8h.html">lopcodes.h</a>"</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include "<a class="code" href="lstate_8h.html">lstate.h</a>"</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include "<a class="code" href="lstring_8h.html">lstring.h</a>"</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include "<a class="code" href="ltable_8h.html">ltable.h</a>"</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include "<a class="code" href="ltm_8h.html">ltm.h</a>"</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include "<a class="code" href="lvm_8h.html">lvm.h</a>"</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="comment">/* function to convert a lua_Number to a string */</span>
<a name="l00034"></a>00034 <span class="preprocessor">#ifndef lua_number2str</span>
<a name="l00035"></a><a class="code" href="lvm_8c.html#70e07a26b7e88b24d8e885cdfe2dfec5">00035</a> <span class="preprocessor"></span><span class="preprocessor">#define lua_number2str(s,n)     sprintf((s), LUA_NUMBER_FMT, (n))</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="comment">/* limit for table tag-method chains (to avoid loops) */</span>
<a name="l00040"></a><a class="code" href="lvm_8c.html#6058853259ae6cc8e4846ec198fded50">00040</a> <span class="preprocessor">#define MAXTAGLOOP      100</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="lvm_8h.html#e12494c46e4a47eb3e1bb6bb32e08b65">00043</a> <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *<a class="code" href="lvm_8c.html#e12494c46e4a47eb3e1bb6bb32e08b65">luaV_tonumber</a> (<span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *obj, <a class="code" href="structlua__TObject.html">TObject</a> *n) {
<a name="l00044"></a>00044   lua_Number num;
<a name="l00045"></a>00045   <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#68cb1f4d9b30527dc6736266f463dae1">ttisnumber</a>(obj)) <span class="keywordflow">return</span> obj;
<a name="l00046"></a>00046   <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#de10042b5d0ee9d0fb6cd891db3ed073">ttisstring</a>(obj) &amp;&amp; <a class="code" href="lobject_8c.html#db07135af6385173b9734da85a1c709b">luaO_str2d</a>(<a class="code" href="lobject_8h.html#76a9770f1b988898be185c06d0e95356">svalue</a>(obj), &amp;num)) {
<a name="l00047"></a>00047     <a class="code" href="lobject_8h.html#93e2206898108ffb2d6d06d5f0130e91">setnvalue</a>(n, num);
<a name="l00048"></a>00048     <span class="keywordflow">return</span> n;
<a name="l00049"></a>00049   }
<a name="l00050"></a>00050   <span class="keywordflow">else</span>
<a name="l00051"></a>00051     <span class="keywordflow">return</span> NULL;
<a name="l00052"></a>00052 }
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 
<a name="l00055"></a><a class="code" href="lvm_8h.html#4041ac918319594785174f78163ad731">00055</a> <span class="keywordtype">int</span> <a class="code" href="lvm_8c.html#4041ac918319594785174f78163ad731">luaV_tostring</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <a class="code" href="structlua__TObject.html">StkId</a> obj) {
<a name="l00056"></a>00056   <span class="keywordflow">if</span> (!<a class="code" href="lobject_8h.html#68cb1f4d9b30527dc6736266f463dae1">ttisnumber</a>(obj))
<a name="l00057"></a>00057     <span class="keywordflow">return</span> 0;
<a name="l00058"></a>00058   <span class="keywordflow">else</span> {
<a name="l00059"></a>00059     <span class="keywordtype">char</span> s[32];  <span class="comment">/* 16 digits, sign, point and \0  (+ some extra...) */</span>
<a name="l00060"></a>00060     <a class="code" href="lvm_8c.html#70e07a26b7e88b24d8e885cdfe2dfec5">lua_number2str</a>(s, <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(obj));
<a name="l00061"></a>00061     <a class="code" href="lobject_8h.html#050ef69c4ef111c48bdf5cf5703a413e">setsvalue2s</a>(obj, <a class="code" href="lstring_8h.html#780c0cd806913440453924e96cedbc80">luaS_new</a>(L, s));
<a name="l00062"></a>00062     <span class="keywordflow">return</span> 1;
<a name="l00063"></a>00063   }
<a name="l00064"></a>00064 }
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 
<a name="l00067"></a><a class="code" href="lvm_8c.html#4b4d3fd3ad6b84d55ef581881f742151">00067</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="lvm_8c.html#4b4d3fd3ad6b84d55ef581881f742151">traceexec</a> (<a class="code" href="structlua__State.html">lua_State</a> *L)
<a name="l00068"></a>00068         <span class="comment">/*@modifies L @*/</span>
<a name="l00069"></a>00069 {
<a name="l00070"></a>00070   <a class="code" href="llimits_8h.html#64f8b22b40cd3b0d9a7b61d79ae2d98f">lu_byte</a> mask = L-&gt;<a class="code" href="structlua__State.html#2a68a9480178f9424337c072b4d84bf0">hookmask</a>;
<a name="l00071"></a>00071   <span class="keywordflow">if</span> (mask &amp; LUA_MASKCOUNT) {  <span class="comment">/* instruction-hook set? */</span>
<a name="l00072"></a>00072     <span class="keywordflow">if</span> (L-&gt;<a class="code" href="structlua__State.html#bd1197659f3dc04eda03c35750227cf1">hookcount</a> == 0) {
<a name="l00073"></a>00073       <a class="code" href="ldebug_8h.html#fa0ae27155d8b7d040a1358a6c3bbf01">resethookcount</a>(L);
<a name="l00074"></a>00074       <a class="code" href="ldo_8c.html#448dcf574fe4bb19b1066489e0c8fea6">luaD_callhook</a>(L, LUA_HOOKCOUNT, -1);
<a name="l00075"></a>00075       <span class="keywordflow">return</span>;
<a name="l00076"></a>00076     }
<a name="l00077"></a>00077   }
<a name="l00078"></a>00078   <span class="keywordflow">if</span> (mask &amp; LUA_MASKLINE) {
<a name="l00079"></a>00079     <a class="code" href="structCallInfo.html">CallInfo</a> *ci = L-&gt;<a class="code" href="structlua__State.html#fa7a2a70fafed9445c4ede0efce89516">ci</a>;
<a name="l00080"></a>00080     <a class="code" href="structProto.html">Proto</a> *p = <a class="code" href="lstate_8h.html#e216fb062a3db66785aee8164f28e0af">ci_func</a>(ci)-&gt;l.p;
<a name="l00081"></a>00081     <span class="keywordtype">int</span> newline = <a class="code" href="ldebug_8h.html#f97d1ebac6bd1aa94e460adafc6af351">getline</a>(p, <a class="code" href="ldebug_8h.html#bd33cc2183104bbd0e0b476c2fd59644">pcRel</a>(*ci-&gt;<a class="code" href="structCallInfo.html#0ffee6994d4e1b3790ea491595cb72be">u</a>.<a class="code" href="structCallInfo.html#970495ecfbc19bca7b399a9429b25110">l</a>.pc, p));
<a name="l00082"></a>00082     <span class="keywordflow">if</span> (!L-&gt;<a class="code" href="structlua__State.html#acf90b529220e0ebc716f9d955a874f3">hookinit</a>) {
<a name="l00083"></a>00083       <a class="code" href="ldebug_8c.html#fc52ad8683497b3da937768676209a2f">luaG_inithooks</a>(L);
<a name="l00084"></a>00084       <span class="keywordflow">return</span>;
<a name="l00085"></a>00085     }
<a name="l00086"></a>00086     <a class="code" href="llimits_8h.html#c4975de4438f4210aa45d111c923498d">lua_assert</a>(ci-&gt;<a class="code" href="structCallInfo.html#7fc380ecc20c791cbe1da8c9f6622455">state</a> &amp; <a class="code" href="lstate_8h.html#69c606d49428cf3eaaa019f80dd6d173">CI_HASFRAME</a>);
<a name="l00087"></a>00087     <span class="keywordflow">if</span> (<a class="code" href="ldebug_8h.html#bd33cc2183104bbd0e0b476c2fd59644">pcRel</a>(*ci-&gt;<a class="code" href="structCallInfo.html#0ffee6994d4e1b3790ea491595cb72be">u</a>.<a class="code" href="structCallInfo.html#970495ecfbc19bca7b399a9429b25110">l</a>.pc, p) == 0)  <span class="comment">/* tracing may be starting now? */</span>
<a name="l00088"></a>00088       ci-&gt;<a class="code" href="structCallInfo.html#0ffee6994d4e1b3790ea491595cb72be">u</a>.<a class="code" href="structCallInfo.html#970495ecfbc19bca7b399a9429b25110">l</a>.savedpc = *ci-&gt;<a class="code" href="structCallInfo.html#0ffee6994d4e1b3790ea491595cb72be">u</a>.<a class="code" href="structCallInfo.html#970495ecfbc19bca7b399a9429b25110">l</a>.pc;  <span class="comment">/* initialize `savedpc' */</span>
<a name="l00089"></a>00089     <span class="comment">/* calls linehook when enters a new line or jumps back (loop) */</span>
<a name="l00090"></a>00090     <span class="keywordflow">if</span> (*ci-&gt;<a class="code" href="structCallInfo.html#0ffee6994d4e1b3790ea491595cb72be">u</a>.<a class="code" href="structCallInfo.html#970495ecfbc19bca7b399a9429b25110">l</a>.pc &lt;= ci-&gt;<a class="code" href="structCallInfo.html#0ffee6994d4e1b3790ea491595cb72be">u</a>.<a class="code" href="structCallInfo.html#970495ecfbc19bca7b399a9429b25110">l</a>.savedpc ||
<a name="l00091"></a>00091         newline != <a class="code" href="ldebug_8h.html#f97d1ebac6bd1aa94e460adafc6af351">getline</a>(p, <a class="code" href="ldebug_8h.html#bd33cc2183104bbd0e0b476c2fd59644">pcRel</a>(ci-&gt;<a class="code" href="structCallInfo.html#0ffee6994d4e1b3790ea491595cb72be">u</a>.<a class="code" href="structCallInfo.html#970495ecfbc19bca7b399a9429b25110">l</a>.savedpc, p))) {
<a name="l00092"></a>00092       <a class="code" href="ldo_8c.html#448dcf574fe4bb19b1066489e0c8fea6">luaD_callhook</a>(L, LUA_HOOKLINE, newline);
<a name="l00093"></a>00093       ci = L-&gt;ci;  <span class="comment">/* previous call may reallocate `ci' */</span>
<a name="l00094"></a>00094     }
<a name="l00095"></a>00095     ci-&gt;<a class="code" href="structCallInfo.html#0ffee6994d4e1b3790ea491595cb72be">u</a>.<a class="code" href="structCallInfo.html#970495ecfbc19bca7b399a9429b25110">l</a>.savedpc = *ci-&gt;<a class="code" href="structCallInfo.html#0ffee6994d4e1b3790ea491595cb72be">u</a>.<a class="code" href="structCallInfo.html#970495ecfbc19bca7b399a9429b25110">l</a>.pc;
<a name="l00096"></a>00096   }
<a name="l00097"></a>00097 }
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 
<a name="l00100"></a><a class="code" href="lvm_8c.html#d206187ae6f5592b61057ad5a9753b94">00100</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="lvm_8c.html#d206187ae6f5592b61057ad5a9753b94">callTMres</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *f,
<a name="l00101"></a>00101                        <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *p1, <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *p2)
<a name="l00102"></a>00102         <span class="comment">/*@modifies L @*/</span>
<a name="l00103"></a>00103 {
<a name="l00104"></a>00104   <a class="code" href="lobject_8h.html#1d50ac962ab057b3e89ddbb1103b543f">setobj2s</a>(L-&gt;<a class="code" href="structlua__State.html#8c5ea5328fe07cf26f7871db2dff8cdb">top</a>, f);  <span class="comment">/* push function */</span>
<a name="l00105"></a>00105   <a class="code" href="lobject_8h.html#1d50ac962ab057b3e89ddbb1103b543f">setobj2s</a>(L-&gt;<a class="code" href="structlua__State.html#8c5ea5328fe07cf26f7871db2dff8cdb">top</a>+1, p1);  <span class="comment">/* 1st argument */</span>
<a name="l00106"></a>00106   <a class="code" href="lobject_8h.html#1d50ac962ab057b3e89ddbb1103b543f">setobj2s</a>(L-&gt;<a class="code" href="structlua__State.html#8c5ea5328fe07cf26f7871db2dff8cdb">top</a>+2, p2);  <span class="comment">/* 2nd argument */</span>
<a name="l00107"></a>00107   <a class="code" href="ldo_8h.html#d5ff0214874768ccf1017415992fecac">luaD_checkstack</a>(L, 3);  <span class="comment">/* cannot check before (could invalidate p1, p2) */</span>
<a name="l00108"></a>00108   L-&gt;<a class="code" href="structlua__State.html#8c5ea5328fe07cf26f7871db2dff8cdb">top</a> += 3;
<a name="l00109"></a>00109   <a class="code" href="ldo_8c.html#8e21ff41ee2c180bf522747b588a8654">luaD_call</a>(L, L-&gt;<a class="code" href="structlua__State.html#8c5ea5328fe07cf26f7871db2dff8cdb">top</a> - 3, 1);
<a name="l00110"></a>00110   L-&gt;<a class="code" href="structlua__State.html#8c5ea5328fe07cf26f7871db2dff8cdb">top</a>--;  <span class="comment">/* result will be in L-&gt;top */</span>
<a name="l00111"></a>00111 }
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 
<a name="l00115"></a><a class="code" href="lvm_8c.html#f2e1f64c4897416fa150c188b186a8cd">00115</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="lvm_8c.html#f2e1f64c4897416fa150c188b186a8cd">callTM</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *f,
<a name="l00116"></a>00116                     <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *p1, <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *p2, <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *p3)
<a name="l00117"></a>00117         <span class="comment">/*@modifies L @*/</span>
<a name="l00118"></a>00118 {
<a name="l00119"></a>00119   <a class="code" href="lobject_8h.html#1d50ac962ab057b3e89ddbb1103b543f">setobj2s</a>(L-&gt;<a class="code" href="structlua__State.html#8c5ea5328fe07cf26f7871db2dff8cdb">top</a>, f);  <span class="comment">/* push function */</span>
<a name="l00120"></a>00120   <a class="code" href="lobject_8h.html#1d50ac962ab057b3e89ddbb1103b543f">setobj2s</a>(L-&gt;<a class="code" href="structlua__State.html#8c5ea5328fe07cf26f7871db2dff8cdb">top</a>+1, p1);  <span class="comment">/* 1st argument */</span>
<a name="l00121"></a>00121   <a class="code" href="lobject_8h.html#1d50ac962ab057b3e89ddbb1103b543f">setobj2s</a>(L-&gt;<a class="code" href="structlua__State.html#8c5ea5328fe07cf26f7871db2dff8cdb">top</a>+2, p2);  <span class="comment">/* 2nd argument */</span>
<a name="l00122"></a>00122   <a class="code" href="lobject_8h.html#1d50ac962ab057b3e89ddbb1103b543f">setobj2s</a>(L-&gt;<a class="code" href="structlua__State.html#8c5ea5328fe07cf26f7871db2dff8cdb">top</a>+3, p3);  <span class="comment">/* 3th argument */</span>
<a name="l00123"></a>00123   <a class="code" href="ldo_8h.html#d5ff0214874768ccf1017415992fecac">luaD_checkstack</a>(L, 4);  <span class="comment">/* cannot check before (could invalidate p1...p3) */</span>
<a name="l00124"></a>00124   L-&gt;<a class="code" href="structlua__State.html#8c5ea5328fe07cf26f7871db2dff8cdb">top</a> += 4;
<a name="l00125"></a>00125   <a class="code" href="ldo_8c.html#8e21ff41ee2c180bf522747b588a8654">luaD_call</a>(L, L-&gt;<a class="code" href="structlua__State.html#8c5ea5328fe07cf26f7871db2dff8cdb">top</a> - 4, 0);
<a name="l00126"></a>00126 }
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 <span class="comment">/*@observer@*/</span>
<a name="l00130"></a><a class="code" href="lvm_8c.html#1776c2ff7659a67684b35bcd6e7fde1f">00130</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *<a class="code" href="lvm_8c.html#1776c2ff7659a67684b35bcd6e7fde1f">luaV_index</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *t,
<a name="l00131"></a>00131                                   <a class="code" href="structlua__TObject.html">TObject</a> *key, <span class="keywordtype">int</span> loop)
<a name="l00132"></a>00132         <span class="comment">/*@modifies L, t @*/</span>
<a name="l00133"></a>00133 {
<a name="l00134"></a>00134   <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *tm = <a class="code" href="ltm_8h.html#cc1a5efd06c148536a4c4b1e8321cb95">fasttm</a>(L, <a class="code" href="lobject_8h.html#a87e2d7ac731a6ced2e29e7bb9891823">hvalue</a>(t)-&gt;metatable, <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b87311182a2fc9b9e9a642bb492a0d40268c8d0">TM_INDEX</a>);
<a name="l00135"></a>00135   <span class="keywordflow">if</span> (tm == NULL) <span class="keywordflow">return</span> &amp;<a class="code" href="lobject_8c.html#e4bdb689a599e3be1d2c1e7480cb1df0">luaO_nilobject</a>;  <span class="comment">/* no TM */</span>
<a name="l00136"></a>00136   <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#f405409e59f38ccfa7fa308556742afd">ttisfunction</a>(tm)) {
<a name="l00137"></a>00137     <a class="code" href="lvm_8c.html#d206187ae6f5592b61057ad5a9753b94">callTMres</a>(L, tm, t, key);
<a name="l00138"></a>00138     <span class="keywordflow">return</span> L-&gt;top;
<a name="l00139"></a>00139   }
<a name="l00140"></a>00140   <span class="keywordflow">else</span> <span class="keywordflow">return</span> <a class="code" href="lvm_8c.html#3682e60ea232aa7c1d38bf5b6a77a089">luaV_gettable</a>(L, tm, key, loop);
<a name="l00141"></a>00141 }
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="comment">/*@observer@*/</span>
<a name="l00144"></a><a class="code" href="lvm_8c.html#7892ac36a4a1e07da89c1aa8e96d1cc4">00144</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *<a class="code" href="lvm_8c.html#7892ac36a4a1e07da89c1aa8e96d1cc4">luaV_getnotable</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *t,
<a name="l00145"></a>00145                                        <a class="code" href="structlua__TObject.html">TObject</a> *key, <span class="keywordtype">int</span> loop)
<a name="l00146"></a>00146         <span class="comment">/*@modifies L @*/</span>
<a name="l00147"></a>00147 {
<a name="l00148"></a>00148   <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *tm = <a class="code" href="ltm_8c.html#e8efd6107f00b85a3dc1ce07f60c648f">luaT_gettmbyobj</a>(L, t, <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b87311182a2fc9b9e9a642bb492a0d40268c8d0">TM_INDEX</a>);
<a name="l00149"></a>00149   <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#344c0486b08e85fb2c31d1b63359ad2e">ttisnil</a>(tm))
<a name="l00150"></a>00150     <a class="code" href="ldebug_8c.html#665e6a7c936161cb89b297c837f813d4">luaG_typeerror</a>(L, t, <span class="stringliteral">"index"</span>);
<a name="l00151"></a>00151   <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#f405409e59f38ccfa7fa308556742afd">ttisfunction</a>(tm)) {
<a name="l00152"></a>00152     <a class="code" href="lvm_8c.html#d206187ae6f5592b61057ad5a9753b94">callTMres</a>(L, tm, t, key);
<a name="l00153"></a>00153     <span class="keywordflow">return</span> L-&gt;top;
<a name="l00154"></a>00154   }
<a name="l00155"></a>00155 <span class="comment">/*@-modobserver@*/</span>
<a name="l00156"></a>00156   <span class="keywordflow">else</span> <span class="keywordflow">return</span> <a class="code" href="lvm_8c.html#3682e60ea232aa7c1d38bf5b6a77a089">luaV_gettable</a>(L, tm, key, loop);
<a name="l00157"></a>00157 <span class="comment">/*@=modobserver@*/</span>
<a name="l00158"></a>00158 }
<a name="l00159"></a>00159 
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 <span class="comment">/*</span>
<a name="l00162"></a>00162 <span class="comment">** Function to index a table.</span>
<a name="l00163"></a>00163 <span class="comment">** Receives the table at `t' and the key at `key'.</span>
<a name="l00164"></a>00164 <span class="comment">** leaves the result at `res'.</span>
<a name="l00165"></a>00165 <span class="comment">*/</span>
<a name="l00166"></a><a class="code" href="lvm_8h.html#3682e60ea232aa7c1d38bf5b6a77a089">00166</a> <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *<a class="code" href="lvm_8c.html#3682e60ea232aa7c1d38bf5b6a77a089">luaV_gettable</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *t, <a class="code" href="structlua__TObject.html">TObject</a> *key,
<a name="l00167"></a>00167                               <span class="keywordtype">int</span> loop) {
<a name="l00168"></a>00168   <span class="keywordflow">if</span> (loop &gt; <a class="code" href="lvm_8c.html#6058853259ae6cc8e4846ec198fded50">MAXTAGLOOP</a>)
<a name="l00169"></a>00169     <a class="code" href="ldebug_8c.html#e46448881e12f78e438526c46c5081ed">luaG_runerror</a>(L, <span class="stringliteral">"loop in gettable"</span>);
<a name="l00170"></a>00170   <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#8ec7da7ba2002d41cdb0430a4396b3e2">ttistable</a>(t)) {  <span class="comment">/* `t' is a table? */</span>
<a name="l00171"></a>00171     <a class="code" href="structTable.html">Table</a> *h = <a class="code" href="lobject_8h.html#a87e2d7ac731a6ced2e29e7bb9891823">hvalue</a>(t);
<a name="l00172"></a>00172     <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *v = <a class="code" href="ltable_8c.html#09200bed948e4efc8ca8d233b3481cc0">luaH_get</a>(h, key);  <span class="comment">/* do a primitive get */</span>
<a name="l00173"></a>00173     <span class="keywordflow">if</span> (!<a class="code" href="lobject_8h.html#344c0486b08e85fb2c31d1b63359ad2e">ttisnil</a>(v)) <span class="keywordflow">return</span> v;
<a name="l00174"></a>00174     <span class="keywordflow">else</span> <span class="keywordflow">return</span> <a class="code" href="lvm_8c.html#1776c2ff7659a67684b35bcd6e7fde1f">luaV_index</a>(L, t, key, loop+1);
<a name="l00175"></a>00175   }
<a name="l00176"></a>00176   <span class="keywordflow">else</span> <span class="keywordflow">return</span> <a class="code" href="lvm_8c.html#7892ac36a4a1e07da89c1aa8e96d1cc4">luaV_getnotable</a>(L, t, key, loop+1);
<a name="l00177"></a>00177 }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 <span class="comment">/*</span>
<a name="l00181"></a>00181 <span class="comment">** Receives table at `t', key at `key' and value at `val'.</span>
<a name="l00182"></a>00182 <span class="comment">*/</span>
<a name="l00183"></a><a class="code" href="lvm_8h.html#c9ff8c8a78d451b8e109db53e1c7a510">00183</a> <span class="keywordtype">void</span> <a class="code" href="lvm_8c.html#c9ff8c8a78d451b8e109db53e1c7a510">luaV_settable</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *t, <a class="code" href="structlua__TObject.html">TObject</a> *key, <a class="code" href="structlua__TObject.html">StkId</a> val) {
<a name="l00184"></a>00184   <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *tm;
<a name="l00185"></a>00185   <span class="keywordtype">int</span> loop = 0;
<a name="l00186"></a>00186   <span class="keywordflow">do</span> {
<a name="l00187"></a>00187     <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#8ec7da7ba2002d41cdb0430a4396b3e2">ttistable</a>(t)) {  <span class="comment">/* `t' is a table? */</span>
<a name="l00188"></a>00188       <a class="code" href="structTable.html">Table</a> *h = <a class="code" href="lobject_8h.html#a87e2d7ac731a6ced2e29e7bb9891823">hvalue</a>(t);
<a name="l00189"></a>00189       <a class="code" href="structlua__TObject.html">TObject</a> *oldval = <a class="code" href="ltable_8c.html#f5ad9bf060df23d1f85629cb0c35a8d2">luaH_set</a>(L, h, key); <span class="comment">/* do a primitive set */</span>
<a name="l00190"></a>00190       <span class="keywordflow">if</span> (!<a class="code" href="lobject_8h.html#344c0486b08e85fb2c31d1b63359ad2e">ttisnil</a>(oldval) ||  <span class="comment">/* result is no nil? */</span>
<a name="l00191"></a>00191           (tm = <a class="code" href="ltm_8h.html#cc1a5efd06c148536a4c4b1e8321cb95">fasttm</a>(L, h-&gt;<a class="code" href="structTable.html#555ea0bae60b13366c0f130737c00c5f">metatable</a>, <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b873111f38b23c73597224b7bda58fe1f69f8c7">TM_NEWINDEX</a>)) == NULL) { <span class="comment">/* or no TM? */</span>
<a name="l00192"></a>00192         <a class="code" href="lobject_8h.html#a2b9eaa62e6a32f5acf22ac269dea749">setobj2t</a>(oldval, val);  <span class="comment">/* write barrier */</span>
<a name="l00193"></a>00193         <span class="keywordflow">return</span>;
<a name="l00194"></a>00194       }
<a name="l00195"></a>00195       <span class="comment">/* else will try the tag method */</span>
<a name="l00196"></a>00196     }
<a name="l00197"></a>00197     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#344c0486b08e85fb2c31d1b63359ad2e">ttisnil</a>(tm = <a class="code" href="ltm_8c.html#e8efd6107f00b85a3dc1ce07f60c648f">luaT_gettmbyobj</a>(L, t, <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b873111f38b23c73597224b7bda58fe1f69f8c7">TM_NEWINDEX</a>)))
<a name="l00198"></a>00198       <a class="code" href="ldebug_8c.html#665e6a7c936161cb89b297c837f813d4">luaG_typeerror</a>(L, t, <span class="stringliteral">"index"</span>);
<a name="l00199"></a>00199     <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#f405409e59f38ccfa7fa308556742afd">ttisfunction</a>(tm)) {
<a name="l00200"></a>00200       <a class="code" href="lvm_8c.html#f2e1f64c4897416fa150c188b186a8cd">callTM</a>(L, tm, t, key, val);
<a name="l00201"></a>00201       <span class="keywordflow">return</span>;
<a name="l00202"></a>00202     }
<a name="l00203"></a>00203     t = tm;  <span class="comment">/* else repeat with `tm' */</span> 
<a name="l00204"></a>00204   } <span class="keywordflow">while</span> (++loop &lt;= <a class="code" href="lvm_8c.html#6058853259ae6cc8e4846ec198fded50">MAXTAGLOOP</a>);
<a name="l00205"></a>00205   <a class="code" href="ldebug_8c.html#e46448881e12f78e438526c46c5081ed">luaG_runerror</a>(L, <span class="stringliteral">"loop in settable"</span>);
<a name="l00206"></a>00206 }
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 
<a name="l00209"></a><a class="code" href="lvm_8c.html#e7e68e9bad64d6d9675f183b520537f3">00209</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="lvm_8c.html#e7e68e9bad64d6d9675f183b520537f3">call_binTM</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *p1, <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *p2,
<a name="l00210"></a>00210                        <a class="code" href="structlua__TObject.html">StkId</a> res, <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b873111">TMS</a> event)
<a name="l00211"></a>00211         <span class="comment">/*@modifies L @*/</span>
<a name="l00212"></a>00212 {
<a name="l00213"></a>00213   ptrdiff_t result = <a class="code" href="ldo_8h.html#4c0524c6931a29d416e52bbf291bad6e">savestack</a>(L, res);
<a name="l00214"></a>00214   <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *tm = <a class="code" href="ltm_8c.html#e8efd6107f00b85a3dc1ce07f60c648f">luaT_gettmbyobj</a>(L, p1, event);  <span class="comment">/* try first operand */</span>
<a name="l00215"></a>00215   <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#344c0486b08e85fb2c31d1b63359ad2e">ttisnil</a>(tm))
<a name="l00216"></a>00216     tm = <a class="code" href="ltm_8c.html#e8efd6107f00b85a3dc1ce07f60c648f">luaT_gettmbyobj</a>(L, p2, event);  <span class="comment">/* try second operand */</span>
<a name="l00217"></a>00217   <span class="keywordflow">if</span> (!<a class="code" href="lobject_8h.html#f405409e59f38ccfa7fa308556742afd">ttisfunction</a>(tm)) <span class="keywordflow">return</span> 0;
<a name="l00218"></a>00218   <a class="code" href="lvm_8c.html#d206187ae6f5592b61057ad5a9753b94">callTMres</a>(L, tm, p1, p2);
<a name="l00219"></a>00219   res = <a class="code" href="ldo_8h.html#c547472262482a682c96b321cf4734ab">restorestack</a>(L, result);  <span class="comment">/* previous call may change stack */</span>
<a name="l00220"></a>00220   <a class="code" href="lobject_8h.html#bec8d92c9803a6870ff69dbc6d77a5b5">setobjs2s</a>(res, L-&gt;<a class="code" href="structlua__State.html#8c5ea5328fe07cf26f7871db2dff8cdb">top</a>);
<a name="l00221"></a>00221   <span class="keywordflow">return</span> 1;
<a name="l00222"></a>00222 }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 
<a name="l00225"></a>00225 <span class="comment">/*@null@*/</span>
<a name="l00226"></a><a class="code" href="lvm_8c.html#1b83234dd646b5af2db3be5c211044e1">00226</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *<a class="code" href="lvm_8c.html#1b83234dd646b5af2db3be5c211044e1">get_compTM</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <a class="code" href="structTable.html">Table</a> *mt1, <a class="code" href="structTable.html">Table</a> *mt2,
<a name="l00227"></a>00227                                   <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b873111">TMS</a> event)
<a name="l00228"></a>00228         <span class="comment">/*@modifies mt1, mt2 @*/</span>
<a name="l00229"></a>00229 {
<a name="l00230"></a>00230   <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *tm1 = <a class="code" href="ltm_8h.html#cc1a5efd06c148536a4c4b1e8321cb95">fasttm</a>(L, mt1, event);
<a name="l00231"></a>00231   <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *tm2;
<a name="l00232"></a>00232   <span class="keywordflow">if</span> (tm1 == NULL) <span class="keywordflow">return</span> NULL;  <span class="comment">/* no metamethod */</span>
<a name="l00233"></a>00233   <span class="keywordflow">if</span> (mt1 == mt2) <span class="keywordflow">return</span> tm1;  <span class="comment">/* same metatables =&gt; same metamethods */</span>
<a name="l00234"></a>00234   tm2 = <a class="code" href="ltm_8h.html#cc1a5efd06c148536a4c4b1e8321cb95">fasttm</a>(L, mt2, event);
<a name="l00235"></a>00235   <span class="keywordflow">if</span> (tm2 == NULL) <span class="keywordflow">return</span> NULL;  <span class="comment">/* no metamethod */</span>
<a name="l00236"></a>00236   <span class="keywordflow">if</span> (<a class="code" href="lobject_8c.html#2aad8c91ed030a5ac8a9e8effcce7188">luaO_rawequalObj</a>(tm1, tm2))  <span class="comment">/* same metamethods? */</span>
<a name="l00237"></a>00237     <span class="keywordflow">return</span> tm1;
<a name="l00238"></a>00238   <span class="keywordflow">return</span> NULL;
<a name="l00239"></a>00239 }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 
<a name="l00242"></a><a class="code" href="lvm_8c.html#021098699c0c8edf5c640bd144da8d27">00242</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="lvm_8c.html#021098699c0c8edf5c640bd144da8d27">call_orderTM</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *p1, <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *p2,
<a name="l00243"></a>00243                          <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b873111">TMS</a> event)
<a name="l00244"></a>00244         <span class="comment">/*@modifies L @*/</span>
<a name="l00245"></a>00245 {
<a name="l00246"></a>00246   <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *tm1 = <a class="code" href="ltm_8c.html#e8efd6107f00b85a3dc1ce07f60c648f">luaT_gettmbyobj</a>(L, p1, event);
<a name="l00247"></a>00247   <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *tm2;
<a name="l00248"></a>00248   <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#344c0486b08e85fb2c31d1b63359ad2e">ttisnil</a>(tm1)) <span class="keywordflow">return</span> -1;  <span class="comment">/* no metamethod? */</span>
<a name="l00249"></a>00249   tm2 = <a class="code" href="ltm_8c.html#e8efd6107f00b85a3dc1ce07f60c648f">luaT_gettmbyobj</a>(L, p2, event);
<a name="l00250"></a>00250   <span class="keywordflow">if</span> (!<a class="code" href="lobject_8c.html#2aad8c91ed030a5ac8a9e8effcce7188">luaO_rawequalObj</a>(tm1, tm2))  <span class="comment">/* different metamethods? */</span>
<a name="l00251"></a>00251     <span class="keywordflow">return</span> -1;
<a name="l00252"></a>00252   <a class="code" href="lvm_8c.html#d206187ae6f5592b61057ad5a9753b94">callTMres</a>(L, tm1, p1, p2);
<a name="l00253"></a>00253   <span class="keywordflow">return</span> !<a class="code" href="lobject_8h.html#1f7b4b9967d91fd87fc59e89a0abb841">l_isfalse</a>(L-&gt;<a class="code" href="structlua__State.html#8c5ea5328fe07cf26f7871db2dff8cdb">top</a>);
<a name="l00254"></a>00254 }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256 
<a name="l00257"></a><a class="code" href="lvm_8c.html#42456a206909695a5ef5bc6396b056b8">00257</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="lvm_8c.html#42456a206909695a5ef5bc6396b056b8">luaV_strcmp</a> (<span class="keyword">const</span> <a class="code" href="unionTString.html">TString</a> *ls, <span class="keyword">const</span> <a class="code" href="unionTString.html">TString</a> *rs)
<a name="l00258"></a>00258         <span class="comment">/*@*/</span>
<a name="l00259"></a>00259 {
<a name="l00260"></a>00260   <span class="keyword">const</span> <span class="keywordtype">char</span> *l = <a class="code" href="lobject_8h.html#5e329e8c5c9d6804b34af1edda2189a5">getstr</a>(ls);
<a name="l00261"></a>00261   <span class="keywordtype">size_t</span> ll = ls-&gt;<a class="code" href="unionTString.html#5b5f3aab62cfc3aeaae8c437156d62b1">tsv</a>.<a class="code" href="unionTString.html#6928dfd1613dd5107c7f01feead68575">len</a>;
<a name="l00262"></a>00262   <span class="keyword">const</span> <span class="keywordtype">char</span> *r = <a class="code" href="lobject_8h.html#5e329e8c5c9d6804b34af1edda2189a5">getstr</a>(rs);
<a name="l00263"></a>00263   <span class="keywordtype">size_t</span> lr = rs-&gt;<a class="code" href="unionTString.html#5b5f3aab62cfc3aeaae8c437156d62b1">tsv</a>.<a class="code" href="unionTString.html#6928dfd1613dd5107c7f01feead68575">len</a>;
<a name="l00264"></a>00264   <span class="keywordflow">for</span> (;;) {
<a name="l00265"></a>00265     <span class="keywordtype">int</span> temp = strcoll(l, r);
<a name="l00266"></a>00266     <span class="keywordflow">if</span> (temp != 0) <span class="keywordflow">return</span> temp;
<a name="l00267"></a>00267     <span class="keywordflow">else</span> {  <span class="comment">/* strings are equal up to a `\0' */</span>
<a name="l00268"></a>00268       <span class="keywordtype">size_t</span> len = strlen(l);  <span class="comment">/* index of first `\0' in both strings */</span>
<a name="l00269"></a>00269       <span class="keywordflow">if</span> (len == lr)  <span class="comment">/* r is finished? */</span>
<a name="l00270"></a>00270         <span class="keywordflow">return</span> (len == ll) ? 0 : 1;
<a name="l00271"></a>00271       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len == ll)  <span class="comment">/* l is finished? */</span>
<a name="l00272"></a>00272         <span class="keywordflow">return</span> -1;  <span class="comment">/* l is smaller than r (because r is not finished) */</span>
<a name="l00273"></a>00273       <span class="comment">/* both strings longer than `len'; go on comparing (after the `\0') */</span>
<a name="l00274"></a>00274       len++;
<a name="l00275"></a>00275       l += len; ll -= len; r += len; lr -= len;
<a name="l00276"></a>00276     }
<a name="l00277"></a>00277   }
<a name="l00278"></a>00278 }
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 
<a name="l00281"></a><a class="code" href="lvm_8h.html#f43af2f76caabc3c21b9088a7b17618e">00281</a> <span class="keywordtype">int</span> <a class="code" href="lvm_8c.html#f43af2f76caabc3c21b9088a7b17618e">luaV_lessthan</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *l, <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *r) {
<a name="l00282"></a>00282   <span class="keywordtype">int</span> res;
<a name="l00283"></a>00283   <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#9ebc2a3d8da310624ddc540d72e68dc5">ttype</a>(l) != <a class="code" href="lobject_8h.html#9ebc2a3d8da310624ddc540d72e68dc5">ttype</a>(r))
<a name="l00284"></a>00284     <span class="keywordflow">return</span> <a class="code" href="ldebug_8c.html#38711e6d02ca223fc3d045242522e2f1">luaG_ordererror</a>(L, l, r);
<a name="l00285"></a>00285   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#68cb1f4d9b30527dc6736266f463dae1">ttisnumber</a>(l))
<a name="l00286"></a>00286     <span class="keywordflow">return</span> <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(l) &lt; <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(r);
<a name="l00287"></a>00287   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#de10042b5d0ee9d0fb6cd891db3ed073">ttisstring</a>(l))
<a name="l00288"></a>00288     <span class="keywordflow">return</span> <a class="code" href="lvm_8c.html#42456a206909695a5ef5bc6396b056b8">luaV_strcmp</a>(<a class="code" href="lobject_8h.html#6d13c36ebbe624d33d15307cc93b2cf7">tsvalue</a>(l), <a class="code" href="lobject_8h.html#6d13c36ebbe624d33d15307cc93b2cf7">tsvalue</a>(r)) &lt; 0;
<a name="l00289"></a>00289   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((res = <a class="code" href="lvm_8c.html#021098699c0c8edf5c640bd144da8d27">call_orderTM</a>(L, l, r, <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b873111e962e9a8e73510dbe1769684ab4ad009">TM_LT</a>)) != -1)
<a name="l00290"></a>00290     <span class="keywordflow">return</span> res;
<a name="l00291"></a>00291   <span class="keywordflow">return</span> <a class="code" href="ldebug_8c.html#38711e6d02ca223fc3d045242522e2f1">luaG_ordererror</a>(L, l, r);
<a name="l00292"></a>00292 }
<a name="l00293"></a>00293 
<a name="l00294"></a>00294 
<a name="l00295"></a><a class="code" href="lvm_8c.html#570f78e3174c27e4455fa8176cf558eb">00295</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="lvm_8c.html#570f78e3174c27e4455fa8176cf558eb">luaV_lessequal</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *l, <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *r)
<a name="l00296"></a>00296         <span class="comment">/*@modifies L @*/</span>
<a name="l00297"></a>00297 {
<a name="l00298"></a>00298   <span class="keywordtype">int</span> res;
<a name="l00299"></a>00299   <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#9ebc2a3d8da310624ddc540d72e68dc5">ttype</a>(l) != <a class="code" href="lobject_8h.html#9ebc2a3d8da310624ddc540d72e68dc5">ttype</a>(r))
<a name="l00300"></a>00300     <span class="keywordflow">return</span> <a class="code" href="ldebug_8c.html#38711e6d02ca223fc3d045242522e2f1">luaG_ordererror</a>(L, l, r);
<a name="l00301"></a>00301   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#68cb1f4d9b30527dc6736266f463dae1">ttisnumber</a>(l))
<a name="l00302"></a>00302     <span class="keywordflow">return</span> <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(l) &lt;= <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(r);
<a name="l00303"></a>00303   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#de10042b5d0ee9d0fb6cd891db3ed073">ttisstring</a>(l))
<a name="l00304"></a>00304     <span class="keywordflow">return</span> <a class="code" href="lvm_8c.html#42456a206909695a5ef5bc6396b056b8">luaV_strcmp</a>(<a class="code" href="lobject_8h.html#6d13c36ebbe624d33d15307cc93b2cf7">tsvalue</a>(l), <a class="code" href="lobject_8h.html#6d13c36ebbe624d33d15307cc93b2cf7">tsvalue</a>(r)) &lt;= 0;
<a name="l00305"></a>00305   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((res = <a class="code" href="lvm_8c.html#021098699c0c8edf5c640bd144da8d27">call_orderTM</a>(L, l, r, <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b873111c2fc8b7e42bdf5c4b37bf76e5722f7e6">TM_LE</a>)) != -1)  <span class="comment">/* first try `le' */</span>
<a name="l00306"></a>00306     <span class="keywordflow">return</span> res;
<a name="l00307"></a>00307   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((res = <a class="code" href="lvm_8c.html#021098699c0c8edf5c640bd144da8d27">call_orderTM</a>(L, r, l, <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b873111e962e9a8e73510dbe1769684ab4ad009">TM_LT</a>)) != -1)  <span class="comment">/* else try `lt' */</span>
<a name="l00308"></a>00308     <span class="keywordflow">return</span> !res;
<a name="l00309"></a>00309   <span class="keywordflow">return</span> <a class="code" href="ldebug_8c.html#38711e6d02ca223fc3d045242522e2f1">luaG_ordererror</a>(L, l, r);
<a name="l00310"></a>00310 }
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 
<a name="l00313"></a><a class="code" href="lvm_8h.html#e84959106acf7c05c7d34515dc6ce70e">00313</a> <span class="keywordtype">int</span> <a class="code" href="lvm_8c.html#e84959106acf7c05c7d34515dc6ce70e">luaV_equalval</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *t1, <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *t2) {
<a name="l00314"></a>00314   <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *tm;
<a name="l00315"></a>00315   <a class="code" href="llimits_8h.html#c4975de4438f4210aa45d111c923498d">lua_assert</a>(<a class="code" href="lobject_8h.html#9ebc2a3d8da310624ddc540d72e68dc5">ttype</a>(t1) == <a class="code" href="lobject_8h.html#9ebc2a3d8da310624ddc540d72e68dc5">ttype</a>(t2));
<a name="l00316"></a>00316   <span class="keywordflow">switch</span> (<a class="code" href="lobject_8h.html#9ebc2a3d8da310624ddc540d72e68dc5">ttype</a>(t1)) {
<a name="l00317"></a>00317     <span class="keywordflow">case</span> LUA_TNIL: <span class="keywordflow">return</span> 1;
<a name="l00318"></a>00318     <span class="keywordflow">case</span> LUA_TNUMBER: <span class="keywordflow">return</span> <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(t1) == <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(t2);
<a name="l00319"></a>00319     <span class="keywordflow">case</span> LUA_TBOOLEAN: <span class="keywordflow">return</span> <a class="code" href="lobject_8h.html#b59ef37f5bd23f7fc41d35843d45bfa5">bvalue</a>(t1) == <a class="code" href="lobject_8h.html#b59ef37f5bd23f7fc41d35843d45bfa5">bvalue</a>(t2);  <span class="comment">/* true must be 1 !! */</span>
<a name="l00320"></a>00320     <span class="keywordflow">case</span> LUA_TLIGHTUSERDATA: <span class="keywordflow">return</span> <a class="code" href="lobject_8h.html#8fec42888ccaf7d7267f23894d5bac10">pvalue</a>(t1) == <a class="code" href="lobject_8h.html#8fec42888ccaf7d7267f23894d5bac10">pvalue</a>(t2);
<a name="l00321"></a>00321     <span class="keywordflow">case</span> LUA_TUSERDATA: {
<a name="l00322"></a>00322       <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#6813685aa76c68682ae188221ff1541c">uvalue</a>(t1) == <a class="code" href="lobject_8h.html#6813685aa76c68682ae188221ff1541c">uvalue</a>(t2)) <span class="keywordflow">return</span> 1;
<a name="l00323"></a>00323       tm = <a class="code" href="lvm_8c.html#1b83234dd646b5af2db3be5c211044e1">get_compTM</a>(L, <a class="code" href="lobject_8h.html#6813685aa76c68682ae188221ff1541c">uvalue</a>(t1)-&gt;uv.metatable, <a class="code" href="lobject_8h.html#6813685aa76c68682ae188221ff1541c">uvalue</a>(t2)-&gt;uv.metatable,
<a name="l00324"></a>00324                          <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b8731115f906e3d34fd30b29280206b4ffc99e2">TM_EQ</a>);
<a name="l00325"></a>00325       <span class="keywordflow">break</span>;  <span class="comment">/* will try TM */</span>
<a name="l00326"></a>00326     }
<a name="l00327"></a>00327     <span class="keywordflow">case</span> LUA_TTABLE: {
<a name="l00328"></a>00328       <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#a87e2d7ac731a6ced2e29e7bb9891823">hvalue</a>(t1) == <a class="code" href="lobject_8h.html#a87e2d7ac731a6ced2e29e7bb9891823">hvalue</a>(t2)) <span class="keywordflow">return</span> 1;
<a name="l00329"></a>00329       tm = <a class="code" href="lvm_8c.html#1b83234dd646b5af2db3be5c211044e1">get_compTM</a>(L, <a class="code" href="lobject_8h.html#a87e2d7ac731a6ced2e29e7bb9891823">hvalue</a>(t1)-&gt;metatable, <a class="code" href="lobject_8h.html#a87e2d7ac731a6ced2e29e7bb9891823">hvalue</a>(t2)-&gt;metatable, <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b8731115f906e3d34fd30b29280206b4ffc99e2">TM_EQ</a>);
<a name="l00330"></a>00330       <span class="keywordflow">break</span>;  <span class="comment">/* will try TM */</span>
<a name="l00331"></a>00331     }
<a name="l00332"></a>00332     <span class="keywordflow">default</span>: <span class="keywordflow">return</span> <a class="code" href="lobject_8h.html#30ceb3b00890172023fa1fcadd96fd56">gcvalue</a>(t1) == <a class="code" href="lobject_8h.html#30ceb3b00890172023fa1fcadd96fd56">gcvalue</a>(t2);
<a name="l00333"></a>00333   }
<a name="l00334"></a>00334   <span class="keywordflow">if</span> (tm == NULL) <span class="keywordflow">return</span> 0;  <span class="comment">/* no TM? */</span>
<a name="l00335"></a>00335   <a class="code" href="lvm_8c.html#d206187ae6f5592b61057ad5a9753b94">callTMres</a>(L, tm, t1, t2);  <span class="comment">/* call TM */</span>
<a name="l00336"></a>00336   <span class="keywordflow">return</span> !<a class="code" href="lobject_8h.html#1f7b4b9967d91fd87fc59e89a0abb841">l_isfalse</a>(L-&gt;<a class="code" href="structlua__State.html#8c5ea5328fe07cf26f7871db2dff8cdb">top</a>);
<a name="l00337"></a>00337 }
<a name="l00338"></a>00338 
<a name="l00339"></a>00339 
<a name="l00340"></a><a class="code" href="lvm_8h.html#0bd01d7a5f39b6f2c23ebd973849840f">00340</a> <span class="keywordtype">void</span> <a class="code" href="lvm_8c.html#0bd01d7a5f39b6f2c23ebd973849840f">luaV_concat</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> total, <span class="keywordtype">int</span> last) {
<a name="l00341"></a>00341   <span class="keywordflow">do</span> {
<a name="l00342"></a>00342     <a class="code" href="structlua__TObject.html">StkId</a> top = L-&gt;<a class="code" href="structlua__State.html#d83d03a2544d7ea885657d516724ddc9">base</a> + last + 1;
<a name="l00343"></a>00343     <span class="keywordtype">int</span> n = 2;  <span class="comment">/* number of elements handled in this pass (at least 2) */</span>
<a name="l00344"></a>00344     <span class="keywordflow">if</span> (!<a class="code" href="lvm_8h.html#fb1d2857baaa45355dcb4c483e4fcdbf">tostring</a>(L, top-2) || !<a class="code" href="lvm_8h.html#fb1d2857baaa45355dcb4c483e4fcdbf">tostring</a>(L, top-1)) {
<a name="l00345"></a>00345       <span class="keywordflow">if</span> (!<a class="code" href="lvm_8c.html#e7e68e9bad64d6d9675f183b520537f3">call_binTM</a>(L, top-2, top-1, top-2, <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b87311121ee5e18f07d0f3775199c20a4084cb9">TM_CONCAT</a>))
<a name="l00346"></a>00346         <a class="code" href="ldebug_8c.html#c5aa3a7e61746aa8b6a4ac6b2a9f7e12">luaG_concaterror</a>(L, top-2, top-1);
<a name="l00347"></a>00347     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#6d13c36ebbe624d33d15307cc93b2cf7">tsvalue</a>(top-1)-&gt;tsv.len &gt; 0) {  <span class="comment">/* if len=0, do nothing */</span>
<a name="l00348"></a>00348       <span class="comment">/* at least two string values; get as many as possible */</span>
<a name="l00349"></a>00349       <a class="code" href="llimits_8h.html#fc2ed184646ea6ecdffcad97c95c3611">lu_mem</a> tl = <a class="code" href="llimits_8h.html#f469cd45a80dd7d512ca0dff225a99ce">cast</a>(<a class="code" href="llimits_8h.html#fc2ed184646ea6ecdffcad97c95c3611">lu_mem</a>, <a class="code" href="lobject_8h.html#6d13c36ebbe624d33d15307cc93b2cf7">tsvalue</a>(top-1)-&gt;tsv.len) +
<a name="l00350"></a>00350                   <a class="code" href="llimits_8h.html#f469cd45a80dd7d512ca0dff225a99ce">cast</a>(<a class="code" href="llimits_8h.html#fc2ed184646ea6ecdffcad97c95c3611">lu_mem</a>, <a class="code" href="lobject_8h.html#6d13c36ebbe624d33d15307cc93b2cf7">tsvalue</a>(top-2)-&gt;tsv.len);
<a name="l00351"></a>00351       <span class="keywordtype">char</span> *buffer;
<a name="l00352"></a>00352       <span class="keywordtype">int</span> i;
<a name="l00353"></a>00353       <span class="keywordflow">while</span> (n &lt; total &amp;&amp; <a class="code" href="lvm_8h.html#fb1d2857baaa45355dcb4c483e4fcdbf">tostring</a>(L, top-n-1)) {  <span class="comment">/* collect total length */</span>
<a name="l00354"></a>00354         tl += <a class="code" href="lobject_8h.html#6d13c36ebbe624d33d15307cc93b2cf7">tsvalue</a>(top-n-1)-&gt;tsv.len;
<a name="l00355"></a>00355         n++;
<a name="l00356"></a>00356       }
<a name="l00357"></a>00357       <span class="keywordflow">if</span> (tl &gt; <a class="code" href="llimits_8h.html#f8d922ca06918cda52479213ac290e53">MAX_SIZET</a>) <a class="code" href="ldebug_8c.html#e46448881e12f78e438526c46c5081ed">luaG_runerror</a>(L, <span class="stringliteral">"string size overflow"</span>);
<a name="l00358"></a>00358       buffer = <a class="code" href="lzio_8c.html#c181e8d1628f771768332d42204857e4">luaZ_openspace</a>(L, &amp;<a class="code" href="lstate_8h.html#0125ace4e680108699344e83736df60b">G</a>(L)-&gt;buff, tl);
<a name="l00359"></a>00359       tl = 0;
<a name="l00360"></a>00360       <span class="keywordflow">for</span> (i=n; i&gt;0; i--) {  <span class="comment">/* concat all strings */</span>
<a name="l00361"></a>00361         <span class="keywordtype">size_t</span> l = <a class="code" href="lobject_8h.html#6d13c36ebbe624d33d15307cc93b2cf7">tsvalue</a>(top-i)-&gt;tsv.len;
<a name="l00362"></a>00362         memcpy(buffer+tl, <a class="code" href="lobject_8h.html#76a9770f1b988898be185c06d0e95356">svalue</a>(top-i), l);
<a name="l00363"></a>00363         tl += l;
<a name="l00364"></a>00364       }
<a name="l00365"></a>00365       <a class="code" href="lobject_8h.html#050ef69c4ef111c48bdf5cf5703a413e">setsvalue2s</a>(top-n, <a class="code" href="lstring_8c.html#63764b86a26ae664d57e9e8e546f3729">luaS_newlstr</a>(L, buffer, tl));
<a name="l00366"></a>00366     }
<a name="l00367"></a>00367     total -= n-1;  <span class="comment">/* got `n' strings to create 1 new */</span>
<a name="l00368"></a>00368     last -= n-1;
<a name="l00369"></a>00369   } <span class="keywordflow">while</span> (total &gt; 1);  <span class="comment">/* repeat until only 1 result left */</span>
<a name="l00370"></a>00370 }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372 
<a name="l00373"></a><a class="code" href="lvm_8c.html#7bdbff14776f809109ececd9bef27a2d">00373</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="lvm_8c.html#7bdbff14776f809109ececd9bef27a2d">Arith</a> (<a class="code" href="structlua__State.html">lua_State</a> *L, <a class="code" href="structlua__TObject.html">StkId</a> ra,
<a name="l00374"></a>00374                    <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *rb, <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *rc, <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b873111">TMS</a> op)
<a name="l00375"></a>00375         <span class="comment">/*@modifies L, ra @*/</span>
<a name="l00376"></a>00376 {
<a name="l00377"></a>00377   <a class="code" href="structlua__TObject.html">TObject</a> tempb, tempc;
<a name="l00378"></a>00378   <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *b, *c;
<a name="l00379"></a>00379   <span class="keywordflow">if</span> ((b = <a class="code" href="lvm_8c.html#e12494c46e4a47eb3e1bb6bb32e08b65">luaV_tonumber</a>(rb, &amp;tempb)) != NULL &amp;&amp;
<a name="l00380"></a>00380       (c = <a class="code" href="lvm_8c.html#e12494c46e4a47eb3e1bb6bb32e08b65">luaV_tonumber</a>(rc, &amp;tempc)) != NULL) {
<a name="l00381"></a>00381     <span class="keywordflow">switch</span> (op) {
<a name="l00382"></a>00382       <span class="keywordflow">case</span> <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b87311141ebc4eb5d01f64a9250313a2413b1d2">TM_ADD</a>: <a class="code" href="lobject_8h.html#93e2206898108ffb2d6d06d5f0130e91">setnvalue</a>(ra, <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(b) + <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(c)); <span class="keywordflow">break</span>;
<a name="l00383"></a>00383       <span class="keywordflow">case</span> <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b87311128e53c7f1b7737563d04798f00935007">TM_SUB</a>: <a class="code" href="lobject_8h.html#93e2206898108ffb2d6d06d5f0130e91">setnvalue</a>(ra, <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(b) - <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(c)); <span class="keywordflow">break</span>;
<a name="l00384"></a>00384       <span class="keywordflow">case</span> <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b87311115fe71d49096e2ce6a1ed33b3aa45459">TM_MUL</a>: <a class="code" href="lobject_8h.html#93e2206898108ffb2d6d06d5f0130e91">setnvalue</a>(ra, <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(b) * <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(c)); <span class="keywordflow">break</span>;
<a name="l00385"></a>00385       <span class="keywordflow">case</span> <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b873111ebc0e3e3d84b923b91607705694bb03f">TM_DIV</a>: <a class="code" href="lobject_8h.html#93e2206898108ffb2d6d06d5f0130e91">setnvalue</a>(ra, <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(b) / <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(c)); <span class="keywordflow">break</span>;
<a name="l00386"></a>00386       <span class="keywordflow">case</span> <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b873111e5f8732d4fc44223ec61352caef84ca9">TM_POW</a>: {
<a name="l00387"></a>00387         <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *f = <a class="code" href="ltable_8c.html#162360563b1f37e4a3d2eddbd845f756">luaH_getstr</a>(<a class="code" href="lobject_8h.html#a87e2d7ac731a6ced2e29e7bb9891823">hvalue</a>(<a class="code" href="lstate_8h.html#8bba35a935dda83dfaed658080d21dbd">gt</a>(L)), <a class="code" href="lstate_8h.html#0125ace4e680108699344e83736df60b">G</a>(L)-&gt;tmname[<a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b873111e5f8732d4fc44223ec61352caef84ca9">TM_POW</a>]);
<a name="l00388"></a>00388         ptrdiff_t res = <a class="code" href="ldo_8h.html#4c0524c6931a29d416e52bbf291bad6e">savestack</a>(L, ra);
<a name="l00389"></a>00389         <span class="keywordflow">if</span> (!<a class="code" href="lobject_8h.html#f405409e59f38ccfa7fa308556742afd">ttisfunction</a>(f))
<a name="l00390"></a>00390           <a class="code" href="ldebug_8c.html#e46448881e12f78e438526c46c5081ed">luaG_runerror</a>(L, <span class="stringliteral">"`__pow' (`^' operator) is not a function"</span>);
<a name="l00391"></a>00391         <a class="code" href="lvm_8c.html#d206187ae6f5592b61057ad5a9753b94">callTMres</a>(L, f, b, c);
<a name="l00392"></a>00392         ra = <a class="code" href="ldo_8h.html#c547472262482a682c96b321cf4734ab">restorestack</a>(L, res);  <span class="comment">/* previous call may change stack */</span>
<a name="l00393"></a>00393         <a class="code" href="lobject_8h.html#bec8d92c9803a6870ff69dbc6d77a5b5">setobjs2s</a>(ra, L-&gt;top);
<a name="l00394"></a>00394         <span class="keywordflow">break</span>;
<a name="l00395"></a>00395       }
<a name="l00396"></a>00396       <span class="keywordflow">default</span>: <a class="code" href="llimits_8h.html#c4975de4438f4210aa45d111c923498d">lua_assert</a>(0); <span class="keywordflow">break</span>;
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398   }
<a name="l00399"></a>00399   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="lvm_8c.html#e7e68e9bad64d6d9675f183b520537f3">call_binTM</a>(L, rb, rc, ra, op))
<a name="l00400"></a>00400     <a class="code" href="ldebug_8c.html#1e03595e5dfe45b4670ae372c352c4bd">luaG_aritherror</a>(L, rb, rc);
<a name="l00401"></a>00401 }
<a name="l00402"></a>00402 
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 
<a name="l00405"></a>00405 <span class="comment">/*</span>
<a name="l00406"></a>00406 <span class="comment">** some macros for common tasks in `luaV_execute'</span>
<a name="l00407"></a>00407 <span class="comment">*/</span>
<a name="l00408"></a>00408 
<a name="l00409"></a><a class="code" href="lvm_8c.html#9d2821e4d59185d2d2b9b20b4457b6aa">00409</a> <span class="preprocessor">#define runtime_check(L, c)     { if (!(c)) return 0; }</span>
<a name="l00410"></a>00410 <span class="preprocessor"></span>
<a name="l00411"></a><a class="code" href="lvm_8c.html#3404543e1612baa3eae87665206318e1">00411</a> <span class="preprocessor">#define RA(i)   (base+GETARG_A(i))</span>
<a name="l00412"></a>00412 <span class="preprocessor"></span><span class="comment">/* to be used after possible stack reallocation */</span>
<a name="l00413"></a><a class="code" href="lvm_8c.html#a132066e99629d785935e2c9ba217369">00413</a> <span class="preprocessor">#define XRA(i)  (L-&gt;base+GETARG_A(i))</span>
<a name="l00414"></a><a class="code" href="lvm_8c.html#96e4545705c431d62f5c71027c111e80">00414</a> <span class="preprocessor"></span><span class="preprocessor">#define RB(i)   (base+GETARG_B(i))</span>
<a name="l00415"></a><a class="code" href="lvm_8c.html#20fbba7ab405dd85a00c2397b5a69f1e">00415</a> <span class="preprocessor"></span><span class="preprocessor">#define RKB(i)  ((GETARG_B(i) &lt; MAXSTACK) ? RB(i) : k+GETARG_B(i)-MAXSTACK)</span>
<a name="l00416"></a><a class="code" href="lvm_8c.html#6e409842e84b203517ca6b224f61439b">00416</a> <span class="preprocessor"></span><span class="preprocessor">#define RC(i)   (base+GETARG_C(i))</span>
<a name="l00417"></a><a class="code" href="lvm_8c.html#aab6967a11ecbaa72464f8a5f7e280a3">00417</a> <span class="preprocessor"></span><span class="preprocessor">#define RKC(i)  ((GETARG_C(i) &lt; MAXSTACK) ? RC(i) : k+GETARG_C(i)-MAXSTACK)</span>
<a name="l00418"></a><a class="code" href="lvm_8c.html#21d2e0ab141e55162fad91c199024e41">00418</a> <span class="preprocessor"></span><span class="preprocessor">#define KBx(i)  (k+GETARG_Bx(i))</span>
<a name="l00419"></a>00419 <span class="preprocessor"></span>
<a name="l00420"></a>00420 
<a name="l00421"></a><a class="code" href="lvm_8c.html#82ea2276a00426b3b382905cc21b0807">00421</a> <span class="preprocessor">#define dojump(pc, i)   ((pc) += (i))</span>
<a name="l00422"></a>00422 <span class="preprocessor"></span>
<a name="l00423"></a>00423 
<a name="l00424"></a><a class="code" href="lvm_8h.html#19358df69e09dd9dfb37cc0a241b7584">00424</a> <a class="code" href="structlua__TObject.html">StkId</a> <a class="code" href="lvm_8c.html#19358df69e09dd9dfb37cc0a241b7584">luaV_execute</a> (<a class="code" href="structlua__State.html">lua_State</a> *L) {
<a name="l00425"></a>00425   <a class="code" href="structLClosure.html">LClosure</a> *cl;
<a name="l00426"></a>00426   <a class="code" href="structlua__TObject.html">TObject</a> *k;
<a name="l00427"></a>00427   <span class="keyword">const</span> <a class="code" href="llimits_8h.html#cca3addb395457bf751bd428dad257b0">Instruction</a> *pc;
<a name="l00428"></a>00428  callentry:  <span class="comment">/* entry point when calling new functions */</span>
<a name="l00429"></a>00429   <span class="keywordflow">if</span> (L-&gt;<a class="code" href="structlua__State.html#2a68a9480178f9424337c072b4d84bf0">hookmask</a> &amp; LUA_MASKCALL) {
<a name="l00430"></a>00430     L-&gt;<a class="code" href="structlua__State.html#fa7a2a70fafed9445c4ede0efce89516">ci</a>-&gt;<a class="code" href="structCallInfo.html#0ffee6994d4e1b3790ea491595cb72be">u</a>.<a class="code" href="structCallInfo.html#970495ecfbc19bca7b399a9429b25110">l</a>.pc = &amp;pc;
<a name="l00431"></a>00431     <a class="code" href="ldo_8c.html#448dcf574fe4bb19b1066489e0c8fea6">luaD_callhook</a>(L, LUA_HOOKCALL, -1);
<a name="l00432"></a>00432   }
<a name="l00433"></a>00433  retentry:  <span class="comment">/* entry point when returning to old functions */</span>
<a name="l00434"></a>00434   L-&gt;<a class="code" href="structlua__State.html#fa7a2a70fafed9445c4ede0efce89516">ci</a>-&gt;<a class="code" href="structCallInfo.html#0ffee6994d4e1b3790ea491595cb72be">u</a>.<a class="code" href="structCallInfo.html#970495ecfbc19bca7b399a9429b25110">l</a>.pc = &amp;pc;
<a name="l00435"></a>00435   <a class="code" href="llimits_8h.html#c4975de4438f4210aa45d111c923498d">lua_assert</a>(L-&gt;<a class="code" href="structlua__State.html#fa7a2a70fafed9445c4ede0efce89516">ci</a>-&gt;<a class="code" href="structCallInfo.html#7fc380ecc20c791cbe1da8c9f6622455">state</a> == <a class="code" href="lstate_8h.html#ce1f59a843ac99ab98646599c44b1611">CI_SAVEDPC</a> ||
<a name="l00436"></a>00436              L-&gt;<a class="code" href="structlua__State.html#fa7a2a70fafed9445c4ede0efce89516">ci</a>-&gt;<a class="code" href="structCallInfo.html#7fc380ecc20c791cbe1da8c9f6622455">state</a> == (<a class="code" href="lstate_8h.html#ce1f59a843ac99ab98646599c44b1611">CI_SAVEDPC</a> | <a class="code" href="lstate_8h.html#bdf7df873f952e0e5b25b780406887d8">CI_CALLING</a>));
<a name="l00437"></a>00437   L-&gt;<a class="code" href="structlua__State.html#fa7a2a70fafed9445c4ede0efce89516">ci</a>-&gt;<a class="code" href="structCallInfo.html#7fc380ecc20c791cbe1da8c9f6622455">state</a> = <a class="code" href="lstate_8h.html#69c606d49428cf3eaaa019f80dd6d173">CI_HASFRAME</a>;  <span class="comment">/* activate frame */</span>
<a name="l00438"></a>00438   pc = L-&gt;<a class="code" href="structlua__State.html#fa7a2a70fafed9445c4ede0efce89516">ci</a>-&gt;<a class="code" href="structCallInfo.html#0ffee6994d4e1b3790ea491595cb72be">u</a>.<a class="code" href="structCallInfo.html#970495ecfbc19bca7b399a9429b25110">l</a>.savedpc;
<a name="l00439"></a>00439   cl = &amp;<a class="code" href="lobject_8h.html#f47acf7913d69d3910cb9eea727b18b0">clvalue</a>(L-&gt;<a class="code" href="structlua__State.html#d83d03a2544d7ea885657d516724ddc9">base</a> - 1)-&gt;l;
<a name="l00440"></a>00440   k = cl-&gt;<a class="code" href="structLClosure.html#37d5e74eea26bcc86939c972dfff18eb">p</a>-&gt;<a class="code" href="structProto.html#858fef033e8f2c3d5193daea5fb9986c">k</a>;
<a name="l00441"></a>00441   <span class="comment">/* main loop of interpreter */</span>
<a name="l00442"></a>00442   <span class="keywordflow">for</span> (;;) {
<a name="l00443"></a>00443     <span class="keyword">const</span> <a class="code" href="llimits_8h.html#cca3addb395457bf751bd428dad257b0">Instruction</a> i = *pc++;
<a name="l00444"></a>00444     <a class="code" href="structlua__TObject.html">StkId</a> base, ra;
<a name="l00445"></a>00445     <span class="keywordflow">if</span> ((L-&gt;<a class="code" href="structlua__State.html#2a68a9480178f9424337c072b4d84bf0">hookmask</a> &amp; (LUA_MASKLINE | LUA_MASKCOUNT)) &amp;&amp;
<a name="l00446"></a>00446         (--L-&gt;<a class="code" href="structlua__State.html#bd1197659f3dc04eda03c35750227cf1">hookcount</a> == 0 || L-&gt;<a class="code" href="structlua__State.html#2a68a9480178f9424337c072b4d84bf0">hookmask</a> &amp; LUA_MASKLINE)) {
<a name="l00447"></a>00447       <a class="code" href="lvm_8c.html#4b4d3fd3ad6b84d55ef581881f742151">traceexec</a>(L);
<a name="l00448"></a>00448       <span class="keywordflow">if</span> (L-&gt;ci-&gt;state &amp; <a class="code" href="lstate_8h.html#f2fea01f4d3b1116be741cbf66f0603f">CI_YIELD</a>) {  <span class="comment">/* did hook yield? */</span>
<a name="l00449"></a>00449         L-&gt;ci-&gt;u.l.savedpc = pc - 1;
<a name="l00450"></a>00450         L-&gt;ci-&gt;state = CI_YIELD | <a class="code" href="lstate_8h.html#ce1f59a843ac99ab98646599c44b1611">CI_SAVEDPC</a>;
<a name="l00451"></a>00451         <span class="keywordflow">return</span> NULL;
<a name="l00452"></a>00452       }
<a name="l00453"></a>00453     }
<a name="l00454"></a>00454     <span class="comment">/* warning!! several calls may realloc the stack and invalidate `ra' */</span>
<a name="l00455"></a>00455     base = L-&gt;base;
<a name="l00456"></a>00456     ra = <a class="code" href="lvm_8c.html#3404543e1612baa3eae87665206318e1">RA</a>(i);
<a name="l00457"></a>00457     <a class="code" href="llimits_8h.html#c4975de4438f4210aa45d111c923498d">lua_assert</a>(L-&gt;ci-&gt;state &amp; <a class="code" href="lstate_8h.html#69c606d49428cf3eaaa019f80dd6d173">CI_HASFRAME</a>);
<a name="l00458"></a>00458     <a class="code" href="llimits_8h.html#c4975de4438f4210aa45d111c923498d">lua_assert</a>(base == L-&gt;ci-&gt;base);
<a name="l00459"></a>00459     <a class="code" href="llimits_8h.html#c4975de4438f4210aa45d111c923498d">lua_assert</a>(L-&gt;top &lt;= L-&gt;stack + L-&gt;stacksize &amp;&amp; L-&gt;top &gt;= base);
<a name="l00460"></a>00460     <a class="code" href="llimits_8h.html#c4975de4438f4210aa45d111c923498d">lua_assert</a>(L-&gt;top == L-&gt;ci-&gt;top ||
<a name="l00461"></a>00461          <a class="code" href="lopcodes_8h.html#c534aadfac00831d34aa121193db8e88">GET_OPCODE</a>(i) == <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8dd9857b702bebf2d3d62c67f937b52fa">OP_CALL</a> ||   <a class="code" href="lopcodes_8h.html#c534aadfac00831d34aa121193db8e88">GET_OPCODE</a>(i) == <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8c56e23be8dea19d7e8a75285bab1cac4">OP_TAILCALL</a> ||
<a name="l00462"></a>00462          <a class="code" href="lopcodes_8h.html#c534aadfac00831d34aa121193db8e88">GET_OPCODE</a>(i) == <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f89ca6ffb0b699ee287919f5d151d76c57">OP_RETURN</a> || <a class="code" href="lopcodes_8h.html#c534aadfac00831d34aa121193db8e88">GET_OPCODE</a>(i) == <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8f36c7cc1a55304c111cb016e8c88396a">OP_SETLISTO</a>);
<a name="l00463"></a>00463     <span class="keywordflow">switch</span> (<a class="code" href="lopcodes_8h.html#c534aadfac00831d34aa121193db8e88">GET_OPCODE</a>(i)) {
<a name="l00464"></a>00464       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f89a45e5b03f75222f95232ad9d96ec252">OP_MOVE</a>: {
<a name="l00465"></a>00465         <a class="code" href="lobject_8h.html#bec8d92c9803a6870ff69dbc6d77a5b5">setobjs2s</a>(ra, <a class="code" href="lvm_8c.html#96e4545705c431d62f5c71027c111e80">RB</a>(i));
<a name="l00466"></a>00466         <span class="keywordflow">break</span>;
<a name="l00467"></a>00467       }
<a name="l00468"></a>00468       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f821061309b8ce575e20d51138d725a0b1">OP_LOADK</a>: {
<a name="l00469"></a>00469         <a class="code" href="lobject_8h.html#1d50ac962ab057b3e89ddbb1103b543f">setobj2s</a>(ra, <a class="code" href="lvm_8c.html#21d2e0ab141e55162fad91c199024e41">KBx</a>(i));
<a name="l00470"></a>00470         <span class="keywordflow">break</span>;
<a name="l00471"></a>00471       }
<a name="l00472"></a>00472       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8f01c42e5508fdf39a4968d8c8deb0e09">OP_LOADBOOL</a>: {
<a name="l00473"></a>00473         <a class="code" href="lobject_8h.html#dd0a6a4123be48bd8b01366663e1ade9">setbvalue</a>(ra, <a class="code" href="lopcodes_8h.html#59d1e6aadb0052fa6edc4c9500f88c3f">GETARG_B</a>(i));
<a name="l00474"></a>00474         <span class="keywordflow">if</span> (<a class="code" href="lopcodes_8h.html#e2885b1cb338f15dce1f7628aee686c0">GETARG_C</a>(i)) pc++;  <span class="comment">/* skip next instruction (if C) */</span>
<a name="l00475"></a>00475         <span class="keywordflow">break</span>;
<a name="l00476"></a>00476       }
<a name="l00477"></a>00477       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f83279f88d983880567a6e87174a22dff6">OP_LOADNIL</a>: {
<a name="l00478"></a>00478         <a class="code" href="structlua__TObject.html">TObject</a> *rb = <a class="code" href="lvm_8c.html#96e4545705c431d62f5c71027c111e80">RB</a>(i);
<a name="l00479"></a>00479         <span class="keywordflow">do</span> {
<a name="l00480"></a>00480           <a class="code" href="lobject_8h.html#f648493e16661b749b1d1c4611d793dd">setnilvalue</a>(rb--);
<a name="l00481"></a>00481         } <span class="keywordflow">while</span> (rb &gt;= ra);
<a name="l00482"></a>00482         <span class="keywordflow">break</span>;
<a name="l00483"></a>00483       }
<a name="l00484"></a>00484       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f80c96592c1ab5bb60e10eb42eb6e435aa">OP_GETUPVAL</a>: {
<a name="l00485"></a>00485         <span class="keywordtype">int</span> b = <a class="code" href="lopcodes_8h.html#59d1e6aadb0052fa6edc4c9500f88c3f">GETARG_B</a>(i);
<a name="l00486"></a>00486         <a class="code" href="lobject_8h.html#1d50ac962ab057b3e89ddbb1103b543f">setobj2s</a>(ra, cl-&gt;upvals[b]-&gt;v);
<a name="l00487"></a>00487         <span class="keywordflow">break</span>;
<a name="l00488"></a>00488       }
<a name="l00489"></a>00489       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f88f4a1f0944efde71d0f95f29693808b2">OP_GETGLOBAL</a>: {
<a name="l00490"></a>00490         <a class="code" href="structlua__TObject.html">TObject</a> *rb = <a class="code" href="lvm_8c.html#21d2e0ab141e55162fad91c199024e41">KBx</a>(i);
<a name="l00491"></a>00491         <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *v;
<a name="l00492"></a>00492         <a class="code" href="llimits_8h.html#c4975de4438f4210aa45d111c923498d">lua_assert</a>(<a class="code" href="lobject_8h.html#de10042b5d0ee9d0fb6cd891db3ed073">ttisstring</a>(rb) &amp;&amp; <a class="code" href="lobject_8h.html#8ec7da7ba2002d41cdb0430a4396b3e2">ttistable</a>(&amp;cl-&gt;g));
<a name="l00493"></a>00493         v = <a class="code" href="ltable_8c.html#162360563b1f37e4a3d2eddbd845f756">luaH_getstr</a>(<a class="code" href="lobject_8h.html#a87e2d7ac731a6ced2e29e7bb9891823">hvalue</a>(&amp;cl-&gt;g), <a class="code" href="lobject_8h.html#6d13c36ebbe624d33d15307cc93b2cf7">tsvalue</a>(rb));
<a name="l00494"></a>00494         <span class="keywordflow">if</span> (!<a class="code" href="lobject_8h.html#344c0486b08e85fb2c31d1b63359ad2e">ttisnil</a>(v)) { <a class="code" href="lobject_8h.html#1d50ac962ab057b3e89ddbb1103b543f">setobj2s</a>(ra, v); }
<a name="l00495"></a>00495         <span class="keywordflow">else</span>
<a name="l00496"></a>00496           <a class="code" href="lobject_8h.html#1d50ac962ab057b3e89ddbb1103b543f">setobj2s</a>(<a class="code" href="lvm_8c.html#a132066e99629d785935e2c9ba217369">XRA</a>(i), <a class="code" href="lvm_8c.html#1776c2ff7659a67684b35bcd6e7fde1f">luaV_index</a>(L, &amp;cl-&gt;g, rb, 0));
<a name="l00497"></a>00497         <span class="keywordflow">break</span>;
<a name="l00498"></a>00498       }
<a name="l00499"></a>00499       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f806aba2f78387b3f823f0cfc425ba473e">OP_GETTABLE</a>: {
<a name="l00500"></a>00500         <a class="code" href="structlua__TObject.html">StkId</a> rb = <a class="code" href="lvm_8c.html#96e4545705c431d62f5c71027c111e80">RB</a>(i);
<a name="l00501"></a>00501         <a class="code" href="structlua__TObject.html">TObject</a> *rc = <a class="code" href="lvm_8c.html#aab6967a11ecbaa72464f8a5f7e280a3">RKC</a>(i);
<a name="l00502"></a>00502         <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#8ec7da7ba2002d41cdb0430a4396b3e2">ttistable</a>(rb)) {
<a name="l00503"></a>00503           <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *v = <a class="code" href="ltable_8c.html#09200bed948e4efc8ca8d233b3481cc0">luaH_get</a>(<a class="code" href="lobject_8h.html#a87e2d7ac731a6ced2e29e7bb9891823">hvalue</a>(rb), rc);
<a name="l00504"></a>00504           <span class="keywordflow">if</span> (!<a class="code" href="lobject_8h.html#344c0486b08e85fb2c31d1b63359ad2e">ttisnil</a>(v)) { <a class="code" href="lobject_8h.html#1d50ac962ab057b3e89ddbb1103b543f">setobj2s</a>(ra, v); }
<a name="l00505"></a>00505           <span class="keywordflow">else</span>
<a name="l00506"></a>00506             <a class="code" href="lobject_8h.html#1d50ac962ab057b3e89ddbb1103b543f">setobj2s</a>(<a class="code" href="lvm_8c.html#a132066e99629d785935e2c9ba217369">XRA</a>(i), <a class="code" href="lvm_8c.html#1776c2ff7659a67684b35bcd6e7fde1f">luaV_index</a>(L, rb, rc, 0));
<a name="l00507"></a>00507         }
<a name="l00508"></a>00508         <span class="keywordflow">else</span>
<a name="l00509"></a>00509           <a class="code" href="lobject_8h.html#1d50ac962ab057b3e89ddbb1103b543f">setobj2s</a>(<a class="code" href="lvm_8c.html#a132066e99629d785935e2c9ba217369">XRA</a>(i), <a class="code" href="lvm_8c.html#7892ac36a4a1e07da89c1aa8e96d1cc4">luaV_getnotable</a>(L, rb, rc, 0));
<a name="l00510"></a>00510         <span class="keywordflow">break</span>;
<a name="l00511"></a>00511       }
<a name="l00512"></a>00512       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8136b7248bd6ca204f865aacf56fc3147">OP_SETGLOBAL</a>: {
<a name="l00513"></a>00513         <a class="code" href="llimits_8h.html#c4975de4438f4210aa45d111c923498d">lua_assert</a>(<a class="code" href="lobject_8h.html#de10042b5d0ee9d0fb6cd891db3ed073">ttisstring</a>(<a class="code" href="lvm_8c.html#21d2e0ab141e55162fad91c199024e41">KBx</a>(i)) &amp;&amp; <a class="code" href="lobject_8h.html#8ec7da7ba2002d41cdb0430a4396b3e2">ttistable</a>(&amp;cl-&gt;g));
<a name="l00514"></a>00514         <a class="code" href="lvm_8c.html#c9ff8c8a78d451b8e109db53e1c7a510">luaV_settable</a>(L, &amp;cl-&gt;g, <a class="code" href="lvm_8c.html#21d2e0ab141e55162fad91c199024e41">KBx</a>(i), ra);
<a name="l00515"></a>00515         <span class="keywordflow">break</span>;
<a name="l00516"></a>00516       }
<a name="l00517"></a>00517       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8e379a7c92e7e53cb806754789158d443">OP_SETUPVAL</a>: {
<a name="l00518"></a>00518         <span class="keywordtype">int</span> b = <a class="code" href="lopcodes_8h.html#59d1e6aadb0052fa6edc4c9500f88c3f">GETARG_B</a>(i);
<a name="l00519"></a>00519         <a class="code" href="lobject_8h.html#007f642b7e03515febf4466a6ab0ef81">setobj</a>(cl-&gt;upvals[b]-&gt;v, ra);  <span class="comment">/* write barrier */</span>
<a name="l00520"></a>00520         <span class="keywordflow">break</span>;
<a name="l00521"></a>00521       }
<a name="l00522"></a>00522       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8dca08b0d0f5d427b9457702d1b1e28ae">OP_SETTABLE</a>: {
<a name="l00523"></a>00523         <a class="code" href="lvm_8c.html#c9ff8c8a78d451b8e109db53e1c7a510">luaV_settable</a>(L, ra, <a class="code" href="lvm_8c.html#20fbba7ab405dd85a00c2397b5a69f1e">RKB</a>(i), <a class="code" href="lvm_8c.html#aab6967a11ecbaa72464f8a5f7e280a3">RKC</a>(i));
<a name="l00524"></a>00524         <span class="keywordflow">break</span>;
<a name="l00525"></a>00525       }
<a name="l00526"></a>00526       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8f0091b5fea3fe56a9b7d4e146932c68f">OP_NEWTABLE</a>: {
<a name="l00527"></a>00527         <span class="keywordtype">int</span> b = <a class="code" href="lopcodes_8h.html#59d1e6aadb0052fa6edc4c9500f88c3f">GETARG_B</a>(i);
<a name="l00528"></a>00528         b = <a class="code" href="lobject_8h.html#07843c0f2f4e6422a20a110c83b3a9b3">fb2int</a>(b);
<a name="l00529"></a>00529         <a class="code" href="lobject_8h.html#f29567f303a0ecb4e29ff0debec071b6">sethvalue</a>(ra, <a class="code" href="ltable_8c.html#b09f1312cf62dd1ff690330cff6b308a">luaH_new</a>(L, b, <a class="code" href="lopcodes_8h.html#e2885b1cb338f15dce1f7628aee686c0">GETARG_C</a>(i)));
<a name="l00530"></a>00530         <a class="code" href="lgc_8h.html#c7a20fe758f8e8222a93260ffac9ee06">luaC_checkGC</a>(L);
<a name="l00531"></a>00531         <span class="keywordflow">break</span>;
<a name="l00532"></a>00532       }
<a name="l00533"></a>00533       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8c10dc9bf02f0908196ac866c123d1e65">OP_SELF</a>: {
<a name="l00534"></a>00534         <a class="code" href="structlua__TObject.html">StkId</a> rb = <a class="code" href="lvm_8c.html#96e4545705c431d62f5c71027c111e80">RB</a>(i);
<a name="l00535"></a>00535         <a class="code" href="structlua__TObject.html">TObject</a> *rc = <a class="code" href="lvm_8c.html#aab6967a11ecbaa72464f8a5f7e280a3">RKC</a>(i);
<a name="l00536"></a>00536         <a class="code" href="lvm_8c.html#9d2821e4d59185d2d2b9b20b4457b6aa">runtime_check</a>(L, <a class="code" href="lobject_8h.html#de10042b5d0ee9d0fb6cd891db3ed073">ttisstring</a>(rc));
<a name="l00537"></a>00537         <a class="code" href="lobject_8h.html#bec8d92c9803a6870ff69dbc6d77a5b5">setobjs2s</a>(ra+1, rb);
<a name="l00538"></a>00538         <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#8ec7da7ba2002d41cdb0430a4396b3e2">ttistable</a>(rb)) {
<a name="l00539"></a>00539           <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *v = <a class="code" href="ltable_8c.html#162360563b1f37e4a3d2eddbd845f756">luaH_getstr</a>(<a class="code" href="lobject_8h.html#a87e2d7ac731a6ced2e29e7bb9891823">hvalue</a>(rb), <a class="code" href="lobject_8h.html#6d13c36ebbe624d33d15307cc93b2cf7">tsvalue</a>(rc));
<a name="l00540"></a>00540           <span class="keywordflow">if</span> (!<a class="code" href="lobject_8h.html#344c0486b08e85fb2c31d1b63359ad2e">ttisnil</a>(v)) { <a class="code" href="lobject_8h.html#1d50ac962ab057b3e89ddbb1103b543f">setobj2s</a>(ra, v); }
<a name="l00541"></a>00541           <span class="keywordflow">else</span>
<a name="l00542"></a>00542             <a class="code" href="lobject_8h.html#1d50ac962ab057b3e89ddbb1103b543f">setobj2s</a>(<a class="code" href="lvm_8c.html#a132066e99629d785935e2c9ba217369">XRA</a>(i), <a class="code" href="lvm_8c.html#1776c2ff7659a67684b35bcd6e7fde1f">luaV_index</a>(L, rb, rc, 0));
<a name="l00543"></a>00543         }
<a name="l00544"></a>00544         <span class="keywordflow">else</span>
<a name="l00545"></a>00545           <a class="code" href="lobject_8h.html#1d50ac962ab057b3e89ddbb1103b543f">setobj2s</a>(<a class="code" href="lvm_8c.html#a132066e99629d785935e2c9ba217369">XRA</a>(i), <a class="code" href="lvm_8c.html#7892ac36a4a1e07da89c1aa8e96d1cc4">luaV_getnotable</a>(L, rb, rc, 0));
<a name="l00546"></a>00546         <span class="keywordflow">break</span>;
<a name="l00547"></a>00547       }
<a name="l00548"></a>00548       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f87904a633eed55be4f9a362d5519b8e55">OP_ADD</a>: {
<a name="l00549"></a>00549         <a class="code" href="structlua__TObject.html">TObject</a> *rb = <a class="code" href="lvm_8c.html#20fbba7ab405dd85a00c2397b5a69f1e">RKB</a>(i);
<a name="l00550"></a>00550         <a class="code" href="structlua__TObject.html">TObject</a> *rc = <a class="code" href="lvm_8c.html#aab6967a11ecbaa72464f8a5f7e280a3">RKC</a>(i);
<a name="l00551"></a>00551         <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#68cb1f4d9b30527dc6736266f463dae1">ttisnumber</a>(rb) &amp;&amp; <a class="code" href="lobject_8h.html#68cb1f4d9b30527dc6736266f463dae1">ttisnumber</a>(rc)) {
<a name="l00552"></a>00552           <a class="code" href="lobject_8h.html#93e2206898108ffb2d6d06d5f0130e91">setnvalue</a>(ra, <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(rb) + <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(rc));
<a name="l00553"></a>00553         }
<a name="l00554"></a>00554         <span class="keywordflow">else</span>
<a name="l00555"></a>00555           <a class="code" href="lvm_8c.html#7bdbff14776f809109ececd9bef27a2d">Arith</a>(L, ra, rb, rc, <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b87311141ebc4eb5d01f64a9250313a2413b1d2">TM_ADD</a>);
<a name="l00556"></a>00556         <span class="keywordflow">break</span>;
<a name="l00557"></a>00557       }
<a name="l00558"></a>00558       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8e1ae8e7680817abd1890816683def91d">OP_SUB</a>: {
<a name="l00559"></a>00559         <a class="code" href="structlua__TObject.html">TObject</a> *rb = <a class="code" href="lvm_8c.html#20fbba7ab405dd85a00c2397b5a69f1e">RKB</a>(i);
<a name="l00560"></a>00560         <a class="code" href="structlua__TObject.html">TObject</a> *rc = <a class="code" href="lvm_8c.html#aab6967a11ecbaa72464f8a5f7e280a3">RKC</a>(i);
<a name="l00561"></a>00561         <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#68cb1f4d9b30527dc6736266f463dae1">ttisnumber</a>(rb) &amp;&amp; <a class="code" href="lobject_8h.html#68cb1f4d9b30527dc6736266f463dae1">ttisnumber</a>(rc)) {
<a name="l00562"></a>00562           <a class="code" href="lobject_8h.html#93e2206898108ffb2d6d06d5f0130e91">setnvalue</a>(ra, <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(rb) - <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(rc));
<a name="l00563"></a>00563         }
<a name="l00564"></a>00564         <span class="keywordflow">else</span>
<a name="l00565"></a>00565           <a class="code" href="lvm_8c.html#7bdbff14776f809109ececd9bef27a2d">Arith</a>(L, ra, rb, rc, <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b87311128e53c7f1b7737563d04798f00935007">TM_SUB</a>);
<a name="l00566"></a>00566         <span class="keywordflow">break</span>;
<a name="l00567"></a>00567       }
<a name="l00568"></a>00568       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8870024877aed4621ab9c5030aab11010">OP_MUL</a>: {
<a name="l00569"></a>00569         <a class="code" href="structlua__TObject.html">TObject</a> *rb = <a class="code" href="lvm_8c.html#20fbba7ab405dd85a00c2397b5a69f1e">RKB</a>(i);
<a name="l00570"></a>00570         <a class="code" href="structlua__TObject.html">TObject</a> *rc = <a class="code" href="lvm_8c.html#aab6967a11ecbaa72464f8a5f7e280a3">RKC</a>(i);
<a name="l00571"></a>00571         <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#68cb1f4d9b30527dc6736266f463dae1">ttisnumber</a>(rb) &amp;&amp; <a class="code" href="lobject_8h.html#68cb1f4d9b30527dc6736266f463dae1">ttisnumber</a>(rc)) {
<a name="l00572"></a>00572           <a class="code" href="lobject_8h.html#93e2206898108ffb2d6d06d5f0130e91">setnvalue</a>(ra, <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(rb) * <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(rc));
<a name="l00573"></a>00573         }
<a name="l00574"></a>00574         <span class="keywordflow">else</span>
<a name="l00575"></a>00575           <a class="code" href="lvm_8c.html#7bdbff14776f809109ececd9bef27a2d">Arith</a>(L, ra, rb, rc, <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b87311115fe71d49096e2ce6a1ed33b3aa45459">TM_MUL</a>);
<a name="l00576"></a>00576         <span class="keywordflow">break</span>;
<a name="l00577"></a>00577       }
<a name="l00578"></a>00578       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8d2d1549cdb38ae0e2770a800d1ff21c5">OP_DIV</a>: {
<a name="l00579"></a>00579         <a class="code" href="structlua__TObject.html">TObject</a> *rb = <a class="code" href="lvm_8c.html#20fbba7ab405dd85a00c2397b5a69f1e">RKB</a>(i);
<a name="l00580"></a>00580         <a class="code" href="structlua__TObject.html">TObject</a> *rc = <a class="code" href="lvm_8c.html#aab6967a11ecbaa72464f8a5f7e280a3">RKC</a>(i);
<a name="l00581"></a>00581         <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#68cb1f4d9b30527dc6736266f463dae1">ttisnumber</a>(rb) &amp;&amp; <a class="code" href="lobject_8h.html#68cb1f4d9b30527dc6736266f463dae1">ttisnumber</a>(rc)) {
<a name="l00582"></a>00582           <a class="code" href="lobject_8h.html#93e2206898108ffb2d6d06d5f0130e91">setnvalue</a>(ra, <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(rb) / <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(rc));
<a name="l00583"></a>00583         }
<a name="l00584"></a>00584         <span class="keywordflow">else</span>
<a name="l00585"></a>00585           <a class="code" href="lvm_8c.html#7bdbff14776f809109ececd9bef27a2d">Arith</a>(L, ra, rb, rc, <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b873111ebc0e3e3d84b923b91607705694bb03f">TM_DIV</a>);
<a name="l00586"></a>00586         <span class="keywordflow">break</span>;
<a name="l00587"></a>00587       }
<a name="l00588"></a>00588       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f86a139a2af28fd81fbd1ccb28520483c9">OP_POW</a>: {
<a name="l00589"></a>00589         <a class="code" href="lvm_8c.html#7bdbff14776f809109ececd9bef27a2d">Arith</a>(L, ra, <a class="code" href="lvm_8c.html#20fbba7ab405dd85a00c2397b5a69f1e">RKB</a>(i), <a class="code" href="lvm_8c.html#aab6967a11ecbaa72464f8a5f7e280a3">RKC</a>(i), <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b873111e5f8732d4fc44223ec61352caef84ca9">TM_POW</a>);
<a name="l00590"></a>00590         <span class="keywordflow">break</span>;
<a name="l00591"></a>00591       }
<a name="l00592"></a>00592       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f82c2f544d4244358e6b092d7b99dec0f2">OP_UNM</a>: {
<a name="l00593"></a>00593         <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *rb = <a class="code" href="lvm_8c.html#96e4545705c431d62f5c71027c111e80">RB</a>(i);
<a name="l00594"></a>00594         <a class="code" href="structlua__TObject.html">TObject</a> temp;
<a name="l00595"></a>00595         <span class="keywordflow">if</span> (<a class="code" href="lvm_8h.html#fc6279fe1477e55a318ee80b0b516683">tonumber</a>(rb, &amp;temp)) {
<a name="l00596"></a>00596           <a class="code" href="lobject_8h.html#93e2206898108ffb2d6d06d5f0130e91">setnvalue</a>(ra, -<a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(rb));
<a name="l00597"></a>00597         }
<a name="l00598"></a>00598         <span class="keywordflow">else</span> {
<a name="l00599"></a>00599           <a class="code" href="lobject_8h.html#f648493e16661b749b1d1c4611d793dd">setnilvalue</a>(&amp;temp);
<a name="l00600"></a>00600           <span class="keywordflow">if</span> (!<a class="code" href="lvm_8c.html#e7e68e9bad64d6d9675f183b520537f3">call_binTM</a>(L, <a class="code" href="lvm_8c.html#96e4545705c431d62f5c71027c111e80">RB</a>(i), &amp;temp, ra, <a class="code" href="ltm_8h.html#3c68e5682d02a7e895ceb1915b87311149b3c95c8cc4d5a651f106494cc0af55">TM_UNM</a>))
<a name="l00601"></a>00601             <a class="code" href="ldebug_8c.html#1e03595e5dfe45b4670ae372c352c4bd">luaG_aritherror</a>(L, <a class="code" href="lvm_8c.html#96e4545705c431d62f5c71027c111e80">RB</a>(i), &amp;temp);
<a name="l00602"></a>00602         }
<a name="l00603"></a>00603         <span class="keywordflow">break</span>;
<a name="l00604"></a>00604       }
<a name="l00605"></a>00605       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8791ea6ce16f68048afc8b53d514f33e3">OP_NOT</a>: {
<a name="l00606"></a>00606         <span class="keywordtype">int</span> res = <a class="code" href="lobject_8h.html#1f7b4b9967d91fd87fc59e89a0abb841">l_isfalse</a>(<a class="code" href="lvm_8c.html#96e4545705c431d62f5c71027c111e80">RB</a>(i));  <span class="comment">/* next assignment may change this value */</span>
<a name="l00607"></a>00607         <a class="code" href="lobject_8h.html#dd0a6a4123be48bd8b01366663e1ade9">setbvalue</a>(ra, res);
<a name="l00608"></a>00608         <span class="keywordflow">break</span>;
<a name="l00609"></a>00609       }
<a name="l00610"></a>00610       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8db7b410a1a5df04a858a04b9bb618e62">OP_CONCAT</a>: {
<a name="l00611"></a>00611         <span class="keywordtype">int</span> b = <a class="code" href="lopcodes_8h.html#59d1e6aadb0052fa6edc4c9500f88c3f">GETARG_B</a>(i);
<a name="l00612"></a>00612         <span class="keywordtype">int</span> c = <a class="code" href="lopcodes_8h.html#e2885b1cb338f15dce1f7628aee686c0">GETARG_C</a>(i);
<a name="l00613"></a>00613         <a class="code" href="lvm_8c.html#0bd01d7a5f39b6f2c23ebd973849840f">luaV_concat</a>(L, c-b+1, c);  <span class="comment">/* may change `base' (and `ra') */</span>
<a name="l00614"></a>00614         base = L-&gt;base;
<a name="l00615"></a>00615         <a class="code" href="lobject_8h.html#bec8d92c9803a6870ff69dbc6d77a5b5">setobjs2s</a>(<a class="code" href="lvm_8c.html#3404543e1612baa3eae87665206318e1">RA</a>(i), base+b);
<a name="l00616"></a>00616         <a class="code" href="lgc_8h.html#c7a20fe758f8e8222a93260ffac9ee06">luaC_checkGC</a>(L);
<a name="l00617"></a>00617         <span class="keywordflow">break</span>;
<a name="l00618"></a>00618       }
<a name="l00619"></a>00619       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8c1cb8286635de6f6d8acd3a106ef4b2a">OP_JMP</a>: {
<a name="l00620"></a>00620         <a class="code" href="lvm_8c.html#82ea2276a00426b3b382905cc21b0807">dojump</a>(pc, <a class="code" href="lopcodes_8h.html#fb75cf4013e702c6ca0531318223baa8">GETARG_sBx</a>(i));
<a name="l00621"></a>00621         <span class="keywordflow">break</span>;
<a name="l00622"></a>00622       }
<a name="l00623"></a>00623       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f864431379916faf6a7f623214f6722b1c">OP_EQ</a>: {
<a name="l00624"></a>00624         <span class="keywordflow">if</span> (<a class="code" href="lvm_8h.html#8c307bbe7286ebef4c20a2c5ab5f3a4d">equalobj</a>(L, <a class="code" href="lvm_8c.html#20fbba7ab405dd85a00c2397b5a69f1e">RKB</a>(i), <a class="code" href="lvm_8c.html#aab6967a11ecbaa72464f8a5f7e280a3">RKC</a>(i)) != <a class="code" href="lopcodes_8h.html#1b6535ddc0b6ed588de8cc2a1096cc84">GETARG_A</a>(i)) pc++;
<a name="l00625"></a>00625         <span class="keywordflow">else</span> <a class="code" href="lvm_8c.html#82ea2276a00426b3b382905cc21b0807">dojump</a>(pc, <a class="code" href="lopcodes_8h.html#fb75cf4013e702c6ca0531318223baa8">GETARG_sBx</a>(*pc) + 1);
<a name="l00626"></a>00626         <span class="keywordflow">break</span>;
<a name="l00627"></a>00627       }
<a name="l00628"></a>00628       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f87403065ee82e1822f8da268d648cf104">OP_LT</a>: {
<a name="l00629"></a>00629         <span class="keywordflow">if</span> (<a class="code" href="lvm_8c.html#f43af2f76caabc3c21b9088a7b17618e">luaV_lessthan</a>(L, <a class="code" href="lvm_8c.html#20fbba7ab405dd85a00c2397b5a69f1e">RKB</a>(i), <a class="code" href="lvm_8c.html#aab6967a11ecbaa72464f8a5f7e280a3">RKC</a>(i)) != <a class="code" href="lopcodes_8h.html#1b6535ddc0b6ed588de8cc2a1096cc84">GETARG_A</a>(i)) pc++;
<a name="l00630"></a>00630         <span class="keywordflow">else</span> <a class="code" href="lvm_8c.html#82ea2276a00426b3b382905cc21b0807">dojump</a>(pc, <a class="code" href="lopcodes_8h.html#fb75cf4013e702c6ca0531318223baa8">GETARG_sBx</a>(*pc) + 1);
<a name="l00631"></a>00631         <span class="keywordflow">break</span>;
<a name="l00632"></a>00632       }
<a name="l00633"></a>00633       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8e3b2d09331eb9eb2fdc09e6ba0e0fbf3">OP_LE</a>: {
<a name="l00634"></a>00634         <span class="keywordflow">if</span> (<a class="code" href="lvm_8c.html#570f78e3174c27e4455fa8176cf558eb">luaV_lessequal</a>(L, <a class="code" href="lvm_8c.html#20fbba7ab405dd85a00c2397b5a69f1e">RKB</a>(i), <a class="code" href="lvm_8c.html#aab6967a11ecbaa72464f8a5f7e280a3">RKC</a>(i)) != <a class="code" href="lopcodes_8h.html#1b6535ddc0b6ed588de8cc2a1096cc84">GETARG_A</a>(i)) pc++;
<a name="l00635"></a>00635         <span class="keywordflow">else</span> <a class="code" href="lvm_8c.html#82ea2276a00426b3b382905cc21b0807">dojump</a>(pc, <a class="code" href="lopcodes_8h.html#fb75cf4013e702c6ca0531318223baa8">GETARG_sBx</a>(*pc) + 1);
<a name="l00636"></a>00636         <span class="keywordflow">break</span>;
<a name="l00637"></a>00637       }
<a name="l00638"></a>00638       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8d9053c66a926eca03e88f98ed50bb509">OP_TEST</a>: {
<a name="l00639"></a>00639         <a class="code" href="structlua__TObject.html">TObject</a> *rb = <a class="code" href="lvm_8c.html#96e4545705c431d62f5c71027c111e80">RB</a>(i);
<a name="l00640"></a>00640         <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#1f7b4b9967d91fd87fc59e89a0abb841">l_isfalse</a>(rb) == <a class="code" href="lopcodes_8h.html#e2885b1cb338f15dce1f7628aee686c0">GETARG_C</a>(i)) pc++;
<a name="l00641"></a>00641         <span class="keywordflow">else</span> {
<a name="l00642"></a>00642           <a class="code" href="lobject_8h.html#bec8d92c9803a6870ff69dbc6d77a5b5">setobjs2s</a>(ra, rb);
<a name="l00643"></a>00643           <a class="code" href="lvm_8c.html#82ea2276a00426b3b382905cc21b0807">dojump</a>(pc, <a class="code" href="lopcodes_8h.html#fb75cf4013e702c6ca0531318223baa8">GETARG_sBx</a>(*pc) + 1);
<a name="l00644"></a>00644         }
<a name="l00645"></a>00645         <span class="keywordflow">break</span>;
<a name="l00646"></a>00646       }
<a name="l00647"></a>00647       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8dd9857b702bebf2d3d62c67f937b52fa">OP_CALL</a>:
<a name="l00648"></a>00648       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8c56e23be8dea19d7e8a75285bab1cac4">OP_TAILCALL</a>: {
<a name="l00649"></a>00649         <a class="code" href="structlua__TObject.html">StkId</a> firstResult;
<a name="l00650"></a>00650         <span class="keywordtype">int</span> b = <a class="code" href="lopcodes_8h.html#59d1e6aadb0052fa6edc4c9500f88c3f">GETARG_B</a>(i);
<a name="l00651"></a>00651         <span class="keywordtype">int</span> nresults;
<a name="l00652"></a>00652         <span class="keywordflow">if</span> (b != 0) L-&gt;top = ra+b;  <span class="comment">/* else previous instruction set top */</span>
<a name="l00653"></a>00653         nresults = <a class="code" href="lopcodes_8h.html#e2885b1cb338f15dce1f7628aee686c0">GETARG_C</a>(i) - 1;
<a name="l00654"></a>00654         firstResult = <a class="code" href="ldo_8c.html#3290deae0372aec49550fb8d19190b26">luaD_precall</a>(L, ra);
<a name="l00655"></a>00655         <span class="keywordflow">if</span> (firstResult) {
<a name="l00656"></a>00656           <span class="keywordflow">if</span> (firstResult &gt; L-&gt;top) {  <span class="comment">/* yield? */</span>
<a name="l00657"></a>00657             <a class="code" href="llimits_8h.html#c4975de4438f4210aa45d111c923498d">lua_assert</a>(L-&gt;ci-&gt;state == (<a class="code" href="lstate_8h.html#9e68baab1c9e667cae13873d00907eba">CI_C</a> | <a class="code" href="lstate_8h.html#f2fea01f4d3b1116be741cbf66f0603f">CI_YIELD</a>));
<a name="l00658"></a>00658             (L-&gt;ci - 1)-&gt;u.l.savedpc = pc;
<a name="l00659"></a>00659             (L-&gt;ci - 1)-&gt;state = <a class="code" href="lstate_8h.html#ce1f59a843ac99ab98646599c44b1611">CI_SAVEDPC</a>;
<a name="l00660"></a>00660             <span class="keywordflow">return</span> NULL;
<a name="l00661"></a>00661           }
<a name="l00662"></a>00662           <span class="comment">/* it was a C function (`precall' called it); adjust results */</span>
<a name="l00663"></a>00663           <a class="code" href="ldo_8c.html#eb0c4e4f18d5129c08e03c0a0dfbd654">luaD_poscall</a>(L, nresults, firstResult);
<a name="l00664"></a>00664           <span class="keywordflow">if</span> (nresults &gt;= 0) L-&gt;top = L-&gt;ci-&gt;top;
<a name="l00665"></a>00665         }
<a name="l00666"></a>00666         <span class="keywordflow">else</span> {  <span class="comment">/* it is a Lua function */</span>
<a name="l00667"></a>00667           <span class="keywordflow">if</span> (<a class="code" href="lopcodes_8h.html#c534aadfac00831d34aa121193db8e88">GET_OPCODE</a>(i) == <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8dd9857b702bebf2d3d62c67f937b52fa">OP_CALL</a>) {  <span class="comment">/* regular call? */</span>
<a name="l00668"></a>00668             (L-&gt;ci-1)-&gt;u.l.savedpc = pc;  <span class="comment">/* save `pc' to return later */</span>
<a name="l00669"></a>00669             (L-&gt;ci-1)-&gt;state = (<a class="code" href="lstate_8h.html#ce1f59a843ac99ab98646599c44b1611">CI_SAVEDPC</a> | <a class="code" href="lstate_8h.html#bdf7df873f952e0e5b25b780406887d8">CI_CALLING</a>);
<a name="l00670"></a>00670           }
<a name="l00671"></a>00671           <span class="keywordflow">else</span> {  <span class="comment">/* tail call: put new frame in place of previous one */</span>
<a name="l00672"></a>00672             <span class="keywordtype">int</span> aux;
<a name="l00673"></a>00673             base = (L-&gt;ci - 1)-&gt;base;  <span class="comment">/* `luaD_precall' may change the stack */</span>
<a name="l00674"></a>00674             ra = <a class="code" href="lvm_8c.html#3404543e1612baa3eae87665206318e1">RA</a>(i);
<a name="l00675"></a>00675             <span class="keywordflow">if</span> (L-&gt;openupval) <a class="code" href="lfunc_8c.html#500b9259e901eecb633fe47e10295d76">luaF_close</a>(L, base);
<a name="l00676"></a>00676             <span class="keywordflow">for</span> (aux = 0; ra+aux &lt; L-&gt;top; aux++)  <span class="comment">/* move frame down */</span>
<a name="l00677"></a>00677               <a class="code" href="lobject_8h.html#bec8d92c9803a6870ff69dbc6d77a5b5">setobjs2s</a>(base+aux-1, ra+aux);
<a name="l00678"></a>00678             (L-&gt;ci - 1)-&gt;top = L-&gt;top = base+aux;  <span class="comment">/* correct top */</span>
<a name="l00679"></a>00679             <a class="code" href="llimits_8h.html#c4975de4438f4210aa45d111c923498d">lua_assert</a>(L-&gt;ci-&gt;state &amp; <a class="code" href="lstate_8h.html#ce1f59a843ac99ab98646599c44b1611">CI_SAVEDPC</a>);
<a name="l00680"></a>00680             (L-&gt;ci - 1)-&gt;u.l.savedpc = L-&gt;ci-&gt;u.l.savedpc;
<a name="l00681"></a>00681             (L-&gt;ci - 1)-&gt;u.l.tailcalls++;  <span class="comment">/* one more call lost */</span>
<a name="l00682"></a>00682             (L-&gt;ci - 1)-&gt;state = CI_SAVEDPC;
<a name="l00683"></a>00683             L-&gt;ci--;  <span class="comment">/* remove new frame */</span>
<a name="l00684"></a>00684             L-&gt;base = L-&gt;ci-&gt;base;
<a name="l00685"></a>00685           }
<a name="l00686"></a>00686           <span class="keywordflow">goto</span> callentry;
<a name="l00687"></a>00687         }
<a name="l00688"></a>00688         <span class="keywordflow">break</span>;
<a name="l00689"></a>00689       }
<a name="l00690"></a>00690       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f89ca6ffb0b699ee287919f5d151d76c57">OP_RETURN</a>: {
<a name="l00691"></a>00691         <a class="code" href="structCallInfo.html">CallInfo</a> *ci = L-&gt;ci - 1;  <span class="comment">/* previous function frame */</span>
<a name="l00692"></a>00692         <span class="keywordtype">int</span> b = <a class="code" href="lopcodes_8h.html#59d1e6aadb0052fa6edc4c9500f88c3f">GETARG_B</a>(i);
<a name="l00693"></a>00693         <span class="keywordflow">if</span> (b != 0) L-&gt;top = ra+b-1;
<a name="l00694"></a>00694         <a class="code" href="llimits_8h.html#c4975de4438f4210aa45d111c923498d">lua_assert</a>(L-&gt;ci-&gt;state &amp; <a class="code" href="lstate_8h.html#69c606d49428cf3eaaa019f80dd6d173">CI_HASFRAME</a>);
<a name="l00695"></a>00695         <span class="keywordflow">if</span> (L-&gt;openupval) <a class="code" href="lfunc_8c.html#500b9259e901eecb633fe47e10295d76">luaF_close</a>(L, base);
<a name="l00696"></a>00696         L-&gt;ci-&gt;state = <a class="code" href="lstate_8h.html#ce1f59a843ac99ab98646599c44b1611">CI_SAVEDPC</a>;  <span class="comment">/* deactivate current function */</span>
<a name="l00697"></a>00697         L-&gt;ci-&gt;u.l.savedpc = pc;
<a name="l00698"></a>00698         <span class="comment">/* previous function was running `here'? */</span>
<a name="l00699"></a>00699         <span class="keywordflow">if</span> (!(ci-&gt;<a class="code" href="structCallInfo.html#7fc380ecc20c791cbe1da8c9f6622455">state</a> &amp; <a class="code" href="lstate_8h.html#bdf7df873f952e0e5b25b780406887d8">CI_CALLING</a>)) {
<a name="l00700"></a>00700           <a class="code" href="llimits_8h.html#c4975de4438f4210aa45d111c923498d">lua_assert</a>((ci-&gt;<a class="code" href="structCallInfo.html#7fc380ecc20c791cbe1da8c9f6622455">state</a> &amp; <a class="code" href="lstate_8h.html#9e68baab1c9e667cae13873d00907eba">CI_C</a>) || ci-&gt;<a class="code" href="structCallInfo.html#0ffee6994d4e1b3790ea491595cb72be">u</a>.<a class="code" href="structCallInfo.html#970495ecfbc19bca7b399a9429b25110">l</a>.pc != &amp;pc);
<a name="l00701"></a>00701           <span class="keywordflow">return</span> ra;  <span class="comment">/* no: return */</span>
<a name="l00702"></a>00702         }
<a name="l00703"></a>00703         <span class="keywordflow">else</span> {  <span class="comment">/* yes: continue its execution */</span>
<a name="l00704"></a>00704           <span class="keywordtype">int</span> nresults;
<a name="l00705"></a>00705           <a class="code" href="llimits_8h.html#c4975de4438f4210aa45d111c923498d">lua_assert</a>(<a class="code" href="lobject_8h.html#f405409e59f38ccfa7fa308556742afd">ttisfunction</a>(ci-&gt;<a class="code" href="structCallInfo.html#96607192c3b46091f5e77e5a19771e13">base</a> - 1) &amp;&amp; (ci-&gt;<a class="code" href="structCallInfo.html#7fc380ecc20c791cbe1da8c9f6622455">state</a> &amp; <a class="code" href="lstate_8h.html#ce1f59a843ac99ab98646599c44b1611">CI_SAVEDPC</a>));
<a name="l00706"></a>00706           <a class="code" href="llimits_8h.html#c4975de4438f4210aa45d111c923498d">lua_assert</a>(<a class="code" href="lopcodes_8h.html#c534aadfac00831d34aa121193db8e88">GET_OPCODE</a>(*(ci-&gt;<a class="code" href="structCallInfo.html#0ffee6994d4e1b3790ea491595cb72be">u</a>.<a class="code" href="structCallInfo.html#970495ecfbc19bca7b399a9429b25110">l</a>.savedpc - 1)) == <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8dd9857b702bebf2d3d62c67f937b52fa">OP_CALL</a>);
<a name="l00707"></a>00707           nresults = <a class="code" href="lopcodes_8h.html#e2885b1cb338f15dce1f7628aee686c0">GETARG_C</a>(*(ci-&gt;<a class="code" href="structCallInfo.html#0ffee6994d4e1b3790ea491595cb72be">u</a>.<a class="code" href="structCallInfo.html#970495ecfbc19bca7b399a9429b25110">l</a>.savedpc - 1)) - 1;
<a name="l00708"></a>00708           <a class="code" href="ldo_8c.html#eb0c4e4f18d5129c08e03c0a0dfbd654">luaD_poscall</a>(L, nresults, ra);
<a name="l00709"></a>00709           <span class="keywordflow">if</span> (nresults &gt;= 0) L-&gt;top = L-&gt;ci-&gt;top;
<a name="l00710"></a>00710           <span class="keywordflow">goto</span> retentry;
<a name="l00711"></a>00711         }
<a name="l00712"></a>00712       }
<a name="l00713"></a>00713       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f85e7650997649c1dbdfddb8857865b53f">OP_FORLOOP</a>: {
<a name="l00714"></a>00714         lua_Number step, idx, limit;
<a name="l00715"></a>00715         <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *plimit = ra+1;
<a name="l00716"></a>00716         <span class="keyword">const</span> <a class="code" href="structlua__TObject.html">TObject</a> *pstep = ra+2;
<a name="l00717"></a>00717         <span class="keywordflow">if</span> (!<a class="code" href="lobject_8h.html#68cb1f4d9b30527dc6736266f463dae1">ttisnumber</a>(ra))
<a name="l00718"></a>00718           <a class="code" href="ldebug_8c.html#e46448881e12f78e438526c46c5081ed">luaG_runerror</a>(L, <span class="stringliteral">"`for' initial value must be a number"</span>);
<a name="l00719"></a>00719         <span class="keywordflow">if</span> (!<a class="code" href="lvm_8h.html#fc6279fe1477e55a318ee80b0b516683">tonumber</a>(plimit, ra+1))
<a name="l00720"></a>00720           <a class="code" href="ldebug_8c.html#e46448881e12f78e438526c46c5081ed">luaG_runerror</a>(L, <span class="stringliteral">"`for' limit must be a number"</span>);
<a name="l00721"></a>00721 <span class="comment">/*@-modobserver@*/</span>
<a name="l00722"></a>00722         <span class="keywordflow">if</span> (!<a class="code" href="lvm_8h.html#fc6279fe1477e55a318ee80b0b516683">tonumber</a>(pstep, ra+2))
<a name="l00723"></a>00723           <a class="code" href="ldebug_8c.html#e46448881e12f78e438526c46c5081ed">luaG_runerror</a>(L, <span class="stringliteral">"`for' step must be a number"</span>);
<a name="l00724"></a>00724 <span class="comment">/*@=modobserver@*/</span>
<a name="l00725"></a>00725         step = <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(pstep);
<a name="l00726"></a>00726         idx = <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(ra) + step;  <span class="comment">/* increment index */</span>
<a name="l00727"></a>00727         limit = <a class="code" href="lobject_8h.html#b4014580971546004cd5982d201111c9">nvalue</a>(plimit);
<a name="l00728"></a>00728         <span class="keywordflow">if</span> (step &gt; 0 ? idx &lt;= limit : idx &gt;= limit) {
<a name="l00729"></a>00729           <a class="code" href="lvm_8c.html#82ea2276a00426b3b382905cc21b0807">dojump</a>(pc, <a class="code" href="lopcodes_8h.html#fb75cf4013e702c6ca0531318223baa8">GETARG_sBx</a>(i));  <span class="comment">/* jump back */</span>
<a name="l00730"></a>00730           <a class="code" href="lobject_8h.html#5db3626425356955d5af740fdc8bec0a">chgnvalue</a>(ra, idx);  <span class="comment">/* update index */</span>
<a name="l00731"></a>00731         }
<a name="l00732"></a>00732         <span class="keywordflow">break</span>;
<a name="l00733"></a>00733       }
<a name="l00734"></a>00734       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8cdb0130ffef612e8c4152e0db8b6e596">OP_TFORLOOP</a>: {
<a name="l00735"></a>00735         <span class="keywordtype">int</span> nvar = <a class="code" href="lopcodes_8h.html#e2885b1cb338f15dce1f7628aee686c0">GETARG_C</a>(i) + 1;
<a name="l00736"></a>00736         <a class="code" href="structlua__TObject.html">StkId</a> cb = ra + nvar + 2;  <span class="comment">/* call base */</span>
<a name="l00737"></a>00737         <a class="code" href="lobject_8h.html#bec8d92c9803a6870ff69dbc6d77a5b5">setobjs2s</a>(cb, ra);
<a name="l00738"></a>00738         <a class="code" href="lobject_8h.html#bec8d92c9803a6870ff69dbc6d77a5b5">setobjs2s</a>(cb+1, ra+1);
<a name="l00739"></a>00739         <a class="code" href="lobject_8h.html#bec8d92c9803a6870ff69dbc6d77a5b5">setobjs2s</a>(cb+2, ra+2);
<a name="l00740"></a>00740         L-&gt;top = cb+3;  <span class="comment">/* func. + 2 args (state and index) */</span>
<a name="l00741"></a>00741         <a class="code" href="ldo_8c.html#8e21ff41ee2c180bf522747b588a8654">luaD_call</a>(L, cb, nvar);
<a name="l00742"></a>00742         L-&gt;top = L-&gt;ci-&gt;top;
<a name="l00743"></a>00743         ra = <a class="code" href="lvm_8c.html#a132066e99629d785935e2c9ba217369">XRA</a>(i) + 2;  <span class="comment">/* final position of first result */</span>
<a name="l00744"></a>00744         cb = ra + nvar;
<a name="l00745"></a>00745         <span class="keywordflow">do</span> {  <span class="comment">/* move results to proper positions */</span>
<a name="l00746"></a>00746           nvar--;
<a name="l00747"></a>00747           <a class="code" href="lobject_8h.html#bec8d92c9803a6870ff69dbc6d77a5b5">setobjs2s</a>(ra+nvar, cb+nvar);
<a name="l00748"></a>00748         } <span class="keywordflow">while</span> (nvar &gt; 0);
<a name="l00749"></a>00749         <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#344c0486b08e85fb2c31d1b63359ad2e">ttisnil</a>(ra))  <span class="comment">/* break loop? */</span>
<a name="l00750"></a>00750           pc++;  <span class="comment">/* skip jump (break loop) */</span>
<a name="l00751"></a>00751         <span class="keywordflow">else</span>
<a name="l00752"></a>00752           <a class="code" href="lvm_8c.html#82ea2276a00426b3b382905cc21b0807">dojump</a>(pc, <a class="code" href="lopcodes_8h.html#fb75cf4013e702c6ca0531318223baa8">GETARG_sBx</a>(*pc) + 1);  <span class="comment">/* jump back */</span>
<a name="l00753"></a>00753         <span class="keywordflow">break</span>;
<a name="l00754"></a>00754       }
<a name="l00755"></a>00755       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f86f599f7989ae8bba5f9b89a656480222">OP_TFORPREP</a>: {  <span class="comment">/* for compatibility only */</span>
<a name="l00756"></a>00756         <span class="keywordflow">if</span> (<a class="code" href="lobject_8h.html#8ec7da7ba2002d41cdb0430a4396b3e2">ttistable</a>(ra)) {
<a name="l00757"></a>00757           <a class="code" href="lobject_8h.html#bec8d92c9803a6870ff69dbc6d77a5b5">setobjs2s</a>(ra+1, ra);
<a name="l00758"></a>00758           <a class="code" href="lobject_8h.html#1d50ac962ab057b3e89ddbb1103b543f">setobj2s</a>(ra, <a class="code" href="ltable_8c.html#162360563b1f37e4a3d2eddbd845f756">luaH_getstr</a>(<a class="code" href="lobject_8h.html#a87e2d7ac731a6ced2e29e7bb9891823">hvalue</a>(<a class="code" href="lstate_8h.html#8bba35a935dda83dfaed658080d21dbd">gt</a>(L)), <a class="code" href="lstring_8h.html#780c0cd806913440453924e96cedbc80">luaS_new</a>(L, <span class="stringliteral">"next"</span>)));
<a name="l00759"></a>00759         }
<a name="l00760"></a>00760         <a class="code" href="lvm_8c.html#82ea2276a00426b3b382905cc21b0807">dojump</a>(pc, <a class="code" href="lopcodes_8h.html#fb75cf4013e702c6ca0531318223baa8">GETARG_sBx</a>(i));
<a name="l00761"></a>00761         <span class="keywordflow">break</span>;
<a name="l00762"></a>00762       }
<a name="l00763"></a>00763       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8788a3d24f52b7e1f944cfcc8583ad44c">OP_SETLIST</a>:
<a name="l00764"></a>00764       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8f36c7cc1a55304c111cb016e8c88396a">OP_SETLISTO</a>: {
<a name="l00765"></a>00765         <span class="keywordtype">int</span> bc;
<a name="l00766"></a>00766         <span class="keywordtype">int</span> n;
<a name="l00767"></a>00767         <a class="code" href="structTable.html">Table</a> *h;
<a name="l00768"></a>00768         <a class="code" href="lvm_8c.html#9d2821e4d59185d2d2b9b20b4457b6aa">runtime_check</a>(L, <a class="code" href="lobject_8h.html#8ec7da7ba2002d41cdb0430a4396b3e2">ttistable</a>(ra));
<a name="l00769"></a>00769         h = <a class="code" href="lobject_8h.html#a87e2d7ac731a6ced2e29e7bb9891823">hvalue</a>(ra);
<a name="l00770"></a>00770         bc = <a class="code" href="lopcodes_8h.html#718212239c50c62e0df9cd33f5a7f2ab">GETARG_Bx</a>(i);
<a name="l00771"></a>00771         <span class="keywordflow">if</span> (<a class="code" href="lopcodes_8h.html#c534aadfac00831d34aa121193db8e88">GET_OPCODE</a>(i) == <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8788a3d24f52b7e1f944cfcc8583ad44c">OP_SETLIST</a>)
<a name="l00772"></a>00772           n = (bc&amp;(<a class="code" href="lopcodes_8h.html#c93278629d2c705ec1d080c3790221d3">LFIELDS_PER_FLUSH</a>-1)) + 1;
<a name="l00773"></a>00773         <span class="keywordflow">else</span> {
<a name="l00774"></a>00774           n = L-&gt;top - ra - 1;
<a name="l00775"></a>00775           L-&gt;top = L-&gt;ci-&gt;top;
<a name="l00776"></a>00776         }
<a name="l00777"></a>00777         bc &amp;= ~(<a class="code" href="lopcodes_8h.html#c93278629d2c705ec1d080c3790221d3">LFIELDS_PER_FLUSH</a>-1);  <span class="comment">/* bc = bc - bc%FPF */</span>
<a name="l00778"></a>00778         <span class="keywordflow">for</span> (; n &gt; 0; n--)
<a name="l00779"></a>00779           <a class="code" href="lobject_8h.html#a2b9eaa62e6a32f5acf22ac269dea749">setobj2t</a>(<a class="code" href="ltable_8c.html#37a14b5c538be847846066d1a771e0d3">luaH_setnum</a>(L, h, bc+n), ra+n);  <span class="comment">/* write barrier */</span>
<a name="l00780"></a>00780         <span class="keywordflow">break</span>;
<a name="l00781"></a>00781       }
<a name="l00782"></a>00782       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f80652074296686029414d6c12b21fece9">OP_CLOSE</a>: {
<a name="l00783"></a>00783         <a class="code" href="lfunc_8c.html#500b9259e901eecb633fe47e10295d76">luaF_close</a>(L, ra);
<a name="l00784"></a>00784         <span class="keywordflow">break</span>;
<a name="l00785"></a>00785       }
<a name="l00786"></a>00786       <span class="keywordflow">case</span> <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f8bd3b010317ec61a3a779a06c5c465c26">OP_CLOSURE</a>: {
<a name="l00787"></a>00787         <a class="code" href="structProto.html">Proto</a> *p;
<a name="l00788"></a>00788         <a class="code" href="unionClosure.html">Closure</a> *ncl;
<a name="l00789"></a>00789         <span class="keywordtype">int</span> nup, j;
<a name="l00790"></a>00790         p = cl-&gt;<a class="code" href="structProto.html#ec434b19b5f217ddbf708d8662e12ffe">p</a>-&gt;<a class="code" href="structProto.html#ec434b19b5f217ddbf708d8662e12ffe">p</a>[<a class="code" href="lopcodes_8h.html#718212239c50c62e0df9cd33f5a7f2ab">GETARG_Bx</a>(i)];
<a name="l00791"></a>00791         nup = p-&gt;<a class="code" href="structProto.html#46f0767af11dad26b62cb2cf451c580f">nups</a>;
<a name="l00792"></a>00792         ncl = <a class="code" href="lfunc_8c.html#4c55e96272c85b22045b3bea7ee4cbc0">luaF_newLclosure</a>(L, nup, &amp;cl-&gt;g);
<a name="l00793"></a>00793         ncl-&gt;<a class="code" href="unionClosure.html#b52058de5b4c44ac665e48fda54cc084">l</a>.<a class="code" href="structLClosure.html#37d5e74eea26bcc86939c972dfff18eb">p</a> = p;
<a name="l00794"></a>00794         <span class="keywordflow">for</span> (j=0; j&lt;nup; j++, pc++) {
<a name="l00795"></a>00795           <span class="keywordflow">if</span> (<a class="code" href="lopcodes_8h.html#c534aadfac00831d34aa121193db8e88">GET_OPCODE</a>(*pc) == <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f80c96592c1ab5bb60e10eb42eb6e435aa">OP_GETUPVAL</a>)
<a name="l00796"></a>00796             ncl-&gt;<a class="code" href="unionClosure.html#b52058de5b4c44ac665e48fda54cc084">l</a>.<a class="code" href="structLClosure.html#80d2cd3daedb75648e1c79ad31ddf2c5">upvals</a>[j] = cl-&gt;upvals[<a class="code" href="lopcodes_8h.html#59d1e6aadb0052fa6edc4c9500f88c3f">GETARG_B</a>(*pc)];
<a name="l00797"></a>00797           <span class="keywordflow">else</span> {
<a name="l00798"></a>00798             <a class="code" href="llimits_8h.html#c4975de4438f4210aa45d111c923498d">lua_assert</a>(<a class="code" href="lopcodes_8h.html#c534aadfac00831d34aa121193db8e88">GET_OPCODE</a>(*pc) == <a class="code" href="lopcodes_8h.html#dfab396538a59f4b8e31a97483c1e4f89a45e5b03f75222f95232ad9d96ec252">OP_MOVE</a>);
<a name="l00799"></a>00799             ncl-&gt;<a class="code" href="unionClosure.html#b52058de5b4c44ac665e48fda54cc084">l</a>.<a class="code" href="structLClosure.html#80d2cd3daedb75648e1c79ad31ddf2c5">upvals</a>[j] = <a class="code" href="lfunc_8c.html#40a613b2e2144d5246ab14d68da67e4f">luaF_findupval</a>(L, base + <a class="code" href="lopcodes_8h.html#59d1e6aadb0052fa6edc4c9500f88c3f">GETARG_B</a>(*pc));
<a name="l00800"></a>00800           }
<a name="l00801"></a>00801         }
<a name="l00802"></a>00802         <a class="code" href="lobject_8h.html#299408f81fc46b49fc125d02abdef40a">setclvalue</a>(ra, ncl);
<a name="l00803"></a>00803         <a class="code" href="lgc_8h.html#c7a20fe758f8e8222a93260ffac9ee06">luaC_checkGC</a>(L);
<a name="l00804"></a>00804         <span class="keywordflow">break</span>;
<a name="l00805"></a>00805       }
<a name="l00806"></a>00806     }
<a name="l00807"></a>00807   }
<a name="l00808"></a>00808 }
<a name="l00809"></a>00809 
<a name="l00810"></a>00810 
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Fri Oct 12 08:44:54 2007 for rpm by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
