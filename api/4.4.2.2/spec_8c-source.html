<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>rpm: build/spec.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul>
</div>
<h1>build/spec.c</h1><a href="spec_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00006"></a>00006 <span class="preprocessor">#include "<a class="code" href="system_8h.html">system.h</a>"</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="preprocessor">#include "<a class="code" href="buildio_8h.html" title="Routines to read and write packages.">buildio.h</a>"</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include "<a class="code" href="rpmds_8h.html" title="Structure(s) used for dependency tag sets.">rpmds.h</a>"</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="rpmfi_8h.html" title="Structure(s) used for file info tag sets.">rpmfi.h</a>"</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include "<a class="code" href="rpmts_8h.html" title="Structures and prototypes used for an "rpmts" transaction set.">rpmts.h</a>"</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="preprocessor">#include "<a class="code" href="debug_8h.html">debug.h</a>"</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="comment">/*@-redecl@*/</span>
<a name="l00016"></a>00016 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="spec_8c.html#7eb51b476f308337156371e05a4dfe57">specedit</a>;
<a name="l00017"></a>00017 <span class="comment">/*@=redecl@*/</span>
<a name="l00018"></a>00018 
<a name="l00019"></a><a class="code" href="spec_8c.html#c1304386dfab6e8eb2658637075d1eef">00019</a> <span class="preprocessor">#define SKIPWHITE(_x)   {while(*(_x) &amp;&amp; (xisspace(*_x) || *(_x) == ',')) (_x)++;}</span>
<a name="l00020"></a><a class="code" href="spec_8c.html#08668152c50b145275c601fbd07c0973">00020</a> <span class="preprocessor"></span><span class="preprocessor">#define SKIPNONWHITE(_x){while(*(_x) &amp;&amp;!(xisspace(*_x) || *(_x) == ',')) (_x)++;}</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span>
<a name="l00022"></a>00022 <span class="comment">/*@access Header @*/</span>    <span class="comment">/* compared with NULL */</span>
<a name="l00023"></a>00023 <span class="comment">/*@access rpmfi @*/</span>     <span class="comment">/* compared with NULL */</span>
<a name="l00024"></a>00024 
<a name="l00029"></a>00029 <span class="keyword">static</span> <span class="keyword">inline</span>
<a name="l00030"></a><a class="code" href="spec_8c.html#c76eaffac2b6f6f33d5d2e5df3f03758">00030</a> <span class="comment">/*@null@*/</span> <span class="keyword">struct </span><a class="code" href="structTriggerFileEntry.html">TriggerFileEntry</a> * <a class="code" href="spec_8c.html#c76eaffac2b6f6f33d5d2e5df3f03758" title="trigger entry chain">freeTriggerFiles</a>(<span class="comment">/*@only@*/</span> <span class="comment">/*@null@*/</span> <span class="keyword">struct</span> <a class="code" href="structTriggerFileEntry.html">TriggerFileEntry</a> * p)
<a name="l00031"></a>00031         <span class="comment">/*@modifies p @*/</span>
<a name="l00032"></a>00032 {
<a name="l00033"></a>00033     <span class="keyword">struct </span><a class="code" href="structTriggerFileEntry.html">TriggerFileEntry</a> *o, *q = p;
<a name="l00034"></a>00034     
<a name="l00035"></a>00035     <span class="keywordflow">while</span> (q != NULL) {
<a name="l00036"></a>00036         o = q;
<a name="l00037"></a>00037         q = q-&gt;<a class="code" href="structTriggerFileEntry.html#6152285c8b90c4324c0d0ff4a9350bf5">next</a>;
<a name="l00038"></a>00038         o-&gt;<a class="code" href="structTriggerFileEntry.html#663d905a035b9600b11050eb39edd482">fileName</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(o-&gt;<a class="code" href="structTriggerFileEntry.html#663d905a035b9600b11050eb39edd482">fileName</a>);
<a name="l00039"></a>00039         o-&gt;<a class="code" href="structTriggerFileEntry.html#e6edb81e46136ade6743c41fdb23a597">script</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(o-&gt;<a class="code" href="structTriggerFileEntry.html#e6edb81e46136ade6743c41fdb23a597">script</a>);
<a name="l00040"></a>00040         o-&gt;<a class="code" href="structTriggerFileEntry.html#23a20757e3298c88397a7b3a905273da">prog</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(o-&gt;<a class="code" href="structTriggerFileEntry.html#23a20757e3298c88397a7b3a905273da">prog</a>);
<a name="l00041"></a>00041         o = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(o);
<a name="l00042"></a>00042     }
<a name="l00043"></a>00043     <span class="keywordflow">return</span> NULL;
<a name="l00044"></a>00044 }
<a name="l00045"></a>00045 
<a name="l00051"></a>00051 <span class="keyword">static</span> <span class="keyword">inline</span>
<a name="l00052"></a><a class="code" href="spec_8c.html#2d923bf7b2c665afcfae21e2fc2920ee">00052</a> <span class="comment">/*@null@*/</span> <span class="keyword">struct </span><a class="code" href="structSource.html">Source</a> * <a class="code" href="spec_8c.html#2d923bf7b2c665afcfae21e2fc2920ee" title="Destroy source component chain.">freeSources</a>(<span class="comment">/*@only@*/</span> <span class="comment">/*@null@*/</span> <span class="keyword">struct</span> <a class="code" href="structSource.html">Source</a> * s)
<a name="l00053"></a>00053         <span class="comment">/*@modifies s @*/</span>
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055     <span class="keyword">struct </span><a class="code" href="structSource.html">Source</a> *r, *t = s;
<a name="l00056"></a>00056 
<a name="l00057"></a>00057     <span class="keywordflow">while</span> (t != NULL) {
<a name="l00058"></a>00058         r = t;
<a name="l00059"></a>00059         t = t-&gt;<a class="code" href="structSource.html#6f9cc4bf594f5c4693deaf0fdb892987">next</a>;
<a name="l00060"></a>00060         r-&gt;<a class="code" href="structSource.html#f9a6ddfeb7956783513f2a30a5cdbaa7">fullSource</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(r-&gt;<a class="code" href="structSource.html#f9a6ddfeb7956783513f2a30a5cdbaa7">fullSource</a>);
<a name="l00061"></a>00061         r = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(r);
<a name="l00062"></a>00062     }
<a name="l00063"></a>00063     <span class="keywordflow">return</span> NULL;
<a name="l00064"></a>00064 }
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="comment">/*@-boundswrite@*/</span>
<a name="l00067"></a><a class="code" href="group__rpmbuild.html#g419b892d69af28181c394858fd776cea">00067</a> <span class="keywordtype">int</span> <a class="code" href="group__rpmbuild.html#g419b892d69af28181c394858fd776cea" title="Find sub-package control structure by name.">lookupPackage</a>(<a class="code" href="structSpec__s.html" title="The structure used to store values parsed from a spec file.">Spec</a> spec, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structname.html">name</a>, <span class="keywordtype">int</span> flag, <span class="comment">/*@out@*/</span><a class="code" href="structPackage__s.html" title="The structure used to store values for a package.">Package</a> *pkg)
<a name="l00068"></a>00068 {
<a name="l00069"></a>00069     <span class="keyword">const</span> <span class="keywordtype">char</span> *pname;
<a name="l00070"></a>00070     <span class="keyword">const</span> <span class="keywordtype">char</span> *fullName;
<a name="l00071"></a>00071     <a class="code" href="structPackage__s.html" title="The structure used to store values for a package.">Package</a> p;
<a name="l00072"></a>00072     
<a name="l00073"></a>00073     <span class="comment">/* "main" package */</span>
<a name="l00074"></a>00074     <span class="keywordflow">if</span> (name == NULL) {
<a name="l00075"></a>00075         <span class="keywordflow">if</span> (pkg)
<a name="l00076"></a>00076             *pkg = spec-&gt;<a class="code" href="structSpec__s.html#ffcee259f7ea1e815853ac3ae9f643c2">packages</a>;
<a name="l00077"></a>00077         <span class="keywordflow">return</span> 0;
<a name="l00078"></a>00078     }
<a name="l00079"></a>00079 
<a name="l00080"></a>00080     <span class="comment">/* Construct package name */</span>
<a name="l00081"></a>00081   { <span class="keywordtype">char</span> *n;
<a name="l00082"></a>00082     <span class="keywordflow">if</span> (flag == <a class="code" href="rpmbuild_8h.html#8668beb22148fe50b4d29a1c6f591b9a">PART_SUBNAME</a>) {
<a name="l00083"></a>00083         (void) <a class="code" href="group__header.html#g53462b3c5298a60fa2a43162deb4f41a" title="Return name, version, release strings from header.">headerNVR</a>(spec-&gt;<a class="code" href="structSpec__s.html#ffcee259f7ea1e815853ac3ae9f643c2">packages</a>-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>, &amp;pname, NULL, NULL);
<a name="l00084"></a>00084         fullName = n = <a class="code" href="system_8h.html#58ff5c3142f685bf7e95cc0cbfaf49c9">alloca</a>(strlen(pname) + 1 + strlen(name) + 1);
<a name="l00085"></a>00085         <span class="keywordflow">while</span> (*pname != <span class="charliteral">'\0'</span>) *n++ = *pname++;
<a name="l00086"></a>00086         *n++ = <span class="charliteral">'-'</span>;
<a name="l00087"></a>00087     } <span class="keywordflow">else</span> {
<a name="l00088"></a>00088         fullName = n = <a class="code" href="system_8h.html#58ff5c3142f685bf7e95cc0cbfaf49c9">alloca</a>(strlen(name)+1);
<a name="l00089"></a>00089     }
<a name="l00090"></a>00090     <span class="comment">/*@-mayaliasunique@*/</span>
<a name="l00091"></a>00091     strcpy(n, name);
<a name="l00092"></a>00092     <span class="comment">/*@=mayaliasunique@*/</span>
<a name="l00093"></a>00093   }
<a name="l00094"></a>00094 
<a name="l00095"></a>00095     <span class="comment">/* Locate package with fullName */</span>
<a name="l00096"></a>00096     <span class="keywordflow">for</span> (p = spec-&gt;<a class="code" href="structSpec__s.html#ffcee259f7ea1e815853ac3ae9f643c2">packages</a>; p != NULL; p = p-&gt;<a class="code" href="structPackage__s.html#13605bf6a2ed28fa86c892c7c0f31a3f">next</a>) {
<a name="l00097"></a>00097         (void) <a class="code" href="group__header.html#g53462b3c5298a60fa2a43162deb4f41a" title="Return name, version, release strings from header.">headerNVR</a>(p-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>, &amp;pname, NULL, NULL);
<a name="l00098"></a>00098         <span class="keywordflow">if</span> (pname &amp;&amp; (! strcmp(fullName, pname))) {
<a name="l00099"></a>00099             <span class="keywordflow">break</span>;
<a name="l00100"></a>00100         }
<a name="l00101"></a>00101     }
<a name="l00102"></a>00102 
<a name="l00103"></a>00103     <span class="keywordflow">if</span> (pkg)
<a name="l00104"></a>00104         <span class="comment">/*@-dependenttrans@*/</span> *pkg = p; <span class="comment">/*@=dependenttrans@*/</span>
<a name="l00105"></a>00105     <span class="keywordflow">return</span> ((p == NULL) ? 1 : 0);
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 <span class="comment">/*@=boundswrite@*/</span>
<a name="l00108"></a>00108 
<a name="l00109"></a><a class="code" href="group__rpmbuild.html#g5ce0668d7200e6b064f2f28986065326">00109</a> <a class="code" href="structPackage__s.html" title="The structure used to store values for a package.">Package</a> <a class="code" href="group__rpmbuild.html#g5ce0668d7200e6b064f2f28986065326" title="Create and initialize package control structure.">newPackage</a>(<a class="code" href="structSpec__s.html" title="The structure used to store values parsed from a spec file.">Spec</a> spec)
<a name="l00110"></a>00110 {
<a name="l00111"></a>00111     <a class="code" href="structPackage__s.html" title="The structure used to store values for a package.">Package</a> p;
<a name="l00112"></a>00112     <a class="code" href="structPackage__s.html" title="The structure used to store values for a package.">Package</a> pp;
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     p = <a class="code" href="system_8h.html#9533f3165c8a4af7283dce262b32989f">xcalloc</a>(1, <span class="keyword">sizeof</span>(*p));
<a name="l00115"></a>00115 
<a name="l00116"></a>00116     p-&gt;header = <a class="code" href="group__header.html#g89e041c18d9838db19c49f442dbe1e5e" title="Create new (empty) header instance.">headerNew</a>();
<a name="l00117"></a>00117     p-&gt;ds = NULL;
<a name="l00118"></a>00118     p-&gt;icon = NULL;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120     p-&gt;autoProv = 1;
<a name="l00121"></a>00121     p-&gt;autoReq = 1;
<a name="l00122"></a>00122     
<a name="l00123"></a>00123 <span class="preprocessor">#if 0    </span>
<a name="l00124"></a>00124 <span class="preprocessor"></span>    p-&gt;reqProv = NULL;
<a name="l00125"></a>00125     p-&gt;triggers = NULL;
<a name="l00126"></a>00126     p-&gt;triggerScripts = NULL;
<a name="l00127"></a>00127 <span class="preprocessor">#endif</span>
<a name="l00128"></a>00128 <span class="preprocessor"></span>
<a name="l00129"></a>00129     p-&gt;triggerFiles = NULL;
<a name="l00130"></a>00130     
<a name="l00131"></a>00131     p-&gt;fileFile = NULL;
<a name="l00132"></a>00132     p-&gt;fileList = NULL;
<a name="l00133"></a>00133 
<a name="l00134"></a>00134     p-&gt;cpioList = NULL;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136     p-&gt;preInFile = NULL;
<a name="l00137"></a>00137     p-&gt;postInFile = NULL;
<a name="l00138"></a>00138     p-&gt;preUnFile = NULL;
<a name="l00139"></a>00139     p-&gt;postUnFile = NULL;
<a name="l00140"></a>00140     p-&gt;verifyFile = NULL;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142     p-&gt;specialDoc = NULL;
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <span class="keywordflow">if</span> (spec-&gt;<a class="code" href="structSpec__s.html#ffcee259f7ea1e815853ac3ae9f643c2">packages</a> == NULL) {
<a name="l00145"></a>00145         spec-&gt;<a class="code" href="structSpec__s.html#ffcee259f7ea1e815853ac3ae9f643c2">packages</a> = p;
<a name="l00146"></a>00146     } <span class="keywordflow">else</span> {
<a name="l00147"></a>00147         <span class="comment">/* Always add package to end of list */</span>
<a name="l00148"></a>00148         <span class="keywordflow">for</span> (pp = spec-&gt;<a class="code" href="structSpec__s.html#ffcee259f7ea1e815853ac3ae9f643c2">packages</a>; pp-&gt;<a class="code" href="structPackage__s.html#13605bf6a2ed28fa86c892c7c0f31a3f">next</a> != NULL; pp = pp-&gt;<a class="code" href="structPackage__s.html#13605bf6a2ed28fa86c892c7c0f31a3f">next</a>)
<a name="l00149"></a>00149             {};
<a name="l00150"></a>00150         pp-&gt;<a class="code" href="structPackage__s.html#13605bf6a2ed28fa86c892c7c0f31a3f">next</a> = p;
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152     p-&gt;<a class="code" href="structPackage__s.html#13605bf6a2ed28fa86c892c7c0f31a3f">next</a> = NULL;
<a name="l00153"></a>00153 
<a name="l00154"></a>00154     <span class="keywordflow">return</span> p;
<a name="l00155"></a>00155 }
<a name="l00156"></a>00156 
<a name="l00157"></a><a class="code" href="group__rpmbuild.html#g01a27e1bfdd6fe5f166dda2b1ab35cc3">00157</a> <a class="code" href="structPackage__s.html" title="The structure used to store values for a package.">Package</a> <a class="code" href="group__rpmbuild.html#g01a27e1bfdd6fe5f166dda2b1ab35cc3" title="Destroy package control structure.">freePackage</a>(<a class="code" href="structPackage__s.html" title="The structure used to store values for a package.">Package</a> pkg)
<a name="l00158"></a>00158 {
<a name="l00159"></a>00159     <span class="keywordflow">if</span> (pkg == NULL) <span class="keywordflow">return</span> NULL;
<a name="l00160"></a>00160     
<a name="l00161"></a>00161     pkg-&gt;<a class="code" href="structPackage__s.html#b92ee209f1670231174077e52d18878f">preInFile</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(pkg-&gt;<a class="code" href="structPackage__s.html#b92ee209f1670231174077e52d18878f">preInFile</a>);
<a name="l00162"></a>00162     pkg-&gt;<a class="code" href="structPackage__s.html#b0b88d9cfa36b5c3299cb4ac38550e35">postInFile</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(pkg-&gt;<a class="code" href="structPackage__s.html#b0b88d9cfa36b5c3299cb4ac38550e35">postInFile</a>);
<a name="l00163"></a>00163     pkg-&gt;<a class="code" href="structPackage__s.html#2944211b7a9c8ec4df69b9711d37e22b">preUnFile</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(pkg-&gt;<a class="code" href="structPackage__s.html#2944211b7a9c8ec4df69b9711d37e22b">preUnFile</a>);
<a name="l00164"></a>00164     pkg-&gt;<a class="code" href="structPackage__s.html#a76922c2a4f2bf881fcc6ab354160b6b">postUnFile</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(pkg-&gt;<a class="code" href="structPackage__s.html#a76922c2a4f2bf881fcc6ab354160b6b">postUnFile</a>);
<a name="l00165"></a>00165     pkg-&gt;<a class="code" href="structPackage__s.html#c6e6f617081a7bab3d0ef6b8c0938130">verifyFile</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(pkg-&gt;<a class="code" href="structPackage__s.html#c6e6f617081a7bab3d0ef6b8c0938130">verifyFile</a>);
<a name="l00166"></a>00166 
<a name="l00167"></a>00167     pkg-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a> = <a class="code" href="group__header.html#g7edd0b8c6a0e7e98632181b9390af930" title="Dereference a header instance.">headerFree</a>(pkg-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>);
<a name="l00168"></a>00168     pkg-&gt;<a class="code" href="structPackage__s.html#fac4777e99424dd25fe8ba062cf66026">ds</a> = <a class="code" href="rpmds_8c.html#d4f6e653b9867dafe662f57cf08431f6" title="Destroy a dependency set.">rpmdsFree</a>(pkg-&gt;<a class="code" href="structPackage__s.html#fac4777e99424dd25fe8ba062cf66026">ds</a>);
<a name="l00169"></a>00169     pkg-&gt;<a class="code" href="structPackage__s.html#4c91fdb06ead8b6bc0ebda1c41b06297">fileList</a> = <a class="code" href="stringbuf_8c.html#567493f29b7cd54c9df0598612a45511">freeStringBuf</a>(pkg-&gt;<a class="code" href="structPackage__s.html#4c91fdb06ead8b6bc0ebda1c41b06297">fileList</a>);
<a name="l00170"></a>00170     pkg-&gt;<a class="code" href="structPackage__s.html#bffafbb8b3dc6ece885169e7e82be161">fileFile</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(pkg-&gt;<a class="code" href="structPackage__s.html#bffafbb8b3dc6ece885169e7e82be161">fileFile</a>);
<a name="l00171"></a>00171     <span class="keywordflow">if</span> (pkg-&gt;<a class="code" href="structPackage__s.html#22895a51d58ee7526cb78e88653726c0">cpioList</a>) {
<a name="l00172"></a>00172         <a class="code" href="rpmlib_8h.html#2f4e0bf6f106ed6889162837ce39b83e" title="File info tag sets from a header, so that a header can be discarded early.">rpmfi</a> fi = pkg-&gt;<a class="code" href="structPackage__s.html#22895a51d58ee7526cb78e88653726c0">cpioList</a>;
<a name="l00173"></a>00173         pkg-&gt;<a class="code" href="structPackage__s.html#22895a51d58ee7526cb78e88653726c0">cpioList</a> = NULL;
<a name="l00174"></a>00174         fi = <a class="code" href="rpmfi_8c.html#577687ae390b322e982251d7c07deb50" title="Destroy a file info set.">rpmfiFree</a>(fi);
<a name="l00175"></a>00175     }
<a name="l00176"></a>00176 
<a name="l00177"></a>00177     pkg-&gt;<a class="code" href="structPackage__s.html#1d2168c54d4e51087701dc51d0a1530e">specialDoc</a> = <a class="code" href="stringbuf_8c.html#567493f29b7cd54c9df0598612a45511">freeStringBuf</a>(pkg-&gt;<a class="code" href="structPackage__s.html#1d2168c54d4e51087701dc51d0a1530e">specialDoc</a>);
<a name="l00178"></a>00178     pkg-&gt;<a class="code" href="structPackage__s.html#24bffded5b5fbd2d22a8ecda8366be52">icon</a> = <a class="code" href="spec_8c.html#2d923bf7b2c665afcfae21e2fc2920ee" title="Destroy source component chain.">freeSources</a>(pkg-&gt;<a class="code" href="structPackage__s.html#24bffded5b5fbd2d22a8ecda8366be52">icon</a>);
<a name="l00179"></a>00179     pkg-&gt;<a class="code" href="structPackage__s.html#b2cde5bdd0eabefb349d3ce0fe0a889d">triggerFiles</a> = <a class="code" href="spec_8c.html#c76eaffac2b6f6f33d5d2e5df3f03758" title="trigger entry chain">freeTriggerFiles</a>(pkg-&gt;<a class="code" href="structPackage__s.html#b2cde5bdd0eabefb349d3ce0fe0a889d">triggerFiles</a>);
<a name="l00180"></a>00180 
<a name="l00181"></a>00181     pkg = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(pkg);
<a name="l00182"></a>00182     <span class="keywordflow">return</span> NULL;
<a name="l00183"></a>00183 }
<a name="l00184"></a>00184 
<a name="l00185"></a><a class="code" href="group__rpmbuild.html#gf7a8aeacf0c7928805191cf195bf978d">00185</a> <a class="code" href="structPackage__s.html" title="The structure used to store values for a package.">Package</a> <a class="code" href="group__rpmbuild.html#gf7a8aeacf0c7928805191cf195bf978d" title="Destroy all packages associated with spec file.">freePackages</a>(<a class="code" href="structPackage__s.html" title="The structure used to store values for a package.">Package</a> packages)
<a name="l00186"></a>00186 {
<a name="l00187"></a>00187     <a class="code" href="structPackage__s.html" title="The structure used to store values for a package.">Package</a> p;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     <span class="keywordflow">while</span> ((p = packages) != NULL) {
<a name="l00190"></a>00190         packages = p-&gt;<a class="code" href="structPackage__s.html#13605bf6a2ed28fa86c892c7c0f31a3f">next</a>;
<a name="l00191"></a>00191         p-&gt;<a class="code" href="structPackage__s.html#13605bf6a2ed28fa86c892c7c0f31a3f">next</a> = NULL;
<a name="l00192"></a>00192         p = <a class="code" href="group__rpmbuild.html#g01a27e1bfdd6fe5f166dda2b1ab35cc3" title="Destroy package control structure.">freePackage</a>(p);
<a name="l00193"></a>00193     }
<a name="l00194"></a>00194     <span class="keywordflow">return</span> NULL;
<a name="l00195"></a>00195 }
<a name="l00196"></a>00196 
<a name="l00199"></a><a class="code" href="spec_8c.html#eb25b9af39a161a2759a3f8d754403b9">00199</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="comment">/*@owned@*/</span> <span class="keyword">struct </span><a class="code" href="structSource.html">Source</a> *<a class="code" href="spec_8c.html#eb25b9af39a161a2759a3f8d754403b9">findSource</a>(<a class="code" href="structSpec__s.html" title="The structure used to store values parsed from a spec file.">Spec</a> spec, <span class="keywordtype">int</span> <a class="code" href="structSource.html#3b50cac6d04914bae125086da4f7136a">num</a>, <span class="keywordtype">int</span> flag)
<a name="l00200"></a>00200         <span class="comment">/*@*/</span>
<a name="l00201"></a>00201 {
<a name="l00202"></a>00202     <span class="keyword">struct </span><a class="code" href="structSource.html">Source</a> *p;
<a name="l00203"></a>00203 
<a name="l00204"></a>00204     <span class="keywordflow">for</span> (p = spec-&gt;<a class="code" href="structSpec__s.html#eaa653ce193ab22d6769c3e645fd3c62">sources</a>; p != NULL; p = p-&gt;<a class="code" href="structSource.html#6f9cc4bf594f5c4693deaf0fdb892987">next</a>)
<a name="l00205"></a>00205         <span class="keywordflow">if</span> ((num == p-&gt;<a class="code" href="structSource.html#3b50cac6d04914bae125086da4f7136a">num</a>) &amp;&amp; (p-&gt;<a class="code" href="structSource.html#2671dcac0bc53bdbe4bb40a242a1e524">flags</a> &amp; flag)) <span class="keywordflow">return</span> p;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207     <span class="keywordflow">return</span> NULL;
<a name="l00208"></a>00208 }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210 <span class="comment">/*@-boundsread@*/</span>
<a name="l00211"></a><a class="code" href="group__rpmbuild.html#g4ed6d99ee7b894b9b5a52df72cf246bb">00211</a> <span class="keywordtype">int</span> <a class="code" href="group__rpmbuild.html#g4ed6d99ee7b894b9b5a52df72cf246bb" title="spec file control structure">parseNoSource</a>(<a class="code" href="structSpec__s.html" title="The structure used to store values parsed from a spec file.">Spec</a> spec, <span class="keyword">const</span> <span class="keywordtype">char</span> * field, <span class="keywordtype">int</span> tag)
<a name="l00212"></a>00212 {
<a name="l00213"></a>00213     <span class="keyword">const</span> <span class="keywordtype">char</span> *f, *fe;
<a name="l00214"></a>00214     <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structname.html">name</a>;
<a name="l00215"></a>00215     <span class="keywordtype">int</span> <a class="code" href="structSource.html#3b50cac6d04914bae125086da4f7136a">num</a>, flag;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     <span class="keywordflow">if</span> (tag == <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591c2f6801a422b78fcaad2ed2b04a26d23">RPMTAG_NOSOURCE</a>) {
<a name="l00218"></a>00218         flag = <a class="code" href="rpmspec_8h.html#5e7e2e3cb515fc4188cd272b9e4fafe2">RPMBUILD_ISSOURCE</a>;
<a name="l00219"></a>00219         name = <span class="stringliteral">"source"</span>;
<a name="l00220"></a>00220     } <span class="keywordflow">else</span> {
<a name="l00221"></a>00221         flag = <a class="code" href="rpmspec_8h.html#dfb83457c9974729c0b8841a516120e6">RPMBUILD_ISPATCH</a>;
<a name="l00222"></a>00222         name = <span class="stringliteral">"patch"</span>;
<a name="l00223"></a>00223     }
<a name="l00224"></a>00224     
<a name="l00225"></a>00225     fe = field;
<a name="l00226"></a>00226     <span class="keywordflow">for</span> (f = fe; *f != <span class="charliteral">'\0'</span>; f = fe) {
<a name="l00227"></a>00227         <span class="keyword">struct</span> <a class="code" href="structSource.html">Source</a> *p;
<a name="l00228"></a>00228 
<a name="l00229"></a>00229         <a class="code" href="files_8c.html#c1304386dfab6e8eb2658637075d1eef">SKIPWHITE</a>(f);
<a name="l00230"></a>00230         <span class="keywordflow">if</span> (*f == <span class="charliteral">'\0'</span>)
<a name="l00231"></a>00231             <span class="keywordflow">break</span>;
<a name="l00232"></a>00232         fe = f;
<a name="l00233"></a>00233         <a class="code" href="files_8c.html#08668152c50b145275c601fbd07c0973">SKIPNONWHITE</a>(fe);
<a name="l00234"></a>00234         <span class="keywordflow">if</span> (*fe != <span class="charliteral">'\0'</span>) fe++;
<a name="l00235"></a>00235 
<a name="l00236"></a>00236         <span class="keywordflow">if</span> (<a class="code" href="group__rpmbuild.html#gd05cc467e34ee5f643b38744f18c2710" title="Parse a number.">parseNum</a>(f, &amp;num)) {
<a name="l00237"></a>00237             <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"line %d: Bad number: %s\n"</span>),
<a name="l00238"></a>00238                      spec-&gt;<a class="code" href="structSpec__s.html#f11d8c7aaa2b4fc86b775a920d3fd319">lineNum</a>, f);
<a name="l00239"></a>00239             <span class="keywordflow">return</span> RPMERR_BADSPEC;
<a name="l00240"></a>00240         }
<a name="l00241"></a>00241 
<a name="l00242"></a>00242         <span class="keywordflow">if</span> (! (p = <a class="code" href="spec_8c.html#eb25b9af39a161a2759a3f8d754403b9">findSource</a>(spec, num, flag))) {
<a name="l00243"></a>00243             <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"line %d: Bad no%s number: %d\n"</span>),
<a name="l00244"></a>00244                      spec-&gt;<a class="code" href="structSpec__s.html#f11d8c7aaa2b4fc86b775a920d3fd319">lineNum</a>, name, num);
<a name="l00245"></a>00245             <span class="keywordflow">return</span> RPMERR_BADSPEC;
<a name="l00246"></a>00246         }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248         p-&gt;flags |= <a class="code" href="rpmspec_8h.html#cdeae09bc19922dfe8593d2c4916bdc3">RPMBUILD_ISNO</a>;
<a name="l00249"></a>00249 
<a name="l00250"></a>00250     }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252     <span class="keywordflow">return</span> 0;
<a name="l00253"></a>00253 }
<a name="l00254"></a>00254 <span class="comment">/*@=boundsread@*/</span>
<a name="l00255"></a>00255 
<a name="l00256"></a>00256 <span class="comment">/*@-boundswrite@*/</span>
<a name="l00257"></a><a class="code" href="group__rpmbuild.html#ge015968528f4151620ba653f0320078e">00257</a> <span class="keywordtype">int</span> <a class="code" href="group__rpmbuild.html#ge015968528f4151620ba653f0320078e" title="spec file control structure">addSource</a>(<a class="code" href="structSpec__s.html" title="The structure used to store values parsed from a spec file.">Spec</a> spec, <a class="code" href="structPackage__s.html" title="The structure used to store values for a package.">Package</a> pkg, <span class="keyword">const</span> <span class="keywordtype">char</span> *field, <span class="keywordtype">int</span> tag)
<a name="l00258"></a>00258 {
<a name="l00259"></a>00259     <span class="keyword">struct </span><a class="code" href="structSource.html">Source</a> *p;
<a name="l00260"></a>00260     <span class="keywordtype">int</span> flag = 0;
<a name="l00261"></a>00261     <span class="keywordtype">char</span> *<a class="code" href="structname.html">name</a> = NULL;
<a name="l00262"></a>00262     <span class="keywordtype">char</span> *nump;
<a name="l00263"></a>00263     <span class="keyword">const</span> <span class="keywordtype">char</span> *fieldp = NULL;
<a name="l00264"></a>00264     <span class="keywordtype">char</span> buf[BUFSIZ];
<a name="l00265"></a>00265     <span class="keywordtype">int</span> <a class="code" href="structSource.html#3b50cac6d04914bae125086da4f7136a">num</a> = 0;
<a name="l00266"></a>00266 
<a name="l00267"></a>00267     buf[0] = <span class="charliteral">'\0'</span>;
<a name="l00268"></a>00268     <span class="comment">/*@-branchstate@*/</span>
<a name="l00269"></a>00269     <span class="keywordflow">switch</span> (tag) {
<a name="l00270"></a>00270       <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591d4c54c3f82bb73a2cb4f9d7da6eed4e7">RPMTAG_SOURCE</a>:
<a name="l00271"></a>00271         flag = <a class="code" href="rpmspec_8h.html#5e7e2e3cb515fc4188cd272b9e4fafe2">RPMBUILD_ISSOURCE</a>;
<a name="l00272"></a>00272         name = <span class="stringliteral">"source"</span>;
<a name="l00273"></a>00273         fieldp = spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a> + 6;
<a name="l00274"></a>00274         <span class="keywordflow">break</span>;
<a name="l00275"></a>00275       <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591f1ef9d557fe5d29a8ff069c48ca072fe">RPMTAG_PATCH</a>:
<a name="l00276"></a>00276         flag = <a class="code" href="rpmspec_8h.html#dfb83457c9974729c0b8841a516120e6">RPMBUILD_ISPATCH</a>;
<a name="l00277"></a>00277         name = <span class="stringliteral">"patch"</span>;
<a name="l00278"></a>00278         fieldp = spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a> + 5;
<a name="l00279"></a>00279         <span class="keywordflow">break</span>;
<a name="l00280"></a>00280       <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335913ba77631b933a85efc7ee29f34175a18">RPMTAG_ICON</a>:
<a name="l00281"></a>00281         flag = <a class="code" href="rpmspec_8h.html#77c86cf64f7ce24c0d017f5a6ef75818">RPMBUILD_ISICON</a>;
<a name="l00282"></a>00282         fieldp = NULL;
<a name="l00283"></a>00283         <span class="keywordflow">break</span>;
<a name="l00284"></a>00284     }
<a name="l00285"></a>00285     <span class="comment">/*@=branchstate@*/</span>
<a name="l00286"></a>00286 
<a name="l00287"></a>00287     <span class="comment">/* Get the number */</span>
<a name="l00288"></a>00288     <span class="keywordflow">if</span> (tag != <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335913ba77631b933a85efc7ee29f34175a18">RPMTAG_ICON</a>) {
<a name="l00289"></a>00289         <span class="comment">/* We already know that a ':' exists, and that there */</span>
<a name="l00290"></a>00290         <span class="comment">/* are no spaces before it.                          */</span>
<a name="l00291"></a>00291         <span class="comment">/* This also now allows for spaces and tabs between  */</span>
<a name="l00292"></a>00292         <span class="comment">/* the number and the ':'                            */</span>
<a name="l00293"></a>00293 
<a name="l00294"></a>00294         nump = buf;
<a name="l00295"></a>00295         <span class="keywordflow">while</span> ((*fieldp != <span class="charliteral">':'</span>) &amp;&amp; (*fieldp != <span class="charliteral">' '</span>) &amp;&amp; (*fieldp != <span class="charliteral">'\t'</span>)) {
<a name="l00296"></a>00296             *nump++ = *fieldp++;
<a name="l00297"></a>00297         }
<a name="l00298"></a>00298         *nump = <span class="charliteral">'\0'</span>;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300         nump = buf;
<a name="l00301"></a>00301         <a class="code" href="rpmbuild_8h.html#8f81069c22bebb175ee6c1524590c93c">SKIPSPACE</a>(nump);
<a name="l00302"></a>00302         <span class="keywordflow">if</span> (nump == NULL || *nump == <span class="charliteral">'\0'</span>) {
<a name="l00303"></a>00303             num = 0;
<a name="l00304"></a>00304         } <span class="keywordflow">else</span> {
<a name="l00305"></a>00305             <span class="keywordflow">if</span> (<a class="code" href="group__rpmbuild.html#gd05cc467e34ee5f643b38744f18c2710" title="Parse a number.">parseNum</a>(buf, &amp;num)) {
<a name="l00306"></a>00306                 <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66bae3dd567b831f00df03cb22bceec4ab33">RPMERR_BADSPEC</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"line %d: Bad %s number: %s\n"</span>),
<a name="l00307"></a>00307                          spec-&gt;<a class="code" href="structSpec__s.html#f11d8c7aaa2b4fc86b775a920d3fd319">lineNum</a>, name, spec-&gt;<a class="code" href="structSpec__s.html#8e4b0b65c42c2045b9e14d12607ccd8b">line</a>);
<a name="l00308"></a>00308                 <span class="keywordflow">return</span> RPMERR_BADSPEC;
<a name="l00309"></a>00309             }
<a name="l00310"></a>00310         }
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     <span class="comment">/* Create the entry and link it in */</span>
<a name="l00314"></a>00314     p = <a class="code" href="system_8h.html#2ff4ef58da7e543466e75f20f2a2d8b7">xmalloc</a>(<span class="keyword">sizeof</span>(*p));
<a name="l00315"></a>00315     p-&gt;num = num;
<a name="l00316"></a>00316     p-&gt;fullSource = <a class="code" href="system_8h.html#700bf3013e33311eacdd1f20d13bdc9a">xstrdup</a>(field);
<a name="l00317"></a>00317     p-&gt;flags = flag;
<a name="l00318"></a>00318     p-&gt;source = strrchr(p-&gt;fullSource, <span class="charliteral">'/'</span>);
<a name="l00319"></a>00319     <span class="keywordflow">if</span> (p-&gt;source) {
<a name="l00320"></a>00320         p-&gt;source++;
<a name="l00321"></a>00321     } <span class="keywordflow">else</span> {
<a name="l00322"></a>00322         p-&gt;source = p-&gt;fullSource;
<a name="l00323"></a>00323     }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325     <span class="keywordflow">if</span> (tag != <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335913ba77631b933a85efc7ee29f34175a18">RPMTAG_ICON</a>) {
<a name="l00326"></a>00326         p-&gt;next = spec-&gt;<a class="code" href="structSpec__s.html#eaa653ce193ab22d6769c3e645fd3c62">sources</a>;
<a name="l00327"></a>00327         spec-&gt;<a class="code" href="structSpec__s.html#eaa653ce193ab22d6769c3e645fd3c62">sources</a> = p;
<a name="l00328"></a>00328     } <span class="keywordflow">else</span> {
<a name="l00329"></a>00329         p-&gt;<a class="code" href="structSource.html#6f9cc4bf594f5c4693deaf0fdb892987">next</a> = pkg-&gt;<a class="code" href="structPackage__s.html#24bffded5b5fbd2d22a8ecda8366be52">icon</a>;
<a name="l00330"></a>00330         pkg-&gt;<a class="code" href="structPackage__s.html#24bffded5b5fbd2d22a8ecda8366be52">icon</a> = p;
<a name="l00331"></a>00331     }
<a name="l00332"></a>00332 
<a name="l00333"></a>00333     spec-&gt;<a class="code" href="structSpec__s.html#3a2a45c3731cd951a0b4e75f0ab3105c">numSources</a>++;
<a name="l00334"></a>00334 
<a name="l00335"></a>00335     <span class="keywordflow">if</span> (tag != <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335913ba77631b933a85efc7ee29f34175a18">RPMTAG_ICON</a>) {
<a name="l00336"></a>00336         <span class="comment">/*@-nullpass@*/</span>         <span class="comment">/* LCL: varargs needs null annotate. */</span>
<a name="l00337"></a>00337         <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lparser_8c.html#2134db9038074b92bd895d8040cb5f29">body</a> = <a class="code" href="macro_8c.html#1bce9a7d7c5c5833d2eda2dcaa761bd5" title="Return (malloc'ed) expanded, canonicalized, file path.">rpmGetPath</a>(<span class="stringliteral">"%{_sourcedir}/"</span>, p-&gt;source, NULL);
<a name="l00338"></a>00338         <span class="comment">/*@=nullpass@*/</span>
<a name="l00339"></a>00339 
<a name="l00340"></a>00340         sprintf(buf, <span class="stringliteral">"%s%d"</span>,
<a name="l00341"></a>00341                 (flag &amp; <a class="code" href="rpmspec_8h.html#dfb83457c9974729c0b8841a516120e6">RPMBUILD_ISPATCH</a>) ? <span class="stringliteral">"PATCH"</span> : <span class="stringliteral">"SOURCE"</span>, num);
<a name="l00342"></a>00342         <a class="code" href="macro_8c.html#3851992697896dc8ed8f0be8ca6ec3e4" title="Add macro to context.">addMacro</a>(spec-&gt;<a class="code" href="structSpec__s.html#a6ba79a7deb05c10860fc4870fd7434d">macros</a>, buf, NULL, body, <a class="code" href="rpmmacro_8h.html#3ee0ea50fb98f2c07b552a72a401a7f9">RMIL_SPEC</a>);
<a name="l00343"></a>00343         sprintf(buf, <span class="stringliteral">"%sURL%d"</span>,
<a name="l00344"></a>00344                 (flag &amp; RPMBUILD_ISPATCH) ? <span class="stringliteral">"PATCH"</span> : <span class="stringliteral">"SOURCE"</span>, num);
<a name="l00345"></a>00345         <a class="code" href="macro_8c.html#3851992697896dc8ed8f0be8ca6ec3e4" title="Add macro to context.">addMacro</a>(spec-&gt;<a class="code" href="structSpec__s.html#a6ba79a7deb05c10860fc4870fd7434d">macros</a>, buf, NULL, p-&gt;fullSource, <a class="code" href="rpmmacro_8h.html#3ee0ea50fb98f2c07b552a72a401a7f9">RMIL_SPEC</a>);
<a name="l00346"></a>00346         body = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(body);
<a name="l00347"></a>00347     }
<a name="l00348"></a>00348     
<a name="l00349"></a>00349     <span class="keywordflow">return</span> 0;
<a name="l00350"></a>00350 }
<a name="l00351"></a>00351 <span class="comment">/*@=boundswrite@*/</span>
<a name="l00352"></a>00352 
<a name="l00355"></a><a class="code" href="spec_8c.html#0eec86f4bba1db69c454d91416147c1c">00355</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="comment">/*@only@*/</span> <span class="comment">/*@null@*/</span> <a class="code" href="structspeclines__s.html">speclines</a> <a class="code" href="spec_8c.html#0eec86f4bba1db69c454d91416147c1c">newSl</a>(<span class="keywordtype">void</span>)
<a name="l00356"></a>00356         <span class="comment">/*@*/</span>
<a name="l00357"></a>00357 {
<a name="l00358"></a>00358     <a class="code" href="structspeclines__s.html">speclines</a> sl = NULL;
<a name="l00359"></a>00359     <span class="comment">/*@-branchstate@*/</span>
<a name="l00360"></a>00360     <span class="keywordflow">if</span> (<a class="code" href="spec_8c.html#7eb51b476f308337156371e05a4dfe57">specedit</a>) {
<a name="l00361"></a>00361         sl = <a class="code" href="system_8h.html#2ff4ef58da7e543466e75f20f2a2d8b7">xmalloc</a>(<span class="keyword">sizeof</span>(*sl));
<a name="l00362"></a>00362         sl-&gt;sl_lines = NULL;
<a name="l00363"></a>00363         sl-&gt;sl_nalloc = 0;
<a name="l00364"></a>00364         sl-&gt;sl_nlines = 0;
<a name="l00365"></a>00365     }
<a name="l00366"></a>00366     <span class="comment">/*@=branchstate@*/</span>
<a name="l00367"></a>00367     <span class="keywordflow">return</span> sl;
<a name="l00368"></a>00368 }
<a name="l00369"></a>00369 
<a name="l00372"></a>00372 <span class="comment">/*@-boundswrite@*/</span>
<a name="l00373"></a><a class="code" href="spec_8c.html#93a20cf696715fac97a7791b02d2f19e">00373</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="comment">/*@null@*/</span> <a class="code" href="structspeclines__s.html">speclines</a> <a class="code" href="spec_8c.html#93a20cf696715fac97a7791b02d2f19e">freeSl</a>(<span class="comment">/*@only@*/</span> <span class="comment">/*@null@*/</span> <a class="code" href="structspeclines__s.html">speclines</a> sl)
<a name="l00374"></a>00374         <span class="comment">/*@modifies sl @*/</span>
<a name="l00375"></a>00375 {
<a name="l00376"></a>00376     <span class="keywordtype">int</span> i;
<a name="l00377"></a>00377     <span class="keywordflow">if</span> (sl == NULL) <span class="keywordflow">return</span> NULL;
<a name="l00378"></a>00378     <span class="keywordflow">for</span> (i = 0; i &lt; sl-&gt;<a class="code" href="structspeclines__s.html#fb8379e80bcf7bccb0a4f8e6b168308b">sl_nlines</a>; i++)
<a name="l00379"></a>00379         <span class="comment">/*@-unqualifiedtrans@*/</span>
<a name="l00380"></a>00380         sl-&gt;<a class="code" href="structspeclines__s.html#122e469d353480cedb15fa433dbfa1bf">sl_lines</a>[i] = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(sl-&gt;<a class="code" href="structspeclines__s.html#122e469d353480cedb15fa433dbfa1bf">sl_lines</a>[i]);
<a name="l00381"></a>00381         <span class="comment">/*@=unqualifiedtrans@*/</span>
<a name="l00382"></a>00382     sl-&gt;<a class="code" href="structspeclines__s.html#122e469d353480cedb15fa433dbfa1bf">sl_lines</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(sl-&gt;<a class="code" href="structspeclines__s.html#122e469d353480cedb15fa433dbfa1bf">sl_lines</a>);
<a name="l00383"></a>00383     <span class="keywordflow">return</span> <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(sl);
<a name="l00384"></a>00384 }
<a name="l00385"></a>00385 <span class="comment">/*@=boundswrite@*/</span>
<a name="l00386"></a>00386 
<a name="l00389"></a><a class="code" href="spec_8c.html#001f1a22b1d9c3c534b0733c113b07b6">00389</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="comment">/*@only@*/</span> <span class="comment">/*@null@*/</span> <a class="code" href="structspectags__s.html">spectags</a> <a class="code" href="spec_8c.html#001f1a22b1d9c3c534b0733c113b07b6">newSt</a>(<span class="keywordtype">void</span>)
<a name="l00390"></a>00390         <span class="comment">/*@*/</span>
<a name="l00391"></a>00391 {
<a name="l00392"></a>00392     <a class="code" href="structspectags__s.html">spectags</a> st = NULL;
<a name="l00393"></a>00393     <span class="comment">/*@-branchstate@*/</span>
<a name="l00394"></a>00394     <span class="keywordflow">if</span> (<a class="code" href="spec_8c.html#7eb51b476f308337156371e05a4dfe57">specedit</a>) {
<a name="l00395"></a>00395         st = <a class="code" href="system_8h.html#2ff4ef58da7e543466e75f20f2a2d8b7">xmalloc</a>(<span class="keyword">sizeof</span>(*st));
<a name="l00396"></a>00396         st-&gt;st_t = NULL;
<a name="l00397"></a>00397         st-&gt;st_nalloc = 0;
<a name="l00398"></a>00398         st-&gt;st_ntags = 0;
<a name="l00399"></a>00399     }
<a name="l00400"></a>00400     <span class="comment">/*@=branchstate@*/</span>
<a name="l00401"></a>00401     <span class="keywordflow">return</span> st;
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 
<a name="l00406"></a><a class="code" href="spec_8c.html#1931d5da4c96dbc459862ec8d25fb682">00406</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="comment">/*@null@*/</span> <a class="code" href="structspectags__s.html">spectags</a> <a class="code" href="spec_8c.html#1931d5da4c96dbc459862ec8d25fb682">freeSt</a>(<span class="comment">/*@only@*/</span> <span class="comment">/*@null@*/</span> <a class="code" href="structspectags__s.html">spectags</a> st)
<a name="l00407"></a>00407         <span class="comment">/*@modifies st @*/</span>
<a name="l00408"></a>00408 {
<a name="l00409"></a>00409     <span class="keywordtype">int</span> i;
<a name="l00410"></a>00410     <span class="keywordflow">if</span> (st == NULL) <span class="keywordflow">return</span> NULL;
<a name="l00411"></a>00411     <span class="keywordflow">for</span> (i = 0; i &lt; st-&gt;<a class="code" href="structspectags__s.html#21369137314add350710d6569d3f7298">st_ntags</a>; i++) {
<a name="l00412"></a>00412         <a class="code" href="structspectag__s.html">spectag</a> t = st-&gt;<a class="code" href="structspectags__s.html#3adc0c0f77e35dbbea9377780406f8b1">st_t</a> + i;
<a name="l00413"></a>00413         t-&gt;<a class="code" href="structspectag__s.html#3cf1adaa73be872cd00f3ffe9fa04a92">t_lang</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(t-&gt;t_lang);
<a name="l00414"></a>00414         t-&gt;t_msgid = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(t-&gt;t_msgid);
<a name="l00415"></a>00415     }
<a name="l00416"></a>00416     st-&gt;<a class="code" href="structspectags__s.html#3adc0c0f77e35dbbea9377780406f8b1">st_t</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(st-&gt;<a class="code" href="structspectags__s.html#3adc0c0f77e35dbbea9377780406f8b1">st_t</a>);
<a name="l00417"></a>00417     <span class="keywordflow">return</span> <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(st);
<a name="l00418"></a>00418 }
<a name="l00419"></a>00419 
<a name="l00420"></a><a class="code" href="group__rpmbuild.html#gd03c676c9e184124684f6f170bec8712">00420</a> <a class="code" href="structSpec__s.html" title="The structure used to store values parsed from a spec file.">Spec</a> <a class="code" href="group__rpmbuild.html#gd03c676c9e184124684f6f170bec8712" title="Create and initialize Spec structure.">newSpec</a>(<span class="keywordtype">void</span>)
<a name="l00421"></a>00421 {
<a name="l00422"></a>00422     <a class="code" href="structSpec__s.html" title="The structure used to store values parsed from a spec file.">Spec</a> spec = <a class="code" href="system_8h.html#9533f3165c8a4af7283dce262b32989f">xcalloc</a>(1, <span class="keyword">sizeof</span>(*spec));
<a name="l00423"></a>00423     
<a name="l00424"></a>00424     spec-&gt;specFile = NULL;
<a name="l00425"></a>00425 
<a name="l00426"></a>00426     spec-&gt;sl = <a class="code" href="spec_8c.html#0eec86f4bba1db69c454d91416147c1c">newSl</a>();
<a name="l00427"></a>00427     spec-&gt;st = <a class="code" href="spec_8c.html#001f1a22b1d9c3c534b0733c113b07b6">newSt</a>();
<a name="l00428"></a>00428 
<a name="l00429"></a>00429     spec-&gt;fileStack = NULL;
<a name="l00430"></a>00430 <span class="comment">/*@-boundswrite@*/</span>
<a name="l00431"></a>00431     spec-&gt;lbuf[0] = <span class="charliteral">'\0'</span>;
<a name="l00432"></a>00432 <span class="comment">/*@=boundswrite@*/</span>
<a name="l00433"></a>00433     spec-&gt;line = spec-&gt;lbuf;
<a name="l00434"></a>00434     spec-&gt;nextline = NULL;
<a name="l00435"></a>00435     spec-&gt;nextpeekc = <span class="charliteral">'\0'</span>;
<a name="l00436"></a>00436     spec-&gt;lineNum = 0;
<a name="l00437"></a>00437     spec-&gt;readStack = <a class="code" href="system_8h.html#9533f3165c8a4af7283dce262b32989f">xcalloc</a>(1, <span class="keyword">sizeof</span>(*spec-&gt;readStack));
<a name="l00438"></a>00438     spec-&gt;readStack-&gt;next = NULL;
<a name="l00439"></a>00439     spec-&gt;readStack-&gt;reading = 1;
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     spec-&gt;rootURL = NULL;
<a name="l00442"></a>00442     spec-&gt;prep = NULL;
<a name="l00443"></a>00443     spec-&gt;build = NULL;
<a name="l00444"></a>00444     spec-&gt;install = NULL;
<a name="l00445"></a>00445     spec-&gt;check = NULL;
<a name="l00446"></a>00446     spec-&gt;clean = NULL;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448     spec-&gt;sources = NULL;
<a name="l00449"></a>00449     spec-&gt;packages = NULL;
<a name="l00450"></a>00450     spec-&gt;noSource = 0;
<a name="l00451"></a>00451     spec-&gt;numSources = 0;
<a name="l00452"></a>00452 
<a name="l00453"></a>00453     spec-&gt;sourceRpmName = NULL;
<a name="l00454"></a>00454     spec-&gt;sourcePkgId = NULL;
<a name="l00455"></a>00455     spec-&gt;sourceHeader = NULL;
<a name="l00456"></a>00456     spec-&gt;sourceCpioList = NULL;
<a name="l00457"></a>00457     
<a name="l00458"></a>00458     spec-&gt;gotBuildRootURL = 0;
<a name="l00459"></a>00459     spec-&gt;buildRootURL = NULL;
<a name="l00460"></a>00460     spec-&gt;buildSubdir = NULL;
<a name="l00461"></a>00461 
<a name="l00462"></a>00462     spec-&gt;passPhrase = NULL;
<a name="l00463"></a>00463     spec-&gt;timeCheck = 0;
<a name="l00464"></a>00464     spec-&gt;cookie = NULL;
<a name="l00465"></a>00465 
<a name="l00466"></a>00466     spec-&gt;buildRestrictions = <a class="code" href="group__header.html#g89e041c18d9838db19c49f442dbe1e5e" title="Create new (empty) header instance.">headerNew</a>();
<a name="l00467"></a>00467     spec-&gt;BANames = NULL;
<a name="l00468"></a>00468     spec-&gt;BACount = 0;
<a name="l00469"></a>00469     spec-&gt;recursing = 0;
<a name="l00470"></a>00470     spec-&gt;BASpecs = NULL;
<a name="l00471"></a>00471 
<a name="l00472"></a>00472     spec-&gt;force = 0;
<a name="l00473"></a>00473     spec-&gt;anyarch = 0;
<a name="l00474"></a>00474 
<a name="l00475"></a>00475 <span class="comment">/*@i@*/</span> spec-&gt;macros = <a class="code" href="rpmlib_8h.html#5f1e66bfdc1ff8894d704a5c98fb25f4">rpmGlobalMacroContext</a>;
<a name="l00476"></a>00476     
<a name="l00477"></a>00477     <span class="keywordflow">return</span> spec;
<a name="l00478"></a>00478 }
<a name="l00479"></a>00479 
<a name="l00480"></a><a class="code" href="group__rpmbuild.html#g60c3eb1a791318201e7497ca162217c2">00480</a> <a class="code" href="structSpec__s.html" title="The structure used to store values parsed from a spec file.">Spec</a> <a class="code" href="group__rpmbuild.html#g60c3eb1a791318201e7497ca162217c2" title="Destroy Spec structure.">freeSpec</a>(<a class="code" href="structSpec__s.html" title="The structure used to store values parsed from a spec file.">Spec</a> spec)
<a name="l00481"></a>00481 {
<a name="l00482"></a>00482     <span class="keyword">struct </span><a class="code" href="structReadLevelEntry.html">ReadLevelEntry</a> *rl;
<a name="l00483"></a>00483 
<a name="l00484"></a>00484     <span class="keywordflow">if</span> (spec == NULL) <span class="keywordflow">return</span> NULL;
<a name="l00485"></a>00485 
<a name="l00486"></a>00486     spec-&gt;<a class="code" href="structSpec__s.html#70bc6c0b93fa033e5a2a9cecdb391894">sl</a> = <a class="code" href="spec_8c.html#93a20cf696715fac97a7791b02d2f19e">freeSl</a>(spec-&gt;<a class="code" href="structSpec__s.html#70bc6c0b93fa033e5a2a9cecdb391894">sl</a>);
<a name="l00487"></a>00487     spec-&gt;<a class="code" href="structSpec__s.html#79c8d93efa234640e8340e32b4d0c5ca">st</a> = <a class="code" href="spec_8c.html#1931d5da4c96dbc459862ec8d25fb682">freeSt</a>(spec-&gt;<a class="code" href="structSpec__s.html#79c8d93efa234640e8340e32b4d0c5ca">st</a>);
<a name="l00488"></a>00488 
<a name="l00489"></a>00489     spec-&gt;<a class="code" href="structSpec__s.html#09098cde22fc219c1c6367e5e117f365">prep</a> = <a class="code" href="stringbuf_8c.html#567493f29b7cd54c9df0598612a45511">freeStringBuf</a>(spec-&gt;<a class="code" href="structSpec__s.html#09098cde22fc219c1c6367e5e117f365">prep</a>);
<a name="l00490"></a>00490     spec-&gt;<a class="code" href="structSpec__s.html#5aa983345498324beb53253ca53a6db5">build</a> = <a class="code" href="stringbuf_8c.html#567493f29b7cd54c9df0598612a45511">freeStringBuf</a>(spec-&gt;<a class="code" href="structSpec__s.html#5aa983345498324beb53253ca53a6db5">build</a>);
<a name="l00491"></a>00491     spec-&gt;<a class="code" href="structSpec__s.html#fbcfe2250b824858a679c13291203fbe">install</a> = <a class="code" href="stringbuf_8c.html#567493f29b7cd54c9df0598612a45511">freeStringBuf</a>(spec-&gt;<a class="code" href="structSpec__s.html#fbcfe2250b824858a679c13291203fbe">install</a>);
<a name="l00492"></a>00492     spec-&gt;<a class="code" href="structSpec__s.html#df5dabd72d091854b4a408fd706498bc">check</a> = <a class="code" href="stringbuf_8c.html#567493f29b7cd54c9df0598612a45511">freeStringBuf</a>(spec-&gt;<a class="code" href="structSpec__s.html#df5dabd72d091854b4a408fd706498bc">check</a>);
<a name="l00493"></a>00493     spec-&gt;<a class="code" href="structSpec__s.html#9ecabe746fb92ebcbd532ea5abb3a6ad">clean</a> = <a class="code" href="stringbuf_8c.html#567493f29b7cd54c9df0598612a45511">freeStringBuf</a>(spec-&gt;<a class="code" href="structSpec__s.html#9ecabe746fb92ebcbd532ea5abb3a6ad">clean</a>);
<a name="l00494"></a>00494 
<a name="l00495"></a>00495     spec-&gt;<a class="code" href="structSpec__s.html#e5e372fa94803e9d0ca3a75b74925f6f">buildRootURL</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(spec-&gt;<a class="code" href="structSpec__s.html#e5e372fa94803e9d0ca3a75b74925f6f">buildRootURL</a>);
<a name="l00496"></a>00496     spec-&gt;<a class="code" href="structSpec__s.html#62e614ee5328af12966cc90dc20c810d">buildSubdir</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(spec-&gt;<a class="code" href="structSpec__s.html#62e614ee5328af12966cc90dc20c810d">buildSubdir</a>);
<a name="l00497"></a>00497     spec-&gt;<a class="code" href="structSpec__s.html#8038917cd6b1804cddc3812127b95125">rootURL</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(spec-&gt;<a class="code" href="structSpec__s.html#8038917cd6b1804cddc3812127b95125">rootURL</a>);
<a name="l00498"></a>00498     spec-&gt;<a class="code" href="structSpec__s.html#d1aa987b6587e5397a04f1e86e50a902">specFile</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(spec-&gt;<a class="code" href="structSpec__s.html#d1aa987b6587e5397a04f1e86e50a902">specFile</a>);
<a name="l00499"></a>00499 
<a name="l00500"></a>00500 <span class="preprocessor">#ifdef  DEAD</span>
<a name="l00501"></a>00501 <span class="preprocessor"></span>  { <span class="keyword">struct </span><a class="code" href="structOpenFileInfo.html">OpenFileInfo</a> *ofi;
<a name="l00502"></a>00502     <span class="keywordflow">while</span> (spec-&gt;<a class="code" href="structSpec__s.html#b3d5f6b07dbea73216b81fe0e586a359">fileStack</a>) {
<a name="l00503"></a>00503         ofi = spec-&gt;<a class="code" href="structSpec__s.html#b3d5f6b07dbea73216b81fe0e586a359">fileStack</a>;
<a name="l00504"></a>00504         spec-&gt;<a class="code" href="structSpec__s.html#b3d5f6b07dbea73216b81fe0e586a359">fileStack</a> = ofi-&gt;<a class="code" href="structOpenFileInfo.html#aefbb6ff632e350655e1bb2fd4a23b67">next</a>;
<a name="l00505"></a>00505         ofi-&gt;<a class="code" href="structOpenFileInfo.html#aefbb6ff632e350655e1bb2fd4a23b67">next</a> = NULL;
<a name="l00506"></a>00506         ofi-&gt;<a class="code" href="structOpenFileInfo.html#c6adaec4acbd56c4952ce195c5da992d">fileName</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(ofi-&gt;<a class="code" href="structOpenFileInfo.html#c6adaec4acbd56c4952ce195c5da992d">fileName</a>);
<a name="l00507"></a>00507         ofi = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(ofi);
<a name="l00508"></a>00508     }
<a name="l00509"></a>00509   }
<a name="l00510"></a>00510 <span class="preprocessor">#else</span>
<a name="l00511"></a>00511 <span class="preprocessor"></span>    <a class="code" href="group__rpmbuild.html#gf25d9b72f0d32fedfad53a9eea6b3416" title="Stop reading from spec file, freeing resources.">closeSpec</a>(spec);
<a name="l00512"></a>00512 <span class="preprocessor">#endif</span>
<a name="l00513"></a>00513 <span class="preprocessor"></span>
<a name="l00514"></a>00514     <span class="keywordflow">while</span> (spec-&gt;<a class="code" href="structSpec__s.html#78a846c88907930504f7a3ceb7d71b46">readStack</a>) {
<a name="l00515"></a>00515         rl = spec-&gt;<a class="code" href="structSpec__s.html#78a846c88907930504f7a3ceb7d71b46">readStack</a>;
<a name="l00516"></a>00516         <span class="comment">/*@-dependenttrans@*/</span>
<a name="l00517"></a>00517         spec-&gt;<a class="code" href="structSpec__s.html#78a846c88907930504f7a3ceb7d71b46">readStack</a> = rl-&gt;<a class="code" href="structReadLevelEntry.html#6a4535560073d8c4fc45917260f5a1fc">next</a>;
<a name="l00518"></a>00518         <span class="comment">/*@=dependenttrans@*/</span>
<a name="l00519"></a>00519         rl-&gt;<a class="code" href="structReadLevelEntry.html#6a4535560073d8c4fc45917260f5a1fc">next</a> = NULL;
<a name="l00520"></a>00520         rl = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(rl);
<a name="l00521"></a>00521     }
<a name="l00522"></a>00522     
<a name="l00523"></a>00523     spec-&gt;<a class="code" href="structSpec__s.html#6ed780920ce83bf828282dbbb104ddb2">sourceRpmName</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(spec-&gt;<a class="code" href="structSpec__s.html#6ed780920ce83bf828282dbbb104ddb2">sourceRpmName</a>);
<a name="l00524"></a>00524     spec-&gt;<a class="code" href="structSpec__s.html#8d2536ae77469160111a1b4ad7c9c2d6">sourcePkgId</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(spec-&gt;<a class="code" href="structSpec__s.html#8d2536ae77469160111a1b4ad7c9c2d6">sourcePkgId</a>);
<a name="l00525"></a>00525     spec-&gt;<a class="code" href="structSpec__s.html#43682f939205985b1d28e31117f8f095">sourceHeader</a> = <a class="code" href="group__header.html#g7edd0b8c6a0e7e98632181b9390af930" title="Dereference a header instance.">headerFree</a>(spec-&gt;<a class="code" href="structSpec__s.html#43682f939205985b1d28e31117f8f095">sourceHeader</a>);
<a name="l00526"></a>00526 
<a name="l00527"></a>00527     <span class="keywordflow">if</span> (spec-&gt;<a class="code" href="structSpec__s.html#27343ea7c214826328688010f54b1968">sourceCpioList</a>) {
<a name="l00528"></a>00528         <a class="code" href="rpmlib_8h.html#2f4e0bf6f106ed6889162837ce39b83e" title="File info tag sets from a header, so that a header can be discarded early.">rpmfi</a> fi = spec-&gt;<a class="code" href="structSpec__s.html#27343ea7c214826328688010f54b1968">sourceCpioList</a>;
<a name="l00529"></a>00529         spec-&gt;<a class="code" href="structSpec__s.html#27343ea7c214826328688010f54b1968">sourceCpioList</a> = NULL;
<a name="l00530"></a>00530         fi = <a class="code" href="rpmfi_8c.html#577687ae390b322e982251d7c07deb50" title="Destroy a file info set.">rpmfiFree</a>(fi);
<a name="l00531"></a>00531     }
<a name="l00532"></a>00532     
<a name="l00533"></a>00533     spec-&gt;<a class="code" href="structSpec__s.html#6971ea3f633365c1451a806d359fd7ff">buildRestrictions</a> = <a class="code" href="group__header.html#g7edd0b8c6a0e7e98632181b9390af930" title="Dereference a header instance.">headerFree</a>(spec-&gt;<a class="code" href="structSpec__s.html#6971ea3f633365c1451a806d359fd7ff">buildRestrictions</a>);
<a name="l00534"></a>00534 
<a name="l00535"></a>00535     <span class="keywordflow">if</span> (!spec-&gt;<a class="code" href="structSpec__s.html#c449d990f6d1c34ea43fde17487ac28f">recursing</a>) {
<a name="l00536"></a>00536 <span class="comment">/*@-boundswrite@*/</span>
<a name="l00537"></a>00537         <span class="keywordflow">if</span> (spec-&gt;<a class="code" href="structSpec__s.html#5e49af1385f819120bda073c3e5983b7">BASpecs</a> != NULL)
<a name="l00538"></a>00538         <span class="keywordflow">while</span> (spec-&gt;<a class="code" href="structSpec__s.html#1b967e2c626e4a8116f651338e70ead0">BACount</a>--) {
<a name="l00539"></a>00539             <span class="comment">/*@-unqualifiedtrans@*/</span>
<a name="l00540"></a>00540             spec-&gt;<a class="code" href="structSpec__s.html#5e49af1385f819120bda073c3e5983b7">BASpecs</a>[spec-&gt;<a class="code" href="structSpec__s.html#1b967e2c626e4a8116f651338e70ead0">BACount</a>] =
<a name="l00541"></a>00541                         <a class="code" href="group__rpmbuild.html#g60c3eb1a791318201e7497ca162217c2" title="Destroy Spec structure.">freeSpec</a>(spec-&gt;<a class="code" href="structSpec__s.html#5e49af1385f819120bda073c3e5983b7">BASpecs</a>[spec-&gt;<a class="code" href="structSpec__s.html#1b967e2c626e4a8116f651338e70ead0">BACount</a>]);
<a name="l00542"></a>00542             <span class="comment">/*@=unqualifiedtrans@*/</span>
<a name="l00543"></a>00543         }
<a name="l00544"></a>00544 <span class="comment">/*@=boundswrite@*/</span>
<a name="l00545"></a>00545         <span class="comment">/*@-compdef@*/</span>
<a name="l00546"></a>00546         spec-&gt;<a class="code" href="structSpec__s.html#5e49af1385f819120bda073c3e5983b7">BASpecs</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(spec-&gt;<a class="code" href="structSpec__s.html#5e49af1385f819120bda073c3e5983b7">BASpecs</a>);
<a name="l00547"></a>00547         <span class="comment">/*@=compdef@*/</span>
<a name="l00548"></a>00548     }
<a name="l00549"></a>00549     spec-&gt;<a class="code" href="structSpec__s.html#317830f242bb2211397b65da0f86dd51">BANames</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(spec-&gt;<a class="code" href="structSpec__s.html#317830f242bb2211397b65da0f86dd51">BANames</a>);
<a name="l00550"></a>00550 
<a name="l00551"></a>00551     spec-&gt;<a class="code" href="structSpec__s.html#5089a1911121bb12f28bfcbebfb88036">passPhrase</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(spec-&gt;<a class="code" href="structSpec__s.html#5089a1911121bb12f28bfcbebfb88036">passPhrase</a>);
<a name="l00552"></a>00552     spec-&gt;<a class="code" href="structSpec__s.html#6bb9ca036787a5cf51573f8178e4b70a">cookie</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(spec-&gt;<a class="code" href="structSpec__s.html#6bb9ca036787a5cf51573f8178e4b70a">cookie</a>);
<a name="l00553"></a>00553 
<a name="l00554"></a>00554     spec-&gt;<a class="code" href="structSpec__s.html#eaa653ce193ab22d6769c3e645fd3c62">sources</a> = <a class="code" href="spec_8c.html#2d923bf7b2c665afcfae21e2fc2920ee" title="Destroy source component chain.">freeSources</a>(spec-&gt;<a class="code" href="structSpec__s.html#eaa653ce193ab22d6769c3e645fd3c62">sources</a>);
<a name="l00555"></a>00555     spec-&gt;<a class="code" href="structSpec__s.html#ffcee259f7ea1e815853ac3ae9f643c2">packages</a> = <a class="code" href="group__rpmbuild.html#gf7a8aeacf0c7928805191cf195bf978d" title="Destroy all packages associated with spec file.">freePackages</a>(spec-&gt;<a class="code" href="structSpec__s.html#ffcee259f7ea1e815853ac3ae9f643c2">packages</a>);
<a name="l00556"></a>00556     
<a name="l00557"></a>00557     spec = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(spec);
<a name="l00558"></a>00558 
<a name="l00559"></a>00559     <span class="keywordflow">return</span> spec;
<a name="l00560"></a>00560 }
<a name="l00561"></a>00561 
<a name="l00562"></a>00562 <span class="comment">/*@only@*/</span>
<a name="l00563"></a><a class="code" href="group__rpmbuild.html#g7d9d9372365939a90e2561de63f9e787">00563</a> <span class="keyword">struct </span><a class="code" href="structOpenFileInfo.html">OpenFileInfo</a> * <a class="code" href="group__rpmbuild.html#g7d9d9372365939a90e2561de63f9e787">newOpenFileInfo</a>(<span class="keywordtype">void</span>)
<a name="l00564"></a>00564 {
<a name="l00565"></a>00565     <span class="keyword">struct </span><a class="code" href="structOpenFileInfo.html">OpenFileInfo</a> *ofi;
<a name="l00566"></a>00566 
<a name="l00567"></a>00567     ofi = <a class="code" href="system_8h.html#2ff4ef58da7e543466e75f20f2a2d8b7">xmalloc</a>(<span class="keyword">sizeof</span>(*ofi));
<a name="l00568"></a>00568     ofi-&gt;fd = NULL;
<a name="l00569"></a>00569     ofi-&gt;fileName = NULL;
<a name="l00570"></a>00570     ofi-&gt;lineNum = 0;
<a name="l00571"></a>00571 <span class="comment">/*@-boundswrite@*/</span>
<a name="l00572"></a>00572     ofi-&gt;readBuf[0] = <span class="charliteral">'\0'</span>;
<a name="l00573"></a>00573 <span class="comment">/*@=boundswrite@*/</span>
<a name="l00574"></a>00574     ofi-&gt;readPtr = NULL;
<a name="l00575"></a>00575     ofi-&gt;next = NULL;
<a name="l00576"></a>00576 
<a name="l00577"></a>00577     <span class="keywordflow">return</span> ofi;
<a name="l00578"></a>00578 }
<a name="l00579"></a>00579 
<a name="l00584"></a>00584 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00585"></a><a class="code" href="spec_8c.html#f0a7cb78a07e895b27fefb051098a401">00585</a> <a class="code" href="spec_8c.html#f0a7cb78a07e895b27fefb051098a401" title="Print copy of spec file, filling in Group/Description/Summary from specspo.">printNewSpecfile</a>(<a class="code" href="structSpec__s.html" title="The structure used to store values parsed from a spec file.">Spec</a> spec)
<a name="l00586"></a>00586         <span class="comment">/*@globals fileSystem @*/</span>
<a name="l00587"></a>00587         <span class="comment">/*@modifies spec-&gt;sl-&gt;sl_lines[], fileSystem @*/</span>
<a name="l00588"></a>00588 {
<a name="l00589"></a>00589     <a class="code" href="structheaderToken__s.html" title="The Header data structure.">Header</a> h;
<a name="l00590"></a>00590     <a class="code" href="structspeclines__s.html">speclines</a> sl = spec-&gt;<a class="code" href="structSpec__s.html#70bc6c0b93fa033e5a2a9cecdb391894">sl</a>;
<a name="l00591"></a>00591     <a class="code" href="structspectags__s.html">spectags</a> st = spec-&gt;<a class="code" href="structSpec__s.html#79c8d93efa234640e8340e32b4d0c5ca">st</a>;
<a name="l00592"></a>00592     <span class="keyword">const</span> <span class="keywordtype">char</span> * msgstr = NULL;
<a name="l00593"></a>00593     <span class="keywordtype">int</span> i, j;
<a name="l00594"></a>00594 
<a name="l00595"></a>00595     <span class="keywordflow">if</span> (sl == NULL || st == NULL)
<a name="l00596"></a>00596         <span class="keywordflow">return</span>;
<a name="l00597"></a>00597 
<a name="l00598"></a>00598     <span class="comment">/*@-branchstate@*/</span>
<a name="l00599"></a>00599     <span class="keywordflow">for</span> (i = 0; i &lt; st-&gt;<a class="code" href="structspectags__s.html#21369137314add350710d6569d3f7298">st_ntags</a>; i++) {
<a name="l00600"></a>00600         <a class="code" href="structspectag__s.html">spectag</a> t = st-&gt;<a class="code" href="structspectags__s.html#3adc0c0f77e35dbbea9377780406f8b1">st_t</a> + i;
<a name="l00601"></a>00601         <span class="keyword">const</span> <span class="keywordtype">char</span> * tn = <a class="code" href="rpmlib_8h.html#3a61a67f93831144b44b4f43cc718320" title="Return tag name from value.">tagName</a>(t-&gt;t_tag);
<a name="l00602"></a>00602         <span class="keyword">const</span> <span class="keywordtype">char</span> * errstr;
<a name="l00603"></a>00603         <span class="keywordtype">char</span> fmt[1024];
<a name="l00604"></a>00604 
<a name="l00605"></a>00605         fmt[0] = <span class="charliteral">'\0'</span>;
<a name="l00606"></a>00606         if (t-&gt;t_msgid == NULL)
<a name="l00607"></a>00607             h = spec-&gt;<a class="code" href="structSpec__s.html#ffcee259f7ea1e815853ac3ae9f643c2">packages</a>-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>;
<a name="l00608"></a>00608         <span class="keywordflow">else</span> {
<a name="l00609"></a>00609             <a class="code" href="structPackage__s.html" title="The structure used to store values for a package.">Package</a> pkg;
<a name="l00610"></a>00610             <span class="keywordtype">char</span> *fe;
<a name="l00611"></a>00611 
<a name="l00612"></a>00612 <span class="comment">/*@-bounds@*/</span>
<a name="l00613"></a>00613             strcpy(fmt, t-&gt;t_msgid);
<a name="l00614"></a>00614             for (fe = fmt; *fe &amp;&amp; *fe != <span class="charliteral">'('</span>; fe++)
<a name="l00615"></a>00615                 {} ;
<a name="l00616"></a>00616             <span class="keywordflow">if</span> (*fe == <span class="charliteral">'('</span>) *fe = <span class="charliteral">'\0'</span>;
<a name="l00617"></a>00617 <span class="comment">/*@=bounds@*/</span>
<a name="l00618"></a>00618             h = NULL;
<a name="l00619"></a>00619             <span class="keywordflow">for</span> (pkg = spec-&gt;<a class="code" href="structSpec__s.html#ffcee259f7ea1e815853ac3ae9f643c2">packages</a>; pkg != NULL; pkg = pkg-&gt;<a class="code" href="structPackage__s.html#13605bf6a2ed28fa86c892c7c0f31a3f">next</a>) {
<a name="l00620"></a>00620                 <span class="keyword">const</span> <span class="keywordtype">char</span> *pkgname;
<a name="l00621"></a>00621                 h = pkg-&gt;header;
<a name="l00622"></a>00622                 (<span class="keywordtype">void</span>) <a class="code" href="group__header.html#g53462b3c5298a60fa2a43162deb4f41a" title="Return name, version, release strings from header.">headerNVR</a>(h, &amp;pkgname, NULL, NULL);
<a name="l00623"></a>00623                 <span class="keywordflow">if</span> (!strcmp(pkgname, fmt))
<a name="l00624"></a>00624                     <span class="comment">/*@innerbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00625"></a>00625             }
<a name="l00626"></a>00626             <span class="keywordflow">if</span> (pkg == NULL || h == NULL)
<a name="l00627"></a>00627                 h = spec-&gt;<a class="code" href="structSpec__s.html#ffcee259f7ea1e815853ac3ae9f643c2">packages</a>-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>;
<a name="l00628"></a>00628         }
<a name="l00629"></a>00629 
<a name="l00630"></a>00630         <span class="keywordflow">if</span> (h == NULL)
<a name="l00631"></a>00631             <span class="keywordflow">continue</span>;
<a name="l00632"></a>00632 
<a name="l00633"></a>00633         fmt[0] = <span class="charliteral">'\0'</span>;
<a name="l00634"></a>00634 <span class="comment">/*@-boundswrite@*/</span>
<a name="l00635"></a>00635         (void) <a class="code" href="system_8h.html#58841684f76853b313e27e663c850381">stpcpy</a>( <a class="code" href="system_8h.html#58841684f76853b313e27e663c850381">stpcpy</a>( <a class="code" href="system_8h.html#58841684f76853b313e27e663c850381">stpcpy</a>( fmt, <span class="stringliteral">"%{"</span>), tn), <span class="stringliteral">"}"</span>);
<a name="l00636"></a>00636 <span class="comment">/*@=boundswrite@*/</span>
<a name="l00637"></a>00637         msgstr = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(msgstr);
<a name="l00638"></a>00638 
<a name="l00639"></a>00639         <span class="comment">/* XXX this should use queryHeader(), but prints out tn as well. */</span>
<a name="l00640"></a>00640         msgstr = <a class="code" href="group__header.html#g7d710c2a50e88fefe8faae6efce8b039" title="Return formatted output string from header tags.">headerSprintf</a>(h, fmt, <a class="code" href="rpmlib_8h.html#a9352d22ad9fd8a7c4d699516fc015ca" title="Automatically generated table of tag name/value pairs.">rpmTagTable</a>, <a class="code" href="formats_8c.html#8c497f85ccf3d1b4ee014be46e3e4b5e" title="Table of query format extensions.">rpmHeaderFormats</a>, &amp;errstr);
<a name="l00641"></a>00641         <span class="keywordflow">if</span> (msgstr == NULL) {
<a name="l00642"></a>00642             <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66ba6ec9ced0a917002b6c421e7ccbf9bbf8">RPMERR_QFMT</a>, <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"can't query %s: %s\n"</span>), tn, errstr);
<a name="l00643"></a>00643             <span class="keywordflow">return</span>;
<a name="l00644"></a>00644         }
<a name="l00645"></a>00645 
<a name="l00646"></a>00646 <span class="comment">/*@-boundswrite@*/</span>
<a name="l00647"></a>00647         <span class="keywordflow">switch</span>(t-&gt;t_tag) {
<a name="l00648"></a>00648         <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc33591bd1d91d5ab5e18336b4ba004b10c1e7c">RPMTAG_SUMMARY</a>:
<a name="l00649"></a>00649         <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc335915485f21121ce49425dcf4eef0b83caa6">RPMTAG_GROUP</a>:
<a name="l00650"></a>00650             <span class="comment">/*@-unqualifiedtrans@*/</span>
<a name="l00651"></a>00651             sl-&gt;<a class="code" href="structspeclines__s.html#122e469d353480cedb15fa433dbfa1bf">sl_lines</a>[t-&gt;t_startx] = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(sl-&gt;<a class="code" href="structspeclines__s.html#122e469d353480cedb15fa433dbfa1bf">sl_lines</a>[t-&gt;t_startx]);
<a name="l00652"></a>00652             <span class="comment">/*@=unqualifiedtrans@*/</span>
<a name="l00653"></a>00653             <span class="keywordflow">if</span> (t-&gt;t_lang &amp;&amp; strcmp(t-&gt;t_lang, <a class="code" href="rpmspec_8h.html#9b6c70d9e5d4215bdc8dc68a41d64f82">RPMBUILD_DEFAULT_LANG</a>))
<a name="l00654"></a>00654                 <span class="keywordflow">continue</span>;
<a name="l00655"></a>00655             {   <span class="keywordtype">char</span> *buf = <a class="code" href="system_8h.html#2ff4ef58da7e543466e75f20f2a2d8b7">xmalloc</a>(strlen(tn) + <span class="keyword">sizeof</span>(<span class="stringliteral">": "</span>) + strlen(msgstr));
<a name="l00656"></a>00656                 (void) <a class="code" href="system_8h.html#58841684f76853b313e27e663c850381">stpcpy</a>( <a class="code" href="system_8h.html#58841684f76853b313e27e663c850381">stpcpy</a>( <a class="code" href="system_8h.html#58841684f76853b313e27e663c850381">stpcpy</a>(buf, tn), <span class="stringliteral">": "</span>), msgstr);
<a name="l00657"></a>00657                 sl-&gt;<a class="code" href="structspeclines__s.html#122e469d353480cedb15fa433dbfa1bf">sl_lines</a>[t-&gt;t_startx] = buf;
<a name="l00658"></a>00658             }
<a name="l00659"></a>00659             <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00660"></a>00660         <span class="keywordflow">case</span> <a class="code" href="rpmlib_8h.html#d1edbc08d3fcb1a7678eb956cfc3359119d6b21f4170cf2bb306d42c27c693c8">RPMTAG_DESCRIPTION</a>:
<a name="l00661"></a>00661             <span class="keywordflow">for</span> (j = 1; j &lt; t-&gt;t_nlines; j++) {
<a name="l00662"></a>00662                 <span class="keywordflow">if</span> (*sl-&gt;<a class="code" href="structspeclines__s.html#122e469d353480cedb15fa433dbfa1bf">sl_lines</a>[t-&gt;t_startx + j] == <span class="charliteral">'%'</span>)
<a name="l00663"></a>00663                     <span class="comment">/*@innercontinue@*/</span> <span class="keywordflow">continue</span>;
<a name="l00664"></a>00664                 <span class="comment">/*@-unqualifiedtrans@*/</span>
<a name="l00665"></a>00665                 sl-&gt;<a class="code" href="structspeclines__s.html#122e469d353480cedb15fa433dbfa1bf">sl_lines</a>[t-&gt;t_startx + j] =
<a name="l00666"></a>00666                         <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(sl-&gt;<a class="code" href="structspeclines__s.html#122e469d353480cedb15fa433dbfa1bf">sl_lines</a>[t-&gt;t_startx + j]);
<a name="l00667"></a>00667                 <span class="comment">/*@=unqualifiedtrans@*/</span>
<a name="l00668"></a>00668             }
<a name="l00669"></a>00669             <span class="keywordflow">if</span> (t-&gt;t_lang &amp;&amp; strcmp(t-&gt;t_lang, <a class="code" href="rpmspec_8h.html#9b6c70d9e5d4215bdc8dc68a41d64f82">RPMBUILD_DEFAULT_LANG</a>)) {
<a name="l00670"></a>00670                 sl-&gt;<a class="code" href="structspeclines__s.html#122e469d353480cedb15fa433dbfa1bf">sl_lines</a>[t-&gt;t_startx] = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(sl-&gt;<a class="code" href="structspeclines__s.html#122e469d353480cedb15fa433dbfa1bf">sl_lines</a>[t-&gt;t_startx]);
<a name="l00671"></a>00671                 <span class="keywordflow">continue</span>;
<a name="l00672"></a>00672             }
<a name="l00673"></a>00673             sl-&gt;<a class="code" href="structspeclines__s.html#122e469d353480cedb15fa433dbfa1bf">sl_lines</a>[t-&gt;t_startx + 1] = <a class="code" href="system_8h.html#700bf3013e33311eacdd1f20d13bdc9a">xstrdup</a>(msgstr);
<a name="l00674"></a>00674             <span class="keywordflow">if</span> (t-&gt;t_nlines &gt; 2)
<a name="l00675"></a>00675                 sl-&gt;<a class="code" href="structspeclines__s.html#122e469d353480cedb15fa433dbfa1bf">sl_lines</a>[t-&gt;t_startx + 2] = <a class="code" href="system_8h.html#700bf3013e33311eacdd1f20d13bdc9a">xstrdup</a>(<span class="stringliteral">"\n\n"</span>);
<a name="l00676"></a>00676             <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00677"></a>00677         }
<a name="l00678"></a>00678 <span class="comment">/*@=boundswrite@*/</span>
<a name="l00679"></a>00679     }
<a name="l00680"></a>00680     <span class="comment">/*@=branchstate@*/</span>
<a name="l00681"></a>00681     msgstr = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(msgstr);
<a name="l00682"></a>00682 
<a name="l00683"></a>00683 <span class="comment">/*@-boundsread@*/</span>
<a name="l00684"></a>00684     <span class="keywordflow">for</span> (i = 0; i &lt; sl-&gt;sl_nlines; i++) {
<a name="l00685"></a>00685         <span class="keyword">const</span> <span class="keywordtype">char</span> * s = sl-&gt;sl_lines[i];
<a name="l00686"></a>00686         if (s == NULL)
<a name="l00687"></a>00687             <span class="keywordflow">continue</span>;
<a name="l00688"></a>00688         printf(<span class="stringliteral">"%s"</span>, s);
<a name="l00689"></a>00689         <span class="keywordflow">if</span> (strchr(s, <span class="charliteral">'\n'</span>) == NULL &amp;&amp; s[strlen(s)-1] != <span class="charliteral">'\n'</span>)
<a name="l00690"></a>00690             printf(<span class="stringliteral">"\n"</span>);
<a name="l00691"></a>00691     }
<a name="l00692"></a>00692 <span class="comment">/*@=boundsread@*/</span>
<a name="l00693"></a>00693 }
<a name="l00694"></a>00694 
<a name="l00695"></a><a class="code" href="group__rpmbuild.html#g1455cc2c9b125a06dd2973afba5518b9">00695</a> <span class="keywordtype">int</span> <a class="code" href="group__rpmbuild.html#g1455cc2c9b125a06dd2973afba5518b9" title="Function to query spec file(s).">rpmspecQuery</a>(<a class="code" href="rpmlib_8h.html#35d575e76e47e498176ffb43c6bd7fcb" title="The RPM Transaction Set.">rpmts</a> ts, <a class="code" href="structrpmQVKArguments__s.html" title="Describe query/verify/signature command line operation.">QVA_t</a> qva, <span class="keyword">const</span> <span class="keywordtype">char</span> * arg)
<a name="l00696"></a>00696 {
<a name="l00697"></a>00697     <a class="code" href="structSpec__s.html" title="The structure used to store values parsed from a spec file.">Spec</a> spec = NULL;
<a name="l00698"></a>00698     <a class="code" href="structPackage__s.html" title="The structure used to store values for a package.">Package</a> pkg;
<a name="l00699"></a>00699     <span class="keywordtype">char</span> * buildRoot = NULL;
<a name="l00700"></a>00700     <span class="keywordtype">int</span> recursing = 0;
<a name="l00701"></a>00701     <span class="keywordtype">char</span> * passPhrase = <span class="stringliteral">""</span>;
<a name="l00702"></a>00702     <span class="keywordtype">char</span> *cookie = NULL;
<a name="l00703"></a>00703     <span class="keywordtype">int</span> anyarch = 1;
<a name="l00704"></a>00704     <span class="keywordtype">int</span> force = 1;
<a name="l00705"></a>00705     <span class="keywordtype">int</span> res = 1;
<a name="l00706"></a>00706     <span class="keywordtype">int</span> xx;
<a name="l00707"></a>00707 
<a name="l00708"></a>00708     <span class="keywordflow">if</span> (qva-&gt;<a class="code" href="structrpmQVKArguments__s.html#28de627d3b58aec1f382a26c466e4e64">qva_showPackage</a> == NULL)
<a name="l00709"></a>00709         <span class="keywordflow">goto</span> exit;
<a name="l00710"></a>00710 
<a name="l00711"></a>00711 <span class="comment">/*@-branchstate@*/</span>
<a name="l00712"></a>00712     <span class="comment">/*@-mods@*/</span> <span class="comment">/* FIX: make spec abstract */</span>
<a name="l00713"></a>00713     <span class="keywordflow">if</span> (<a class="code" href="group__rpmbuild.html#gb48b21525d05ffe91298ab9d13eec7c1" title="Parse spec file into spec control structure.">parseSpec</a>(ts, arg, <span class="stringliteral">"/"</span>, buildRoot, recursing, passPhrase,
<a name="l00714"></a>00714                 cookie, anyarch, force)
<a name="l00715"></a>00715       || (spec = <a class="code" href="group__rpmts.html#g69e5bd84bc4ae518855ae861f8046325" title="Set a spec control structure in transaction set.">rpmtsSetSpec</a>(ts, NULL)) == NULL)
<a name="l00716"></a>00716     {
<a name="l00717"></a>00717         <a class="code" href="rpmerr_8h.html#9c6d3f4067f89d2ef665ced76617e0cf" title="Retrofit rpmError() onto rpmlog sub-system.">rpmError</a>(<a class="code" href="rpmerr_8h.html#c60d8521276534617d1a659f5b1b66ba27813f46b6f58b2db7d0a8daf7b02cea">RPMERR_QUERY</a>,
<a name="l00718"></a>00718                         <a class="code" href="system_8h.html#2ec2c1c3098396e2d147d58b66f18ceb">_</a>(<span class="stringliteral">"query of specfile %s failed, can't parse\n"</span>), arg);
<a name="l00719"></a>00719         <span class="keywordflow">goto</span> exit;
<a name="l00720"></a>00720     }
<a name="l00721"></a>00721     <span class="comment">/*@=mods@*/</span>
<a name="l00722"></a>00722 <span class="comment">/*@=branchstate@*/</span>
<a name="l00723"></a>00723 
<a name="l00724"></a>00724     res = 0;
<a name="l00725"></a>00725     <span class="keywordflow">if</span> (<a class="code" href="spec_8c.html#7eb51b476f308337156371e05a4dfe57">specedit</a>) {
<a name="l00726"></a>00726         <a class="code" href="spec_8c.html#f0a7cb78a07e895b27fefb051098a401" title="Print copy of spec file, filling in Group/Description/Summary from specspo.">printNewSpecfile</a>(spec);
<a name="l00727"></a>00727         <span class="keywordflow">goto</span> exit;
<a name="l00728"></a>00728     }
<a name="l00729"></a>00729 
<a name="l00730"></a>00730     <span class="keywordflow">for</span> (pkg = spec-&gt;<a class="code" href="structSpec__s.html#ffcee259f7ea1e815853ac3ae9f643c2">packages</a>; pkg != NULL; pkg = pkg-&gt;<a class="code" href="structPackage__s.html#13605bf6a2ed28fa86c892c7c0f31a3f">next</a>)
<a name="l00731"></a>00731         xx = qva-&gt;<a class="code" href="structrpmQVKArguments__s.html#28de627d3b58aec1f382a26c466e4e64">qva_showPackage</a>(qva, ts, pkg-&gt;<a class="code" href="structPackage__s.html#57b7df476d0d3dfa63453ea5c460ca20">header</a>);
<a name="l00732"></a>00732 
<a name="l00733"></a>00733 exit:
<a name="l00734"></a>00734     spec = <a class="code" href="group__rpmbuild.html#g60c3eb1a791318201e7497ca162217c2" title="Destroy Spec structure.">freeSpec</a>(spec);
<a name="l00735"></a>00735     <span class="keywordflow">return</span> res;
<a name="l00736"></a>00736 }
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Fri Oct 12 08:44:53 2007 for rpm by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
