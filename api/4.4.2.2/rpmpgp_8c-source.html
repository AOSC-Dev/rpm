<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>rpm: rpmio/rpmpgp.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul>
</div>
<h1>rpmio/rpmpgp.c</h1><a href="rpmpgp_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*@-boundsread@*/</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include "<a class="code" href="system_8h.html">system.h</a>"</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include "<a class="code" href="rpmio__internal_8h.html">rpmio_internal.h</a>"</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include "<a class="code" href="debug_8h.html">debug.h</a>"</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="comment">/*@access pgpDig @*/</span>
<a name="l00012"></a>00012 <span class="comment">/*@access pgpDigParams @*/</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="comment">/*@unchecked@*/</span>
<a name="l00015"></a><a class="code" href="rpmpgp_8c.html#3f39405c2d7c0f545d6b90051f250c85">00015</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="poptALL_8c.html#3f39405c2d7c0f545d6b90051f250c85">_debug</a> = 0;
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="comment">/*@unchecked@*/</span>
<a name="l00018"></a><a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">00018</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a> = 0;
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="comment">/*@unchecked@*/</span> <span class="comment">/*@null@*/</span>
<a name="l00021"></a><a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">00021</a> <span class="keyword">static</span> <a class="code" href="structpgpDig__s.html" title="Container for values parsed from an OpenPGP signature and public key.">pgpDig</a> <a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a> = NULL;
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="comment">/*@unchecked@*/</span> <span class="comment">/*@null@*/</span>
<a name="l00024"></a><a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">00024</a> <span class="keyword">static</span> <a class="code" href="structpgpDigParams__s.html" title="Values parsed from OpenPGP signature/pubkey packet(s).">pgpDigParams</a> <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a> = NULL;
<a name="l00025"></a>00025 
<a name="l00026"></a><a class="code" href="rpmpgp_8h.html#040dfc120755c3dbd7fb0f11dcdaa88d">00026</a> <span class="keyword">struct </span><a class="code" href="structpgpValTbl__s.html">pgpValTbl_s</a> <a class="code" href="rpmpgp_8c.html#040dfc120755c3dbd7fb0f11dcdaa88d">pgpSigTypeTbl</a>[] = {
<a name="l00027"></a>00027     { <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2ec01656884e0357f0c05a66d92c870111">PGPSIGTYPE_BINARY</a>,        <span class="stringliteral">"Binary document signature"</span> },
<a name="l00028"></a>00028     { <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2e1e81296a45b94f211d9db696882b364e">PGPSIGTYPE_TEXT</a>,          <span class="stringliteral">"Text document signature"</span> },
<a name="l00029"></a>00029     { <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2e42e9155cfbd31454e2d2007e28f7024d">PGPSIGTYPE_STANDALONE</a>,    <span class="stringliteral">"Standalone signature"</span> },
<a name="l00030"></a>00030     { <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2ed591613df487aab0cb9fd667b8bb2465">PGPSIGTYPE_GENERIC_CERT</a>,  <span class="stringliteral">"Generic certification of a User ID and Public Key"</span> },
<a name="l00031"></a>00031     { <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2ea67b77fb11e6688c970c608b11a9d756">PGPSIGTYPE_PERSONA_CERT</a>,  <span class="stringliteral">"Persona certification of a User ID and Public Key"</span> },
<a name="l00032"></a>00032     { <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2e55745756dcaf3fa676e27c5364a13cff">PGPSIGTYPE_CASUAL_CERT</a>,   <span class="stringliteral">"Casual certification of a User ID and Public Key"</span> },
<a name="l00033"></a>00033     { <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2ecd2c5babb790850212570cac735cc443">PGPSIGTYPE_POSITIVE_CERT</a>, <span class="stringliteral">"Positive certification of a User ID and Public Key"</span> },
<a name="l00034"></a>00034     { <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2e72930c77b715f1b236fbe45f65c1609f">PGPSIGTYPE_SUBKEY_BINDING</a>,<span class="stringliteral">"Subkey Binding Signature"</span> },
<a name="l00035"></a>00035     { <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2e612579d480834bbadfd35473960bd6ea">PGPSIGTYPE_SIGNED_KEY</a>,    <span class="stringliteral">"Signature directly on a key"</span> },
<a name="l00036"></a>00036     { <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2e0325b4c871b927f3bc9131ed5636f96e">PGPSIGTYPE_KEY_REVOKE</a>,    <span class="stringliteral">"Key revocation signature"</span> },
<a name="l00037"></a>00037     { <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2e5770496947959978443b92214017cad9">PGPSIGTYPE_SUBKEY_REVOKE</a>, <span class="stringliteral">"Subkey revocation signature"</span> },
<a name="l00038"></a>00038     { <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2eb96c082a305b4bec22d6a69a3a935fd2">PGPSIGTYPE_CERT_REVOKE</a>,   <span class="stringliteral">"Certification revocation signature"</span> },
<a name="l00039"></a>00039     { <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2e08502a32d8f27d4668dc787fa37ff776">PGPSIGTYPE_TIMESTAMP</a>,     <span class="stringliteral">"Timestamp signature"</span> },
<a name="l00040"></a>00040     { -1,                       <span class="stringliteral">"Unknown signature type"</span> },
<a name="l00041"></a>00041 };
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="rpmpgp_8h.html#f2b9c065773bf45a20652e6d7ae9a50d">00043</a> <span class="keyword">struct </span><a class="code" href="structpgpValTbl__s.html">pgpValTbl_s</a> <a class="code" href="rpmpgp_8c.html#f2b9c065773bf45a20652e6d7ae9a50d">pgpPubkeyTbl</a>[] = {
<a name="l00044"></a>00044     { <a class="code" href="rpmpgp_8h.html#ff2fe1c7e6a7056de3b2fe65f9a0c7df1e566f354567b4ea9934a2c34a831abc">PGPPUBKEYALGO_RSA</a>,        <span class="stringliteral">"RSA"</span> },
<a name="l00045"></a>00045     { <a class="code" href="rpmpgp_8h.html#ff2fe1c7e6a7056de3b2fe65f9a0c7df6df2fd7d752242e7922085a591616226">PGPPUBKEYALGO_RSA_ENCRYPT</a>,<span class="stringliteral">"RSA(Encrypt-Only)"</span> },
<a name="l00046"></a>00046     { <a class="code" href="rpmpgp_8h.html#ff2fe1c7e6a7056de3b2fe65f9a0c7dfecd6ac2bfcc12731477715dac1156da6">PGPPUBKEYALGO_RSA_SIGN</a>,   <span class="stringliteral">"RSA(Sign-Only)"</span> },
<a name="l00047"></a>00047     { <a class="code" href="rpmpgp_8h.html#ff2fe1c7e6a7056de3b2fe65f9a0c7dfdd083e905321655ad5a18b641976385e">PGPPUBKEYALGO_ELGAMAL_ENCRYPT</a>,<span class="stringliteral">"Elgamal(Encrypt-Only)"</span> },
<a name="l00048"></a>00048     { <a class="code" href="rpmpgp_8h.html#ff2fe1c7e6a7056de3b2fe65f9a0c7df0f7e95526c0f4c5023734df9cd895d73">PGPPUBKEYALGO_DSA</a>,        <span class="stringliteral">"DSA"</span> },
<a name="l00049"></a>00049     { <a class="code" href="rpmpgp_8h.html#ff2fe1c7e6a7056de3b2fe65f9a0c7dfd76f2839b7af536c5e16da1dd9dc73d7">PGPPUBKEYALGO_EC</a>,         <span class="stringliteral">"Elliptic Curve"</span> },
<a name="l00050"></a>00050     { <a class="code" href="rpmpgp_8h.html#ff2fe1c7e6a7056de3b2fe65f9a0c7df3658f84516801e3d3ca2ad31658953ea">PGPPUBKEYALGO_ECDSA</a>,      <span class="stringliteral">"ECDSA"</span> },
<a name="l00051"></a>00051     { <a class="code" href="rpmpgp_8h.html#ff2fe1c7e6a7056de3b2fe65f9a0c7df9f0949dfbeac3e394c3368e652b9efaf">PGPPUBKEYALGO_ELGAMAL</a>,    <span class="stringliteral">"Elgamal"</span> },
<a name="l00052"></a>00052     { <a class="code" href="rpmpgp_8h.html#ff2fe1c7e6a7056de3b2fe65f9a0c7df52a1bfad183fc44742f0cff449d2c7f5">PGPPUBKEYALGO_DH</a>,         <span class="stringliteral">"Diffie-Hellman (X9.42)"</span> },
<a name="l00053"></a>00053     { -1,                       <span class="stringliteral">"Unknown public key algorithm"</span> },
<a name="l00054"></a>00054 };
<a name="l00055"></a>00055 
<a name="l00056"></a><a class="code" href="rpmpgp_8h.html#1f55290d708f48b088353a7a9b147554">00056</a> <span class="keyword">struct </span><a class="code" href="structpgpValTbl__s.html">pgpValTbl_s</a> <a class="code" href="rpmpgp_8c.html#1f55290d708f48b088353a7a9b147554" title="Symmetric key (string, value) pairs.">pgpSymkeyTbl</a>[] = {
<a name="l00057"></a>00057     { <a class="code" href="rpmpgp_8h.html#b6064e248f49fb567c1e451d4ca7dec65627d9c8c3fa070950b806b250559e31">PGPSYMKEYALGO_PLAINTEXT</a>,  <span class="stringliteral">"Plaintext"</span> },
<a name="l00058"></a>00058     { <a class="code" href="rpmpgp_8h.html#b6064e248f49fb567c1e451d4ca7dec65d56592d8a1ced1a313d3c5eef7ec4d5">PGPSYMKEYALGO_IDEA</a>,       <span class="stringliteral">"IDEA"</span> },
<a name="l00059"></a>00059     { <a class="code" href="rpmpgp_8h.html#b6064e248f49fb567c1e451d4ca7dec6aa7a5457553f80a5dcc578501052ffe7">PGPSYMKEYALGO_TRIPLE_DES</a>, <span class="stringliteral">"3DES"</span> },
<a name="l00060"></a>00060     { <a class="code" href="rpmpgp_8h.html#b6064e248f49fb567c1e451d4ca7dec611bc5ee83e784523a3f041b0f5ec0b2d">PGPSYMKEYALGO_CAST5</a>,      <span class="stringliteral">"CAST5"</span> },
<a name="l00061"></a>00061     { <a class="code" href="rpmpgp_8h.html#b6064e248f49fb567c1e451d4ca7dec686c9ab065e21cf446449f215c1b99895">PGPSYMKEYALGO_BLOWFISH</a>,   <span class="stringliteral">"BLOWFISH"</span> },
<a name="l00062"></a>00062     { <a class="code" href="rpmpgp_8h.html#b6064e248f49fb567c1e451d4ca7dec6875e41902737afb33f0f356007baad17">PGPSYMKEYALGO_SAFER</a>,      <span class="stringliteral">"SAFER"</span> },
<a name="l00063"></a>00063     { <a class="code" href="rpmpgp_8h.html#b6064e248f49fb567c1e451d4ca7dec67ccab7394b4cd071f711dd3641998436">PGPSYMKEYALGO_DES_SK</a>,     <span class="stringliteral">"DES/SK"</span> },
<a name="l00064"></a>00064     { <a class="code" href="rpmpgp_8h.html#b6064e248f49fb567c1e451d4ca7dec6429a5188ad2c10c1e52101772c4a3e2f">PGPSYMKEYALGO_AES_128</a>,    <span class="stringliteral">"AES(128-bit key)"</span> },
<a name="l00065"></a>00065     { <a class="code" href="rpmpgp_8h.html#b6064e248f49fb567c1e451d4ca7dec6daefc17ca0d71aae2ab9318791d72904">PGPSYMKEYALGO_AES_192</a>,    <span class="stringliteral">"AES(192-bit key)"</span> },
<a name="l00066"></a>00066     { <a class="code" href="rpmpgp_8h.html#b6064e248f49fb567c1e451d4ca7dec61eab467fcdea65b54c2aec8e89bfaf27">PGPSYMKEYALGO_AES_256</a>,    <span class="stringliteral">"AES(256-bit key)"</span> },
<a name="l00067"></a>00067     { <a class="code" href="rpmpgp_8h.html#b6064e248f49fb567c1e451d4ca7dec6df5af4f054026070fab58919e599b6d1">PGPSYMKEYALGO_TWOFISH</a>,    <span class="stringliteral">"TWOFISH(256-bit key)"</span> },
<a name="l00068"></a>00068     { <a class="code" href="rpmpgp_8h.html#b6064e248f49fb567c1e451d4ca7dec6872f61f20f169ae4238126ce4d3f265a">PGPSYMKEYALGO_NOENCRYPT</a>,  <span class="stringliteral">"no encryption"</span> },
<a name="l00069"></a>00069     { -1,                       <span class="stringliteral">"Unknown symmetric key algorithm"</span> },
<a name="l00070"></a>00070 };
<a name="l00071"></a>00071 
<a name="l00072"></a><a class="code" href="rpmpgp_8h.html#a279a2a9619200d3652c39c88ee8c69f">00072</a> <span class="keyword">struct </span><a class="code" href="structpgpValTbl__s.html">pgpValTbl_s</a> <a class="code" href="rpmpgp_8c.html#a279a2a9619200d3652c39c88ee8c69f" title="Compression (string, value) pairs.">pgpCompressionTbl</a>[] = {
<a name="l00073"></a>00073     { <a class="code" href="rpmpgp_8h.html#d45493371e53b0b19acaa766c17f3f1eb009c472f8a04e0c7a4ddfc57702a819">PGPCOMPRESSALGO_NONE</a>,     <span class="stringliteral">"Uncompressed"</span> },
<a name="l00074"></a>00074     { <a class="code" href="rpmpgp_8h.html#d45493371e53b0b19acaa766c17f3f1ed25b37d7106a6aac9edf7316286bf31d">PGPCOMPRESSALGO_ZIP</a>,      <span class="stringliteral">"ZIP"</span> },
<a name="l00075"></a>00075     { <a class="code" href="rpmpgp_8h.html#d45493371e53b0b19acaa766c17f3f1e120eb4ddf1d0de1450421800b838a050">PGPCOMPRESSALGO_ZLIB</a>,     <span class="stringliteral">"ZLIB"</span> },
<a name="l00076"></a>00076     { <a class="code" href="rpmpgp_8h.html#d45493371e53b0b19acaa766c17f3f1ea48054893471b399bd582b4bb5efaec6">PGPCOMPRESSALGO_BZIP2</a>,    <span class="stringliteral">"BZIP2"</span> },
<a name="l00077"></a>00077     { -1,                       <span class="stringliteral">"Unknown compression algorithm"</span> },
<a name="l00078"></a>00078 };
<a name="l00079"></a>00079 
<a name="l00080"></a><a class="code" href="rpmpgp_8h.html#82ab0356f3044a25bb1dc316d0d3de96">00080</a> <span class="keyword">struct </span><a class="code" href="structpgpValTbl__s.html">pgpValTbl_s</a> <a class="code" href="rpmpgp_8c.html#82ab0356f3044a25bb1dc316d0d3de96" title="Hash (string, value) pairs.">pgpHashTbl</a>[] = {
<a name="l00081"></a>00081     { <a class="code" href="rpmpgp_8h.html#62b36a3001a9d3870d1fd637a9e355d7e4badf8c607e5c6bd188cc1e48ac8619">PGPHASHALGO_MD5</a>,          <span class="stringliteral">"MD5"</span> },
<a name="l00082"></a>00082     { <a class="code" href="rpmpgp_8h.html#62b36a3001a9d3870d1fd637a9e355d710b23bd7fa0d33da7662fa85fa38887e">PGPHASHALGO_SHA1</a>,         <span class="stringliteral">"SHA1"</span> },
<a name="l00083"></a>00083     { <a class="code" href="rpmpgp_8h.html#62b36a3001a9d3870d1fd637a9e355d79d01367de1c46bb956976b7ac00f1176">PGPHASHALGO_RIPEMD160</a>,    <span class="stringliteral">"RIPEMD160"</span> },
<a name="l00084"></a>00084     { <a class="code" href="rpmpgp_8h.html#62b36a3001a9d3870d1fd637a9e355d715e4fed105885df0da34500952e7e7b2">PGPHASHALGO_MD2</a>,          <span class="stringliteral">"MD2"</span> },
<a name="l00085"></a>00085     { <a class="code" href="rpmpgp_8h.html#62b36a3001a9d3870d1fd637a9e355d7b75a4e8f5b2b85220a388eec48693676">PGPHASHALGO_TIGER192</a>,     <span class="stringliteral">"TIGER192"</span> },
<a name="l00086"></a>00086     { <a class="code" href="rpmpgp_8h.html#62b36a3001a9d3870d1fd637a9e355d74609879d7729f75c0ed5a638846a6ebc">PGPHASHALGO_HAVAL_5_160</a>,  <span class="stringliteral">"HAVAL-5-160"</span> },
<a name="l00087"></a>00087     { <a class="code" href="rpmpgp_8h.html#62b36a3001a9d3870d1fd637a9e355d7e1e4affe998aa5c1abb69bee1e0f9c67">PGPHASHALGO_SHA256</a>,       <span class="stringliteral">"SHA256"</span> },
<a name="l00088"></a>00088     { <a class="code" href="rpmpgp_8h.html#62b36a3001a9d3870d1fd637a9e355d7828e8d173553754539d9681019bf3088">PGPHASHALGO_SHA384</a>,       <span class="stringliteral">"SHA384"</span> },
<a name="l00089"></a>00089     { <a class="code" href="rpmpgp_8h.html#62b36a3001a9d3870d1fd637a9e355d7232043a9d5db562ddab6a3d66bef1e4e">PGPHASHALGO_SHA512</a>,       <span class="stringliteral">"SHA512"</span> },
<a name="l00090"></a>00090     { -1,                       <span class="stringliteral">"Unknown hash algorithm"</span> },
<a name="l00091"></a>00091 };
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="comment">/*@-exportlocal -exportheadervar@*/</span>
<a name="l00094"></a>00094 <span class="comment">/*@observer@*/</span> <span class="comment">/*@unchecked@*/</span>
<a name="l00095"></a><a class="code" href="rpmpgp_8c.html#ab58666c91aa37a7423bd832b0ffe968">00095</a> <span class="keyword">struct </span><a class="code" href="structpgpValTbl__s.html">pgpValTbl_s</a> <a class="code" href="rpmpgp_8c.html#ab58666c91aa37a7423bd832b0ffe968">pgpKeyServerPrefsTbl</a>[] = {
<a name="l00096"></a>00096     { 0x80,                     <span class="stringliteral">"No-modify"</span> },
<a name="l00097"></a>00097     { -1,                       <span class="stringliteral">"Unknown key server preference"</span> },
<a name="l00098"></a>00098 };
<a name="l00099"></a>00099 <span class="comment">/*@=exportlocal =exportheadervar@*/</span>
<a name="l00100"></a>00100 
<a name="l00101"></a><a class="code" href="rpmpgp_8h.html#912c50eb938a6c9ec178db47f05b3890">00101</a> <span class="keyword">struct </span><a class="code" href="structpgpValTbl__s.html">pgpValTbl_s</a> <a class="code" href="rpmpgp_8c.html#912c50eb938a6c9ec178db47f05b3890" title="Subtype (string, value) pairs.">pgpSubTypeTbl</a>[] = {
<a name="l00102"></a>00102     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240dc22a02d01086ffcac5f7eef6767966f2">PGPSUBTYPE_SIG_CREATE_TIME</a>,<span class="stringliteral">"signature creation time"</span> },
<a name="l00103"></a>00103     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d4b16ca35ba458db4ad878f63314187dc">PGPSUBTYPE_SIG_EXPIRE_TIME</a>,<span class="stringliteral">"signature expiration time"</span> },
<a name="l00104"></a>00104     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d806969aac2dcaa8681ccb67b42973433">PGPSUBTYPE_EXPORTABLE_CERT</a>,<span class="stringliteral">"exportable certification"</span> },
<a name="l00105"></a>00105     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d949a8cdfb0a5acc69e3f707051ca6968">PGPSUBTYPE_TRUST_SIG</a>,     <span class="stringliteral">"trust signature"</span> },
<a name="l00106"></a>00106     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d10638f4846b421a3b7bb61d48c887b50">PGPSUBTYPE_REGEX</a>,         <span class="stringliteral">"regular expression"</span> },
<a name="l00107"></a>00107     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240dc7f33ad4b6ed4c1805250ecd600188bc">PGPSUBTYPE_REVOCABLE</a>,     <span class="stringliteral">"revocable"</span> },
<a name="l00108"></a>00108     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d618c9d7caeebfb54813de98941fc64e5">PGPSUBTYPE_KEY_EXPIRE_TIME</a>,<span class="stringliteral">"key expiration time"</span> },
<a name="l00109"></a>00109     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240dc64d36ab42dd6be30d485a924afe6253">PGPSUBTYPE_ARR</a>,           <span class="stringliteral">"additional recipient request"</span> },
<a name="l00110"></a>00110     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d6fb6c923dc83d2263d65dc0a8939b684">PGPSUBTYPE_PREFER_SYMKEY</a>, <span class="stringliteral">"preferred symmetric algorithms"</span> },
<a name="l00111"></a>00111     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d76886bc747cc71e8fa0f7a111e05468a">PGPSUBTYPE_REVOKE_KEY</a>,    <span class="stringliteral">"revocation key"</span> },
<a name="l00112"></a>00112     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240dee833b82b633753e767f7700a60417a8">PGPSUBTYPE_ISSUER_KEYID</a>,  <span class="stringliteral">"issuer key ID"</span> },
<a name="l00113"></a>00113     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d0ef271dc1a5524aabc19a3a102b25d3d">PGPSUBTYPE_NOTATION</a>,      <span class="stringliteral">"notation data"</span> },
<a name="l00114"></a>00114     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240de75b899b2885f16f2d8df25d514abe43">PGPSUBTYPE_PREFER_HASH</a>,   <span class="stringliteral">"preferred hash algorithms"</span> },
<a name="l00115"></a>00115     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d0423357df52203d65193a09756b01c23">PGPSUBTYPE_PREFER_COMPRESS</a>,<span class="stringliteral">"preferred compression algorithms"</span> },
<a name="l00116"></a>00116     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d28ebd6fe2be072f5f4a77a5351229574">PGPSUBTYPE_KEYSERVER_PREFERS</a>,<span class="stringliteral">"key server preferences"</span> },
<a name="l00117"></a>00117     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d682c8d913291cf49bcb9c33a9a095088">PGPSUBTYPE_PREFER_KEYSERVER</a>,<span class="stringliteral">"preferred key server"</span> },
<a name="l00118"></a>00118     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240dbea414a1541f4a0d6703fcba06b6f737">PGPSUBTYPE_PRIMARY_USERID</a>,<span class="stringliteral">"primary user id"</span> },
<a name="l00119"></a>00119     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d2b7ce9ce7e1a004d97b8129e999aaf25">PGPSUBTYPE_POLICY_URL</a>,    <span class="stringliteral">"policy URL"</span> },
<a name="l00120"></a>00120     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240dd5ff3aceacf78ec45b0d1ed81baf9554">PGPSUBTYPE_KEY_FLAGS</a>,     <span class="stringliteral">"key flags"</span> },
<a name="l00121"></a>00121     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d3dd383d965efde363aaa27fa8274ab01">PGPSUBTYPE_SIGNER_USERID</a>, <span class="stringliteral">"signer's user id"</span> },
<a name="l00122"></a>00122     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d65a2961991b3dc216830e5da78265d96">PGPSUBTYPE_REVOKE_REASON</a>, <span class="stringliteral">"reason for revocation"</span> },
<a name="l00123"></a>00123     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d24c73a3ed509b028b132e4e53cf4835f">PGPSUBTYPE_FEATURES</a>,      <span class="stringliteral">"features"</span> },
<a name="l00124"></a>00124     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240df2f35b915c80a25e6a41215445032c20">PGPSUBTYPE_EMBEDDED_SIG</a>,  <span class="stringliteral">"embedded signature"</span> },
<a name="l00125"></a>00125 
<a name="l00126"></a>00126     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240dade7fb6468de8f21d02fb0ebd80869eb">PGPSUBTYPE_INTERNAL_100</a>,  <span class="stringliteral">"internal subpkt type 100"</span> },
<a name="l00127"></a>00127     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d23161da10bb5c3975976c2b07725e928">PGPSUBTYPE_INTERNAL_101</a>,  <span class="stringliteral">"internal subpkt type 101"</span> },
<a name="l00128"></a>00128     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d78b1db846c73bbd5148200002e5cc8a7">PGPSUBTYPE_INTERNAL_102</a>,  <span class="stringliteral">"internal subpkt type 102"</span> },
<a name="l00129"></a>00129     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d4f355547924d017823118a438560c2bd">PGPSUBTYPE_INTERNAL_103</a>,  <span class="stringliteral">"internal subpkt type 103"</span> },
<a name="l00130"></a>00130     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d3adcc895ffd8cebd637cca96b4ccb23e">PGPSUBTYPE_INTERNAL_104</a>,  <span class="stringliteral">"internal subpkt type 104"</span> },
<a name="l00131"></a>00131     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d8ebcc1e4c979ec0cf2e331aab736aa21">PGPSUBTYPE_INTERNAL_105</a>,  <span class="stringliteral">"internal subpkt type 105"</span> },
<a name="l00132"></a>00132     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240da4a0e39e8c1932dac6350c046bc98cfb">PGPSUBTYPE_INTERNAL_106</a>,  <span class="stringliteral">"internal subpkt type 106"</span> },
<a name="l00133"></a>00133     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d8f2a319c7599d33db1ad62e9c95bda60">PGPSUBTYPE_INTERNAL_107</a>,  <span class="stringliteral">"internal subpkt type 107"</span> },
<a name="l00134"></a>00134     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d852c561ac89b5635b5b64ae2745343a2">PGPSUBTYPE_INTERNAL_108</a>,  <span class="stringliteral">"internal subpkt type 108"</span> },
<a name="l00135"></a>00135     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240dba6218571bd66d62a636631f1cf1f09f">PGPSUBTYPE_INTERNAL_109</a>,  <span class="stringliteral">"internal subpkt type 109"</span> },
<a name="l00136"></a>00136     { <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d631c2c478ee05238a5c745e3610c066e">PGPSUBTYPE_INTERNAL_110</a>,  <span class="stringliteral">"internal subpkt type 110"</span> },
<a name="l00137"></a>00137     { -1,                       <span class="stringliteral">"Unknown signature subkey type"</span> },
<a name="l00138"></a>00138 };
<a name="l00139"></a>00139 
<a name="l00140"></a><a class="code" href="rpmpgp_8h.html#1df19d1753fb12d7f6c400039e0d897d">00140</a> <span class="keyword">struct </span><a class="code" href="structpgpValTbl__s.html">pgpValTbl_s</a> <a class="code" href="rpmpgp_8c.html#1df19d1753fb12d7f6c400039e0d897d">pgpTagTbl</a>[] = {
<a name="l00141"></a>00141     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe739b2456d2549f25555ba686e4197ffe">PGPTAG_PUBLIC_SESSION_KEY</a>,<span class="stringliteral">"Public-Key Encrypted Session Key"</span> },
<a name="l00142"></a>00142     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebee217c5ebf1b396a6eda48d8f4b874012">PGPTAG_SIGNATURE</a>,         <span class="stringliteral">"Signature"</span> },
<a name="l00143"></a>00143     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebec1fd63462d744e57de041b127d443bca">PGPTAG_SYMMETRIC_SESSION_KEY</a>,<span class="stringliteral">"Symmetric-Key Encrypted Session Key"</span> },
<a name="l00144"></a>00144     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe270f426c367322272e447f1137ed0ed1">PGPTAG_ONEPASS_SIGNATURE</a>, <span class="stringliteral">"One-Pass Signature"</span> },
<a name="l00145"></a>00145     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe7e729ee4f694870c88c8c2f58ea34b6d">PGPTAG_SECRET_KEY</a>,        <span class="stringliteral">"Secret Key"</span> },
<a name="l00146"></a>00146     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebeef47643cfdc941fb40a2cdc49c5e05a5">PGPTAG_PUBLIC_KEY</a>,        <span class="stringliteral">"Public Key"</span> },
<a name="l00147"></a>00147     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebeb9f6bb6dbfee5afd75a28e318a8b28b0">PGPTAG_SECRET_SUBKEY</a>,     <span class="stringliteral">"Secret Subkey"</span> },
<a name="l00148"></a>00148     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe894601f6a407f43b55c4e21454049b9d">PGPTAG_COMPRESSED_DATA</a>,   <span class="stringliteral">"Compressed Data"</span> },
<a name="l00149"></a>00149     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe39d8b2ad57256acbe2f92575c1d1c714">PGPTAG_SYMMETRIC_DATA</a>,    <span class="stringliteral">"Symmetrically Encrypted Data"</span> },
<a name="l00150"></a>00150     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe5f6dec440fa74b53a2e85030419cd9eb">PGPTAG_MARKER</a>,            <span class="stringliteral">"Marker"</span> },
<a name="l00151"></a>00151     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebec21c71df99b6a6a7d635af127425d1cf">PGPTAG_LITERAL_DATA</a>,      <span class="stringliteral">"Literal Data"</span> },
<a name="l00152"></a>00152     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe492adfb43a819e734807dadc5e9a7955">PGPTAG_TRUST</a>,             <span class="stringliteral">"Trust"</span> },
<a name="l00153"></a>00153     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe588cd31869c6ea499819aaf52bbca9a9">PGPTAG_USER_ID</a>,           <span class="stringliteral">"User ID"</span> },
<a name="l00154"></a>00154     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe5ed10139124c4a2e7ae9f1232280ebc0">PGPTAG_PUBLIC_SUBKEY</a>,     <span class="stringliteral">"Public Subkey"</span> },
<a name="l00155"></a>00155     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebee012a0516347afa1a073c14be7834cc7">PGPTAG_COMMENT_OLD</a>,       <span class="stringliteral">"Comment (from OpenPGP draft)"</span> },
<a name="l00156"></a>00156     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe339ba0ca41101e113b6712cce2a58b68">PGPTAG_PHOTOID</a>,           <span class="stringliteral">"PGP's photo ID"</span> },
<a name="l00157"></a>00157     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebeeb9b576d7e51a8fe73efd7b0b58a8f6c">PGPTAG_ENCRYPTED_MDC</a>,     <span class="stringliteral">"Integrity protected encrypted data"</span> },
<a name="l00158"></a>00158     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe1d100c2c0cc0bb768805ab45582129be">PGPTAG_MDC</a>,               <span class="stringliteral">"Manipulaion detection code packet"</span> },
<a name="l00159"></a>00159     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebeec67fc33ca752d745fb33b5d2368b9d4">PGPTAG_PRIVATE_60</a>,        <span class="stringliteral">"Private #60"</span> },
<a name="l00160"></a>00160     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebeeaca21d02de598f3fbe3a49eb8b94476">PGPTAG_COMMENT</a>,           <span class="stringliteral">"Comment"</span> },
<a name="l00161"></a>00161     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe86065449feb947b55f38d1a76f346160">PGPTAG_PRIVATE_62</a>,        <span class="stringliteral">"Private #62"</span> },
<a name="l00162"></a>00162     { <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebefb374a6ef8ad6a7491e5753fcd66f712">PGPTAG_CONTROL</a>,           <span class="stringliteral">"Control (GPG)"</span> },
<a name="l00163"></a>00163     { -1,                       <span class="stringliteral">"Unknown packet tag"</span> },
<a name="l00164"></a>00164 };
<a name="l00165"></a>00165 
<a name="l00166"></a><a class="code" href="rpmpgp_8h.html#a065c28e76b412c383b6932e09966f36">00166</a> <span class="keyword">struct </span><a class="code" href="structpgpValTbl__s.html">pgpValTbl_s</a> <a class="code" href="rpmpgp_8c.html#a065c28e76b412c383b6932e09966f36" title="Armor (string, value) pairs.">pgpArmorTbl</a>[] = {
<a name="l00167"></a>00167     { <a class="code" href="rpmpgp_8h.html#8b921f71244ef324fd0e84fc2291007a8fb86b33f88c81de752bd71444a54e8c">PGPARMOR_MESSAGE</a>,         <span class="stringliteral">"MESSAGE"</span> },
<a name="l00168"></a>00168     { <a class="code" href="rpmpgp_8h.html#8b921f71244ef324fd0e84fc2291007a76140d37cec0497e345db167f2f1d9df">PGPARMOR_PUBKEY</a>,          <span class="stringliteral">"PUBLIC KEY BLOCK"</span> },
<a name="l00169"></a>00169     { <a class="code" href="rpmpgp_8h.html#8b921f71244ef324fd0e84fc2291007a5a6e453d37ff2f91b64c2ec26f1532c2">PGPARMOR_SIGNATURE</a>,       <span class="stringliteral">"SIGNATURE"</span> },
<a name="l00170"></a>00170     { <a class="code" href="rpmpgp_8h.html#8b921f71244ef324fd0e84fc2291007adaa7dba9b10a6d69852be352e5729d4a">PGPARMOR_SIGNED_MESSAGE</a>,  <span class="stringliteral">"SIGNED MESSAGE"</span> },
<a name="l00171"></a>00171     { <a class="code" href="rpmpgp_8h.html#8b921f71244ef324fd0e84fc2291007aeb7d859d44b8eb905070f8bd08aa7046">PGPARMOR_FILE</a>,            <span class="stringliteral">"ARMORED FILE"</span> },
<a name="l00172"></a>00172     { <a class="code" href="rpmpgp_8h.html#8b921f71244ef324fd0e84fc2291007ac714651f265cfd0027cf6f1cf87beab7">PGPARMOR_PRIVKEY</a>,         <span class="stringliteral">"PRIVATE KEY BLOCK"</span> },
<a name="l00173"></a>00173     { <a class="code" href="rpmpgp_8h.html#8b921f71244ef324fd0e84fc2291007a3589bc332484f9170ab2f543f345954c">PGPARMOR_SECKEY</a>,          <span class="stringliteral">"SECRET KEY BLOCK"</span> },
<a name="l00174"></a>00174     { -1,                       <span class="stringliteral">"Unknown armor block"</span> }
<a name="l00175"></a>00175 };
<a name="l00176"></a>00176 
<a name="l00177"></a><a class="code" href="rpmpgp_8h.html#6336e71fffea77ecde1a1cc0284494d8">00177</a> <span class="keyword">struct </span><a class="code" href="structpgpValTbl__s.html">pgpValTbl_s</a> <a class="code" href="rpmpgp_8c.html#6336e71fffea77ecde1a1cc0284494d8" title="Armor key (string, value) pairs.">pgpArmorKeyTbl</a>[] = {
<a name="l00178"></a>00178     { <a class="code" href="rpmpgp_8h.html#1872d98db08c86ef4d048ab81fa192369bc9621699dcbbf9b84cb3284e3a2bad">PGPARMORKEY_VERSION</a>,      <span class="stringliteral">"Version: "</span> },
<a name="l00179"></a>00179     { <a class="code" href="rpmpgp_8h.html#1872d98db08c86ef4d048ab81fa192361cad0eddf00e6a3f8e4963eec5d8da85">PGPARMORKEY_COMMENT</a>,      <span class="stringliteral">"Comment: "</span> },
<a name="l00180"></a>00180     { <a class="code" href="rpmpgp_8h.html#1872d98db08c86ef4d048ab81fa19236f6587554d64046dce2b441c67163e17c">PGPARMORKEY_MESSAGEID</a>,    <span class="stringliteral">"MessageID: "</span> },
<a name="l00181"></a>00181     { <a class="code" href="rpmpgp_8h.html#1872d98db08c86ef4d048ab81fa1923659a9c308be957d806874eceffc597090">PGPARMORKEY_HASH</a>,         <span class="stringliteral">"Hash: "</span> },
<a name="l00182"></a>00182     { <a class="code" href="rpmpgp_8h.html#1872d98db08c86ef4d048ab81fa192364cd0141bc06cc75d69a4d506ee784d7e">PGPARMORKEY_CHARSET</a>,      <span class="stringliteral">"Charset: "</span> },
<a name="l00183"></a>00183     { -1,                       <span class="stringliteral">"Unknown armor key"</span> }
<a name="l00184"></a>00184 };
<a name="l00185"></a>00185 
<a name="l00191"></a>00191 <span class="comment">/*@unused@*/</span> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="comment">/*@null@*/</span> <span class="keywordtype">void</span> *
<a name="l00192"></a><a class="code" href="rpmpgp_8c.html#d608c2923552dbeeb832133a9a289bb7">00192</a> <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(<span class="comment">/*@only@*/</span> <span class="comment">/*@null@*/</span> <span class="comment">/*@out@*/</span> <span class="keyword">const</span> <span class="keywordtype">void</span> * p)
<a name="l00193"></a>00193         <span class="comment">/*@modifies p @*/</span>
<a name="l00194"></a>00194 {
<a name="l00195"></a>00195     <span class="keywordflow">if</span> (p != NULL)      free((<span class="keywordtype">void</span> *)p);
<a name="l00196"></a>00196     <span class="keywordflow">return</span> NULL;
<a name="l00197"></a>00197 }
<a name="l00198"></a>00198 
<a name="l00199"></a><a class="code" href="rpmpgp_8c.html#fcdfe6a1d333b1904202d685c4ccc345">00199</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="rpmpgp_8c.html#fcdfe6a1d333b1904202d685c4ccc345">pgpPrtNL</a>(<span class="keywordtype">void</span>)
<a name="l00200"></a>00200         <span class="comment">/*@globals fileSystem @*/</span>
<a name="l00201"></a>00201         <span class="comment">/*@modifies fileSystem @*/</span>
<a name="l00202"></a>00202 {
<a name="l00203"></a>00203     <span class="keywordflow">if</span> (!<a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>) <span class="keywordflow">return</span>;
<a name="l00204"></a>00204     fprintf(stderr, <span class="stringliteral">"\n"</span>);
<a name="l00205"></a>00205 }
<a name="l00206"></a>00206 
<a name="l00207"></a><a class="code" href="rpmpgp_8c.html#4be63d5895dd2cbd026f2087100e2337">00207</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="rpmpgp_8c.html#4be63d5895dd2cbd026f2087100e2337">pgpPrtInt</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *pre, <span class="keywordtype">int</span> i)
<a name="l00208"></a>00208         <span class="comment">/*@globals fileSystem @*/</span>
<a name="l00209"></a>00209         <span class="comment">/*@modifies fileSystem @*/</span>
<a name="l00210"></a>00210 {
<a name="l00211"></a>00211     <span class="keywordflow">if</span> (!<a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>) <span class="keywordflow">return</span>;
<a name="l00212"></a>00212     <span class="keywordflow">if</span> (pre &amp;&amp; *pre)
<a name="l00213"></a>00213         fprintf(stderr, <span class="stringliteral">"%s"</span>, pre);
<a name="l00214"></a>00214     fprintf(stderr, <span class="stringliteral">" %d"</span>, i);
<a name="l00215"></a>00215 }
<a name="l00216"></a>00216 
<a name="l00217"></a><a class="code" href="rpmpgp_8c.html#ff507fd3f3151e94f5a77285f1e02b77">00217</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="rpmpgp_8c.html#ff507fd3f3151e94f5a77285f1e02b77">pgpPrtStr</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *pre, <span class="keyword">const</span> <span class="keywordtype">char</span> *s)
<a name="l00218"></a>00218         <span class="comment">/*@globals fileSystem @*/</span>
<a name="l00219"></a>00219         <span class="comment">/*@modifies fileSystem @*/</span>
<a name="l00220"></a>00220 {
<a name="l00221"></a>00221     <span class="keywordflow">if</span> (!<a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>) <span class="keywordflow">return</span>;
<a name="l00222"></a>00222     <span class="keywordflow">if</span> (pre &amp;&amp; *pre)
<a name="l00223"></a>00223         fprintf(stderr, <span class="stringliteral">"%s"</span>, pre);
<a name="l00224"></a>00224     fprintf(stderr, <span class="stringliteral">" %s"</span>, s);
<a name="l00225"></a>00225 }
<a name="l00226"></a>00226 
<a name="l00227"></a><a class="code" href="rpmpgp_8c.html#22816bc06ecdf64e79a307008b9ab097">00227</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="rpmpgp_8c.html#22816bc06ecdf64e79a307008b9ab097">pgpPrtHex</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *pre, <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *p, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> plen)
<a name="l00228"></a>00228         <span class="comment">/*@globals fileSystem @*/</span>
<a name="l00229"></a>00229         <span class="comment">/*@modifies fileSystem @*/</span>
<a name="l00230"></a>00230 {
<a name="l00231"></a>00231     <span class="keywordflow">if</span> (!<a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>) <span class="keywordflow">return</span>;
<a name="l00232"></a>00232     <span class="keywordflow">if</span> (pre &amp;&amp; *pre)
<a name="l00233"></a>00233         fprintf(stderr, <span class="stringliteral">"%s"</span>, pre);
<a name="l00234"></a>00234     fprintf(stderr, <span class="stringliteral">" %s"</span>, <a class="code" href="rpmpgp_8h.html#ae93931c2a2b30811b6e6dd2c8fd7d73" title="Return hex formatted representation of bytes.">pgpHexStr</a>(p, plen));
<a name="l00235"></a>00235 }
<a name="l00236"></a>00236 
<a name="l00237"></a><a class="code" href="rpmpgp_8h.html#f04278c2fd10f99efe6210d94283e4aa">00237</a> <span class="keywordtype">void</span> <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * pre, <a class="code" href="structpgpValTbl__s.html">pgpValTbl</a> vs, <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> <a class="code" href="structpgpValTbl__s.html#5781d8878d6c2d0e0e183277e1a6c5fa">val</a>)
<a name="l00238"></a>00238         <span class="comment">/*@globals fileSystem @*/</span>
<a name="l00239"></a>00239         <span class="comment">/*@modifies fileSystem @*/</span>
<a name="l00240"></a>00240 {
<a name="l00241"></a>00241     <span class="keywordflow">if</span> (!<a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>) <span class="keywordflow">return</span>;
<a name="l00242"></a>00242     <span class="keywordflow">if</span> (pre &amp;&amp; *pre)
<a name="l00243"></a>00243         fprintf(stderr, <span class="stringliteral">"%s"</span>, pre);
<a name="l00244"></a>00244     fprintf(stderr, <span class="stringliteral">"%s(%u)"</span>, <a class="code" href="rpmpgp_8h.html#6c3c06a197ceb4b4b93a3ed0ade7f184" title="Return string representation of am OpenPGP value.">pgpValStr</a>(vs, val), (<span class="keywordtype">unsigned</span>)val);
<a name="l00245"></a>00245 }
<a name="l00246"></a>00246 
<a name="l00249"></a>00249 <span class="comment">/*@unused@*/</span> <span class="keyword">static</span> <span class="comment">/*@observer@*/</span>
<a name="l00250"></a><a class="code" href="rpmpgp_8c.html#7b75992d35f40d484f16033b6ba582d6">00250</a> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="rpmpgp_8c.html#7b75992d35f40d484f16033b6ba582d6">pgpMpiHex</a>(<span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *p)
<a name="l00251"></a>00251         <span class="comment">/*@*/</span>
<a name="l00252"></a>00252 {
<a name="l00253"></a>00253     <span class="keyword">static</span> <span class="keywordtype">char</span> prbuf[2048];
<a name="l00254"></a>00254     <span class="keywordtype">char</span> *t = prbuf;
<a name="l00255"></a>00255     t = <a class="code" href="rpmpgp_8h.html#4a7ffe977624b51e49b70c404ef956b8" title="Convert to hex.">pgpHexCvt</a>(t, p+2, <a class="code" href="rpmpgp_8h.html#46e1a524178bdb4a3564caf5ad52424d" title="Return no.">pgpMpiLen</a>(p)-2);
<a name="l00256"></a>00256     <span class="keywordflow">return</span> prbuf;
<a name="l00257"></a>00257 }
<a name="l00258"></a>00258 
<a name="l00259"></a>00259 <span class="comment">/*@-boundswrite@*/</span>
<a name="l00263"></a><a class="code" href="rpmpgp_8c.html#287aa5a45bb370b3c11b65f437e49d3e">00263</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rpmpgp_8c.html#287aa5a45bb370b3c11b65f437e49d3e" title="0 on success">pgpHexSet</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * pre, <span class="keywordtype">int</span> lbits,
<a name="l00264"></a>00264                 <span class="comment">/*@out@*/</span> mpnumber * mpn, <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> * p, <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> * pend)
<a name="l00265"></a>00265         <span class="comment">/*@globals fileSystem @*/</span>
<a name="l00266"></a>00266         <span class="comment">/*@modifies mpn, fileSystem @*/</span>
<a name="l00267"></a>00267 {
<a name="l00268"></a>00268     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mbits = <a class="code" href="rpmpgp_8h.html#45d9226f7080dfca70cc4f1899b8cd8f" title="Return no.">pgpMpiBits</a>(p);
<a name="l00269"></a>00269     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nbits;
<a name="l00270"></a>00270     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nbytes;
<a name="l00271"></a>00271     <span class="keywordtype">char</span> * t;
<a name="l00272"></a>00272     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ix;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274     <span class="keywordflow">if</span> ((p + ((mbits+7) &gt;&gt; 3)) &gt; pend)
<a name="l00275"></a>00275         <span class="keywordflow">return</span> 1;
<a name="l00276"></a>00276 
<a name="l00277"></a>00277     nbits = (lbits &gt; mbits ? lbits : mbits);
<a name="l00278"></a>00278     nbytes = ((nbits + 7) &gt;&gt; 3);
<a name="l00279"></a>00279     t = <a class="code" href="system_8h.html#2ff4ef58da7e543466e75f20f2a2d8b7">xmalloc</a>(2*nbytes+1);
<a name="l00280"></a>00280     ix = 2 * ((nbits - mbits) &gt;&gt; 3);
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 <span class="keywordflow">if</span> (<a class="code" href="poptALL_8c.html#3f39405c2d7c0f545d6b90051f250c85">_debug</a>)
<a name="l00283"></a>00283 fprintf(stderr, <span class="stringliteral">"*** mbits %u nbits %u nbytes %u t %p[%d] ix %u\n"</span>, mbits, nbits, nbytes, t, (2*nbytes+1), ix);
<a name="l00284"></a>00284     <span class="keywordflow">if</span> (ix &gt; 0) memset(t, (<span class="keywordtype">int</span>)<span class="charliteral">'0'</span>, ix);
<a name="l00285"></a>00285     strcpy(t+ix, <a class="code" href="rpmpgp_8c.html#7b75992d35f40d484f16033b6ba582d6">pgpMpiHex</a>(p));
<a name="l00286"></a>00286 <span class="keywordflow">if</span> (<a class="code" href="poptALL_8c.html#3f39405c2d7c0f545d6b90051f250c85">_debug</a>)
<a name="l00287"></a>00287 fprintf(stderr, <span class="stringliteral">"*** %s %s\n"</span>, pre, t);
<a name="l00288"></a>00288     (void) mpnsethex(mpn, t);
<a name="l00289"></a>00289     t = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(t);
<a name="l00290"></a>00290 <span class="keywordflow">if</span> (<a class="code" href="poptALL_8c.html#3f39405c2d7c0f545d6b90051f250c85">_debug</a> &amp;&amp; <a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>)
<a name="l00291"></a>00291 fprintf(stderr, <span class="stringliteral">"\t %s "</span>, pre), mpfprintln(stderr, mpn-&gt;size, mpn-&gt;data);
<a name="l00292"></a>00292     <span class="keywordflow">return</span> 0;
<a name="l00293"></a>00293 }
<a name="l00294"></a>00294 <span class="comment">/*@=boundswrite@*/</span>
<a name="l00295"></a>00295 
<a name="l00296"></a><a class="code" href="rpmpgp_8h.html#917ad537ba456313151aef0858a60ec5">00296</a> <span class="keywordtype">int</span> <a class="code" href="rpmpgp_8c.html#917ad537ba456313151aef0858a60ec5" title="Print/parse an OpenPGP subtype packet.">pgpPrtSubType</a>(<span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *h, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hlen, <a class="code" href="rpmpgp_8h.html#e0a0deab0fdb820c698fa0f86911b934" title="5.2.1.">pgpSigType</a> sigtype)
<a name="l00297"></a>00297 {
<a name="l00298"></a>00298     <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *p = h;
<a name="l00299"></a>00299     <span class="keywordtype">unsigned</span> plen;
<a name="l00300"></a>00300     <span class="keywordtype">int</span> i;
<a name="l00301"></a>00301 
<a name="l00302"></a>00302     <span class="keywordflow">while</span> (hlen &gt; 0) {
<a name="l00303"></a>00303         i = <a class="code" href="rpmpgp_8h.html#8647e2cc029df21936e782eb71f2b474" title="Return length of an OpenPGP packet.">pgpLen</a>(p, &amp;plen);
<a name="l00304"></a>00304         p += i;
<a name="l00305"></a>00305         hlen -= i;
<a name="l00306"></a>00306 
<a name="l00307"></a>00307         <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">"    "</span>, <a class="code" href="rpmpgp_8c.html#912c50eb938a6c9ec178db47f05b3890" title="Subtype (string, value) pairs.">pgpSubTypeTbl</a>, (p[0]&amp;(~<a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240dda98312792648a90d39985a8cbb77d28">PGPSUBTYPE_CRITICAL</a>)));
<a name="l00308"></a>00308         <span class="keywordflow">if</span> (p[0] &amp; <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240dda98312792648a90d39985a8cbb77d28">PGPSUBTYPE_CRITICAL</a>)
<a name="l00309"></a>00309             <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>)
<a name="l00310"></a>00310                 fprintf(stderr, <span class="stringliteral">" *CRITICAL*"</span>);
<a name="l00311"></a>00311         <span class="keywordflow">switch</span> (*p) {
<a name="l00312"></a>00312         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d6fb6c923dc83d2263d65dc0a8939b684">PGPSUBTYPE_PREFER_SYMKEY</a>:  <span class="comment">/* preferred symmetric algorithms */</span>
<a name="l00313"></a>00313             <span class="keywordflow">for</span> (i = 1; i &lt; plen; i++)
<a name="l00314"></a>00314                 <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">" "</span>, <a class="code" href="rpmpgp_8c.html#1f55290d708f48b088353a7a9b147554" title="Symmetric key (string, value) pairs.">pgpSymkeyTbl</a>, p[i]);
<a name="l00315"></a>00315             <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00316"></a>00316         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240de75b899b2885f16f2d8df25d514abe43">PGPSUBTYPE_PREFER_HASH</a>:    <span class="comment">/* preferred hash algorithms */</span>
<a name="l00317"></a>00317             <span class="keywordflow">for</span> (i = 1; i &lt; plen; i++)
<a name="l00318"></a>00318                 <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">" "</span>, <a class="code" href="rpmpgp_8c.html#82ab0356f3044a25bb1dc316d0d3de96" title="Hash (string, value) pairs.">pgpHashTbl</a>, p[i]);
<a name="l00319"></a>00319             <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00320"></a>00320         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d0423357df52203d65193a09756b01c23">PGPSUBTYPE_PREFER_COMPRESS</a>:<span class="comment">/* preferred compression algorithms */</span>
<a name="l00321"></a>00321             <span class="keywordflow">for</span> (i = 1; i &lt; plen; i++)
<a name="l00322"></a>00322                 <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">" "</span>, <a class="code" href="rpmpgp_8c.html#a279a2a9619200d3652c39c88ee8c69f" title="Compression (string, value) pairs.">pgpCompressionTbl</a>, p[i]);
<a name="l00323"></a>00323             <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00324"></a>00324         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d28ebd6fe2be072f5f4a77a5351229574">PGPSUBTYPE_KEYSERVER_PREFERS</a>:<span class="comment">/* key server preferences */</span>
<a name="l00325"></a>00325             <span class="keywordflow">for</span> (i = 1; i &lt; plen; i++)
<a name="l00326"></a>00326                 <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">" "</span>, <a class="code" href="rpmpgp_8c.html#ab58666c91aa37a7423bd832b0ffe968">pgpKeyServerPrefsTbl</a>, p[i]);
<a name="l00327"></a>00327             <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00328"></a>00328         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240dc22a02d01086ffcac5f7eef6767966f2">PGPSUBTYPE_SIG_CREATE_TIME</a>:
<a name="l00329"></a>00329 <span class="comment">/*@-mods -mayaliasunique @*/</span>
<a name="l00330"></a>00330             <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a> &amp;&amp; !(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#7a5e064c6e17202ef647472b90ccd2b2">saved</a> &amp; <a class="code" href="rpmio__internal_8h.html#bd6859da72d1d530f086cc5d948e46d5">PGPDIG_SAVED_TIME</a>) &amp;&amp;
<a name="l00331"></a>00331                 (sigtype == <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2ecd2c5babb790850212570cac735cc443">PGPSIGTYPE_POSITIVE_CERT</a> || sigtype == <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2ec01656884e0357f0c05a66d92c870111">PGPSIGTYPE_BINARY</a> || sigtype == <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2e1e81296a45b94f211d9db696882b364e">PGPSIGTYPE_TEXT</a> || sigtype == <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2e42e9155cfbd31454e2d2007e28f7024d">PGPSIGTYPE_STANDALONE</a>))
<a name="l00332"></a>00332             {
<a name="l00333"></a>00333                 <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#7a5e064c6e17202ef647472b90ccd2b2">saved</a> |= <a class="code" href="rpmio__internal_8h.html#bd6859da72d1d530f086cc5d948e46d5">PGPDIG_SAVED_TIME</a>;
<a name="l00334"></a>00334                 memcpy(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#5970148fe2546a2e49cd75481c99fd2f">time</a>, p+1, <span class="keyword">sizeof</span>(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#5970148fe2546a2e49cd75481c99fd2f">time</a>));
<a name="l00335"></a>00335             }
<a name="l00336"></a>00336 <span class="comment">/*@=mods =mayaliasunique @*/</span>
<a name="l00337"></a>00337             <span class="comment">/*@fallthrough@*/</span>
<a name="l00338"></a>00338         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d4b16ca35ba458db4ad878f63314187dc">PGPSUBTYPE_SIG_EXPIRE_TIME</a>:
<a name="l00339"></a>00339         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d618c9d7caeebfb54813de98941fc64e5">PGPSUBTYPE_KEY_EXPIRE_TIME</a>:
<a name="l00340"></a>00340             <span class="keywordflow">if</span> ((plen - 1) == 4) {
<a name="l00341"></a>00341                 time_t t = <a class="code" href="rpmpgp_8h.html#86d21d8e18146a24c553685163fce60e" title="Return (native-endian) integer from big-endian representation.">pgpGrab</a>(p+1, plen-1);
<a name="l00342"></a>00342                 <span class="keywordflow">if</span> (_print)
<a name="l00343"></a>00343                    fprintf(stderr, <span class="stringliteral">" %-24.24s(0x%08x)"</span>, ctime(&amp;t), (<span class="keywordtype">unsigned</span>)t);
<a name="l00344"></a>00344             } <span class="keywordflow">else</span>
<a name="l00345"></a>00345                 <a class="code" href="rpmpgp_8c.html#22816bc06ecdf64e79a307008b9ab097">pgpPrtHex</a>(<span class="stringliteral">""</span>, p+1, plen-1);
<a name="l00346"></a>00346             <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00347"></a>00347 
<a name="l00348"></a>00348         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240dee833b82b633753e767f7700a60417a8">PGPSUBTYPE_ISSUER_KEYID</a>:   <span class="comment">/* issuer key ID */</span>
<a name="l00349"></a>00349 <span class="comment">/*@-mods -mayaliasunique @*/</span>
<a name="l00350"></a>00350             <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a> &amp;&amp; !(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#7a5e064c6e17202ef647472b90ccd2b2">saved</a> &amp; <a class="code" href="rpmio__internal_8h.html#660ba5c27429b2ab6addf65dcbbb7069">PGPDIG_SAVED_ID</a>) &amp;&amp;
<a name="l00351"></a>00351                 (sigtype == <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2ecd2c5babb790850212570cac735cc443">PGPSIGTYPE_POSITIVE_CERT</a> || sigtype == <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2ec01656884e0357f0c05a66d92c870111">PGPSIGTYPE_BINARY</a> || sigtype == <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2e1e81296a45b94f211d9db696882b364e">PGPSIGTYPE_TEXT</a> || sigtype == <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2e42e9155cfbd31454e2d2007e28f7024d">PGPSIGTYPE_STANDALONE</a>))
<a name="l00352"></a>00352             {
<a name="l00353"></a>00353                 <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#7a5e064c6e17202ef647472b90ccd2b2">saved</a> |= <a class="code" href="rpmio__internal_8h.html#660ba5c27429b2ab6addf65dcbbb7069">PGPDIG_SAVED_ID</a>;
<a name="l00354"></a>00354                 memcpy(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#a8a9b1747151f106cc7bf63ca4599ed8">signid</a>, p+1, <span class="keyword">sizeof</span>(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#a8a9b1747151f106cc7bf63ca4599ed8">signid</a>));
<a name="l00355"></a>00355             }
<a name="l00356"></a>00356 <span class="comment">/*@=mods =mayaliasunique @*/</span>
<a name="l00357"></a>00357             <span class="comment">/*@fallthrough@*/</span>
<a name="l00358"></a>00358         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d806969aac2dcaa8681ccb67b42973433">PGPSUBTYPE_EXPORTABLE_CERT</a>:
<a name="l00359"></a>00359         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d949a8cdfb0a5acc69e3f707051ca6968">PGPSUBTYPE_TRUST_SIG</a>:
<a name="l00360"></a>00360         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d10638f4846b421a3b7bb61d48c887b50">PGPSUBTYPE_REGEX</a>:
<a name="l00361"></a>00361         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240dc7f33ad4b6ed4c1805250ecd600188bc">PGPSUBTYPE_REVOCABLE</a>:
<a name="l00362"></a>00362         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240dc64d36ab42dd6be30d485a924afe6253">PGPSUBTYPE_ARR</a>:
<a name="l00363"></a>00363         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d76886bc747cc71e8fa0f7a111e05468a">PGPSUBTYPE_REVOKE_KEY</a>:
<a name="l00364"></a>00364         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d0ef271dc1a5524aabc19a3a102b25d3d">PGPSUBTYPE_NOTATION</a>:
<a name="l00365"></a>00365         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d682c8d913291cf49bcb9c33a9a095088">PGPSUBTYPE_PREFER_KEYSERVER</a>:
<a name="l00366"></a>00366         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240dbea414a1541f4a0d6703fcba06b6f737">PGPSUBTYPE_PRIMARY_USERID</a>:
<a name="l00367"></a>00367         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d2b7ce9ce7e1a004d97b8129e999aaf25">PGPSUBTYPE_POLICY_URL</a>:
<a name="l00368"></a>00368         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240dd5ff3aceacf78ec45b0d1ed81baf9554">PGPSUBTYPE_KEY_FLAGS</a>:
<a name="l00369"></a>00369         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d3dd383d965efde363aaa27fa8274ab01">PGPSUBTYPE_SIGNER_USERID</a>:
<a name="l00370"></a>00370         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d65a2961991b3dc216830e5da78265d96">PGPSUBTYPE_REVOKE_REASON</a>:
<a name="l00371"></a>00371         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d24c73a3ed509b028b132e4e53cf4835f">PGPSUBTYPE_FEATURES</a>:
<a name="l00372"></a>00372         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240df2f35b915c80a25e6a41215445032c20">PGPSUBTYPE_EMBEDDED_SIG</a>:
<a name="l00373"></a>00373         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240dade7fb6468de8f21d02fb0ebd80869eb">PGPSUBTYPE_INTERNAL_100</a>:
<a name="l00374"></a>00374         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d23161da10bb5c3975976c2b07725e928">PGPSUBTYPE_INTERNAL_101</a>:
<a name="l00375"></a>00375         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d78b1db846c73bbd5148200002e5cc8a7">PGPSUBTYPE_INTERNAL_102</a>:
<a name="l00376"></a>00376         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d4f355547924d017823118a438560c2bd">PGPSUBTYPE_INTERNAL_103</a>:
<a name="l00377"></a>00377         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d3adcc895ffd8cebd637cca96b4ccb23e">PGPSUBTYPE_INTERNAL_104</a>:
<a name="l00378"></a>00378         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d8ebcc1e4c979ec0cf2e331aab736aa21">PGPSUBTYPE_INTERNAL_105</a>:
<a name="l00379"></a>00379         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240da4a0e39e8c1932dac6350c046bc98cfb">PGPSUBTYPE_INTERNAL_106</a>:
<a name="l00380"></a>00380         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d8f2a319c7599d33db1ad62e9c95bda60">PGPSUBTYPE_INTERNAL_107</a>:
<a name="l00381"></a>00381         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d852c561ac89b5635b5b64ae2745343a2">PGPSUBTYPE_INTERNAL_108</a>:
<a name="l00382"></a>00382         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240dba6218571bd66d62a636631f1cf1f09f">PGPSUBTYPE_INTERNAL_109</a>:
<a name="l00383"></a>00383         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a2ffd7748d589fd44b8f0c550d10240d631c2c478ee05238a5c745e3610c066e">PGPSUBTYPE_INTERNAL_110</a>:
<a name="l00384"></a>00384         <span class="keywordflow">default</span>:
<a name="l00385"></a>00385             <a class="code" href="rpmpgp_8c.html#22816bc06ecdf64e79a307008b9ab097">pgpPrtHex</a>(<span class="stringliteral">""</span>, p+1, plen-1);
<a name="l00386"></a>00386             <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00387"></a>00387         }
<a name="l00388"></a>00388         <a class="code" href="rpmpgp_8c.html#fcdfe6a1d333b1904202d685c4ccc345">pgpPrtNL</a>();
<a name="l00389"></a>00389         p += plen;
<a name="l00390"></a>00390         hlen -= plen;
<a name="l00391"></a>00391     }
<a name="l00392"></a>00392     <span class="keywordflow">return</span> 0;
<a name="l00393"></a>00393 }
<a name="l00394"></a>00394 
<a name="l00395"></a>00395 <span class="comment">/*@-varuse =readonlytrans @*/</span>
<a name="l00396"></a>00396 <span class="comment">/*@observer@*/</span> <span class="comment">/*@unchecked@*/</span>
<a name="l00397"></a><a class="code" href="rpmpgp_8c.html#ab5a165776b823b66d56687f2c77e0ff">00397</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="rpmpgp_8c.html#ab5a165776b823b66d56687f2c77e0ff">pgpSigRSA</a>[] = {
<a name="l00398"></a>00398     <span class="stringliteral">" m**d ="</span>,
<a name="l00399"></a>00399     NULL,
<a name="l00400"></a>00400 };
<a name="l00401"></a>00401 
<a name="l00402"></a>00402 <span class="comment">/*@observer@*/</span> <span class="comment">/*@unchecked@*/</span>
<a name="l00403"></a><a class="code" href="rpmpgp_8c.html#ce192a0ce595394433d13e117747c9ec">00403</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="rpmpgp_8c.html#ce192a0ce595394433d13e117747c9ec">pgpSigDSA</a>[] = {
<a name="l00404"></a>00404     <span class="stringliteral">"    r ="</span>,
<a name="l00405"></a>00405     <span class="stringliteral">"    s ="</span>,
<a name="l00406"></a>00406     NULL,
<a name="l00407"></a>00407 };
<a name="l00408"></a>00408 <span class="comment">/*@=varuse =readonlytrans @*/</span>
<a name="l00409"></a>00409 
<a name="l00410"></a><a class="code" href="rpmpgp_8c.html#8834a8aaedc957fddbcd6c3609dc4aaf">00410</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rpmpgp_8c.html#8834a8aaedc957fddbcd6c3609dc4aaf">pgpPrtSigParams</a>(<span class="comment">/*@unused@*/</span> <a class="code" href="rpmpgp_8h.html#f814c5eae8f6dfbed984e367c6459043" title="4.3.">pgpTag</a> tag, <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> pubkey_algo, <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> sigtype,
<a name="l00411"></a>00411                 <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *p, <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *h, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hlen)
<a name="l00412"></a>00412         <span class="comment">/*@globals fileSystem @*/</span>
<a name="l00413"></a>00413         <span class="comment">/*@modifies fileSystem @*/</span>
<a name="l00414"></a>00414 {
<a name="l00415"></a>00415     <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> * pend = h + hlen;
<a name="l00416"></a>00416     <span class="keywordtype">int</span> i;
<a name="l00417"></a>00417 
<a name="l00418"></a>00418     <span class="keywordflow">for</span> (i = 0; p &lt; pend; i++, p += <a class="code" href="rpmpgp_8h.html#46e1a524178bdb4a3564caf5ad52424d" title="Return no.">pgpMpiLen</a>(p)) {
<a name="l00419"></a>00419         <span class="keywordflow">if</span> (pubkey_algo == <a class="code" href="rpmpgp_8h.html#ff2fe1c7e6a7056de3b2fe65f9a0c7df1e566f354567b4ea9934a2c34a831abc">PGPPUBKEYALGO_RSA</a>) {
<a name="l00420"></a>00420             <span class="keywordflow">if</span> (i &gt;= 1) <span class="keywordflow">break</span>;
<a name="l00421"></a>00421             <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a> &amp;&amp;
<a name="l00422"></a>00422         (sigtype == <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2ec01656884e0357f0c05a66d92c870111">PGPSIGTYPE_BINARY</a> || sigtype == <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2e1e81296a45b94f211d9db696882b364e">PGPSIGTYPE_TEXT</a>))
<a name="l00423"></a>00423             {
<a name="l00424"></a>00424                 <span class="keywordflow">switch</span> (i) {
<a name="l00425"></a>00425                 <span class="keywordflow">case</span> 0:         <span class="comment">/* m**d */</span>
<a name="l00426"></a>00426                     (void) mpnsethex(&amp;<a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#eec8aad2ed9881a823a8ff656af9776d">c</a>, <a class="code" href="rpmpgp_8c.html#7b75992d35f40d484f16033b6ba582d6">pgpMpiHex</a>(p));
<a name="l00427"></a>00427 <span class="keywordflow">if</span> (<a class="code" href="poptALL_8c.html#3f39405c2d7c0f545d6b90051f250c85">_debug</a> &amp;&amp; <a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>)
<a name="l00428"></a>00428 fprintf(stderr, <span class="stringliteral">"\t  m**d = "</span>),  mpfprintln(stderr, <a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#eec8aad2ed9881a823a8ff656af9776d">c</a>.size, <a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#eec8aad2ed9881a823a8ff656af9776d">c</a>.data);
<a name="l00429"></a>00429                     <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00430"></a>00430                 <span class="keywordflow">default</span>:
<a name="l00431"></a>00431                     <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00432"></a>00432                 }
<a name="l00433"></a>00433             }
<a name="l00434"></a>00434             <a class="code" href="rpmpgp_8c.html#ff507fd3f3151e94f5a77285f1e02b77">pgpPrtStr</a>(<span class="stringliteral">""</span>, <a class="code" href="rpmpgp_8c.html#ab5a165776b823b66d56687f2c77e0ff">pgpSigRSA</a>[i]);
<a name="l00435"></a>00435         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pubkey_algo == <a class="code" href="rpmpgp_8h.html#ff2fe1c7e6a7056de3b2fe65f9a0c7df0f7e95526c0f4c5023734df9cd895d73">PGPPUBKEYALGO_DSA</a>) {
<a name="l00436"></a>00436             <span class="keywordflow">if</span> (i &gt;= 2) <span class="keywordflow">break</span>;
<a name="l00437"></a>00437             <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a> &amp;&amp;
<a name="l00438"></a>00438         (sigtype == <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2ec01656884e0357f0c05a66d92c870111">PGPSIGTYPE_BINARY</a> || sigtype == <a class="code" href="rpmpgp_8h.html#870fbd87c84cff05458172b40b356a2e1e81296a45b94f211d9db696882b364e">PGPSIGTYPE_TEXT</a>))
<a name="l00439"></a>00439             {
<a name="l00440"></a>00440                 <span class="keywordtype">int</span> xx;
<a name="l00441"></a>00441                 xx = 0;
<a name="l00442"></a>00442                 <span class="keywordflow">switch</span> (i) {
<a name="l00443"></a>00443                 <span class="keywordflow">case</span> 0:         <span class="comment">/* r */</span>
<a name="l00444"></a>00444                     xx = <a class="code" href="rpmpgp_8c.html#287aa5a45bb370b3c11b65f437e49d3e" title="0 on success">pgpHexSet</a>(<a class="code" href="rpmpgp_8c.html#ce192a0ce595394433d13e117747c9ec">pgpSigDSA</a>[i], 160, &amp;<a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#251f81407b9982712e79cd1b1a2f46e1">r</a>, p, pend);
<a name="l00445"></a>00445                     <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00446"></a>00446                 <span class="keywordflow">case</span> 1:         <span class="comment">/* s */</span>
<a name="l00447"></a>00447                     xx = <a class="code" href="rpmpgp_8c.html#287aa5a45bb370b3c11b65f437e49d3e" title="0 on success">pgpHexSet</a>(<a class="code" href="rpmpgp_8c.html#ce192a0ce595394433d13e117747c9ec">pgpSigDSA</a>[i], 160, &amp;<a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#8ef80b38c8586a5251b3601fe1d9b8d7">s</a>, p, pend);
<a name="l00448"></a>00448                     <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00449"></a>00449                 <span class="keywordflow">default</span>:
<a name="l00450"></a>00450                     xx = 1;
<a name="l00451"></a>00451                     <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00452"></a>00452                 }
<a name="l00453"></a>00453                 <span class="keywordflow">if</span> (xx) <span class="keywordflow">return</span> xx;
<a name="l00454"></a>00454             }
<a name="l00455"></a>00455             <a class="code" href="rpmpgp_8c.html#ff507fd3f3151e94f5a77285f1e02b77">pgpPrtStr</a>(<span class="stringliteral">""</span>, <a class="code" href="rpmpgp_8c.html#ce192a0ce595394433d13e117747c9ec">pgpSigDSA</a>[i]);
<a name="l00456"></a>00456         } <span class="keywordflow">else</span> {
<a name="l00457"></a>00457             <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>)
<a name="l00458"></a>00458                 fprintf(stderr, <span class="stringliteral">"%7d"</span>, i);
<a name="l00459"></a>00459         }
<a name="l00460"></a>00460         <a class="code" href="rpmpgp_8c.html#ff507fd3f3151e94f5a77285f1e02b77">pgpPrtStr</a>(<span class="stringliteral">""</span>, <a class="code" href="rpmpgp_8h.html#e79674a20e83b584a2f1b12f5e95394b" title="Return hex formatted representation of a multiprecision integer.">pgpMpiStr</a>(p));
<a name="l00461"></a>00461         <a class="code" href="rpmpgp_8c.html#fcdfe6a1d333b1904202d685c4ccc345">pgpPrtNL</a>();
<a name="l00462"></a>00462     }
<a name="l00463"></a>00463 
<a name="l00464"></a>00464     <span class="keywordflow">return</span> 0;
<a name="l00465"></a>00465 }
<a name="l00466"></a>00466 
<a name="l00467"></a><a class="code" href="rpmpgp_8h.html#e85be6aa03dbff9db549645fcc8b60c9">00467</a> <span class="keywordtype">int</span> <a class="code" href="rpmpgp_8c.html#e85be6aa03dbff9db549645fcc8b60c9" title="Print/parse an OpenPGP signature packet.">pgpPrtSig</a>(<a class="code" href="rpmpgp_8h.html#f814c5eae8f6dfbed984e367c6459043" title="4.3.">pgpTag</a> tag, <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *h, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hlen)
<a name="l00468"></a>00468         <span class="comment">/*@globals _digp @*/</span>
<a name="l00469"></a>00469         <span class="comment">/*@modifies *_digp @*/</span>
<a name="l00470"></a>00470 {
<a name="l00471"></a>00471     <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> version = h[0];
<a name="l00472"></a>00472     <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> * p;
<a name="l00473"></a>00473     <span class="keywordtype">unsigned</span> plen;
<a name="l00474"></a>00474     <span class="keywordtype">int</span> rc;
<a name="l00475"></a>00475 
<a name="l00476"></a>00476     <span class="keywordflow">switch</span> (version) {
<a name="l00477"></a>00477     <span class="keywordflow">case</span> 3:
<a name="l00478"></a>00478     {   <a class="code" href="structpgpPktSigV3__s.html" title="5.2.2.">pgpPktSigV3</a> v = (<a class="code" href="structpgpPktSigV3__s.html" title="5.2.2.">pgpPktSigV3</a>)h;
<a name="l00479"></a>00479         time_t t;
<a name="l00480"></a>00480 
<a name="l00481"></a>00481         <span class="keywordflow">if</span> (v-&gt;<a class="code" href="structpgpPktSigV3__s.html#a0b340bdf8babb721921251eb5b3ade5">hashlen</a> != 5)
<a name="l00482"></a>00482             <span class="keywordflow">return</span> 1;
<a name="l00483"></a>00483 
<a name="l00484"></a>00484         <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">"V3 "</span>, <a class="code" href="rpmpgp_8c.html#1df19d1753fb12d7f6c400039e0d897d">pgpTagTbl</a>, tag);
<a name="l00485"></a>00485         <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">" "</span>, <a class="code" href="rpmpgp_8c.html#f2b9c065773bf45a20652e6d7ae9a50d">pgpPubkeyTbl</a>, v-&gt;<a class="code" href="structpgpPktSigV3__s.html#7656353dfbc3b35d40e54a4b4287d205">pubkey_algo</a>);
<a name="l00486"></a>00486         <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">" "</span>, <a class="code" href="rpmpgp_8c.html#82ab0356f3044a25bb1dc316d0d3de96" title="Hash (string, value) pairs.">pgpHashTbl</a>, v-&gt;<a class="code" href="structpgpPktSigV3__s.html#5f9546375ef6c90aacbefa4f3dbe33cc">hash_algo</a>);
<a name="l00487"></a>00487         <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">" "</span>, <a class="code" href="rpmpgp_8c.html#040dfc120755c3dbd7fb0f11dcdaa88d">pgpSigTypeTbl</a>, v-&gt;<a class="code" href="structpgpPktSigV3__s.html#b3b0231777ff5a695f11c99a6acb905f">sigtype</a>);
<a name="l00488"></a>00488         <a class="code" href="rpmpgp_8c.html#fcdfe6a1d333b1904202d685c4ccc345">pgpPrtNL</a>();
<a name="l00489"></a>00489         t = <a class="code" href="rpmpgp_8h.html#86d21d8e18146a24c553685163fce60e" title="Return (native-endian) integer from big-endian representation.">pgpGrab</a>(v-&gt;<a class="code" href="structpgpPktSigV3__s.html#bd0329078e379884c77015f0a8948dab">time</a>, <span class="keyword">sizeof</span>(v-&gt;<a class="code" href="structpgpPktSigV3__s.html#bd0329078e379884c77015f0a8948dab">time</a>));
<a name="l00490"></a>00490         <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>)
<a name="l00491"></a>00491             fprintf(stderr, <span class="stringliteral">" %-24.24s(0x%08x)"</span>, ctime(&amp;t), (<span class="keywordtype">unsigned</span>)t);
<a name="l00492"></a>00492         <a class="code" href="rpmpgp_8c.html#fcdfe6a1d333b1904202d685c4ccc345">pgpPrtNL</a>();
<a name="l00493"></a>00493         <a class="code" href="rpmpgp_8c.html#22816bc06ecdf64e79a307008b9ab097">pgpPrtHex</a>(<span class="stringliteral">" signer keyid"</span>, v-&gt;<a class="code" href="structpgpPktSigV3__s.html#fd7e172ac9deee317eed7b03a72504d3">signid</a>, <span class="keyword">sizeof</span>(v-&gt;<a class="code" href="structpgpPktSigV3__s.html#fd7e172ac9deee317eed7b03a72504d3">signid</a>));
<a name="l00494"></a>00494         plen = <a class="code" href="rpmpgp_8h.html#86d21d8e18146a24c553685163fce60e" title="Return (native-endian) integer from big-endian representation.">pgpGrab</a>(v-&gt;<a class="code" href="structpgpPktSigV3__s.html#f7be5041d8e51f887bc81fb1f3a8a828">signhash16</a>, <span class="keyword">sizeof</span>(v-&gt;<a class="code" href="structpgpPktSigV3__s.html#f7be5041d8e51f887bc81fb1f3a8a828">signhash16</a>));
<a name="l00495"></a>00495         <a class="code" href="rpmpgp_8c.html#22816bc06ecdf64e79a307008b9ab097">pgpPrtHex</a>(<span class="stringliteral">" signhash16"</span>, v-&gt;<a class="code" href="structpgpPktSigV3__s.html#f7be5041d8e51f887bc81fb1f3a8a828">signhash16</a>, <span class="keyword">sizeof</span>(v-&gt;<a class="code" href="structpgpPktSigV3__s.html#f7be5041d8e51f887bc81fb1f3a8a828">signhash16</a>));
<a name="l00496"></a>00496         <a class="code" href="rpmpgp_8c.html#fcdfe6a1d333b1904202d685c4ccc345">pgpPrtNL</a>();
<a name="l00497"></a>00497 
<a name="l00498"></a>00498         <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a> &amp;&amp; <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#31e09130f44863a19046175f8aff0ed8">pubkey_algo</a> == 0) {
<a name="l00499"></a>00499             <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#b64b4fc9eff79d7217531769e0fa2665">version</a> = v-&gt;<a class="code" href="structpgpPktSigV3__s.html#c94a8ac501ef9a62596394523f55716e">version</a>;
<a name="l00500"></a>00500             <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#985cf878e69e1263e4e25db57f8115fd">hashlen</a> = v-&gt;<a class="code" href="structpgpPktSigV3__s.html#a0b340bdf8babb721921251eb5b3ade5">hashlen</a>;
<a name="l00501"></a>00501             <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#73c4d7e3e5d6d1a3e3bbc74de9f3410a">sigtype</a> = v-&gt;<a class="code" href="structpgpPktSigV3__s.html#b3b0231777ff5a695f11c99a6acb905f">sigtype</a>;
<a name="l00502"></a>00502             <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#14b94e2e2363607c4723624b91e69b46">hash</a> = memcpy(<a class="code" href="system_8h.html#2ff4ef58da7e543466e75f20f2a2d8b7">xmalloc</a>(v-&gt;<a class="code" href="structpgpPktSigV3__s.html#a0b340bdf8babb721921251eb5b3ade5">hashlen</a>), &amp;v-&gt;<a class="code" href="structpgpPktSigV3__s.html#b3b0231777ff5a695f11c99a6acb905f">sigtype</a>, v-&gt;<a class="code" href="structpgpPktSigV3__s.html#a0b340bdf8babb721921251eb5b3ade5">hashlen</a>);
<a name="l00503"></a>00503             memcpy(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#5970148fe2546a2e49cd75481c99fd2f">time</a>, v-&gt;<a class="code" href="structpgpPktSigV3__s.html#bd0329078e379884c77015f0a8948dab">time</a>, <span class="keyword">sizeof</span>(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#5970148fe2546a2e49cd75481c99fd2f">time</a>));
<a name="l00504"></a>00504             memcpy(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#a8a9b1747151f106cc7bf63ca4599ed8">signid</a>, v-&gt;<a class="code" href="structpgpPktSigV3__s.html#fd7e172ac9deee317eed7b03a72504d3">signid</a>, <span class="keyword">sizeof</span>(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#a8a9b1747151f106cc7bf63ca4599ed8">signid</a>));
<a name="l00505"></a>00505             <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#31e09130f44863a19046175f8aff0ed8">pubkey_algo</a> = v-&gt;<a class="code" href="structpgpPktSigV3__s.html#7656353dfbc3b35d40e54a4b4287d205">pubkey_algo</a>;
<a name="l00506"></a>00506             <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#b7877aaec211f878b0b32bacb4b826ce">hash_algo</a> = v-&gt;<a class="code" href="structpgpPktSigV3__s.html#5f9546375ef6c90aacbefa4f3dbe33cc">hash_algo</a>;
<a name="l00507"></a>00507             memcpy(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#afecfa801cc6d96b23f5e719adb8df91">signhash16</a>, v-&gt;<a class="code" href="structpgpPktSigV3__s.html#f7be5041d8e51f887bc81fb1f3a8a828">signhash16</a>, <span class="keyword">sizeof</span>(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#afecfa801cc6d96b23f5e719adb8df91">signhash16</a>));
<a name="l00508"></a>00508         }
<a name="l00509"></a>00509 
<a name="l00510"></a>00510         p = ((<a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *)v) + <span class="keyword">sizeof</span>(*v);
<a name="l00511"></a>00511         rc = <a class="code" href="rpmpgp_8c.html#8834a8aaedc957fddbcd6c3609dc4aaf">pgpPrtSigParams</a>(tag, v-&gt;<a class="code" href="structpgpPktSigV3__s.html#7656353dfbc3b35d40e54a4b4287d205">pubkey_algo</a>, v-&gt;<a class="code" href="structpgpPktSigV3__s.html#b3b0231777ff5a695f11c99a6acb905f">sigtype</a>, p, h, hlen);
<a name="l00512"></a>00512     }   <span class="keywordflow">break</span>;
<a name="l00513"></a>00513     <span class="keywordflow">case</span> 4:
<a name="l00514"></a>00514     {   <a class="code" href="structpgpPktSigV4__s.html" title="5.2.3.">pgpPktSigV4</a> v = (<a class="code" href="structpgpPktSigV4__s.html" title="5.2.3.">pgpPktSigV4</a>)h;
<a name="l00515"></a>00515 
<a name="l00516"></a>00516         <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">"V4 "</span>, <a class="code" href="rpmpgp_8c.html#1df19d1753fb12d7f6c400039e0d897d">pgpTagTbl</a>, tag);
<a name="l00517"></a>00517         <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">" "</span>, <a class="code" href="rpmpgp_8c.html#f2b9c065773bf45a20652e6d7ae9a50d">pgpPubkeyTbl</a>, v-&gt;<a class="code" href="structpgpPktSigV4__s.html#e286b931ff8271ae61c16e794af83a39">pubkey_algo</a>);
<a name="l00518"></a>00518         <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">" "</span>, <a class="code" href="rpmpgp_8c.html#82ab0356f3044a25bb1dc316d0d3de96" title="Hash (string, value) pairs.">pgpHashTbl</a>, v-&gt;<a class="code" href="structpgpPktSigV4__s.html#337acdfc08da0d35341d5afff51292a3">hash_algo</a>);
<a name="l00519"></a>00519         <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">" "</span>, <a class="code" href="rpmpgp_8c.html#040dfc120755c3dbd7fb0f11dcdaa88d">pgpSigTypeTbl</a>, v-&gt;<a class="code" href="structpgpPktSigV4__s.html#18f401a832347efa5deab044ffd9e8c0">sigtype</a>);
<a name="l00520"></a>00520         <a class="code" href="rpmpgp_8c.html#fcdfe6a1d333b1904202d685c4ccc345">pgpPrtNL</a>();
<a name="l00521"></a>00521 
<a name="l00522"></a>00522         p = &amp;v-&gt;<a class="code" href="structpgpPktSigV4__s.html#92f4671b506922194aed22464c7fa4bf">hashlen</a>[0];
<a name="l00523"></a>00523         plen = <a class="code" href="rpmpgp_8h.html#86d21d8e18146a24c553685163fce60e" title="Return (native-endian) integer from big-endian representation.">pgpGrab</a>(v-&gt;<a class="code" href="structpgpPktSigV4__s.html#92f4671b506922194aed22464c7fa4bf">hashlen</a>, <span class="keyword">sizeof</span>(v-&gt;<a class="code" href="structpgpPktSigV4__s.html#92f4671b506922194aed22464c7fa4bf">hashlen</a>));
<a name="l00524"></a>00524         p += <span class="keyword">sizeof</span>(v-&gt;<a class="code" href="structpgpPktSigV4__s.html#92f4671b506922194aed22464c7fa4bf">hashlen</a>);
<a name="l00525"></a>00525 
<a name="l00526"></a>00526         <span class="keywordflow">if</span> ((p + plen) &gt; (h + hlen))
<a name="l00527"></a>00527             <span class="keywordflow">return</span> 1;
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 <span class="keywordflow">if</span> (<a class="code" href="poptALL_8c.html#3f39405c2d7c0f545d6b90051f250c85">_debug</a> &amp;&amp; <a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>)
<a name="l00530"></a>00530 fprintf(stderr, <span class="stringliteral">"   hash[%u] -- %s\n"</span>, plen, <a class="code" href="rpmpgp_8h.html#ae93931c2a2b30811b6e6dd2c8fd7d73" title="Return hex formatted representation of bytes.">pgpHexStr</a>(p, plen));
<a name="l00531"></a>00531         <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a> &amp;&amp; <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#31e09130f44863a19046175f8aff0ed8">pubkey_algo</a> == 0) {
<a name="l00532"></a>00532             <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#985cf878e69e1263e4e25db57f8115fd">hashlen</a> = <span class="keyword">sizeof</span>(*v) + plen;
<a name="l00533"></a>00533             <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#14b94e2e2363607c4723624b91e69b46">hash</a> = memcpy(<a class="code" href="system_8h.html#2ff4ef58da7e543466e75f20f2a2d8b7">xmalloc</a>(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#985cf878e69e1263e4e25db57f8115fd">hashlen</a>), v, <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#985cf878e69e1263e4e25db57f8115fd">hashlen</a>);
<a name="l00534"></a>00534         }
<a name="l00535"></a>00535         (void) <a class="code" href="rpmpgp_8c.html#917ad537ba456313151aef0858a60ec5" title="Print/parse an OpenPGP subtype packet.">pgpPrtSubType</a>(p, plen, v-&gt;<a class="code" href="structpgpPktSigV4__s.html#18f401a832347efa5deab044ffd9e8c0">sigtype</a>);
<a name="l00536"></a>00536         p += plen;
<a name="l00537"></a>00537 
<a name="l00538"></a>00538         plen = <a class="code" href="rpmpgp_8h.html#86d21d8e18146a24c553685163fce60e" title="Return (native-endian) integer from big-endian representation.">pgpGrab</a>(p,2);
<a name="l00539"></a>00539         p += 2;
<a name="l00540"></a>00540 
<a name="l00541"></a>00541         <span class="keywordflow">if</span> ((p + plen) &gt; (h + hlen))
<a name="l00542"></a>00542             <span class="keywordflow">return</span> 1;
<a name="l00543"></a>00543 
<a name="l00544"></a>00544 <span class="keywordflow">if</span> (<a class="code" href="poptALL_8c.html#3f39405c2d7c0f545d6b90051f250c85">_debug</a> &amp;&amp; <a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>)
<a name="l00545"></a>00545 fprintf(stderr, <span class="stringliteral">" unhash[%u] -- %s\n"</span>, plen, <a class="code" href="rpmpgp_8h.html#ae93931c2a2b30811b6e6dd2c8fd7d73" title="Return hex formatted representation of bytes.">pgpHexStr</a>(p, plen));
<a name="l00546"></a>00546         (void) <a class="code" href="rpmpgp_8c.html#917ad537ba456313151aef0858a60ec5" title="Print/parse an OpenPGP subtype packet.">pgpPrtSubType</a>(p, plen, v-&gt;<a class="code" href="structpgpPktSigV4__s.html#18f401a832347efa5deab044ffd9e8c0">sigtype</a>);
<a name="l00547"></a>00547         p += plen;
<a name="l00548"></a>00548 
<a name="l00549"></a>00549         plen = <a class="code" href="rpmpgp_8h.html#86d21d8e18146a24c553685163fce60e" title="Return (native-endian) integer from big-endian representation.">pgpGrab</a>(p,2);
<a name="l00550"></a>00550         <a class="code" href="rpmpgp_8c.html#22816bc06ecdf64e79a307008b9ab097">pgpPrtHex</a>(<span class="stringliteral">" signhash16"</span>, p, 2);
<a name="l00551"></a>00551         <a class="code" href="rpmpgp_8c.html#fcdfe6a1d333b1904202d685c4ccc345">pgpPrtNL</a>();
<a name="l00552"></a>00552 
<a name="l00553"></a>00553         <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a> &amp;&amp; <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#31e09130f44863a19046175f8aff0ed8">pubkey_algo</a> == 0) {
<a name="l00554"></a>00554             <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#b64b4fc9eff79d7217531769e0fa2665">version</a> = v-&gt;<a class="code" href="structpgpPktSigV4__s.html#72b23b31f739a0b1548f8dda71e3265a">version</a>;
<a name="l00555"></a>00555             <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#73c4d7e3e5d6d1a3e3bbc74de9f3410a">sigtype</a> = v-&gt;<a class="code" href="structpgpPktSigV4__s.html#18f401a832347efa5deab044ffd9e8c0">sigtype</a>;
<a name="l00556"></a>00556             <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#31e09130f44863a19046175f8aff0ed8">pubkey_algo</a> = v-&gt;<a class="code" href="structpgpPktSigV4__s.html#e286b931ff8271ae61c16e794af83a39">pubkey_algo</a>;
<a name="l00557"></a>00557             <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#b7877aaec211f878b0b32bacb4b826ce">hash_algo</a> = v-&gt;<a class="code" href="structpgpPktSigV4__s.html#337acdfc08da0d35341d5afff51292a3">hash_algo</a>;
<a name="l00558"></a>00558             memcpy(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#afecfa801cc6d96b23f5e719adb8df91">signhash16</a>, p, <span class="keyword">sizeof</span>(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#afecfa801cc6d96b23f5e719adb8df91">signhash16</a>));
<a name="l00559"></a>00559         }
<a name="l00560"></a>00560 
<a name="l00561"></a>00561         p += 2;
<a name="l00562"></a>00562         <span class="keywordflow">if</span> (p &gt; (h + hlen))
<a name="l00563"></a>00563             <span class="keywordflow">return</span> 1;
<a name="l00564"></a>00564 
<a name="l00565"></a>00565         rc = <a class="code" href="rpmpgp_8c.html#8834a8aaedc957fddbcd6c3609dc4aaf">pgpPrtSigParams</a>(tag, v-&gt;<a class="code" href="structpgpPktSigV4__s.html#e286b931ff8271ae61c16e794af83a39">pubkey_algo</a>, v-&gt;<a class="code" href="structpgpPktSigV4__s.html#18f401a832347efa5deab044ffd9e8c0">sigtype</a>, p, h, hlen);
<a name="l00566"></a>00566     }   <span class="keywordflow">break</span>;
<a name="l00567"></a>00567     <span class="keywordflow">default</span>:
<a name="l00568"></a>00568         rc = 1;
<a name="l00569"></a>00569         <span class="keywordflow">break</span>;
<a name="l00570"></a>00570     }
<a name="l00571"></a>00571     <span class="keywordflow">return</span> rc;
<a name="l00572"></a>00572 }
<a name="l00573"></a>00573 
<a name="l00574"></a>00574 <span class="comment">/*@-varuse =readonlytrans @*/</span>
<a name="l00575"></a>00575 <span class="comment">/*@observer@*/</span> <span class="comment">/*@unchecked@*/</span>
<a name="l00576"></a><a class="code" href="rpmpgp_8c.html#e39fae543b9a078c9ca5fd74eccff7fc">00576</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="rpmpgp_8c.html#e39fae543b9a078c9ca5fd74eccff7fc">pgpPublicRSA</a>[] = {
<a name="l00577"></a>00577     <span class="stringliteral">"    n ="</span>,
<a name="l00578"></a>00578     <span class="stringliteral">"    e ="</span>,
<a name="l00579"></a>00579     NULL,
<a name="l00580"></a>00580 };
<a name="l00581"></a>00581 
<a name="l00582"></a>00582 <span class="comment">/*@observer@*/</span> <span class="comment">/*@unchecked@*/</span>
<a name="l00583"></a><a class="code" href="rpmpgp_8c.html#c8b5397142053bef3cc1ae987d8c2618">00583</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="rpmpgp_8c.html#c8b5397142053bef3cc1ae987d8c2618">pgpSecretRSA</a>[] = {
<a name="l00584"></a>00584     <span class="stringliteral">"    d ="</span>,
<a name="l00585"></a>00585     <span class="stringliteral">"    p ="</span>,
<a name="l00586"></a>00586     <span class="stringliteral">"    q ="</span>,
<a name="l00587"></a>00587     <span class="stringliteral">"    u ="</span>,
<a name="l00588"></a>00588     NULL,
<a name="l00589"></a>00589 };
<a name="l00590"></a>00590 
<a name="l00591"></a>00591 <span class="comment">/*@observer@*/</span> <span class="comment">/*@unchecked@*/</span>
<a name="l00592"></a><a class="code" href="rpmpgp_8c.html#ebb012d64c0ba337cd37d80283cf317e">00592</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="rpmpgp_8c.html#ebb012d64c0ba337cd37d80283cf317e">pgpPublicDSA</a>[] = {
<a name="l00593"></a>00593     <span class="stringliteral">"    p ="</span>,
<a name="l00594"></a>00594     <span class="stringliteral">"    q ="</span>,
<a name="l00595"></a>00595     <span class="stringliteral">"    g ="</span>,
<a name="l00596"></a>00596     <span class="stringliteral">"    y ="</span>,
<a name="l00597"></a>00597     NULL,
<a name="l00598"></a>00598 };
<a name="l00599"></a>00599 
<a name="l00600"></a>00600 <span class="comment">/*@observer@*/</span> <span class="comment">/*@unchecked@*/</span>
<a name="l00601"></a><a class="code" href="rpmpgp_8c.html#45ef85f8118f1ee148b020958176e410">00601</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="rpmpgp_8c.html#45ef85f8118f1ee148b020958176e410">pgpSecretDSA</a>[] = {
<a name="l00602"></a>00602     <span class="stringliteral">"    x ="</span>,
<a name="l00603"></a>00603     NULL,
<a name="l00604"></a>00604 };
<a name="l00605"></a>00605 
<a name="l00606"></a>00606 <span class="comment">/*@observer@*/</span> <span class="comment">/*@unchecked@*/</span>
<a name="l00607"></a><a class="code" href="rpmpgp_8c.html#f0deca94f3020b7264a00d9b1b8d8734">00607</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="rpmpgp_8c.html#f0deca94f3020b7264a00d9b1b8d8734">pgpPublicELGAMAL</a>[] = {
<a name="l00608"></a>00608     <span class="stringliteral">"    p ="</span>,
<a name="l00609"></a>00609     <span class="stringliteral">"    g ="</span>,
<a name="l00610"></a>00610     <span class="stringliteral">"    y ="</span>,
<a name="l00611"></a>00611     NULL,
<a name="l00612"></a>00612 };
<a name="l00613"></a>00613 
<a name="l00614"></a>00614 <span class="comment">/*@observer@*/</span> <span class="comment">/*@unchecked@*/</span>
<a name="l00615"></a><a class="code" href="rpmpgp_8c.html#6290dfb15c9625d467901fc12441cb38">00615</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="rpmpgp_8c.html#6290dfb15c9625d467901fc12441cb38">pgpSecretELGAMAL</a>[] = {
<a name="l00616"></a>00616     <span class="stringliteral">"    x ="</span>,
<a name="l00617"></a>00617     NULL,
<a name="l00618"></a>00618 };
<a name="l00619"></a>00619 <span class="comment">/*@=varuse =readonlytrans @*/</span>
<a name="l00620"></a>00620 
<a name="l00621"></a><a class="code" href="rpmpgp_8c.html#01085085c9321da82b54aa733dd2760a">00621</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> * <a class="code" href="rpmpgp_8c.html#01085085c9321da82b54aa733dd2760a">pgpPrtPubkeyParams</a>(<a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> pubkey_algo,
<a name="l00622"></a>00622                 <span class="comment">/*@returned@*/</span> <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *p, <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *h, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hlen)
<a name="l00623"></a>00623         <span class="comment">/*@globals fileSystem, internalState @*/</span>
<a name="l00624"></a>00624         <span class="comment">/*@modifies fileSystem, internalState @*/</span>
<a name="l00625"></a>00625 {
<a name="l00626"></a>00626     <span class="keywordtype">int</span> i;
<a name="l00627"></a>00627 
<a name="l00628"></a>00628     <span class="keywordflow">for</span> (i = 0; p &lt; &amp;h[hlen]; i++, p += <a class="code" href="rpmpgp_8h.html#46e1a524178bdb4a3564caf5ad52424d" title="Return no.">pgpMpiLen</a>(p)) {
<a name="l00629"></a>00629         <span class="keywordflow">if</span> (pubkey_algo == <a class="code" href="rpmpgp_8h.html#ff2fe1c7e6a7056de3b2fe65f9a0c7df1e566f354567b4ea9934a2c34a831abc">PGPPUBKEYALGO_RSA</a>) {
<a name="l00630"></a>00630             <span class="keywordflow">if</span> (i &gt;= 2) <span class="keywordflow">break</span>;
<a name="l00631"></a>00631             <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>) {
<a name="l00632"></a>00632                 <span class="keywordflow">switch</span> (i) {
<a name="l00633"></a>00633                 <span class="keywordflow">case</span> 0:         <span class="comment">/* n */</span>
<a name="l00634"></a>00634                     (void) mpbsethex(&amp;<a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#067b82c1cd41efa554c0e4d01f776d68">rsa_pk</a>.n, <a class="code" href="rpmpgp_8c.html#7b75992d35f40d484f16033b6ba582d6">pgpMpiHex</a>(p));
<a name="l00635"></a>00635 <span class="keywordflow">if</span> (<a class="code" href="poptALL_8c.html#3f39405c2d7c0f545d6b90051f250c85">_debug</a> &amp;&amp; <a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>)
<a name="l00636"></a>00636 fprintf(stderr, <span class="stringliteral">"\t     n = "</span>),  mpfprintln(stderr, <a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#067b82c1cd41efa554c0e4d01f776d68">rsa_pk</a>.n.size, <a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#067b82c1cd41efa554c0e4d01f776d68">rsa_pk</a>.n.modl);
<a name="l00637"></a>00637                     <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00638"></a>00638                 <span class="keywordflow">case</span> 1:         <span class="comment">/* e */</span>
<a name="l00639"></a>00639                     (void) mpnsethex(&amp;<a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#067b82c1cd41efa554c0e4d01f776d68">rsa_pk</a>.e, <a class="code" href="rpmpgp_8c.html#7b75992d35f40d484f16033b6ba582d6">pgpMpiHex</a>(p));
<a name="l00640"></a>00640 <span class="keywordflow">if</span> (<a class="code" href="poptALL_8c.html#3f39405c2d7c0f545d6b90051f250c85">_debug</a> &amp;&amp; <a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>)
<a name="l00641"></a>00641 fprintf(stderr, <span class="stringliteral">"\t     e = "</span>),  mpfprintln(stderr, <a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#067b82c1cd41efa554c0e4d01f776d68">rsa_pk</a>.e.size, <a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#067b82c1cd41efa554c0e4d01f776d68">rsa_pk</a>.e.data);
<a name="l00642"></a>00642                     <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00643"></a>00643                 <span class="keywordflow">default</span>:
<a name="l00644"></a>00644                     <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00645"></a>00645                 }
<a name="l00646"></a>00646             }
<a name="l00647"></a>00647             <a class="code" href="rpmpgp_8c.html#ff507fd3f3151e94f5a77285f1e02b77">pgpPrtStr</a>(<span class="stringliteral">""</span>, <a class="code" href="rpmpgp_8c.html#e39fae543b9a078c9ca5fd74eccff7fc">pgpPublicRSA</a>[i]);
<a name="l00648"></a>00648         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pubkey_algo == <a class="code" href="rpmpgp_8h.html#ff2fe1c7e6a7056de3b2fe65f9a0c7df0f7e95526c0f4c5023734df9cd895d73">PGPPUBKEYALGO_DSA</a>) {
<a name="l00649"></a>00649             <span class="keywordflow">if</span> (i &gt;= 4) <span class="keywordflow">break</span>;
<a name="l00650"></a>00650             <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>) {
<a name="l00651"></a>00651                 <span class="keywordflow">switch</span> (i) {
<a name="l00652"></a>00652                 <span class="keywordflow">case</span> 0:         <span class="comment">/* p */</span>
<a name="l00653"></a>00653                     (void) mpbsethex(&amp;<a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#292a3feb2c4c1fadfe3320a628121c20">p</a>, <a class="code" href="rpmpgp_8c.html#7b75992d35f40d484f16033b6ba582d6">pgpMpiHex</a>(p));
<a name="l00654"></a>00654 <span class="keywordflow">if</span> (<a class="code" href="poptALL_8c.html#3f39405c2d7c0f545d6b90051f250c85">_debug</a> &amp;&amp; <a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>)
<a name="l00655"></a>00655 fprintf(stderr, <span class="stringliteral">"\t     p = "</span>),  mpfprintln(stderr, <a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#292a3feb2c4c1fadfe3320a628121c20">p</a>.size, <a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#292a3feb2c4c1fadfe3320a628121c20">p</a>.modl);
<a name="l00656"></a>00656                     <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00657"></a>00657                 <span class="keywordflow">case</span> 1:         <span class="comment">/* q */</span>
<a name="l00658"></a>00658                     (void) mpbsethex(&amp;<a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#db9907ac14c3d93e79e07c7041c4f470">q</a>, <a class="code" href="rpmpgp_8c.html#7b75992d35f40d484f16033b6ba582d6">pgpMpiHex</a>(p));
<a name="l00659"></a>00659 <span class="keywordflow">if</span> (<a class="code" href="poptALL_8c.html#3f39405c2d7c0f545d6b90051f250c85">_debug</a> &amp;&amp; <a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>)
<a name="l00660"></a>00660 fprintf(stderr, <span class="stringliteral">"\t     q = "</span>),  mpfprintln(stderr, <a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#db9907ac14c3d93e79e07c7041c4f470">q</a>.size, <a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#db9907ac14c3d93e79e07c7041c4f470">q</a>.modl);
<a name="l00661"></a>00661                     <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00662"></a>00662                 <span class="keywordflow">case</span> 2:         <span class="comment">/* g */</span>
<a name="l00663"></a>00663                     (void) mpnsethex(&amp;<a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#8b7f97cb59ebb01d98267c7315f073ec">g</a>, <a class="code" href="rpmpgp_8c.html#7b75992d35f40d484f16033b6ba582d6">pgpMpiHex</a>(p));
<a name="l00664"></a>00664 <span class="keywordflow">if</span> (<a class="code" href="poptALL_8c.html#3f39405c2d7c0f545d6b90051f250c85">_debug</a> &amp;&amp; <a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>)
<a name="l00665"></a>00665 fprintf(stderr, <span class="stringliteral">"\t     g = "</span>),  mpfprintln(stderr, <a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#8b7f97cb59ebb01d98267c7315f073ec">g</a>.size, <a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#8b7f97cb59ebb01d98267c7315f073ec">g</a>.data);
<a name="l00666"></a>00666                     <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00667"></a>00667                 <span class="keywordflow">case</span> 3:         <span class="comment">/* y */</span>
<a name="l00668"></a>00668                     (void) mpnsethex(&amp;<a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#5984e554aaa2e5f841ee23c58875ce7c">y</a>, <a class="code" href="rpmpgp_8c.html#7b75992d35f40d484f16033b6ba582d6">pgpMpiHex</a>(p));
<a name="l00669"></a>00669 <span class="keywordflow">if</span> (<a class="code" href="poptALL_8c.html#3f39405c2d7c0f545d6b90051f250c85">_debug</a> &amp;&amp; <a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>)
<a name="l00670"></a>00670 fprintf(stderr, <span class="stringliteral">"\t     y = "</span>),  mpfprintln(stderr, <a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#5984e554aaa2e5f841ee23c58875ce7c">y</a>.size, <a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#5984e554aaa2e5f841ee23c58875ce7c">y</a>.data);
<a name="l00671"></a>00671                     <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00672"></a>00672                 <span class="keywordflow">default</span>:
<a name="l00673"></a>00673                     <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00674"></a>00674                 }
<a name="l00675"></a>00675             }
<a name="l00676"></a>00676             <a class="code" href="rpmpgp_8c.html#ff507fd3f3151e94f5a77285f1e02b77">pgpPrtStr</a>(<span class="stringliteral">""</span>, <a class="code" href="rpmpgp_8c.html#ebb012d64c0ba337cd37d80283cf317e">pgpPublicDSA</a>[i]);
<a name="l00677"></a>00677         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pubkey_algo == <a class="code" href="rpmpgp_8h.html#ff2fe1c7e6a7056de3b2fe65f9a0c7dfdd083e905321655ad5a18b641976385e">PGPPUBKEYALGO_ELGAMAL_ENCRYPT</a>) {
<a name="l00678"></a>00678             <span class="keywordflow">if</span> (i &gt;= 3) <span class="keywordflow">break</span>;
<a name="l00679"></a>00679             <a class="code" href="rpmpgp_8c.html#ff507fd3f3151e94f5a77285f1e02b77">pgpPrtStr</a>(<span class="stringliteral">""</span>, <a class="code" href="rpmpgp_8c.html#f0deca94f3020b7264a00d9b1b8d8734">pgpPublicELGAMAL</a>[i]);
<a name="l00680"></a>00680         } <span class="keywordflow">else</span> {
<a name="l00681"></a>00681             <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>)
<a name="l00682"></a>00682                 fprintf(stderr, <span class="stringliteral">"%7d"</span>, i);
<a name="l00683"></a>00683         }
<a name="l00684"></a>00684         <a class="code" href="rpmpgp_8c.html#ff507fd3f3151e94f5a77285f1e02b77">pgpPrtStr</a>(<span class="stringliteral">""</span>, <a class="code" href="rpmpgp_8h.html#e79674a20e83b584a2f1b12f5e95394b" title="Return hex formatted representation of a multiprecision integer.">pgpMpiStr</a>(p));
<a name="l00685"></a>00685         <a class="code" href="rpmpgp_8c.html#fcdfe6a1d333b1904202d685c4ccc345">pgpPrtNL</a>();
<a name="l00686"></a>00686     }
<a name="l00687"></a>00687 
<a name="l00688"></a>00688     <span class="keywordflow">return</span> p;
<a name="l00689"></a>00689 }
<a name="l00690"></a>00690 
<a name="l00691"></a><a class="code" href="rpmpgp_8c.html#2692c7fbcf8f426b7e4270d0f06489ff">00691</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> * <a class="code" href="rpmpgp_8c.html#2692c7fbcf8f426b7e4270d0f06489ff">pgpPrtSeckeyParams</a>(<span class="comment">/*@unused@*/</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> pubkey_algo,
<a name="l00692"></a>00692                 <span class="comment">/*@returned@*/</span> <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *p, <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *h, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hlen)
<a name="l00693"></a>00693         <span class="comment">/*@globals fileSystem @*/</span>
<a name="l00694"></a>00694         <span class="comment">/*@modifies fileSystem @*/</span>
<a name="l00695"></a>00695 {
<a name="l00696"></a>00696     <span class="keywordtype">int</span> i;
<a name="l00697"></a>00697 
<a name="l00698"></a>00698     <span class="keywordflow">switch</span> (*p) {
<a name="l00699"></a>00699     <span class="keywordflow">case</span> 0:
<a name="l00700"></a>00700         <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">" "</span>, <a class="code" href="rpmpgp_8c.html#1f55290d708f48b088353a7a9b147554" title="Symmetric key (string, value) pairs.">pgpSymkeyTbl</a>, *p);
<a name="l00701"></a>00701         <span class="keywordflow">break</span>;
<a name="l00702"></a>00702     <span class="keywordflow">case</span> 255:
<a name="l00703"></a>00703         p++;
<a name="l00704"></a>00704         <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">" "</span>, <a class="code" href="rpmpgp_8c.html#1f55290d708f48b088353a7a9b147554" title="Symmetric key (string, value) pairs.">pgpSymkeyTbl</a>, *p);
<a name="l00705"></a>00705         <span class="keywordflow">switch</span> (p[1]) {
<a name="l00706"></a>00706         <span class="keywordflow">case</span> 0x00:
<a name="l00707"></a>00707             <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">" simple "</span>, <a class="code" href="rpmpgp_8c.html#82ab0356f3044a25bb1dc316d0d3de96" title="Hash (string, value) pairs.">pgpHashTbl</a>, p[2]);
<a name="l00708"></a>00708             p += 2;
<a name="l00709"></a>00709             <span class="comment">/*@innerbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00710"></a>00710         <span class="keywordflow">case</span> 0x01:
<a name="l00711"></a>00711             <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">" salted "</span>, <a class="code" href="rpmpgp_8c.html#82ab0356f3044a25bb1dc316d0d3de96" title="Hash (string, value) pairs.">pgpHashTbl</a>, p[2]);
<a name="l00712"></a>00712             <a class="code" href="rpmpgp_8c.html#22816bc06ecdf64e79a307008b9ab097">pgpPrtHex</a>(<span class="stringliteral">""</span>, p+3, 8);
<a name="l00713"></a>00713             p += 10;
<a name="l00714"></a>00714             <span class="comment">/*@innerbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00715"></a>00715         <span class="keywordflow">case</span> 0x03:
<a name="l00716"></a>00716             <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">" iterated/salted "</span>, <a class="code" href="rpmpgp_8c.html#82ab0356f3044a25bb1dc316d0d3de96" title="Hash (string, value) pairs.">pgpHashTbl</a>, p[2]);
<a name="l00717"></a>00717             <span class="comment">/*@-shiftnegative -shiftimplementation @*/</span> <span class="comment">/* FIX: unsigned cast */</span>
<a name="l00718"></a>00718             i = (16 + (p[11] &amp; 0xf)) &lt;&lt; ((p[11] &gt;&gt; 4) + 6);
<a name="l00719"></a>00719             <span class="comment">/*@=shiftnegative =shiftimplementation @*/</span>
<a name="l00720"></a>00720             <a class="code" href="rpmpgp_8c.html#22816bc06ecdf64e79a307008b9ab097">pgpPrtHex</a>(<span class="stringliteral">""</span>, p+3, 8);
<a name="l00721"></a>00721             <a class="code" href="rpmpgp_8c.html#4be63d5895dd2cbd026f2087100e2337">pgpPrtInt</a>(<span class="stringliteral">" iter"</span>, i);
<a name="l00722"></a>00722             p += 11;
<a name="l00723"></a>00723             <span class="comment">/*@innerbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00724"></a>00724         }
<a name="l00725"></a>00725         <span class="keywordflow">break</span>;
<a name="l00726"></a>00726     <span class="keywordflow">default</span>:
<a name="l00727"></a>00727         <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">" "</span>, <a class="code" href="rpmpgp_8c.html#1f55290d708f48b088353a7a9b147554" title="Symmetric key (string, value) pairs.">pgpSymkeyTbl</a>, *p);
<a name="l00728"></a>00728         <a class="code" href="rpmpgp_8c.html#22816bc06ecdf64e79a307008b9ab097">pgpPrtHex</a>(<span class="stringliteral">" IV"</span>, p+1, 8);
<a name="l00729"></a>00729         p += 8;
<a name="l00730"></a>00730         <span class="keywordflow">break</span>;
<a name="l00731"></a>00731     }
<a name="l00732"></a>00732     <a class="code" href="rpmpgp_8c.html#fcdfe6a1d333b1904202d685c4ccc345">pgpPrtNL</a>();
<a name="l00733"></a>00733 
<a name="l00734"></a>00734     p++;
<a name="l00735"></a>00735 
<a name="l00736"></a>00736 <span class="preprocessor">#ifdef  NOTYET  </span><span class="comment">/* XXX encrypted MPI's need to be handled. */</span>
<a name="l00737"></a>00737     <span class="keywordflow">for</span> (i = 0; p &lt; &amp;h[hlen]; i++, p += <a class="code" href="rpmpgp_8h.html#46e1a524178bdb4a3564caf5ad52424d" title="Return no.">pgpMpiLen</a>(p)) {
<a name="l00738"></a>00738         <span class="keywordflow">if</span> (pubkey_algo == <a class="code" href="rpmpgp_8h.html#ff2fe1c7e6a7056de3b2fe65f9a0c7df1e566f354567b4ea9934a2c34a831abc">PGPPUBKEYALGO_RSA</a>) {
<a name="l00739"></a>00739             <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#c8b5397142053bef3cc1ae987d8c2618">pgpSecretRSA</a>[i] == NULL) <span class="keywordflow">break</span>;
<a name="l00740"></a>00740             <a class="code" href="rpmpgp_8c.html#ff507fd3f3151e94f5a77285f1e02b77">pgpPrtStr</a>(<span class="stringliteral">""</span>, <a class="code" href="rpmpgp_8c.html#c8b5397142053bef3cc1ae987d8c2618">pgpSecretRSA</a>[i]);
<a name="l00741"></a>00741         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pubkey_algo == <a class="code" href="rpmpgp_8h.html#ff2fe1c7e6a7056de3b2fe65f9a0c7df0f7e95526c0f4c5023734df9cd895d73">PGPPUBKEYALGO_DSA</a>) {
<a name="l00742"></a>00742             <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#45ef85f8118f1ee148b020958176e410">pgpSecretDSA</a>[i] == NULL) <span class="keywordflow">break</span>;
<a name="l00743"></a>00743             <a class="code" href="rpmpgp_8c.html#ff507fd3f3151e94f5a77285f1e02b77">pgpPrtStr</a>(<span class="stringliteral">""</span>, <a class="code" href="rpmpgp_8c.html#45ef85f8118f1ee148b020958176e410">pgpSecretDSA</a>[i]);
<a name="l00744"></a>00744         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pubkey_algo == <a class="code" href="rpmpgp_8h.html#ff2fe1c7e6a7056de3b2fe65f9a0c7dfdd083e905321655ad5a18b641976385e">PGPPUBKEYALGO_ELGAMAL_ENCRYPT</a>) {
<a name="l00745"></a>00745             <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#6290dfb15c9625d467901fc12441cb38">pgpSecretELGAMAL</a>[i] == NULL) <span class="keywordflow">break</span>;
<a name="l00746"></a>00746             <a class="code" href="rpmpgp_8c.html#ff507fd3f3151e94f5a77285f1e02b77">pgpPrtStr</a>(<span class="stringliteral">""</span>, <a class="code" href="rpmpgp_8c.html#6290dfb15c9625d467901fc12441cb38">pgpSecretELGAMAL</a>[i]);
<a name="l00747"></a>00747         } <span class="keywordflow">else</span> {
<a name="l00748"></a>00748             <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>)
<a name="l00749"></a>00749                 fprintf(stderr, <span class="stringliteral">"%7d"</span>, i);
<a name="l00750"></a>00750         }
<a name="l00751"></a>00751         <a class="code" href="rpmpgp_8c.html#ff507fd3f3151e94f5a77285f1e02b77">pgpPrtStr</a>(<span class="stringliteral">""</span>, <a class="code" href="rpmpgp_8h.html#e79674a20e83b584a2f1b12f5e95394b" title="Return hex formatted representation of a multiprecision integer.">pgpMpiStr</a>(p));
<a name="l00752"></a>00752         <a class="code" href="rpmpgp_8c.html#fcdfe6a1d333b1904202d685c4ccc345">pgpPrtNL</a>();
<a name="l00753"></a>00753     }
<a name="l00754"></a>00754 <span class="preprocessor">#else</span>
<a name="l00755"></a>00755 <span class="preprocessor"></span>    <a class="code" href="rpmpgp_8c.html#22816bc06ecdf64e79a307008b9ab097">pgpPrtHex</a>(<span class="stringliteral">" secret"</span>, p, (hlen - (p - h) - 2));
<a name="l00756"></a>00756     <a class="code" href="rpmpgp_8c.html#fcdfe6a1d333b1904202d685c4ccc345">pgpPrtNL</a>();
<a name="l00757"></a>00757     p += (hlen - (p - h) - 2);
<a name="l00758"></a>00758 <span class="preprocessor">#endif</span>
<a name="l00759"></a>00759 <span class="preprocessor"></span>    <a class="code" href="rpmpgp_8c.html#22816bc06ecdf64e79a307008b9ab097">pgpPrtHex</a>(<span class="stringliteral">" checksum"</span>, p, 2);
<a name="l00760"></a>00760     <a class="code" href="rpmpgp_8c.html#fcdfe6a1d333b1904202d685c4ccc345">pgpPrtNL</a>();
<a name="l00761"></a>00761 
<a name="l00762"></a>00762     <span class="keywordflow">return</span> p;
<a name="l00763"></a>00763 }
<a name="l00764"></a>00764 
<a name="l00765"></a><a class="code" href="rpmpgp_8h.html#c3437902c44a6bf7f098b6342d6732f2">00765</a> <span class="keywordtype">int</span> <a class="code" href="rpmpgp_8c.html#c3437902c44a6bf7f098b6342d6732f2" title="Print/parse an OpenPGP key packet.">pgpPrtKey</a>(<a class="code" href="rpmpgp_8h.html#f814c5eae8f6dfbed984e367c6459043" title="4.3.">pgpTag</a> tag, <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *h, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hlen)
<a name="l00766"></a>00766         <span class="comment">/*@globals _digp @*/</span>
<a name="l00767"></a>00767         <span class="comment">/*@modifies *_digp @*/</span>
<a name="l00768"></a>00768 {
<a name="l00769"></a>00769     <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> version = *h;
<a name="l00770"></a>00770     <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> * p;
<a name="l00771"></a>00771     <span class="keywordtype">unsigned</span> plen;
<a name="l00772"></a>00772     time_t t;
<a name="l00773"></a>00773     <span class="keywordtype">int</span> rc;
<a name="l00774"></a>00774 
<a name="l00775"></a>00775     <span class="keywordflow">switch</span> (version) {
<a name="l00776"></a>00776     <span class="keywordflow">case</span> 3:
<a name="l00777"></a>00777     {   <a class="code" href="structpgpPktKeyV3__s.html" title="5.5.1.">pgpPktKeyV3</a> v = (<a class="code" href="structpgpPktKeyV3__s.html" title="5.5.1.">pgpPktKeyV3</a>)h;
<a name="l00778"></a>00778         <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">"V3 "</span>, <a class="code" href="rpmpgp_8c.html#1df19d1753fb12d7f6c400039e0d897d">pgpTagTbl</a>, tag);
<a name="l00779"></a>00779         <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">" "</span>, <a class="code" href="rpmpgp_8c.html#f2b9c065773bf45a20652e6d7ae9a50d">pgpPubkeyTbl</a>, v-&gt;<a class="code" href="structpgpPktKeyV3__s.html#11a1ae54bdaf932b1ffbc11de0cb3bc9">pubkey_algo</a>);
<a name="l00780"></a>00780         t = <a class="code" href="rpmpgp_8h.html#86d21d8e18146a24c553685163fce60e" title="Return (native-endian) integer from big-endian representation.">pgpGrab</a>(v-&gt;<a class="code" href="structpgpPktKeyV3__s.html#8b4a25a722d6b8273cc2b6d4457ab24d">time</a>, <span class="keyword">sizeof</span>(v-&gt;<a class="code" href="structpgpPktKeyV3__s.html#8b4a25a722d6b8273cc2b6d4457ab24d">time</a>));
<a name="l00781"></a>00781         <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>)
<a name="l00782"></a>00782             fprintf(stderr, <span class="stringliteral">" %-24.24s(0x%08x)"</span>, ctime(&amp;t), (<span class="keywordtype">unsigned</span>)t);
<a name="l00783"></a>00783         plen = <a class="code" href="rpmpgp_8h.html#86d21d8e18146a24c553685163fce60e" title="Return (native-endian) integer from big-endian representation.">pgpGrab</a>(v-&gt;<a class="code" href="structpgpPktKeyV3__s.html#b35611bc084aba5f6ff9bb8c5bddb924">valid</a>, <span class="keyword">sizeof</span>(v-&gt;<a class="code" href="structpgpPktKeyV3__s.html#b35611bc084aba5f6ff9bb8c5bddb924">valid</a>));
<a name="l00784"></a>00784         <span class="keywordflow">if</span> (plen != 0)
<a name="l00785"></a>00785             fprintf(stderr, <span class="stringliteral">" valid %u days"</span>, plen);
<a name="l00786"></a>00786         <a class="code" href="rpmpgp_8c.html#fcdfe6a1d333b1904202d685c4ccc345">pgpPrtNL</a>();
<a name="l00787"></a>00787 
<a name="l00788"></a>00788         <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a> &amp;&amp; <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#16d66e3965da4f729217e1660a9958de">tag</a> == tag) {
<a name="l00789"></a>00789             <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#b64b4fc9eff79d7217531769e0fa2665">version</a> = v-&gt;<a class="code" href="structpgpPktKeyV3__s.html#5193ca680f1e65847384ab35f44023d1">version</a>;
<a name="l00790"></a>00790             memcpy(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#5970148fe2546a2e49cd75481c99fd2f">time</a>, v-&gt;<a class="code" href="structpgpPktKeyV3__s.html#8b4a25a722d6b8273cc2b6d4457ab24d">time</a>, <span class="keyword">sizeof</span>(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#5970148fe2546a2e49cd75481c99fd2f">time</a>));
<a name="l00791"></a>00791             <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#31e09130f44863a19046175f8aff0ed8">pubkey_algo</a> = v-&gt;<a class="code" href="structpgpPktKeyV3__s.html#11a1ae54bdaf932b1ffbc11de0cb3bc9">pubkey_algo</a>;
<a name="l00792"></a>00792         }
<a name="l00793"></a>00793 
<a name="l00794"></a>00794         p = ((<a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *)v) + <span class="keyword">sizeof</span>(*v);
<a name="l00795"></a>00795         p = <a class="code" href="rpmpgp_8c.html#01085085c9321da82b54aa733dd2760a">pgpPrtPubkeyParams</a>(v-&gt;<a class="code" href="structpgpPktKeyV3__s.html#11a1ae54bdaf932b1ffbc11de0cb3bc9">pubkey_algo</a>, p, h, hlen);
<a name="l00796"></a>00796         rc = 0;
<a name="l00797"></a>00797     }   <span class="keywordflow">break</span>;
<a name="l00798"></a>00798     <span class="keywordflow">case</span> 4:
<a name="l00799"></a>00799     {   <a class="code" href="structpgpPktKeyV4__s.html" title="The version 4 format is similar to the version 3 format except for the absence of...">pgpPktKeyV4</a> v = (<a class="code" href="structpgpPktKeyV4__s.html" title="The version 4 format is similar to the version 3 format except for the absence of...">pgpPktKeyV4</a>)h;
<a name="l00800"></a>00800         <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">"V4 "</span>, <a class="code" href="rpmpgp_8c.html#1df19d1753fb12d7f6c400039e0d897d">pgpTagTbl</a>, tag);
<a name="l00801"></a>00801         <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">" "</span>, <a class="code" href="rpmpgp_8c.html#f2b9c065773bf45a20652e6d7ae9a50d">pgpPubkeyTbl</a>, v-&gt;<a class="code" href="structpgpPktKeyV4__s.html#9cc3050cf6ebbee32c07f3ccbee9724c">pubkey_algo</a>);
<a name="l00802"></a>00802         t = <a class="code" href="rpmpgp_8h.html#86d21d8e18146a24c553685163fce60e" title="Return (native-endian) integer from big-endian representation.">pgpGrab</a>(v-&gt;<a class="code" href="structpgpPktKeyV4__s.html#05a20987a63d6c49d73f69146f03e59e">time</a>, <span class="keyword">sizeof</span>(v-&gt;<a class="code" href="structpgpPktKeyV4__s.html#05a20987a63d6c49d73f69146f03e59e">time</a>));
<a name="l00803"></a>00803         <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>)
<a name="l00804"></a>00804             fprintf(stderr, <span class="stringliteral">" %-24.24s(0x%08x)"</span>, ctime(&amp;t), (<span class="keywordtype">unsigned</span>)t);
<a name="l00805"></a>00805         <a class="code" href="rpmpgp_8c.html#fcdfe6a1d333b1904202d685c4ccc345">pgpPrtNL</a>();
<a name="l00806"></a>00806 
<a name="l00807"></a>00807         <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a> &amp;&amp; <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#16d66e3965da4f729217e1660a9958de">tag</a> == tag) {
<a name="l00808"></a>00808             <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#b64b4fc9eff79d7217531769e0fa2665">version</a> = v-&gt;<a class="code" href="structpgpPktKeyV4__s.html#7d38056d8e57b7cea6db3d7e1d65de15">version</a>;
<a name="l00809"></a>00809             memcpy(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#5970148fe2546a2e49cd75481c99fd2f">time</a>, v-&gt;<a class="code" href="structpgpPktKeyV4__s.html#05a20987a63d6c49d73f69146f03e59e">time</a>, <span class="keyword">sizeof</span>(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#5970148fe2546a2e49cd75481c99fd2f">time</a>));
<a name="l00810"></a>00810             <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#31e09130f44863a19046175f8aff0ed8">pubkey_algo</a> = v-&gt;<a class="code" href="structpgpPktKeyV4__s.html#9cc3050cf6ebbee32c07f3ccbee9724c">pubkey_algo</a>;
<a name="l00811"></a>00811         }
<a name="l00812"></a>00812 
<a name="l00813"></a>00813         p = ((<a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *)v) + <span class="keyword">sizeof</span>(*v);
<a name="l00814"></a>00814         p = <a class="code" href="rpmpgp_8c.html#01085085c9321da82b54aa733dd2760a">pgpPrtPubkeyParams</a>(v-&gt;<a class="code" href="structpgpPktKeyV4__s.html#9cc3050cf6ebbee32c07f3ccbee9724c">pubkey_algo</a>, p, h, hlen);
<a name="l00815"></a>00815         <span class="keywordflow">if</span> (!(tag == <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebeef47643cfdc941fb40a2cdc49c5e05a5">PGPTAG_PUBLIC_KEY</a> || tag == <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe5ed10139124c4a2e7ae9f1232280ebc0">PGPTAG_PUBLIC_SUBKEY</a>))
<a name="l00816"></a>00816             p = <a class="code" href="rpmpgp_8c.html#2692c7fbcf8f426b7e4270d0f06489ff">pgpPrtSeckeyParams</a>(v-&gt;<a class="code" href="structpgpPktKeyV4__s.html#9cc3050cf6ebbee32c07f3ccbee9724c">pubkey_algo</a>, p, h, hlen);
<a name="l00817"></a>00817         rc = 0;
<a name="l00818"></a>00818     }   <span class="keywordflow">break</span>;
<a name="l00819"></a>00819     <span class="keywordflow">default</span>:
<a name="l00820"></a>00820         rc = 1;
<a name="l00821"></a>00821         <span class="keywordflow">break</span>;
<a name="l00822"></a>00822     }
<a name="l00823"></a>00823     <span class="keywordflow">return</span> rc;
<a name="l00824"></a>00824 }
<a name="l00825"></a>00825 
<a name="l00826"></a>00826 <span class="comment">/*@-boundswrite@*/</span>
<a name="l00827"></a><a class="code" href="rpmpgp_8h.html#ddd2a128427d7c982bdb9046920d4a70">00827</a> <span class="keywordtype">int</span> <a class="code" href="rpmpgp_8c.html#ddd2a128427d7c982bdb9046920d4a70" title="Print/parse an OpenPGP userid packet.">pgpPrtUserID</a>(<a class="code" href="rpmpgp_8h.html#f814c5eae8f6dfbed984e367c6459043" title="4.3.">pgpTag</a> tag, <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *h, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hlen)
<a name="l00828"></a>00828         <span class="comment">/*@globals _digp @*/</span>
<a name="l00829"></a>00829         <span class="comment">/*@modifies *_digp @*/</span>
<a name="l00830"></a>00830 {
<a name="l00831"></a>00831     <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">""</span>, <a class="code" href="rpmpgp_8c.html#1df19d1753fb12d7f6c400039e0d897d">pgpTagTbl</a>, tag);
<a name="l00832"></a>00832     <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>)
<a name="l00833"></a>00833         fprintf(stderr, <span class="stringliteral">" \"%.*s\""</span>, (<span class="keywordtype">int</span>)hlen, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)h);
<a name="l00834"></a>00834     <a class="code" href="rpmpgp_8c.html#fcdfe6a1d333b1904202d685c4ccc345">pgpPrtNL</a>();
<a name="l00835"></a>00835     <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>) {
<a name="l00836"></a>00836         <span class="keywordtype">char</span> * t;
<a name="l00837"></a>00837         <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#8817e1e2ff2c3745ee3b36ee2148ae87">userid</a> = t = memcpy(<a class="code" href="system_8h.html#2ff4ef58da7e543466e75f20f2a2d8b7">xmalloc</a>(hlen+1), h, hlen);
<a name="l00838"></a>00838         t[hlen] = <span class="charliteral">'\0'</span>;
<a name="l00839"></a>00839     }
<a name="l00840"></a>00840     <span class="keywordflow">return</span> 0;
<a name="l00841"></a>00841 }
<a name="l00842"></a>00842 <span class="comment">/*@=boundswrite@*/</span>
<a name="l00843"></a>00843 
<a name="l00844"></a><a class="code" href="rpmpgp_8h.html#696af3338405a18d7ab5a148fe6f8d66">00844</a> <span class="keywordtype">int</span> <a class="code" href="rpmpgp_8c.html#696af3338405a18d7ab5a148fe6f8d66" title="Print/parse an OpenPGP comment packet.">pgpPrtComment</a>(<a class="code" href="rpmpgp_8h.html#f814c5eae8f6dfbed984e367c6459043" title="4.3.">pgpTag</a> tag, <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *h, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hlen)
<a name="l00845"></a>00845 {
<a name="l00846"></a>00846     <span class="keywordtype">int</span> i = hlen;
<a name="l00847"></a>00847 
<a name="l00848"></a>00848     <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">""</span>, <a class="code" href="rpmpgp_8c.html#1df19d1753fb12d7f6c400039e0d897d">pgpTagTbl</a>, tag);
<a name="l00849"></a>00849     <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>)
<a name="l00850"></a>00850         fprintf(stderr, <span class="stringliteral">" "</span>);
<a name="l00851"></a>00851     <span class="keywordflow">while</span> (i &gt; 0) {
<a name="l00852"></a>00852         <span class="keywordtype">int</span> j;
<a name="l00853"></a>00853         <span class="keywordflow">if</span> (*h &gt;= <span class="charliteral">' '</span> &amp;&amp; *h &lt;= <span class="charliteral">'z'</span>) {
<a name="l00854"></a>00854             <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a>)
<a name="l00855"></a>00855                 fprintf(stderr, <span class="stringliteral">"%s"</span>, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)h);
<a name="l00856"></a>00856             j = strlen(h);
<a name="l00857"></a>00857             <span class="keywordflow">while</span> (h[j] == <span class="charliteral">'\0'</span>)
<a name="l00858"></a>00858                 j++;
<a name="l00859"></a>00859         } <span class="keywordflow">else</span> {
<a name="l00860"></a>00860             <a class="code" href="rpmpgp_8c.html#22816bc06ecdf64e79a307008b9ab097">pgpPrtHex</a>(<span class="stringliteral">""</span>, h, i);
<a name="l00861"></a>00861             j = i;
<a name="l00862"></a>00862         }
<a name="l00863"></a>00863         i -= j;
<a name="l00864"></a>00864         h += j;
<a name="l00865"></a>00865     }
<a name="l00866"></a>00866     <a class="code" href="rpmpgp_8c.html#fcdfe6a1d333b1904202d685c4ccc345">pgpPrtNL</a>();
<a name="l00867"></a>00867     <span class="keywordflow">return</span> 0;
<a name="l00868"></a>00868 }
<a name="l00869"></a>00869 
<a name="l00870"></a><a class="code" href="rpmpgp_8h.html#bbb8031b2dd728dfda33eec048b58eb1">00870</a> <span class="keywordtype">int</span> <a class="code" href="rpmpgp_8c.html#bbb8031b2dd728dfda33eec048b58eb1" title="Calculate OpenPGP public key fingerprint.">pgpPubkeyFingerprint</a>(<span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> * pkt, <span class="comment">/*@unused@*/</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pktlen,
<a name="l00871"></a>00871                 <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> * keyid)
<a name="l00872"></a>00872 {
<a name="l00873"></a>00873     <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *s = pkt;
<a name="l00874"></a>00874     <a class="code" href="structDIGEST__CTX__s.html" title="MD5/SHA1 digest private data.">DIGEST_CTX</a> ctx;
<a name="l00875"></a>00875     <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> version;
<a name="l00876"></a>00876     <span class="keywordtype">int</span> rc = -1;        <span class="comment">/* assume failure. */</span>
<a name="l00877"></a>00877 
<a name="l00878"></a>00878     <span class="keywordflow">if</span> (pkt[0] != 0x99)
<a name="l00879"></a>00879         <span class="keywordflow">return</span> rc;
<a name="l00880"></a>00880     version = pkt[3];
<a name="l00881"></a>00881 
<a name="l00882"></a>00882     <span class="keywordflow">switch</span> (version) {
<a name="l00883"></a>00883     <span class="keywordflow">case</span> 3:
<a name="l00884"></a>00884       { <a class="code" href="structpgpPktKeyV3__s.html" title="5.5.1.">pgpPktKeyV3</a> v = (<a class="code" href="structpgpPktKeyV3__s.html" title="5.5.1.">pgpPktKeyV3</a>) (pkt + 3);
<a name="l00885"></a>00885 
<a name="l00886"></a>00886         s += <span class="keyword">sizeof</span>(pkt[0]) + <span class="keyword">sizeof</span>(pkt[1]) + <span class="keyword">sizeof</span>(pkt[2]) + <span class="keyword">sizeof</span>(*v);
<a name="l00887"></a>00887         <span class="keywordflow">switch</span> (v-&gt;pubkey_algo) {
<a name="l00888"></a>00888         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#ff2fe1c7e6a7056de3b2fe65f9a0c7df1e566f354567b4ea9934a2c34a831abc">PGPPUBKEYALGO_RSA</a>:
<a name="l00889"></a>00889             s += (<a class="code" href="rpmpgp_8h.html#46e1a524178bdb4a3564caf5ad52424d" title="Return no.">pgpMpiLen</a>(s) - 8);
<a name="l00890"></a>00890 <span class="comment">/*@-boundswrite@*/</span>
<a name="l00891"></a>00891             memmove(keyid, s, 8);
<a name="l00892"></a>00892 <span class="comment">/*@=boundswrite@*/</span>
<a name="l00893"></a>00893             rc = 0;
<a name="l00894"></a>00894             <span class="comment">/*@innerbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00895"></a>00895         <span class="keywordflow">default</span>:        <span class="comment">/* TODO: md5 of mpi bodies (i.e. no length) */</span>
<a name="l00896"></a>00896             <span class="comment">/*@innerbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00897"></a>00897         }
<a name="l00898"></a>00898       } <span class="keywordflow">break</span>;
<a name="l00899"></a>00899     <span class="keywordflow">case</span> 4:
<a name="l00900"></a>00900       { <a class="code" href="structpgpPktKeyV4__s.html" title="The version 4 format is similar to the version 3 format except for the absence of...">pgpPktKeyV4</a> v = (<a class="code" href="structpgpPktKeyV4__s.html" title="The version 4 format is similar to the version 3 format except for the absence of...">pgpPktKeyV4</a>) (pkt + 3);
<a name="l00901"></a>00901         <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> * SHA1 = NULL;
<a name="l00902"></a>00902         <span class="keywordtype">int</span> i;
<a name="l00903"></a>00903 
<a name="l00904"></a>00904         s += <span class="keyword">sizeof</span>(pkt[0]) + <span class="keyword">sizeof</span>(pkt[1]) + <span class="keyword">sizeof</span>(pkt[2]) + <span class="keyword">sizeof</span>(*v);
<a name="l00905"></a>00905         <span class="keywordflow">switch</span> (v-&gt;pubkey_algo) {
<a name="l00906"></a>00906         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#ff2fe1c7e6a7056de3b2fe65f9a0c7df1e566f354567b4ea9934a2c34a831abc">PGPPUBKEYALGO_RSA</a>:
<a name="l00907"></a>00907             <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++)
<a name="l00908"></a>00908                 s += <a class="code" href="rpmpgp_8h.html#46e1a524178bdb4a3564caf5ad52424d" title="Return no.">pgpMpiLen</a>(s);
<a name="l00909"></a>00909             <span class="comment">/*@innerbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00910"></a>00910         <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#ff2fe1c7e6a7056de3b2fe65f9a0c7df0f7e95526c0f4c5023734df9cd895d73">PGPPUBKEYALGO_DSA</a>:
<a name="l00911"></a>00911             <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++)
<a name="l00912"></a>00912                 s += <a class="code" href="rpmpgp_8h.html#46e1a524178bdb4a3564caf5ad52424d" title="Return no.">pgpMpiLen</a>(s);
<a name="l00913"></a>00913             <span class="comment">/*@innerbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00914"></a>00914         }
<a name="l00915"></a>00915 
<a name="l00916"></a>00916         ctx = <a class="code" href="group__rpmio.html#g1bf3358eacb67980206c555665c1882e" title="Initialize digest.">rpmDigestInit</a>(<a class="code" href="rpmpgp_8h.html#62b36a3001a9d3870d1fd637a9e355d710b23bd7fa0d33da7662fa85fa38887e">PGPHASHALGO_SHA1</a>, <a class="code" href="group__rpmio.html#ggbb11b2c3a26633bdb882c7c7f3093f3f5032ccccb0a608673cad27f20318b815">RPMDIGEST_NONE</a>);
<a name="l00917"></a>00917         (void) <a class="code" href="group__rpmio.html#g1fdf08b78d0473f033f9a4348be66d7a" title="Update context with next plain text buffer.">rpmDigestUpdate</a>(ctx, pkt, (s-pkt));
<a name="l00918"></a>00918         (void) <a class="code" href="group__rpmio.html#g13dcad611d1f0c8d57f8464ccff955f6" title="Return digest and destroy context.">rpmDigestFinal</a>(ctx, (<span class="keywordtype">void</span> **)&amp;SHA1, NULL, 0);
<a name="l00919"></a>00919 
<a name="l00920"></a>00920         s = SHA1 + 12;
<a name="l00921"></a>00921 <span class="comment">/*@-boundswrite@*/</span>
<a name="l00922"></a>00922         memmove(keyid, s, 8);
<a name="l00923"></a>00923 <span class="comment">/*@=boundswrite@*/</span>
<a name="l00924"></a>00924         rc = 0;
<a name="l00925"></a>00925 
<a name="l00926"></a>00926         <span class="keywordflow">if</span> (SHA1) free(SHA1);
<a name="l00927"></a>00927       } <span class="keywordflow">break</span>;
<a name="l00928"></a>00928     }
<a name="l00929"></a>00929     <span class="keywordflow">return</span> rc;
<a name="l00930"></a>00930 }
<a name="l00931"></a>00931 
<a name="l00932"></a><a class="code" href="rpmpgp_8h.html#2ccd2a916089ae974e4fb67ec6b750c6">00932</a> <span class="keywordtype">int</span> <a class="code" href="rpmpgp_8c.html#2ccd2a916089ae974e4fb67ec6b750c6" title="Print/parse next OpenPGP packet.">pgpPrtPkt</a>(<span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *pkt, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pleft)
<a name="l00933"></a>00933 {
<a name="l00934"></a>00934     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structpgpValTbl__s.html#5781d8878d6c2d0e0e183277e1a6c5fa">val</a> = *pkt;
<a name="l00935"></a>00935     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pktlen;
<a name="l00936"></a>00936     <a class="code" href="rpmpgp_8h.html#f814c5eae8f6dfbed984e367c6459043" title="4.3.">pgpTag</a> tag;
<a name="l00937"></a>00937     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> plen;
<a name="l00938"></a>00938     <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *h;
<a name="l00939"></a>00939     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hlen = 0;
<a name="l00940"></a>00940     <span class="keywordtype">int</span> rc = 0;
<a name="l00941"></a>00941 
<a name="l00942"></a>00942     <span class="comment">/* XXX can't deal with these. */</span>
<a name="l00943"></a>00943     <span class="keywordflow">if</span> (!(val &amp; 0x80))
<a name="l00944"></a>00944         <span class="keywordflow">return</span> -1;
<a name="l00945"></a>00945 
<a name="l00946"></a>00946     <span class="keywordflow">if</span> (val &amp; 0x40) {
<a name="l00947"></a>00947         tag = (val &amp; 0x3f);
<a name="l00948"></a>00948         plen = <a class="code" href="rpmpgp_8h.html#8647e2cc029df21936e782eb71f2b474" title="Return length of an OpenPGP packet.">pgpLen</a>(pkt+1, &amp;hlen);
<a name="l00949"></a>00949     } <span class="keywordflow">else</span> {
<a name="l00950"></a>00950         tag = (val &gt;&gt; 2) &amp; 0xf;
<a name="l00951"></a>00951         plen = (1 &lt;&lt; (val &amp; 0x3));
<a name="l00952"></a>00952         hlen = <a class="code" href="rpmpgp_8h.html#86d21d8e18146a24c553685163fce60e" title="Return (native-endian) integer from big-endian representation.">pgpGrab</a>(pkt+1, plen);
<a name="l00953"></a>00953     }
<a name="l00954"></a>00954 
<a name="l00955"></a>00955     pktlen = 1 + plen + hlen;
<a name="l00956"></a>00956     <span class="keywordflow">if</span> (pktlen &gt; pleft)
<a name="l00957"></a>00957         <span class="keywordflow">return</span> -1;
<a name="l00958"></a>00958 
<a name="l00959"></a>00959     h = pkt + 1 + plen;
<a name="l00960"></a>00960     <span class="keywordflow">switch</span> (tag) {
<a name="l00961"></a>00961     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebee217c5ebf1b396a6eda48d8f4b874012">PGPTAG_SIGNATURE</a>:
<a name="l00962"></a>00962         rc = <a class="code" href="rpmpgp_8c.html#e85be6aa03dbff9db549645fcc8b60c9" title="Print/parse an OpenPGP signature packet.">pgpPrtSig</a>(tag, h, hlen);
<a name="l00963"></a>00963         <span class="keywordflow">break</span>;
<a name="l00964"></a>00964     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebeef47643cfdc941fb40a2cdc49c5e05a5">PGPTAG_PUBLIC_KEY</a>:
<a name="l00965"></a>00965         <span class="comment">/* Get the public key fingerprint. */</span>
<a name="l00966"></a>00966         <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>) {
<a name="l00967"></a>00967 <span class="comment">/*@-mods@*/</span>
<a name="l00968"></a>00968             <span class="keywordflow">if</span> (!<a class="code" href="rpmpgp_8c.html#bbb8031b2dd728dfda33eec048b58eb1" title="Calculate OpenPGP public key fingerprint.">pgpPubkeyFingerprint</a>(pkt, pktlen, <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#a8a9b1747151f106cc7bf63ca4599ed8">signid</a>))
<a name="l00969"></a>00969                 <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#7a5e064c6e17202ef647472b90ccd2b2">saved</a> |= <a class="code" href="rpmio__internal_8h.html#660ba5c27429b2ab6addf65dcbbb7069">PGPDIG_SAVED_ID</a>;
<a name="l00970"></a>00970             <span class="keywordflow">else</span>
<a name="l00971"></a>00971                 memset(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#a8a9b1747151f106cc7bf63ca4599ed8">signid</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#a8a9b1747151f106cc7bf63ca4599ed8">signid</a>));
<a name="l00972"></a>00972 <span class="comment">/*@=mods@*/</span>
<a name="l00973"></a>00973         }
<a name="l00974"></a>00974         <span class="comment">/*@fallthrough@*/</span>
<a name="l00975"></a>00975     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe5ed10139124c4a2e7ae9f1232280ebc0">PGPTAG_PUBLIC_SUBKEY</a>:
<a name="l00976"></a>00976         rc = <a class="code" href="rpmpgp_8c.html#c3437902c44a6bf7f098b6342d6732f2" title="Print/parse an OpenPGP key packet.">pgpPrtKey</a>(tag, h, hlen);
<a name="l00977"></a>00977         <span class="keywordflow">break</span>;
<a name="l00978"></a>00978     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe7e729ee4f694870c88c8c2f58ea34b6d">PGPTAG_SECRET_KEY</a>:
<a name="l00979"></a>00979     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebeb9f6bb6dbfee5afd75a28e318a8b28b0">PGPTAG_SECRET_SUBKEY</a>:
<a name="l00980"></a>00980         rc = <a class="code" href="rpmpgp_8c.html#c3437902c44a6bf7f098b6342d6732f2" title="Print/parse an OpenPGP key packet.">pgpPrtKey</a>(tag, h, hlen);
<a name="l00981"></a>00981         <span class="keywordflow">break</span>;
<a name="l00982"></a>00982     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe588cd31869c6ea499819aaf52bbca9a9">PGPTAG_USER_ID</a>:
<a name="l00983"></a>00983         rc = <a class="code" href="rpmpgp_8c.html#ddd2a128427d7c982bdb9046920d4a70" title="Print/parse an OpenPGP userid packet.">pgpPrtUserID</a>(tag, h, hlen);
<a name="l00984"></a>00984         <span class="keywordflow">break</span>;
<a name="l00985"></a>00985     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebeeaca21d02de598f3fbe3a49eb8b94476">PGPTAG_COMMENT</a>:
<a name="l00986"></a>00986     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebee012a0516347afa1a073c14be7834cc7">PGPTAG_COMMENT_OLD</a>:
<a name="l00987"></a>00987         rc = <a class="code" href="rpmpgp_8c.html#696af3338405a18d7ab5a148fe6f8d66" title="Print/parse an OpenPGP comment packet.">pgpPrtComment</a>(tag, h, hlen);
<a name="l00988"></a>00988         <span class="keywordflow">break</span>;
<a name="l00989"></a>00989 
<a name="l00990"></a>00990     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe083c6b2f3efc717a08598eec74ea35f5">PGPTAG_RESERVED</a>:
<a name="l00991"></a>00991     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe739b2456d2549f25555ba686e4197ffe">PGPTAG_PUBLIC_SESSION_KEY</a>:
<a name="l00992"></a>00992     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebec1fd63462d744e57de041b127d443bca">PGPTAG_SYMMETRIC_SESSION_KEY</a>:
<a name="l00993"></a>00993     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe894601f6a407f43b55c4e21454049b9d">PGPTAG_COMPRESSED_DATA</a>:
<a name="l00994"></a>00994     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe39d8b2ad57256acbe2f92575c1d1c714">PGPTAG_SYMMETRIC_DATA</a>:
<a name="l00995"></a>00995     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe5f6dec440fa74b53a2e85030419cd9eb">PGPTAG_MARKER</a>:
<a name="l00996"></a>00996     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebec21c71df99b6a6a7d635af127425d1cf">PGPTAG_LITERAL_DATA</a>:
<a name="l00997"></a>00997     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe492adfb43a819e734807dadc5e9a7955">PGPTAG_TRUST</a>:
<a name="l00998"></a>00998     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe339ba0ca41101e113b6712cce2a58b68">PGPTAG_PHOTOID</a>:
<a name="l00999"></a>00999     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebeeb9b576d7e51a8fe73efd7b0b58a8f6c">PGPTAG_ENCRYPTED_MDC</a>:
<a name="l01000"></a>01000     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe1d100c2c0cc0bb768805ab45582129be">PGPTAG_MDC</a>:
<a name="l01001"></a>01001     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebeec67fc33ca752d745fb33b5d2368b9d4">PGPTAG_PRIVATE_60</a>:
<a name="l01002"></a>01002     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebe86065449feb947b55f38d1a76f346160">PGPTAG_PRIVATE_62</a>:
<a name="l01003"></a>01003     <span class="keywordflow">case</span> <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebefb374a6ef8ad6a7491e5753fcd66f712">PGPTAG_CONTROL</a>:
<a name="l01004"></a>01004     <span class="keywordflow">default</span>:
<a name="l01005"></a>01005         <a class="code" href="rpmpgp_8c.html#f04278c2fd10f99efe6210d94283e4aa" title="Print an OpenPGP value.">pgpPrtVal</a>(<span class="stringliteral">""</span>, <a class="code" href="rpmpgp_8c.html#1df19d1753fb12d7f6c400039e0d897d">pgpTagTbl</a>, tag);
<a name="l01006"></a>01006         <a class="code" href="rpmpgp_8c.html#22816bc06ecdf64e79a307008b9ab097">pgpPrtHex</a>(<span class="stringliteral">""</span>, h, hlen);
<a name="l01007"></a>01007         <a class="code" href="rpmpgp_8c.html#fcdfe6a1d333b1904202d685c4ccc345">pgpPrtNL</a>();
<a name="l01008"></a>01008         <span class="keywordflow">break</span>;
<a name="l01009"></a>01009     }
<a name="l01010"></a>01010 
<a name="l01011"></a>01011     <span class="keywordflow">return</span> (rc ? -1 : pktlen);
<a name="l01012"></a>01012 }
<a name="l01013"></a>01013 
<a name="l01014"></a><a class="code" href="rpmpgp_8h.html#45e588be8af4bc3dac66b766850d51e6">01014</a> <a class="code" href="structpgpDig__s.html" title="Container for values parsed from an OpenPGP signature and public key.">pgpDig</a> <a class="code" href="rpmpgp_8c.html#45e588be8af4bc3dac66b766850d51e6" title="Create a container for parsed OpenPGP packates.">pgpNewDig</a>(<span class="keywordtype">void</span>)
<a name="l01015"></a>01015 {
<a name="l01016"></a>01016     <a class="code" href="structpgpDig__s.html" title="Container for values parsed from an OpenPGP signature and public key.">pgpDig</a> dig = <a class="code" href="system_8h.html#9533f3165c8a4af7283dce262b32989f">xcalloc</a>(1, <span class="keyword">sizeof</span>(*dig));
<a name="l01017"></a>01017     <span class="keywordflow">return</span> dig;
<a name="l01018"></a>01018 }
<a name="l01019"></a>01019 
<a name="l01020"></a>01020 <span class="comment">/*@-boundswrite@*/</span>
<a name="l01021"></a><a class="code" href="rpmpgp_8h.html#2e98d445cb908ce2901b7dcf106639dd">01021</a> <span class="keywordtype">void</span> <a class="code" href="rpmpgp_8c.html#2e98d445cb908ce2901b7dcf106639dd" title="Release (malloc'd) data from container.">pgpCleanDig</a>(<a class="code" href="structpgpDig__s.html" title="Container for values parsed from an OpenPGP signature and public key.">pgpDig</a> dig)
<a name="l01022"></a>01022 {
<a name="l01023"></a>01023     <span class="keywordflow">if</span> (dig != NULL) {
<a name="l01024"></a>01024         <span class="keywordtype">int</span> i;
<a name="l01025"></a>01025         dig-&gt;<a class="code" href="structpgpDig__s.html#3dd633e4c6988f15732501c182c79e7b">signature</a>.<a class="code" href="structpgpDigParams__s.html#8817e1e2ff2c3745ee3b36ee2148ae87">userid</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(dig-&gt;<a class="code" href="structpgpDig__s.html#3dd633e4c6988f15732501c182c79e7b">signature</a>.<a class="code" href="structpgpDigParams__s.html#8817e1e2ff2c3745ee3b36ee2148ae87">userid</a>);
<a name="l01026"></a>01026         dig-&gt;<a class="code" href="structpgpDig__s.html#c41eb821e854446e2269491f750fcd97">pubkey</a>.<a class="code" href="structpgpDigParams__s.html#8817e1e2ff2c3745ee3b36ee2148ae87">userid</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(dig-&gt;<a class="code" href="structpgpDig__s.html#c41eb821e854446e2269491f750fcd97">pubkey</a>.<a class="code" href="structpgpDigParams__s.html#8817e1e2ff2c3745ee3b36ee2148ae87">userid</a>);
<a name="l01027"></a>01027         dig-&gt;<a class="code" href="structpgpDig__s.html#3dd633e4c6988f15732501c182c79e7b">signature</a>.<a class="code" href="structpgpDigParams__s.html#14b94e2e2363607c4723624b91e69b46">hash</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(dig-&gt;<a class="code" href="structpgpDig__s.html#3dd633e4c6988f15732501c182c79e7b">signature</a>.<a class="code" href="structpgpDigParams__s.html#14b94e2e2363607c4723624b91e69b46">hash</a>);
<a name="l01028"></a>01028         dig-&gt;<a class="code" href="structpgpDig__s.html#c41eb821e854446e2269491f750fcd97">pubkey</a>.<a class="code" href="structpgpDigParams__s.html#14b94e2e2363607c4723624b91e69b46">hash</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(dig-&gt;<a class="code" href="structpgpDig__s.html#c41eb821e854446e2269491f750fcd97">pubkey</a>.<a class="code" href="structpgpDigParams__s.html#14b94e2e2363607c4723624b91e69b46">hash</a>);
<a name="l01029"></a>01029         <span class="comment">/*@-unqualifiedtrans@*/</span> <span class="comment">/* FIX: double indirection */</span>
<a name="l01030"></a>01030         <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++) {
<a name="l01031"></a>01031             dig-&gt;<a class="code" href="structpgpDig__s.html#3dd633e4c6988f15732501c182c79e7b">signature</a>.<a class="code" href="structpgpDigParams__s.html#a827de94b74694cbafa90fb58056c92c">params</a>[i] = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(dig-&gt;<a class="code" href="structpgpDig__s.html#3dd633e4c6988f15732501c182c79e7b">signature</a>.<a class="code" href="structpgpDigParams__s.html#a827de94b74694cbafa90fb58056c92c">params</a>[i]);
<a name="l01032"></a>01032             dig-&gt;<a class="code" href="structpgpDig__s.html#c41eb821e854446e2269491f750fcd97">pubkey</a>.<a class="code" href="structpgpDigParams__s.html#a827de94b74694cbafa90fb58056c92c">params</a>[i] = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(dig-&gt;<a class="code" href="structpgpDig__s.html#c41eb821e854446e2269491f750fcd97">pubkey</a>.<a class="code" href="structpgpDigParams__s.html#a827de94b74694cbafa90fb58056c92c">params</a>[i]);
<a name="l01033"></a>01033         }
<a name="l01034"></a>01034         <span class="comment">/*@=unqualifiedtrans@*/</span>
<a name="l01035"></a>01035 
<a name="l01036"></a>01036         memset(&amp;dig-&gt;<a class="code" href="structpgpDig__s.html#3dd633e4c6988f15732501c182c79e7b">signature</a>, 0, <span class="keyword">sizeof</span>(dig-&gt;<a class="code" href="structpgpDig__s.html#3dd633e4c6988f15732501c182c79e7b">signature</a>));
<a name="l01037"></a>01037         memset(&amp;dig-&gt;<a class="code" href="structpgpDig__s.html#c41eb821e854446e2269491f750fcd97">pubkey</a>, 0, <span class="keyword">sizeof</span>(dig-&gt;<a class="code" href="structpgpDig__s.html#c41eb821e854446e2269491f750fcd97">pubkey</a>));
<a name="l01038"></a>01038 
<a name="l01039"></a>01039         dig-&gt;<a class="code" href="structpgpDig__s.html#38fe5f82da7763486fe18c717cc81c0b">md5</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(dig-&gt;<a class="code" href="structpgpDig__s.html#38fe5f82da7763486fe18c717cc81c0b">md5</a>);
<a name="l01040"></a>01040         dig-&gt;<a class="code" href="structpgpDig__s.html#54f580eb91f745a11138b48c4e246c14">sha1</a> = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(dig-&gt;<a class="code" href="structpgpDig__s.html#54f580eb91f745a11138b48c4e246c14">sha1</a>);
<a name="l01041"></a>01041         mpnfree(&amp;dig-&gt;<a class="code" href="structpgpDig__s.html#478486f41ce5c4a83a275adca6fed25a">hm</a>);
<a name="l01042"></a>01042         mpnfree(&amp;dig-&gt;<a class="code" href="structpgpDig__s.html#251f81407b9982712e79cd1b1a2f46e1">r</a>);
<a name="l01043"></a>01043         mpnfree(&amp;dig-&gt;<a class="code" href="structpgpDig__s.html#8ef80b38c8586a5251b3601fe1d9b8d7">s</a>);
<a name="l01044"></a>01044 
<a name="l01045"></a>01045         (void) rsapkFree(&amp;dig-&gt;<a class="code" href="structpgpDig__s.html#067b82c1cd41efa554c0e4d01f776d68">rsa_pk</a>);
<a name="l01046"></a>01046         mpnfree(&amp;dig-&gt;<a class="code" href="structpgpDig__s.html#1f3bc8511b7ce2f00ac405db79697db2">m</a>);
<a name="l01047"></a>01047         mpnfree(&amp;dig-&gt;<a class="code" href="structpgpDig__s.html#eec8aad2ed9881a823a8ff656af9776d">c</a>);
<a name="l01048"></a>01048         mpnfree(&amp;dig-&gt;<a class="code" href="structpgpDig__s.html#db6cf11fc76265f51b96b5b40c2e7964">rsahm</a>);
<a name="l01049"></a>01049     }
<a name="l01050"></a>01050 <span class="comment">/*@-nullstate@*/</span>
<a name="l01051"></a>01051     <span class="keywordflow">return</span>;
<a name="l01052"></a>01052 <span class="comment">/*@=nullstate@*/</span>
<a name="l01053"></a>01053 }
<a name="l01054"></a>01054 <span class="comment">/*@=boundswrite@*/</span>
<a name="l01055"></a>01055 
<a name="l01056"></a><a class="code" href="rpmpgp_8h.html#d282a2b6c85c64000bba63e64f906b5e">01056</a> <a class="code" href="structpgpDig__s.html" title="Container for values parsed from an OpenPGP signature and public key.">pgpDig</a> <a class="code" href="rpmpgp_8c.html#d282a2b6c85c64000bba63e64f906b5e" title="Destroy a container for parsed OpenPGP packates.">pgpFreeDig</a>(<span class="comment">/*@only@*/</span> <span class="comment">/*@null@*/</span> <a class="code" href="structpgpDig__s.html" title="Container for values parsed from an OpenPGP signature and public key.">pgpDig</a> dig)
<a name="l01057"></a>01057         <span class="comment">/*@modifies dig @*/</span>
<a name="l01058"></a>01058 {
<a name="l01059"></a>01059     <span class="keywordflow">if</span> (dig != NULL) {
<a name="l01060"></a>01060 
<a name="l01061"></a>01061         <span class="comment">/* DUmp the signature/pubkey data. */</span>
<a name="l01062"></a>01062         <a class="code" href="rpmpgp_8c.html#2e98d445cb908ce2901b7dcf106639dd" title="Release (malloc'd) data from container.">pgpCleanDig</a>(dig);
<a name="l01063"></a>01063 
<a name="l01064"></a>01064         <span class="comment">/*@-branchstate@*/</span>
<a name="l01065"></a>01065         <span class="keywordflow">if</span> (dig-&gt;hdrsha1ctx != NULL)
<a name="l01066"></a>01066             (void) <a class="code" href="group__rpmio.html#g13dcad611d1f0c8d57f8464ccff955f6" title="Return digest and destroy context.">rpmDigestFinal</a>(dig-&gt;hdrsha1ctx, NULL, NULL, 0);
<a name="l01067"></a>01067         <span class="comment">/*@=branchstate@*/</span>
<a name="l01068"></a>01068         dig-&gt;hdrsha1ctx = NULL;
<a name="l01069"></a>01069 
<a name="l01070"></a>01070         <span class="comment">/*@-branchstate@*/</span>
<a name="l01071"></a>01071         <span class="keywordflow">if</span> (dig-&gt;sha1ctx != NULL)
<a name="l01072"></a>01072             (void) <a class="code" href="group__rpmio.html#g13dcad611d1f0c8d57f8464ccff955f6" title="Return digest and destroy context.">rpmDigestFinal</a>(dig-&gt;sha1ctx, NULL, NULL, 0);
<a name="l01073"></a>01073         <span class="comment">/*@=branchstate@*/</span>
<a name="l01074"></a>01074         dig-&gt;sha1ctx = NULL;
<a name="l01075"></a>01075 
<a name="l01076"></a>01076         mpbfree(&amp;dig-&gt;p);
<a name="l01077"></a>01077         mpbfree(&amp;dig-&gt;q);
<a name="l01078"></a>01078         mpnfree(&amp;dig-&gt;g);
<a name="l01079"></a>01079         mpnfree(&amp;dig-&gt;y);
<a name="l01080"></a>01080         mpnfree(&amp;dig-&gt;hm);
<a name="l01081"></a>01081         mpnfree(&amp;dig-&gt;r);
<a name="l01082"></a>01082         mpnfree(&amp;dig-&gt;s);
<a name="l01083"></a>01083 
<a name="l01084"></a>01084 <span class="preprocessor">#ifdef  NOTYET</span>
<a name="l01085"></a>01085 <span class="preprocessor"></span>        <span class="comment">/*@-branchstate@*/</span>
<a name="l01086"></a>01086         <span class="keywordflow">if</span> (dig-&gt;hdrmd5ctx != NULL)
<a name="l01087"></a>01087             (void) <a class="code" href="group__rpmio.html#g13dcad611d1f0c8d57f8464ccff955f6" title="Return digest and destroy context.">rpmDigestFinal</a>(dig-&gt;hdrmd5ctx, NULL, NULL, 0);
<a name="l01088"></a>01088         <span class="comment">/*@=branchstate@*/</span>
<a name="l01089"></a>01089         dig-&gt;hdrmd5ctx = NULL;
<a name="l01090"></a>01090 <span class="preprocessor">#endif</span>
<a name="l01091"></a>01091 <span class="preprocessor"></span>
<a name="l01092"></a>01092         <span class="comment">/*@-branchstate@*/</span>
<a name="l01093"></a>01093         <span class="keywordflow">if</span> (dig-&gt;md5ctx != NULL)
<a name="l01094"></a>01094             (void) <a class="code" href="group__rpmio.html#g13dcad611d1f0c8d57f8464ccff955f6" title="Return digest and destroy context.">rpmDigestFinal</a>(dig-&gt;md5ctx, NULL, NULL, 0);
<a name="l01095"></a>01095         <span class="comment">/*@=branchstate@*/</span>
<a name="l01096"></a>01096         dig-&gt;md5ctx = NULL;
<a name="l01097"></a>01097 
<a name="l01098"></a>01098         mpbfree(&amp;dig-&gt;rsa_pk.n);
<a name="l01099"></a>01099         mpnfree(&amp;dig-&gt;rsa_pk.e);
<a name="l01100"></a>01100         mpnfree(&amp;dig-&gt;m);
<a name="l01101"></a>01101         mpnfree(&amp;dig-&gt;c);
<a name="l01102"></a>01102         mpnfree(&amp;dig-&gt;hm);
<a name="l01103"></a>01103 
<a name="l01104"></a>01104         dig = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(dig);
<a name="l01105"></a>01105     }
<a name="l01106"></a>01106     <span class="keywordflow">return</span> dig;
<a name="l01107"></a>01107 }
<a name="l01108"></a>01108 
<a name="l01109"></a><a class="code" href="rpmpgp_8h.html#69cfb7ce122edf7a6531787103ea4532">01109</a> <span class="keywordtype">int</span> <a class="code" href="rpmpgp_8c.html#69cfb7ce122edf7a6531787103ea4532" title="Print/parse a OpenPGP packet(s).">pgpPrtPkts</a>(<span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> * pkts, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pktlen, <a class="code" href="structpgpDig__s.html" title="Container for values parsed from an OpenPGP signature and public key.">pgpDig</a> dig, <span class="keywordtype">int</span> printing)
<a name="l01110"></a>01110         <span class="comment">/*@globals _dig, _digp, _print @*/</span>
<a name="l01111"></a>01111         <span class="comment">/*@modifies _dig, _digp, *_digp, _print @*/</span>
<a name="l01112"></a>01112 {
<a name="l01113"></a>01113     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structpgpValTbl__s.html#5781d8878d6c2d0e0e183277e1a6c5fa">val</a> = *pkts;
<a name="l01114"></a>01114     <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> *p;
<a name="l01115"></a>01115     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pleft;
<a name="l01116"></a>01116     <span class="keywordtype">int</span> len;
<a name="l01117"></a>01117 
<a name="l01118"></a>01118     <a class="code" href="rpmpgp_8c.html#0d961e17604ae6ca076de50307b5f57f">_print</a> = printing;
<a name="l01119"></a>01119     <a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a> = dig;
<a name="l01120"></a>01120     <span class="keywordflow">if</span> (dig != NULL &amp;&amp; (val &amp; 0x80)) {
<a name="l01121"></a>01121         <a class="code" href="rpmpgp_8h.html#f814c5eae8f6dfbed984e367c6459043" title="4.3.">pgpTag</a> tag = (val &amp; 0x40) ? (val &amp; 0x3f) : ((val &gt;&gt; 2) &amp; 0xf);
<a name="l01122"></a>01122         <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a> = (tag == <a class="code" href="rpmpgp_8h.html#a4a5221a21016c5af4d4ac0687d38ebee217c5ebf1b396a6eda48d8f4b874012">PGPTAG_SIGNATURE</a>) ? &amp;<a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#3dd633e4c6988f15732501c182c79e7b">signature</a> : &amp;<a class="code" href="rpmpgp_8c.html#6d1445695476a88f95dbadc9fa2027ca">_dig</a>-&gt;<a class="code" href="structpgpDig__s.html#c41eb821e854446e2269491f750fcd97">pubkey</a>;
<a name="l01123"></a>01123         <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a>-&gt;<a class="code" href="structpgpDigParams__s.html#16d66e3965da4f729217e1660a9958de">tag</a> = tag;
<a name="l01124"></a>01124     } <span class="keywordflow">else</span>
<a name="l01125"></a>01125         <a class="code" href="rpmpgp_8c.html#0731916fe97abb54601bbaffdb3f3498">_digp</a> = NULL;
<a name="l01126"></a>01126 
<a name="l01127"></a>01127     <span class="keywordflow">for</span> (p = pkts, pleft = pktlen; p &lt; (pkts + pktlen); p += len, pleft -= len) {
<a name="l01128"></a>01128         len = <a class="code" href="rpmpgp_8c.html#2ccd2a916089ae974e4fb67ec6b750c6" title="Print/parse next OpenPGP packet.">pgpPrtPkt</a>(p, pleft);
<a name="l01129"></a>01129         <span class="keywordflow">if</span> (len &lt;= 0)
<a name="l01130"></a>01130             <span class="keywordflow">return</span> len;
<a name="l01131"></a>01131         <span class="keywordflow">if</span> (len &gt; pleft)        <span class="comment">/* XXX shouldn't happen */</span>
<a name="l01132"></a>01132             <span class="keywordflow">break</span>;
<a name="l01133"></a>01133     }
<a name="l01134"></a>01134     <span class="keywordflow">return</span> 0;
<a name="l01135"></a>01135 }
<a name="l01136"></a>01136 
<a name="l01137"></a>01137 <span class="comment">/*@-boundswrite@*/</span>
<a name="l01138"></a><a class="code" href="rpmpgp_8h.html#60420c9386efc7b04baeec5fac0b75d7">01138</a> <a class="code" href="rpmpgp_8h.html#53fa8021a24828fd636618b20528cea9">pgpArmor</a> <a class="code" href="rpmpgp_8c.html#60420c9386efc7b04baeec5fac0b75d7" title="Parse armored OpenPGP packets from a file.">pgpReadPkts</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * fn, <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> ** pkt, <span class="keywordtype">size_t</span> * pktlen)
<a name="l01139"></a>01139 {
<a name="l01140"></a>01140     <span class="keyword">const</span> <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> * b = NULL;
<a name="l01141"></a>01141     ssize_t blen;
<a name="l01142"></a>01142     <span class="keyword">const</span> <span class="keywordtype">char</span> * enc = NULL;
<a name="l01143"></a>01143     <span class="keyword">const</span> <span class="keywordtype">char</span> * crcenc = NULL;
<a name="l01144"></a>01144     <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> * dec;
<a name="l01145"></a>01145     <a class="code" href="rpmpgp_8h.html#ea185528b70b44efcecbc49855184018">byte</a> * crcdec;
<a name="l01146"></a>01146     <span class="keywordtype">size_t</span> declen;
<a name="l01147"></a>01147     <span class="keywordtype">size_t</span> crclen;
<a name="l01148"></a>01148     uint32_t crcpkt, crc;
<a name="l01149"></a>01149     <span class="keyword">const</span> <span class="keywordtype">char</span> * armortype = NULL;
<a name="l01150"></a>01150     <span class="keywordtype">char</span> * t, * te;
<a name="l01151"></a>01151     <span class="keywordtype">int</span> pstate = 0;
<a name="l01152"></a>01152     <a class="code" href="rpmpgp_8h.html#53fa8021a24828fd636618b20528cea9">pgpArmor</a> ec = <a class="code" href="rpmpgp_8h.html#8b921f71244ef324fd0e84fc2291007af5f259c48f730fdd4527b7cde3203365">PGPARMOR_ERR_NO_BEGIN_PGP</a>;    <span class="comment">/* XXX assume failure */</span>
<a name="l01153"></a>01153     <span class="keywordtype">int</span> rc;
<a name="l01154"></a>01154 
<a name="l01155"></a>01155     rc = <a class="code" href="rpmio_8c.html#a6d30e27618f54cd0651c57e40aab547" title="Read an entire file into a buffer.">rpmioSlurp</a>(fn, &amp;b, &amp;blen);
<a name="l01156"></a>01156     <span class="keywordflow">if</span> (rc || b == NULL || blen &lt;= 0) {
<a name="l01157"></a>01157         <span class="keywordflow">goto</span> exit;
<a name="l01158"></a>01158     }
<a name="l01159"></a>01159 
<a name="l01160"></a>01160     <span class="keywordflow">if</span> (<a class="code" href="rpmpgp_8h.html#f97878237c6503d436bb89a42e8b6528" title="Is buffer at beginning of an OpenPGP packet?">pgpIsPkt</a>(b)) {
<a name="l01161"></a>01161 <span class="preprocessor">#ifdef NOTYET   </span><span class="comment">/* XXX ASCII Pubkeys only, please. */</span>
<a name="l01162"></a>01162         ec = 0; <span class="comment">/* XXX fish out pkt type. */</span>
<a name="l01163"></a>01163 <span class="preprocessor">#endif</span>
<a name="l01164"></a>01164 <span class="preprocessor"></span>        <span class="keywordflow">goto</span> exit;
<a name="l01165"></a>01165     }
<a name="l01166"></a>01166 
<a name="l01167"></a>01167 <span class="preprocessor">#define TOKEQ(_s, _tok) (!strncmp((_s), (_tok), sizeof(_tok)-1))</span>
<a name="l01168"></a>01168 <span class="preprocessor"></span>
<a name="l01169"></a>01169     <span class="keywordflow">for</span> (t = (<span class="keywordtype">char</span> *)b; t &amp;&amp; *t; t = te) {
<a name="l01170"></a>01170         <span class="keywordflow">if</span> ((te = strchr(t, <span class="charliteral">'\n'</span>)) == NULL)
<a name="l01171"></a>01171             te = t + strlen(t);
<a name="l01172"></a>01172         <span class="keywordflow">else</span>
<a name="l01173"></a>01173             te++;
<a name="l01174"></a>01174 
<a name="l01175"></a>01175         <span class="keywordflow">switch</span> (pstate) {
<a name="l01176"></a>01176         <span class="keywordflow">case</span> 0:
<a name="l01177"></a>01177             armortype = NULL;
<a name="l01178"></a>01178             <span class="keywordflow">if</span> (!<a class="code" href="rpmpgp_8c.html#c0021971f7fdffaa47746d6851af0508">TOKEQ</a>(t, <span class="stringliteral">"-----BEGIN PGP "</span>))
<a name="l01179"></a>01179                 <span class="keywordflow">continue</span>;
<a name="l01180"></a>01180             t += <span class="keyword">sizeof</span>(<span class="stringliteral">"-----BEGIN PGP "</span>)-1;
<a name="l01181"></a>01181 
<a name="l01182"></a>01182             rc = <a class="code" href="rpmpgp_8h.html#51352046cadf731f15c67d8c12c104fd" title="Return value of an OpenPGP string.">pgpValTok</a>(<a class="code" href="rpmpgp_8c.html#a065c28e76b412c383b6932e09966f36" title="Armor (string, value) pairs.">pgpArmorTbl</a>, t, te);
<a name="l01183"></a>01183             <span class="keywordflow">if</span> (rc &lt; 0) {
<a name="l01184"></a>01184                 ec = <a class="code" href="rpmpgp_8h.html#8b921f71244ef324fd0e84fc2291007a54be6621409d378a77ae4f74416a4ff2">PGPARMOR_ERR_UNKNOWN_ARMOR_TYPE</a>;
<a name="l01185"></a>01185                 <span class="keywordflow">goto</span> exit;
<a name="l01186"></a>01186             }
<a name="l01187"></a>01187             <span class="keywordflow">if</span> (rc != <a class="code" href="rpmpgp_8h.html#8b921f71244ef324fd0e84fc2291007a76140d37cec0497e345db167f2f1d9df">PGPARMOR_PUBKEY</a>)  <span class="comment">/* XXX ASCII Pubkeys only, please. */</span>
<a name="l01188"></a>01188                 <span class="keywordflow">continue</span>;
<a name="l01189"></a>01189             armortype = t;
<a name="l01190"></a>01190 
<a name="l01191"></a>01191             t = te - (<span class="keyword">sizeof</span>(<span class="stringliteral">"-----\n"</span>)-1);
<a name="l01192"></a>01192             <span class="keywordflow">if</span> (!<a class="code" href="rpmpgp_8c.html#c0021971f7fdffaa47746d6851af0508">TOKEQ</a>(t, <span class="stringliteral">"-----\n"</span>))
<a name="l01193"></a>01193                 <span class="keywordflow">continue</span>;
<a name="l01194"></a>01194             *t = <span class="charliteral">'\0'</span>;
<a name="l01195"></a>01195             pstate++;
<a name="l01196"></a>01196             <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l01197"></a>01197         <span class="keywordflow">case</span> 1:
<a name="l01198"></a>01198             enc = NULL;
<a name="l01199"></a>01199             rc = <a class="code" href="rpmpgp_8h.html#51352046cadf731f15c67d8c12c104fd" title="Return value of an OpenPGP string.">pgpValTok</a>(<a class="code" href="rpmpgp_8c.html#6336e71fffea77ecde1a1cc0284494d8" title="Armor key (string, value) pairs.">pgpArmorKeyTbl</a>, t, te);
<a name="l01200"></a>01200             <span class="keywordflow">if</span> (rc &gt;= 0)
<a name="l01201"></a>01201                 <span class="keywordflow">continue</span>;
<a name="l01202"></a>01202             <span class="keywordflow">if</span> (*t != <span class="charliteral">'\n'</span>) {
<a name="l01203"></a>01203                 pstate = 0;
<a name="l01204"></a>01204                 <span class="keywordflow">continue</span>;
<a name="l01205"></a>01205             }
<a name="l01206"></a>01206             enc = te;           <span class="comment">/* Start of encoded packets */</span>
<a name="l01207"></a>01207             pstate++;
<a name="l01208"></a>01208             <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l01209"></a>01209         <span class="keywordflow">case</span> 2:
<a name="l01210"></a>01210             crcenc = NULL;
<a name="l01211"></a>01211             <span class="keywordflow">if</span> (*t != <span class="charliteral">'='</span>)
<a name="l01212"></a>01212                 <span class="keywordflow">continue</span>;
<a name="l01213"></a>01213             *t++ = <span class="charliteral">'\0'</span>;        <span class="comment">/* Terminate encoded packets */</span>
<a name="l01214"></a>01214             crcenc = t;         <span class="comment">/* Start of encoded crc */</span>
<a name="l01215"></a>01215             pstate++;
<a name="l01216"></a>01216             <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l01217"></a>01217         <span class="keywordflow">case</span> 3:
<a name="l01218"></a>01218             pstate = 0;
<a name="l01219"></a>01219             <span class="keywordflow">if</span> (!<a class="code" href="rpmpgp_8c.html#c0021971f7fdffaa47746d6851af0508">TOKEQ</a>(t, <span class="stringliteral">"-----END PGP "</span>)) {
<a name="l01220"></a>01220                 ec = <a class="code" href="rpmpgp_8h.html#8b921f71244ef324fd0e84fc2291007a368f0f98034eb7068328fe2f2e6db6e9">PGPARMOR_ERR_NO_END_PGP</a>;
<a name="l01221"></a>01221                 <span class="keywordflow">goto</span> exit;
<a name="l01222"></a>01222             }
<a name="l01223"></a>01223             *t = <span class="charliteral">'\0'</span>;          <span class="comment">/* Terminate encoded crc */</span>
<a name="l01224"></a>01224             t += <span class="keyword">sizeof</span>(<span class="stringliteral">"-----END PGP "</span>)-1;
<a name="l01225"></a>01225             <span class="keywordflow">if</span> (t &gt;= te) <span class="keywordflow">continue</span>;
<a name="l01226"></a>01226 
<a name="l01227"></a>01227             <span class="keywordflow">if</span> (armortype == NULL) <span class="comment">/* XXX can't happen */</span>
<a name="l01228"></a>01228                 <span class="keywordflow">continue</span>;
<a name="l01229"></a>01229             rc = strncmp(t, armortype, strlen(armortype));
<a name="l01230"></a>01230             <span class="keywordflow">if</span> (rc)
<a name="l01231"></a>01231                 <span class="keywordflow">continue</span>;
<a name="l01232"></a>01232 
<a name="l01233"></a>01233             t += strlen(armortype);
<a name="l01234"></a>01234             <span class="keywordflow">if</span> (t &gt;= te) <span class="keywordflow">continue</span>;
<a name="l01235"></a>01235 
<a name="l01236"></a>01236             <span class="keywordflow">if</span> (!<a class="code" href="rpmpgp_8c.html#c0021971f7fdffaa47746d6851af0508">TOKEQ</a>(t, <span class="stringliteral">"-----"</span>)) {
<a name="l01237"></a>01237                 ec = <a class="code" href="rpmpgp_8h.html#8b921f71244ef324fd0e84fc2291007a368f0f98034eb7068328fe2f2e6db6e9">PGPARMOR_ERR_NO_END_PGP</a>;
<a name="l01238"></a>01238                 <span class="keywordflow">goto</span> exit;
<a name="l01239"></a>01239             }
<a name="l01240"></a>01240             t += (<span class="keyword">sizeof</span>(<span class="stringliteral">"-----"</span>)-1);
<a name="l01241"></a>01241             <span class="keywordflow">if</span> (t &gt;= te) <span class="keywordflow">continue</span>;
<a name="l01242"></a>01242             <span class="comment">/* XXX permitting \r here is not RFC-2440 compliant &lt;shrug&gt; */</span>
<a name="l01243"></a>01243             <span class="keywordflow">if</span> (!(*t == <span class="charliteral">'\n'</span> || *t == <span class="charliteral">'\r'</span>)) <span class="keywordflow">continue</span>;
<a name="l01244"></a>01244 
<a name="l01245"></a>01245             crcdec = NULL;
<a name="l01246"></a>01246             crclen = 0;
<a name="l01247"></a>01247             <span class="keywordflow">if</span> (b64decode(crcenc, (<span class="keywordtype">void</span> **)&amp;crcdec, &amp;crclen) != 0) {
<a name="l01248"></a>01248                 ec = <a class="code" href="rpmpgp_8h.html#8b921f71244ef324fd0e84fc2291007a5a8782927794292e22e15b015f8527a2">PGPARMOR_ERR_CRC_DECODE</a>;
<a name="l01249"></a>01249                 <span class="keywordflow">goto</span> exit;
<a name="l01250"></a>01250             }
<a name="l01251"></a>01251             crcpkt = <a class="code" href="rpmpgp_8h.html#86d21d8e18146a24c553685163fce60e" title="Return (native-endian) integer from big-endian representation.">pgpGrab</a>(crcdec, crclen);
<a name="l01252"></a>01252             crcdec = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(crcdec);
<a name="l01253"></a>01253             dec = NULL;
<a name="l01254"></a>01254             declen = 0;
<a name="l01255"></a>01255             <span class="keywordflow">if</span> (b64decode(enc, (<span class="keywordtype">void</span> **)&amp;dec, &amp;declen) != 0) {
<a name="l01256"></a>01256                 ec = <a class="code" href="rpmpgp_8h.html#8b921f71244ef324fd0e84fc2291007afe864be7d83e7980132f2b5cd6262ef0">PGPARMOR_ERR_BODY_DECODE</a>;
<a name="l01257"></a>01257                 <span class="keywordflow">goto</span> exit;
<a name="l01258"></a>01258             }
<a name="l01259"></a>01259             crc = <a class="code" href="rpmpgp_8h.html#dbc7fd84a41518e16cdc1b189bab9cbb" title="Return CRC of a buffer.">pgpCRC</a>(dec, declen);
<a name="l01260"></a>01260             <span class="keywordflow">if</span> (crcpkt != crc) {
<a name="l01261"></a>01261                 ec = <a class="code" href="rpmpgp_8h.html#8b921f71244ef324fd0e84fc2291007a1a656d3b8bc1be33b8bff6e1cd7399db">PGPARMOR_ERR_CRC_CHECK</a>;
<a name="l01262"></a>01262                 <span class="keywordflow">goto</span> exit;
<a name="l01263"></a>01263             }
<a name="l01264"></a>01264             b = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(b);
<a name="l01265"></a>01265             b = dec;
<a name="l01266"></a>01266             blen = declen;
<a name="l01267"></a>01267             ec = <a class="code" href="rpmpgp_8h.html#8b921f71244ef324fd0e84fc2291007a76140d37cec0497e345db167f2f1d9df">PGPARMOR_PUBKEY</a>;       <span class="comment">/* XXX ASCII Pubkeys only, please. */</span>
<a name="l01268"></a>01268             <span class="keywordflow">goto</span> exit;
<a name="l01269"></a>01269             <span class="comment">/*@notreached@*/</span> <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l01270"></a>01270         }
<a name="l01271"></a>01271     }
<a name="l01272"></a>01272     ec = <a class="code" href="rpmpgp_8h.html#8b921f71244ef324fd0e84fc2291007af441222a4645b24b747bc7f828608d90">PGPARMOR_NONE</a>;
<a name="l01273"></a>01273 
<a name="l01274"></a>01274 exit:
<a name="l01275"></a>01275     <span class="keywordflow">if</span> (ec &gt; <a class="code" href="rpmpgp_8h.html#8b921f71244ef324fd0e84fc2291007af441222a4645b24b747bc7f828608d90">PGPARMOR_NONE</a> &amp;&amp; pkt)
<a name="l01276"></a>01276         *pkt = b;
<a name="l01277"></a>01277     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (b != NULL)
<a name="l01278"></a>01278         b = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(b);
<a name="l01279"></a>01279     <span class="keywordflow">if</span> (pktlen)
<a name="l01280"></a>01280         *pktlen = blen;
<a name="l01281"></a>01281     <span class="keywordflow">return</span> ec;
<a name="l01282"></a>01282 }
<a name="l01283"></a>01283 <span class="comment">/*@=boundswrite@*/</span>
<a name="l01284"></a>01284 
<a name="l01285"></a><a class="code" href="rpmpgp_8h.html#4f02706d3dcadf63e938083116c5099e">01285</a> <span class="keywordtype">char</span> * <a class="code" href="rpmpgp_8c.html#4f02706d3dcadf63e938083116c5099e" title="Wrap a OpenPGP packets in ascii armor for transport.">pgpArmorWrap</a>(<span class="keywordtype">int</span> atype, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * s, <span class="keywordtype">size_t</span> ns)
<a name="l01286"></a>01286 {
<a name="l01287"></a>01287     <span class="keyword">const</span> <span class="keywordtype">char</span> * enc;
<a name="l01288"></a>01288     <span class="keywordtype">char</span> * t;
<a name="l01289"></a>01289     <span class="keywordtype">size_t</span> nt;
<a name="l01290"></a>01290     <span class="keywordtype">char</span> * <a class="code" href="structpgpValTbl__s.html#5781d8878d6c2d0e0e183277e1a6c5fa">val</a>;
<a name="l01291"></a>01291     <span class="keywordtype">int</span> lc;
<a name="l01292"></a>01292 
<a name="l01293"></a>01293     nt = ((ns + 2) / 3) * 4;
<a name="l01294"></a>01294     <span class="comment">/*@-globs@*/</span>
<a name="l01295"></a>01295     <span class="comment">/* Add additional bytes necessary for eol string(s). */</span>
<a name="l01296"></a>01296     <span class="keywordflow">if</span> (b64encode_chars_per_line &gt; 0 &amp;&amp; b64encode_eolstr != NULL) {
<a name="l01297"></a>01297         lc = (nt + b64encode_chars_per_line - 1) / b64encode_chars_per_line;
<a name="l01298"></a>01298        <span class="keywordflow">if</span> (((nt + b64encode_chars_per_line - 1) % b64encode_chars_per_line) != 0)
<a name="l01299"></a>01299         ++lc;
<a name="l01300"></a>01300         nt += lc * strlen(b64encode_eolstr);
<a name="l01301"></a>01301     }
<a name="l01302"></a>01302     <span class="comment">/*@=globs@*/</span>
<a name="l01303"></a>01303 
<a name="l01304"></a>01304     nt += 512;  <span class="comment">/* XXX slop for armor and crc */</span>
<a name="l01305"></a>01305 
<a name="l01306"></a>01306 <span class="comment">/*@-boundswrite@*/</span>
<a name="l01307"></a>01307     val = t = <a class="code" href="system_8h.html#2ff4ef58da7e543466e75f20f2a2d8b7">xmalloc</a>(nt + 1);
<a name="l01308"></a>01308     *t = <span class="charliteral">'\0'</span>;
<a name="l01309"></a>01309     t = <a class="code" href="system_8h.html#58841684f76853b313e27e663c850381">stpcpy</a>(t, <span class="stringliteral">"-----BEGIN PGP "</span>);
<a name="l01310"></a>01310     t = <a class="code" href="system_8h.html#58841684f76853b313e27e663c850381">stpcpy</a>(t, <a class="code" href="rpmpgp_8h.html#6c3c06a197ceb4b4b93a3ed0ade7f184" title="Return string representation of am OpenPGP value.">pgpValStr</a>(<a class="code" href="rpmpgp_8c.html#a065c28e76b412c383b6932e09966f36" title="Armor (string, value) pairs.">pgpArmorTbl</a>, atype));
<a name="l01311"></a>01311     <span class="comment">/*@-globs@*/</span>
<a name="l01312"></a>01312     t = <a class="code" href="system_8h.html#58841684f76853b313e27e663c850381">stpcpy</a>( <a class="code" href="system_8h.html#58841684f76853b313e27e663c850381">stpcpy</a>(t, <span class="stringliteral">"-----\nVersion: rpm-"</span>), <a class="code" href="config_8h.html#d50944c12fe46b051e56ecff63a08c17">VERSION</a>);
<a name="l01313"></a>01313     <span class="comment">/*@=globs@*/</span>
<a name="l01314"></a>01314     t = <a class="code" href="system_8h.html#58841684f76853b313e27e663c850381">stpcpy</a>(t, <span class="stringliteral">" (beecrypt-4.1.2)\n\n"</span>);
<a name="l01315"></a>01315 
<a name="l01316"></a>01316     <span class="keywordflow">if</span> ((enc = b64encode(s, ns)) != NULL) {
<a name="l01317"></a>01317         t = <a class="code" href="system_8h.html#58841684f76853b313e27e663c850381">stpcpy</a>(t, enc);
<a name="l01318"></a>01318         enc = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(enc);
<a name="l01319"></a>01319         <span class="keywordflow">if</span> ((enc = b64crc(s, ns)) != NULL) {
<a name="l01320"></a>01320             *t++ = <span class="charliteral">'='</span>;
<a name="l01321"></a>01321             t = <a class="code" href="system_8h.html#58841684f76853b313e27e663c850381">stpcpy</a>(t, enc);
<a name="l01322"></a>01322             enc = <a class="code" href="rpmlib_8h.html#d608c2923552dbeeb832133a9a289bb7" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(enc);
<a name="l01323"></a>01323         }
<a name="l01324"></a>01324     }
<a name="l01325"></a>01325         
<a name="l01326"></a>01326     t = <a class="code" href="system_8h.html#58841684f76853b313e27e663c850381">stpcpy</a>(t, <span class="stringliteral">"-----END PGP "</span>);
<a name="l01327"></a>01327     t = <a class="code" href="system_8h.html#58841684f76853b313e27e663c850381">stpcpy</a>(t, <a class="code" href="rpmpgp_8h.html#6c3c06a197ceb4b4b93a3ed0ade7f184" title="Return string representation of am OpenPGP value.">pgpValStr</a>(<a class="code" href="rpmpgp_8c.html#a065c28e76b412c383b6932e09966f36" title="Armor (string, value) pairs.">pgpArmorTbl</a>, atype));
<a name="l01328"></a>01328     t = <a class="code" href="system_8h.html#58841684f76853b313e27e663c850381">stpcpy</a>(t, <span class="stringliteral">"-----\n"</span>);
<a name="l01329"></a>01329 <span class="comment">/*@=boundswrite@*/</span>
<a name="l01330"></a>01330 
<a name="l01331"></a>01331     <span class="keywordflow">return</span> val;
<a name="l01332"></a>01332 }
<a name="l01333"></a>01333 
<a name="l01334"></a>01334 <span class="comment">/*@=boundsread@*/</span>
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Fri Oct 12 08:44:54 2007 for rpm by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
